package uniswap_test

import (
	"context"
	"math/big"
	"testing"

	"github.com/ethereum/go-ethereum/common"
	"github.com/ethereum/go-ethereum/common/hexutil"
	"github.com/rss3-network/node/v2/config"
	source "github.com/rss3-network/node/v2/internal/engine/protocol/ethereum"
	worker "github.com/rss3-network/node/v2/internal/engine/worker/decentralized/contract/uniswap"
	"github.com/rss3-network/node/v2/provider/ethereum"
	"github.com/rss3-network/node/v2/provider/ethereum/contract/uniswap"
	"github.com/rss3-network/node/v2/provider/ethereum/endpoint"
	workerx "github.com/rss3-network/node/v2/schema/worker/decentralized"
	activityx "github.com/rss3-network/protocol-go/schema/activity"
	"github.com/rss3-network/protocol-go/schema/metadata"
	"github.com/rss3-network/protocol-go/schema/network"
	"github.com/rss3-network/protocol-go/schema/typex"
	"github.com/samber/lo"
	"github.com/shopspring/decimal"
	"github.com/stretchr/testify/require"
)

func TestWorker_Ethereum(t *testing.T) {
	t.Parallel()

	type arguments struct {
		task   *source.Task
		config *config.Module
	}

	testcases := []struct {
		name      string
		arguments arguments
		want      *activityx.Activity
		wantError require.ErrorAssertionFunc
	}{
		{
			name: "Swap RAI for DAI on Universal Router",
			arguments: arguments{
				task: &source.Task{
					Network: network.Ethereum,
					ChainID: 1,
					Header: &ethereum.Header{
						Hash:         common.HexToHash("0x04eea124abdeed2a6c9676e71631a2bf0c8850babacd302517e3ce2534421b2c"),
						ParentHash:   common.HexToHash("0x49495451b1f8987f2ea7970429eaaf882f0e7102a8b06e73e6a3c76c320ae8b2"),
						UncleHash:    common.HexToHash("0x1dcc4de8dec75d7aab85b567b6ccd41ad312451b948a7413f0a142fd40d49347"),
						Coinbase:     common.HexToAddress("0xDAFEA492D9c6733ae3d56b7Ed1ADB60692c98Bc5"),
						Number:       lo.Must(new(big.Int).SetString("16803370", 0)),
						GasLimit:     30000000,
						GasUsed:      11563128,
						Timestamp:    1678519847,
						BaseFee:      lo.Must(new(big.Int).SetString("326898794882", 0)),
						Transactions: nil,
					},
					Transaction: &ethereum.Transaction{
						BlockHash: common.HexToHash("0x872ef1fca3aacd6ef892511edbc72d79917a59026dfb792d64f4f7c3f1bcdc5c"),
						From:      common.HexToAddress("0xd8dA6BF26964aF9D7eEd9e03E53415D37aA96045"),
						Gas:       322240,
						GasPrice:  lo.Must(new(big.Int).SetString("328898794882", 10)),
						Hash:      common.HexToHash("0x872ef1fca3aacd6ef892511edbc72d79917a59026dfb792d64f4f7c3f1bcdc5c"),
						Input:     hexutil.MustDecode("0x3593564c000000000000000000000000000000000000000000000000000000000000006000000000000000000000000000000000000000000000000000000000000000a000000000000000000000000000000000000000000000000000000000640c350b00000000000000000000000000000000000000000000000000000000000000010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000100000000000000000000000000000000000000000000000000000000000000200000000000000000000000000000000000000000000000000000000000000100000000000000000000000000000000000000000000000000000000000000000100000000000000000000000000000000000000000000021e19e0c9bab24000000000000000000000000000000000000000000000000005c149c4fb1e893cd58f00000000000000000000000000000000000000000000000000000000000000a00000000000000000000000000000000000000000000000000000000000000001000000000000000000000000000000000000000000000000000000000000002b03ab458634910aad20ef5f1c8ee96f1d6ac549190001f46b175474e89094c44da98b954eedeac495271d0f000000000000000000000000000000000000000000"),
						To:        lo.ToPtr(common.HexToAddress("0xEf1c6E67703c7BD7107eed8303Fbe6EC2554BF6B")),
						Value:     lo.Must(new(big.Int).SetString("0", 0)),
						Type:      2,
						ChainID:   lo.Must(new(big.Int).SetString("1", 0)),
					},
					Receipt: &ethereum.Receipt{
						BlockHash:         common.HexToHash("0x04eea124abdeed2a6c9676e71631a2bf0c8850babacd302517e3ce2534421b2c"),
						BlockNumber:       lo.Must(new(big.Int).SetString("16803370", 0)),
						ContractAddress:   nil,
						CumulativeGasUsed: 1172888,
						EffectiveGasPrice: hexutil.MustDecodeBig("0x4c93e55582"),
						GasUsed:           159508,
						Logs: []*ethereum.Log{
							{
								Address: common.HexToAddress("0x6B175474E89094C44Da98b954EedeAC495271d0F"),
								Topics: []common.Hash{
									common.HexToHash("0xddf252ad1be2c89b69c2b068fc378daa952ba7f163c4a11628f55a4df523b3ef"),
									common.HexToHash("0x000000000000000000000000cb0c5d9d92f4f2f80cce7aa271a1e148c226e19d"),
									common.HexToHash("0x000000000000000000000000d8da6bf26964af9d7eed9e03e53415d37aa96045"),
								},
								Data:            hexutil.MustDecode("0x0000000000000000000000000000000000000000000005c15ac95ff1ff92e518"),
								BlockNumber:     lo.Must(new(big.Int).SetString("16803370", 0)),
								TransactionHash: common.HexToHash("0x872ef1fca3aacd6ef892511edbc72d79917a59026dfb792d64f4f7c3f1bcdc5c"),
								Index:           22,
								Removed:         false,
							},
							{
								Address: common.HexToAddress("0x03ab458634910AaD20eF5f1C8ee96F1D6ac54919"),
								Topics: []common.Hash{
									common.HexToHash("0xddf252ad1be2c89b69c2b068fc378daa952ba7f163c4a11628f55a4df523b3ef"),
									common.HexToHash("0x000000000000000000000000d8da6bf26964af9d7eed9e03e53415d37aa96045"),
									common.HexToHash("0x000000000000000000000000cb0c5d9d92f4f2f80cce7aa271a1e148c226e19d"),
								},
								Data:            hexutil.MustDecode("0x00000000000000000000000000000000000000000000021e19e0c9bab2400000"),
								BlockNumber:     lo.Must(new(big.Int).SetString("16803370", 0)),
								TransactionHash: common.HexToHash("0x872ef1fca3aacd6ef892511edbc72d79917a59026dfb792d64f4f7c3f1bcdc5c"),
								Index:           23,
								Removed:         false,
							},
							{
								Address: common.HexToAddress("0xcB0C5d9D92f4F2F80cce7aa271a1E148c226e19D"),
								Topics: []common.Hash{
									common.HexToHash("0xc42079f94a6350d7e6235f29174924f928cc2ac818eb64fed8004e115fbcca67"),
									common.HexToHash("0x000000000000000000000000ef1c6e67703c7bd7107eed8303fbe6ec2554bf6b"),
									common.HexToHash("0x000000000000000000000000d8da6bf26964af9d7eed9e03e53415d37aa96045"),
								},
								Data:            hexutil.MustDecode("0x00000000000000000000000000000000000000000000021e19e0c9bab2400000fffffffffffffffffffffffffffffffffffffffffffffa3ea536a00e006d1ae80000000000000000000000000000000000000001a1504276fbc51f11f625673a00000000000000000000000000000000000000000000918355d1b5d0bb617733000000000000000000000000000000000000000000000000000000000000262d"),
								BlockNumber:     lo.Must(new(big.Int).SetString("16803370", 0)),
								TransactionHash: common.HexToHash("0x872ef1fca3aacd6ef892511edbc72d79917a59026dfb792d64f4f7c3f1bcdc5c"),
								Index:           24,
								Removed:         false,
							},
						},
						Status:           1,
						TransactionHash:  common.HexToHash("0x872ef1fca3aacd6ef892511edbc72d79917a59026dfb792d64f4f7c3f1bcdc5c"),
						TransactionIndex: 4,
					},
				},
				config: &config.Module{
					Network: network.Ethereum,
					Endpoint: config.Endpoint{
						URL: endpoint.MustGet(network.Ethereum),
					},
				},
			},
			want: &activityx.Activity{
				ID:      "0x872ef1fca3aacd6ef892511edbc72d79917a59026dfb792d64f4f7c3f1bcdc5c",
				Network: network.Ethereum,
				Index:   4,
				From:    "0xd8dA6BF26964aF9D7eEd9e03E53415D37aA96045",
				To:      uniswap.AddressUniversalRouter02.String(),
				Type:    typex.ExchangeSwap,
				Calldata: &activityx.Calldata{
					FunctionHash: "0x3593564c",
				},
				Platform: workerx.PlatformUniswap.String(),
				Fee: &activityx.Fee{
					Amount:  lo.Must(decimal.NewFromString("52461988974038056")),
					Decimal: 18,
				},
				Actions: []*activityx.Action{
					{
						Type:     typex.ExchangeSwap,
						Platform: workerx.PlatformUniswap.String(),
						From:     "0xd8dA6BF26964aF9D7eEd9e03E53415D37aA96045",
						To:       "0xd8dA6BF26964aF9D7eEd9e03E53415D37aA96045",
						Metadata: metadata.ExchangeSwap{
							From: metadata.Token{
								Address:  lo.ToPtr("0x03ab458634910AaD20eF5f1C8ee96F1D6ac54919"),
								Value:    lo.ToPtr(lo.Must(decimal.NewFromString("10000000000000000000000"))),
								Name:     "Rai Reflex Index",
								Symbol:   "RAI",
								Decimals: 18,
								Standard: metadata.StandardERC20,
							},
							To: metadata.Token{
								Address:  lo.ToPtr("0x6B175474E89094C44Da98b954EedeAC495271d0F"),
								Value:    lo.ToPtr(lo.Must(decimal.NewFromString("27178595886000881460504"))),
								Name:     "Dai Stablecoin",
								Symbol:   "DAI",
								Decimals: 18,
								Standard: metadata.StandardERC20,
							},
						},
					},
				},
				Status:    true,
				Timestamp: 1678519847,
			},
			wantError: require.NoError,
		},
		{
			name: "Swap LUSD for WETH on Universal Router",
			arguments: arguments{
				task: &source.Task{
					Network: network.Ethereum,
					ChainID: 1,
					Header: &ethereum.Header{
						Hash:         common.HexToHash("0x3502faead807c1d9755406ca713d88f2fc35a2e44a6aa1ebad07f3ea356eda6f"),
						ParentHash:   common.HexToHash("0x9e74e3e18471f236c127d889642053baf75c31c52d2a6454527455f8847dfc24"),
						UncleHash:    common.HexToHash("0x1dcc4de8dec75d7aab85b567b6ccd41ad312451b948a7413f0a142fd40d49347"),
						Coinbase:     common.HexToAddress("0x70D5cCC14a1a264c05Ff48B3ec6751b0959541aA"),
						Number:       lo.Must(new(big.Int).SetString("17525252", 0)),
						GasLimit:     30000000,
						GasUsed:      20998344,
						Timestamp:    1687316771,
						BaseFee:      lo.Must(new(big.Int).SetString("13446942426", 0)),
						Transactions: nil,
					},
					Transaction: &ethereum.Transaction{
						BlockHash: common.HexToHash("0xf5f4c7b09fe2bc00b16506c285e9e4a03116775ad0c35164104f1b49beb9fa81"),
						From:      common.HexToAddress("0xB5A7c3f565f0DFDb4EE63d0ca4b4d59fa69c391C"),
						Gas:       359295,
						GasPrice:  lo.Must(new(big.Int).SetString("15446942426", 10)),
						Hash:      common.HexToHash("0xf5f4c7b09fe2bc00b16506c285e9e4a03116775ad0c35164104f1b49beb9fa81"),
						Input:     hexutil.MustDecode("0x24856bc30000000000000000000000000000000000000000000000000000000000000040000000000000000000000000000000000000000000000000000000000000008000000000000000000000000000000000000000000000000000000000000000030a000c00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000003000000000000000000000000000000000000000000000000000000000000006000000000000000000000000000000000000000000000000000000000000001e0000000000000000000000000000000000000000000000000000000000000032000000000000000000000000000000000000000000000000000000000000001600000000000000000000000005f98805a4e8be255a32880fdec7f6728c6568ba0000000000000000000000000ffffffffffffffffffffffffffffffffffffffff0000000000000000000000000000000000000000000000000000000064b9f60e0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000ef1c6e67703c7bd7107eed8303fbe6ec2554bf6b000000000000000000000000000000000000000000000000000000006492701600000000000000000000000000000000000000000000000000000000000000e0000000000000000000000000000000000000000000000000000000000000004105d0b5dd0fbe7aed89ab3770eac56f01ff2ec77db74dcedbc0579fa239179eff0cd0b777287055b1c2bce6ebc7f8f1924ec5abc274a9691934dea00ffc557bd21c00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000012000000000000000000000000000000000000000000000000000000000000000020000000000000000000000000000000000000000000000253029956a8df80000000000000000000000000000000000000000000000000000053df9628c95e7c100000000000000000000000000000000000000000000000000000000000000a0000000000000000000000000000000000000000000000000000000000000000100000000000000000000000000000000000000000000000000000000000000425f98805a4e8be255a32880fdec7f6728c6568ba00001f4a0b86991c6218b36c1d19d4a2e9eb0ce3606eb480001f4c02aaa39b223fe8d0a0e5c4f27ead9083c756cc20000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000040000000000000000000000000b5a7c3f565f0dfdb4ee63d0ca4b4d59fa69c391c000000000000000000000000000000000000000000000000053df9628c95e7c1"),
						To:        lo.ToPtr(common.HexToAddress("0xEf1c6E67703c7BD7107eed8303Fbe6EC2554BF6B")),
						Value:     lo.Must(new(big.Int).SetString("0", 0)),
						Type:      2,
						ChainID:   lo.Must(new(big.Int).SetString("1", 0)),
					},
					Receipt: &ethereum.Receipt{
						BlockHash:         common.HexToHash("0x3502faead807c1d9755406ca713d88f2fc35a2e44a6aa1ebad07f3ea356eda6f"),
						BlockNumber:       lo.Must(new(big.Int).SetString("17525252", 0)),
						ContractAddress:   nil,
						CumulativeGasUsed: 5059070,
						EffectiveGasPrice: hexutil.MustDecodeBig("0x398b5a2da"),
						GasUsed:           248473,
						Logs: []*ethereum.Log{
							{
								Address: common.HexToAddress("0x000000000022D473030F116dDEE9F6B43aC78BA3"),
								Topics: []common.Hash{
									common.HexToHash("0xc6a377bfc4eb120024a8ac08eef205be16b817020812c73223e81d1bdb9708ec"),
									common.HexToHash("0x000000000000000000000000b5a7c3f565f0dfdb4ee63d0ca4b4d59fa69c391c"),
									common.HexToHash("0x0000000000000000000000005f98805a4e8be255a32880fdec7f6728c6568ba0"),
									common.HexToHash("0x000000000000000000000000ef1c6e67703c7bd7107eed8303fbe6ec2554bf6b"),
								},
								Data:            hexutil.MustDecode("0x000000000000000000000000ffffffffffffffffffffffffffffffffffffffff0000000000000000000000000000000000000000000000000000000064b9f60e0000000000000000000000000000000000000000000000000000000000000000"),
								BlockNumber:     lo.Must(new(big.Int).SetString("17525252", 0)),
								TransactionHash: common.HexToHash("0xf5f4c7b09fe2bc00b16506c285e9e4a03116775ad0c35164104f1b49beb9fa81"),
								Index:           86,
								Removed:         false,
							},
							{
								Address: common.HexToAddress("0xA0b86991c6218b36c1d19D4a2e9Eb0cE3606eB48"),
								Topics: []common.Hash{
									common.HexToHash("0xddf252ad1be2c89b69c2b068fc378daa952ba7f163c4a11628f55a4df523b3ef"),
									common.HexToHash("0x0000000000000000000000004e0924d3a751be199c426d52fb1f2337fa96f736"),
									common.HexToHash("0x000000000000000000000000ef1c6e67703c7bd7107eed8303fbe6ec2554bf6b"),
								},
								Data:            hexutil.MustDecode("0x00000000000000000000000000000000000000000000000000000000290fe48b"),
								BlockNumber:     lo.Must(new(big.Int).SetString("17525252", 0)),
								TransactionHash: common.HexToHash("0xf5f4c7b09fe2bc00b16506c285e9e4a03116775ad0c35164104f1b49beb9fa81"),
								Index:           87,
								Removed:         false,
							},
							{
								Address: common.HexToAddress("0x5f98805A4E8be255a32880FDeC7F6728C6568bA0"),
								Topics: []common.Hash{
									common.HexToHash("0xddf252ad1be2c89b69c2b068fc378daa952ba7f163c4a11628f55a4df523b3ef"),
									common.HexToHash("0x000000000000000000000000b5a7c3f565f0dfdb4ee63d0ca4b4d59fa69c391c"),
									common.HexToHash("0x0000000000000000000000004e0924d3a751be199c426d52fb1f2337fa96f736"),
								},
								Data:            hexutil.MustDecode("0x0000000000000000000000000000000000000000000000253029956a8df80000"),
								BlockNumber:     lo.Must(new(big.Int).SetString("17525252", 0)),
								TransactionHash: common.HexToHash("0xf5f4c7b09fe2bc00b16506c285e9e4a03116775ad0c35164104f1b49beb9fa81"),
								Index:           88,
								Removed:         false,
							},
							{
								Address: common.HexToAddress("0x5f98805A4E8be255a32880FDeC7F6728C6568bA0"),
								Topics: []common.Hash{
									common.HexToHash("0x8c5be1e5ebec7d5bd14f71427d1e84f3dd0314c0f7b2291e5b200ac8c7c3b925"),
									common.HexToHash("0x000000000000000000000000b5a7c3f565f0dfdb4ee63d0ca4b4d59fa69c391c"),
									common.HexToHash("0x000000000000000000000000000000000022d473030f116ddee9f6b43ac78ba3"),
								},
								Data:            hexutil.MustDecode("0xffffffffffffffffffffffffffffffffffffffffffffffdacfd66a957207ffff"),
								BlockNumber:     lo.Must(new(big.Int).SetString("17525252", 0)),
								TransactionHash: common.HexToHash("0xf5f4c7b09fe2bc00b16506c285e9e4a03116775ad0c35164104f1b49beb9fa81"),
								Index:           89,
								Removed:         false,
							},
							{
								Address: common.HexToAddress("0x4e0924d3a751bE199C426d52fb1f2337fa96f736"),
								Topics: []common.Hash{
									common.HexToHash("0xc42079f94a6350d7e6235f29174924f928cc2ac818eb64fed8004e115fbcca67"),
									common.HexToHash("0x000000000000000000000000ef1c6e67703c7bd7107eed8303fbe6ec2554bf6b"),
									common.HexToHash("0x000000000000000000000000ef1c6e67703c7bd7107eed8303fbe6ec2554bf6b"),
								},
								Data:            hexutil.MustDecode("0x0000000000000000000000000000000000000000000000253029956a8df80000ffffffffffffffffffffffffffffffffffffffffffffffffffffffffd6f01b750000000000000000000000000000000000000000000010d121ee4a5ea212dbef00000000000000000000000000000000000000000000001aa7e98affd592f9f2fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffbc8cb"),
								BlockNumber:     lo.Must(new(big.Int).SetString("17525252", 0)),
								TransactionHash: common.HexToHash("0xf5f4c7b09fe2bc00b16506c285e9e4a03116775ad0c35164104f1b49beb9fa81"),
								Index:           90,
								Removed:         false,
							},
							{
								Address: common.HexToAddress("0xC02aaA39b223FE8D0A0e5C4F27eAD9083C756Cc2"),
								Topics: []common.Hash{
									common.HexToHash("0xddf252ad1be2c89b69c2b068fc378daa952ba7f163c4a11628f55a4df523b3ef"),
									common.HexToHash("0x00000000000000000000000088e6a0c2ddd26feeb64f039a2c41296fcb3f5640"),
									common.HexToHash("0x000000000000000000000000ef1c6e67703c7bd7107eed8303fbe6ec2554bf6b"),
								},
								Data:            hexutil.MustDecode("0x00000000000000000000000000000000000000000000000005482cf17451b14f"),
								BlockNumber:     lo.Must(new(big.Int).SetString("17525252", 0)),
								TransactionHash: common.HexToHash("0xf5f4c7b09fe2bc00b16506c285e9e4a03116775ad0c35164104f1b49beb9fa81"),
								Index:           91,
								Removed:         false,
							},
							{
								Address: common.HexToAddress("0xA0b86991c6218b36c1d19D4a2e9Eb0cE3606eB48"),
								Topics: []common.Hash{
									common.HexToHash("0xddf252ad1be2c89b69c2b068fc378daa952ba7f163c4a11628f55a4df523b3ef"),
									common.HexToHash("0x000000000000000000000000ef1c6e67703c7bd7107eed8303fbe6ec2554bf6b"),
									common.HexToHash("0x00000000000000000000000088e6a0c2ddd26feeb64f039a2c41296fcb3f5640"),
								},
								Data:            hexutil.MustDecode("0x00000000000000000000000000000000000000000000000000000000290fe48b"),
								BlockNumber:     lo.Must(new(big.Int).SetString("17525252", 0)),
								TransactionHash: common.HexToHash("0xf5f4c7b09fe2bc00b16506c285e9e4a03116775ad0c35164104f1b49beb9fa81"),
								Index:           92,
								Removed:         false,
							},
							{
								Address: common.HexToAddress("0x88e6A0c2dDD26FEEb64F039a2c41296FcB3f5640"),
								Topics: []common.Hash{
									common.HexToHash("0xc42079f94a6350d7e6235f29174924f928cc2ac818eb64fed8004e115fbcca67"),
									common.HexToHash("0x000000000000000000000000ef1c6e67703c7bd7107eed8303fbe6ec2554bf6b"),
									common.HexToHash("0x000000000000000000000000ef1c6e67703c7bd7107eed8303fbe6ec2554bf6b"),
								},
								Data:            hexutil.MustDecode("0x00000000000000000000000000000000000000000000000000000000290fe48bfffffffffffffffffffffffffffffffffffffffffffffffffab7d30e8bae4eb10000000000000000000000000000000000005bd6a439d2b10ace3baaed2469ad000000000000000000000000000000000000000000000001704dcd5233cf79c40000000000000000000000000000000000000000000000000000000000031262"),
								BlockNumber:     lo.Must(new(big.Int).SetString("17525252", 0)),
								TransactionHash: common.HexToHash("0xf5f4c7b09fe2bc00b16506c285e9e4a03116775ad0c35164104f1b49beb9fa81"),
								Index:           93,
								Removed:         false,
							},
							{
								Address: common.HexToAddress("0xC02aaA39b223FE8D0A0e5C4F27eAD9083C756Cc2"),
								Topics: []common.Hash{
									common.HexToHash("0x7fcf532c15f0a6db0bd6d0e038bea71d30d808c7d98cb3bf7268a95bf5081b65"),
									common.HexToHash("0x000000000000000000000000ef1c6e67703c7bd7107eed8303fbe6ec2554bf6b"),
								},
								Data:            hexutil.MustDecode("0x00000000000000000000000000000000000000000000000005482cf17451b14f"),
								BlockNumber:     lo.Must(new(big.Int).SetString("17525252", 0)),
								TransactionHash: common.HexToHash("0xf5f4c7b09fe2bc00b16506c285e9e4a03116775ad0c35164104f1b49beb9fa81"),
								Index:           94,
								Removed:         false,
							},
						},
						Status:           1,
						TransactionHash:  common.HexToHash("0xf5f4c7b09fe2bc00b16506c285e9e4a03116775ad0c35164104f1b49beb9fa81"),
						TransactionIndex: 113,
					},
				},
				config: &config.Module{
					Network: network.Ethereum,
					Endpoint: config.Endpoint{
						URL: endpoint.MustGet(network.Ethereum),
					},
				},
			},
			want: &activityx.Activity{
				ID:      "0xf5f4c7b09fe2bc00b16506c285e9e4a03116775ad0c35164104f1b49beb9fa81",
				Network: network.Ethereum,
				Index:   113,
				From:    "0xB5A7c3f565f0DFDb4EE63d0ca4b4d59fa69c391C",
				To:      uniswap.AddressUniversalRouter02.String(),
				Type:    typex.ExchangeSwap,
				Calldata: &activityx.Calldata{
					FunctionHash: "0x24856bc3",
				},
				Platform: workerx.PlatformUniswap.String(),
				Fee: &activityx.Fee{
					Amount:  lo.Must(decimal.NewFromString("3838148125415498")),
					Decimal: 18,
				},
				Actions: []*activityx.Action{
					{
						Type:     typex.ExchangeSwap,
						Platform: workerx.PlatformUniswap.String(),
						From:     "0xB5A7c3f565f0DFDb4EE63d0ca4b4d59fa69c391C",
						To:       uniswap.AddressUniversalRouter02.String(),
						Metadata: metadata.ExchangeSwap{
							From: metadata.Token{
								Address:  lo.ToPtr("0x5f98805A4E8be255a32880FDeC7F6728C6568bA0"),
								Value:    lo.ToPtr(lo.Must(decimal.NewFromString("686000000000000000000"))),
								Name:     "LUSD Stablecoin",
								Symbol:   "LUSD",
								Decimals: 18,
								Standard: metadata.StandardERC20,
							},
							To: metadata.Token{
								Address:  lo.ToPtr("0xA0b86991c6218b36c1d19D4a2e9Eb0cE3606eB48"),
								Value:    lo.ToPtr(lo.Must(decimal.NewFromString("688907403"))),
								Name:     "USD Coin",
								Symbol:   "USDC",
								Decimals: 6,
								Standard: metadata.StandardERC20,
							},
						},
					},
					{
						Type:     typex.ExchangeSwap,
						Platform: workerx.PlatformUniswap.String(),
						From:     uniswap.AddressUniversalRouter02.String(),
						To:       uniswap.AddressUniversalRouter02.String(),
						Metadata: metadata.ExchangeSwap{
							From: metadata.Token{
								Address:  lo.ToPtr("0xA0b86991c6218b36c1d19D4a2e9Eb0cE3606eB48"),
								Value:    lo.ToPtr(lo.Must(decimal.NewFromString("688907403"))),
								Name:     "USD Coin",
								Symbol:   "USDC",
								Decimals: 6,
								Standard: metadata.StandardERC20,
							},
							To: metadata.Token{
								Address:  lo.ToPtr("0xC02aaA39b223FE8D0A0e5C4F27eAD9083C756Cc2"),
								Value:    lo.ToPtr(lo.Must(decimal.NewFromString("380603584063058255"))),
								Name:     "Wrapped Ether",
								Symbol:   "WETH",
								Decimals: 18,
								Standard: metadata.StandardERC20,
							},
						},
					},
					{
						Type:     typex.ExchangeSwap,
						Platform: workerx.PlatformUniswap.String(),
						From:     uniswap.AddressUniversalRouter02.String(),
						To:       "0xB5A7c3f565f0DFDb4EE63d0ca4b4d59fa69c391C",
						Metadata: metadata.ExchangeSwap{
							From: metadata.Token{
								Address:  lo.ToPtr("0xC02aaA39b223FE8D0A0e5C4F27eAD9083C756Cc2"),
								Value:    lo.ToPtr(lo.Must(decimal.NewFromString("380603584063058255"))),
								Name:     "Wrapped Ether",
								Symbol:   "WETH",
								Decimals: 18,
								Standard: metadata.StandardERC20,
							},
							To: metadata.Token{
								Value:    lo.ToPtr(lo.Must(decimal.NewFromString("380603584063058255"))),
								Name:     "Ethereum",
								Symbol:   "ETH",
								Decimals: 18,
							},
						},
					},
				},
				Status:    true,
				Timestamp: 1687316771,
			},
			wantError: require.NoError,
		},
		{
			name: "Swap DAI for ETH on Uniswap V2 Router 2",
			arguments: arguments{
				task: &source.Task{
					Network: network.Ethereum,
					ChainID: 1,
					Header: &ethereum.Header{
						Hash:         common.HexToHash("0x9960d6291f283a9dc0f23afd7aaab19b9121a654597585ba013bf769ac0af199"),
						ParentHash:   common.HexToHash("0x94f9eaba46340749840b9ec5fab7277a1007ab3c7ed207defc3be55886a55f55"),
						UncleHash:    common.HexToHash("0x1dcc4de8dec75d7aab85b567b6ccd41ad312451b948a7413f0a142fd40d49347"),
						Coinbase:     common.HexToAddress("0x388C818CA8B9251b393131C08a736A67ccB19297"),
						Number:       lo.Must(new(big.Int).SetString("17208992", 0)),
						GasLimit:     30000000,
						GasUsed:      22361006,
						Timestamp:    1683466475,
						BaseFee:      lo.Must(new(big.Int).SetString("99283541571", 0)),
						Transactions: nil,
					},
					Transaction: &ethereum.Transaction{
						BlockHash: common.HexToHash("0x50479c222eca9d12f041ee1df2db6f9b8b77bf52be4d45536ab2bf0e7578260f"),
						From:      common.HexToAddress("0xe18e3F6015840c3675Add0b82dF801Ebb7D621f3"),
						Gas:       215703,
						GasPrice:  lo.Must(new(big.Int).SetString("99333626634", 10)),
						Hash:      common.HexToHash("0x50479c222eca9d12f041ee1df2db6f9b8b77bf52be4d45536ab2bf0e7578260f"),
						Input:     hexutil.MustDecode("0x18cbafe50000000000000000000000000000000000000000000000333ada195aebfd903000000000000000000000000000000000000000000000000006c868d9242a74c600000000000000000000000000000000000000000000000000000000000000a0000000000000000000000000d8f47b07648f43cbcac55bb0bddbc46605290077000000000000000000000000000000000000000000000000000000006457afc600000000000000000000000000000000000000000000000000000000000000020000000000000000000000006b175474e89094c44da98b954eedeac495271d0f000000000000000000000000c02aaa39b223fe8d0a0e5c4f27ead9083c756cc2"),
						To:        lo.ToPtr(common.HexToAddress("0x7a250d5630B4cF539739dF2C5dAcb4c659F2488D")),
						Value:     lo.Must(new(big.Int).SetString("0", 0)),
						Type:      2,
						ChainID:   lo.Must(new(big.Int).SetString("1", 0)),
					},
					Receipt: &ethereum.Receipt{
						BlockHash:         common.HexToHash("0x9960d6291f283a9dc0f23afd7aaab19b9121a654597585ba013bf769ac0af199"),
						BlockNumber:       lo.Must(new(big.Int).SetString("17208992", 0)),
						ContractAddress:   nil,
						CumulativeGasUsed: 3541254,
						EffectiveGasPrice: hexutil.MustDecodeBig("0x1720bedb0a"),
						GasUsed:           113536,
						Logs: []*ethereum.Log{
							{
								Address: common.HexToAddress("0x6B175474E89094C44Da98b954EedeAC495271d0F"),
								Topics: []common.Hash{
									common.HexToHash("0xddf252ad1be2c89b69c2b068fc378daa952ba7f163c4a11628f55a4df523b3ef"),
									common.HexToHash("0x000000000000000000000000e18e3f6015840c3675add0b82df801ebb7d621f3"),
									common.HexToHash("0x000000000000000000000000a478c2975ab1ea89e8196811f51a7b7ade33eb11"),
								},
								Data:            hexutil.MustDecode("0x0000000000000000000000000000000000000000000000333ada195aebfd9030"),
								BlockNumber:     lo.Must(new(big.Int).SetString("17208992", 0)),
								TransactionHash: common.HexToHash("0x50479c222eca9d12f041ee1df2db6f9b8b77bf52be4d45536ab2bf0e7578260f"),
								Index:           125,
								Removed:         false,
							},
							{
								Address: common.HexToAddress("0xC02aaA39b223FE8D0A0e5C4F27eAD9083C756Cc2"),
								Topics: []common.Hash{
									common.HexToHash("0xddf252ad1be2c89b69c2b068fc378daa952ba7f163c4a11628f55a4df523b3ef"),
									common.HexToHash("0x000000000000000000000000a478c2975ab1ea89e8196811f51a7b7ade33eb11"),
									common.HexToHash("0x0000000000000000000000007a250d5630b4cf539739df2c5dacb4c659f2488d"),
								},
								Data:            hexutil.MustDecode("0x00000000000000000000000000000000000000000000000006d24d22ef47c1c6"),
								BlockNumber:     lo.Must(new(big.Int).SetString("17208992", 0)),
								TransactionHash: common.HexToHash("0x50479c222eca9d12f041ee1df2db6f9b8b77bf52be4d45536ab2bf0e7578260f"),
								Index:           126,
								Removed:         false,
							},
							{
								Address: common.HexToAddress("0xA478c2975Ab1Ea89e8196811F51A7B7Ade33eB11"),
								Topics: []common.Hash{
									common.HexToHash("0x1c411e9a96e071241c2f21f7726b17ae89e3cab4c78be50e062b03a9fffbbad1"),
								},
								Data:            hexutil.MustDecode("0x0000000000000000000000000000000000000000000677d224dc5ac09bad46500000000000000000000000000000000000000000000000dd1dde594b50af78cc"),
								BlockNumber:     lo.Must(new(big.Int).SetString("17208992", 0)),
								TransactionHash: common.HexToHash("0x50479c222eca9d12f041ee1df2db6f9b8b77bf52be4d45536ab2bf0e7578260f"),
								Index:           127,
								Removed:         false,
							},
							{
								Address: common.HexToAddress("0xA478c2975Ab1Ea89e8196811F51A7B7Ade33eB11"),
								Topics: []common.Hash{
									common.HexToHash("0xd78ad95fa46c994b6551d0da85fc275fe613ce37657fb8d5e3d130840159d822"),
									common.HexToHash("0x0000000000000000000000007a250d5630b4cf539739df2c5dacb4c659f2488d"),
									common.HexToHash("0x0000000000000000000000007a250d5630b4cf539739df2c5dacb4c659f2488d"),
								},
								Data:            hexutil.MustDecode("0x0000000000000000000000000000000000000000000000333ada195aebfd90300000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000006d24d22ef47c1c6"),
								BlockNumber:     lo.Must(new(big.Int).SetString("17208992", 0)),
								TransactionHash: common.HexToHash("0x50479c222eca9d12f041ee1df2db6f9b8b77bf52be4d45536ab2bf0e7578260f"),
								Index:           128,
								Removed:         false,
							},
							{
								Address: common.HexToAddress("0xC02aaA39b223FE8D0A0e5C4F27eAD9083C756Cc2"),
								Topics: []common.Hash{
									common.HexToHash("0x7fcf532c15f0a6db0bd6d0e038bea71d30d808c7d98cb3bf7268a95bf5081b65"),
									common.HexToHash("0x0000000000000000000000007a250d5630b4cf539739df2c5dacb4c659f2488d"),
								},
								Data:            hexutil.MustDecode("0x00000000000000000000000000000000000000000000000006d24d22ef47c1c6"),
								BlockNumber:     lo.Must(new(big.Int).SetString("17208992", 0)),
								TransactionHash: common.HexToHash("0x50479c222eca9d12f041ee1df2db6f9b8b77bf52be4d45536ab2bf0e7578260f"),
								Index:           129,
								Removed:         false,
							},
						},
						Status:           1,
						TransactionHash:  common.HexToHash("0x50479c222eca9d12f041ee1df2db6f9b8b77bf52be4d45536ab2bf0e7578260f"),
						TransactionIndex: 26,
					},
				},
				config: &config.Module{
					Network: network.Ethereum,
					Endpoint: config.Endpoint{
						URL: endpoint.MustGet(network.Ethereum),
					},
				},
			},
			want: &activityx.Activity{
				ID:      "0x50479c222eca9d12f041ee1df2db6f9b8b77bf52be4d45536ab2bf0e7578260f",
				Network: network.Ethereum,
				Index:   26,
				From:    "0xe18e3F6015840c3675Add0b82dF801Ebb7D621f3",
				To:      uniswap.AddressV2SwapRouter02.String(),
				Type:    typex.ExchangeSwap,
				Calldata: &activityx.Calldata{
					FunctionHash: "0x18cbafe5",
				},
				Platform: workerx.PlatformUniswap.String(),
				Fee: &activityx.Fee{
					Amount:  lo.Must(decimal.NewFromString("11277942633517824")),
					Decimal: 18,
				},
				Actions: []*activityx.Action{
					{
						Type:     typex.ExchangeSwap,
						Platform: workerx.PlatformUniswap.String(),
						From:     "0xe18e3F6015840c3675Add0b82dF801Ebb7D621f3",
						To:       uniswap.AddressV2SwapRouter02.String(),
						Metadata: metadata.ExchangeSwap{
							From: metadata.Token{
								Address:  lo.ToPtr("0x6B175474E89094C44Da98b954EedeAC495271d0F"),
								Value:    lo.ToPtr(lo.Must(decimal.NewFromString("945024677636606890032"))),
								Name:     "Dai Stablecoin",
								Symbol:   "DAI",
								Decimals: 18,
								Standard: metadata.StandardERC20,
							},
							To: metadata.Token{
								Address:  lo.ToPtr("0xC02aaA39b223FE8D0A0e5C4F27eAD9083C756Cc2"),
								Value:    lo.ToPtr(lo.Must(decimal.NewFromString("491540121775489478"))),
								Name:     "Wrapped Ether",
								Symbol:   "WETH",
								Decimals: 18,
								Standard: metadata.StandardERC20,
							},
						},
					},
					{
						Type:     typex.ExchangeSwap,
						Platform: workerx.PlatformUniswap.String(),
						From:     uniswap.AddressV2SwapRouter02.String(),
						To:       "0xe18e3F6015840c3675Add0b82dF801Ebb7D621f3",
						Metadata: metadata.ExchangeSwap{
							From: metadata.Token{
								Address:  lo.ToPtr("0xC02aaA39b223FE8D0A0e5C4F27eAD9083C756Cc2"),
								Value:    lo.ToPtr(lo.Must(decimal.NewFromString("491540121775489478"))),
								Name:     "Wrapped Ether",
								Symbol:   "WETH",
								Decimals: 18,
								Standard: metadata.StandardERC20,
							},
							To: metadata.Token{
								Value:    lo.ToPtr(lo.Must(decimal.NewFromString("491540121775489478"))),
								Name:     "Ethereum",
								Symbol:   "ETH",
								Decimals: 18,
							},
						},
					},
				},
				Status:    true,
				Timestamp: 1683466475,
			},
			wantError: require.NoError,
		},
		{
			name: "Remove DAI and ETH liquidity from Uniswap V2 Pair",
			arguments: arguments{
				task: &source.Task{
					Network: network.Ethereum,
					ChainID: 1,
					Header: &ethereum.Header{
						Hash:         common.HexToHash("0x1e52d78de7884ff78f3c0792902e32afb1146130df233d91afdd5ddf0abc7511"),
						ParentHash:   common.HexToHash("0x1a729094faa4b9b92e5b2532cda1c4e8ad3e727114b95f77cfdae001edcc2943"),
						UncleHash:    common.HexToHash("0x1dcc4de8dec75d7aab85b567b6ccd41ad312451b948a7413f0a142fd40d49347"),
						Coinbase:     common.HexToAddress("0x690B9A9E9aa1C9dB991C7721a92d351Db4FaC990"),
						Number:       lo.Must(new(big.Int).SetString("17261466", 0)),
						GasLimit:     30000000,
						GasUsed:      19158313,
						Timestamp:    1684108343,
						BaseFee:      lo.Must(new(big.Int).SetString("31042010247", 0)),
						Transactions: nil,
					},
					Transaction: &ethereum.Transaction{
						BlockHash: common.HexToHash("0xc59d2ed54f0ab05f4f40679aa1d32a6537ed75e4da8b496f8bee2c209186b335"),
						From:      common.HexToAddress("0x3E07f1C21024c1bdD2217e51E46C13C143B8aC12"),
						Gas:       311485,
						GasPrice:  lo.Must(new(big.Int).SetString("31130370247", 10)),
						Hash:      common.HexToHash("0xc59d2ed54f0ab05f4f40679aa1d32a6537ed75e4da8b496f8bee2c209186b335"),
						Input:     hexutil.MustDecode("0xded9382a0000000000000000000000006b175474e89094c44da98b954eedeac495271d0f0000000000000000000000000000000000000000000000008b5ef0df9ca4c1fa000000000000000000000000000000000000000000000027f606b2c9083d5bf400000000000000000000000000000000000000000000000005b15a898373f8a60000000000000000000000003e07f1c21024c1bdd2217e51e46c13c143b8ac120000000000000000000000000000000000000000000000000000000064617f170000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001cd9faf344c7ad575b71337cc6bcff4a5b8bdd8f98c473320e97c1e87133639c5b2da2ea5fa3041761fb53c3ed9edb0fe8b42057d818109c0af95f0c8008f7f9bb"),
						To:        lo.ToPtr(common.HexToAddress("0x7a250d5630B4cF539739dF2C5dAcb4c659F2488D")),
						Value:     lo.Must(new(big.Int).SetString("0", 0)),
						Type:      2,
						ChainID:   lo.Must(new(big.Int).SetString("1", 0)),
					},
					Receipt: &ethereum.Receipt{
						BlockHash:         common.HexToHash("0x1e52d78de7884ff78f3c0792902e32afb1146130df233d91afdd5ddf0abc7511"),
						BlockNumber:       lo.Must(new(big.Int).SetString("17261466", 0)),
						ContractAddress:   nil,
						CumulativeGasUsed: 18445202,
						EffectiveGasPrice: hexutil.MustDecodeBig("0x73f83c0c7"),
						GasUsed:           206007,
						Logs: []*ethereum.Log{
							{
								Address: common.HexToAddress("0xA478c2975Ab1Ea89e8196811F51A7B7Ade33eB11"),
								Topics: []common.Hash{
									common.HexToHash("0x8c5be1e5ebec7d5bd14f71427d1e84f3dd0314c0f7b2291e5b200ac8c7c3b925"),
									common.HexToHash("0x0000000000000000000000003e07f1c21024c1bdd2217e51e46c13c143b8ac12"),
									common.HexToHash("0x0000000000000000000000007a250d5630b4cf539739df2c5dacb4c659f2488d"),
								},
								Data:            hexutil.MustDecode("0x0000000000000000000000000000000000000000000000008b5ef0df9ca4c1fa"),
								BlockNumber:     lo.Must(new(big.Int).SetString("17261466", 0)),
								TransactionHash: common.HexToHash("0xc59d2ed54f0ab05f4f40679aa1d32a6537ed75e4da8b496f8bee2c209186b335"),
								Index:           462,
								Removed:         false,
							},
							{
								Address: common.HexToAddress("0xA478c2975Ab1Ea89e8196811F51A7B7Ade33eB11"),
								Topics: []common.Hash{
									common.HexToHash("0xddf252ad1be2c89b69c2b068fc378daa952ba7f163c4a11628f55a4df523b3ef"),
									common.HexToHash("0x0000000000000000000000003e07f1c21024c1bdd2217e51e46c13c143b8ac12"),
									common.HexToHash("0x000000000000000000000000a478c2975ab1ea89e8196811f51a7b7ade33eb11"),
								},
								Data:            hexutil.MustDecode("0x0000000000000000000000000000000000000000000000008b5ef0df9ca4c1fa"),
								BlockNumber:     lo.Must(new(big.Int).SetString("17261466", 0)),
								TransactionHash: common.HexToHash("0xc59d2ed54f0ab05f4f40679aa1d32a6537ed75e4da8b496f8bee2c209186b335"),
								Index:           463,
								Removed:         false,
							},
							{
								Address: common.HexToAddress("0xA478c2975Ab1Ea89e8196811F51A7B7Ade33eB11"),
								Topics: []common.Hash{
									common.HexToHash("0xddf252ad1be2c89b69c2b068fc378daa952ba7f163c4a11628f55a4df523b3ef"),
									common.HexToHash("0x000000000000000000000000a478c2975ab1ea89e8196811f51a7b7ade33eb11"),
									common.HexToHash("0x0000000000000000000000000000000000000000000000000000000000000000"),
								},
								Data:            hexutil.MustDecode("0x0000000000000000000000000000000000000000000000008b5ef0df9ca4c1fa"),
								BlockNumber:     lo.Must(new(big.Int).SetString("17261466", 0)),
								TransactionHash: common.HexToHash("0xc59d2ed54f0ab05f4f40679aa1d32a6537ed75e4da8b496f8bee2c209186b335"),
								Index:           464,
								Removed:         false,
							},
							{
								Address: common.HexToAddress("0x6B175474E89094C44Da98b954EedeAC495271d0F"),
								Topics: []common.Hash{
									common.HexToHash("0xddf252ad1be2c89b69c2b068fc378daa952ba7f163c4a11628f55a4df523b3ef"),
									common.HexToHash("0x000000000000000000000000a478c2975ab1ea89e8196811f51a7b7ade33eb11"),
									common.HexToHash("0x0000000000000000000000007a250d5630b4cf539739df2c5dacb4c659f2488d"),
								},
								Data:            hexutil.MustDecode("0x00000000000000000000000000000000000000000000002a1072d72474767bbe"),
								BlockNumber:     lo.Must(new(big.Int).SetString("17261466", 0)),
								TransactionHash: common.HexToHash("0xc59d2ed54f0ab05f4f40679aa1d32a6537ed75e4da8b496f8bee2c209186b335"),
								Index:           465,
								Removed:         false,
							},
							{
								Address: common.HexToAddress("0xC02aaA39b223FE8D0A0e5C4F27eAD9083C756Cc2"),
								Topics: []common.Hash{
									common.HexToHash("0xddf252ad1be2c89b69c2b068fc378daa952ba7f163c4a11628f55a4df523b3ef"),
									common.HexToHash("0x000000000000000000000000a478c2975ab1ea89e8196811f51a7b7ade33eb11"),
									common.HexToHash("0x0000000000000000000000007a250d5630b4cf539739df2c5dacb4c659f2488d"),
								},
								Data:            hexutil.MustDecode("0x00000000000000000000000000000000000000000000000005fe0e75cdbd7187"),
								BlockNumber:     lo.Must(new(big.Int).SetString("17261466", 0)),
								TransactionHash: common.HexToHash("0xc59d2ed54f0ab05f4f40679aa1d32a6537ed75e4da8b496f8bee2c209186b335"),
								Index:           466,
								Removed:         false,
							},
							{
								Address: common.HexToAddress("0xA478c2975Ab1Ea89e8196811F51A7B7Ade33eB11"),
								Topics: []common.Hash{
									common.HexToHash("0x1c411e9a96e071241c2f21f7726b17ae89e3cab4c78be50e062b03a9fffbbad1"),
								},
								Data:            hexutil.MustDecode("0x00000000000000000000000000000000000000000006441cd6e0033710889fa50000000000000000000000000000000000000000000000e484f7714ef3e6e1c4"),
								BlockNumber:     lo.Must(new(big.Int).SetString("17261466", 0)),
								TransactionHash: common.HexToHash("0xc59d2ed54f0ab05f4f40679aa1d32a6537ed75e4da8b496f8bee2c209186b335"),
								Index:           467,
								Removed:         false,
							},
							{
								Address: common.HexToAddress("0xA478c2975Ab1Ea89e8196811F51A7B7Ade33eB11"),
								Topics: []common.Hash{
									common.HexToHash("0xdccd412f0b1252819cb1fd330b93224ca42612892bb3f4f789976e6d81936496"),
									common.HexToHash("0x0000000000000000000000007a250d5630b4cf539739df2c5dacb4c659f2488d"),
									common.HexToHash("0x0000000000000000000000007a250d5630b4cf539739df2c5dacb4c659f2488d"),
								},
								Data:            hexutil.MustDecode("0x00000000000000000000000000000000000000000000002a1072d72474767bbe00000000000000000000000000000000000000000000000005fe0e75cdbd7187"),
								BlockNumber:     lo.Must(new(big.Int).SetString("17261466", 0)),
								TransactionHash: common.HexToHash("0xc59d2ed54f0ab05f4f40679aa1d32a6537ed75e4da8b496f8bee2c209186b335"),
								Index:           468,
								Removed:         false,
							},
							{
								Address: common.HexToAddress("0x6B175474E89094C44Da98b954EedeAC495271d0F"),
								Topics: []common.Hash{
									common.HexToHash("0xddf252ad1be2c89b69c2b068fc378daa952ba7f163c4a11628f55a4df523b3ef"),
									common.HexToHash("0x0000000000000000000000007a250d5630b4cf539739df2c5dacb4c659f2488d"),
									common.HexToHash("0x0000000000000000000000003e07f1c21024c1bdd2217e51e46c13c143b8ac12"),
								},
								Data:            hexutil.MustDecode("0x00000000000000000000000000000000000000000000002a1072d72474767bbe"),
								BlockNumber:     lo.Must(new(big.Int).SetString("17261466", 0)),
								TransactionHash: common.HexToHash("0xc59d2ed54f0ab05f4f40679aa1d32a6537ed75e4da8b496f8bee2c209186b335"),
								Index:           469,
								Removed:         false,
							},
							{
								Address: common.HexToAddress("0xC02aaA39b223FE8D0A0e5C4F27eAD9083C756Cc2"),
								Topics: []common.Hash{
									common.HexToHash("0x7fcf532c15f0a6db0bd6d0e038bea71d30d808c7d98cb3bf7268a95bf5081b65"),
									common.HexToHash("0x0000000000000000000000007a250d5630b4cf539739df2c5dacb4c659f2488d"),
								},
								Data:            hexutil.MustDecode("0x00000000000000000000000000000000000000000000000005fe0e75cdbd7187"),
								BlockNumber:     lo.Must(new(big.Int).SetString("17261466", 0)),
								TransactionHash: common.HexToHash("0xc59d2ed54f0ab05f4f40679aa1d32a6537ed75e4da8b496f8bee2c209186b335"),
								Index:           470,
								Removed:         false,
							},
						},
						Status:           1,
						TransactionHash:  common.HexToHash("0xc59d2ed54f0ab05f4f40679aa1d32a6537ed75e4da8b496f8bee2c209186b335"),
						TransactionIndex: 156,
					},
				},
				config: &config.Module{
					Network: network.Ethereum,
					Endpoint: config.Endpoint{
						URL: endpoint.MustGet(network.Ethereum),
					},
				},
			},
			want: &activityx.Activity{
				ID:      "0xc59d2ed54f0ab05f4f40679aa1d32a6537ed75e4da8b496f8bee2c209186b335",
				Network: network.Ethereum,
				Index:   156,
				From:    "0x3E07f1C21024c1bdD2217e51E46C13C143B8aC12",
				To:      uniswap.AddressV2SwapRouter02.String(),
				Type:    typex.ExchangeLiquidity,
				Calldata: &activityx.Calldata{
					FunctionHash: "0xded9382a",
				},
				Platform: workerx.PlatformUniswap.String(),
				Fee: &activityx.Fee{
					Amount:  lo.Must(decimal.NewFromString("6413074183473729")),
					Decimal: 18,
				},
				Actions: []*activityx.Action{
					{
						Type:     typex.ExchangeLiquidity,
						Platform: workerx.PlatformUniswap.String(),
						From:     "0xA478c2975Ab1Ea89e8196811F51A7B7Ade33eB11",
						To:       "0x3E07f1C21024c1bdD2217e51E46C13C143B8aC12",
						Metadata: metadata.ExchangeLiquidity{
							Action: metadata.ActionExchangeLiquidityRemove,
							Tokens: []metadata.Token{
								{
									Address:  lo.ToPtr("0x6B175474E89094C44Da98b954EedeAC495271d0F"),
									Value:    lo.ToPtr(lo.Must(decimal.NewFromString("775948497299325746110"))),
									Name:     "Dai Stablecoin",
									Symbol:   "DAI",
									Decimals: 18,
									Standard: metadata.StandardERC20,
								},
								{
									Address:  lo.ToPtr("0xC02aaA39b223FE8D0A0e5C4F27eAD9083C756Cc2"),
									Value:    lo.ToPtr(lo.Must(decimal.NewFromString("431798513399853447"))),
									Name:     "Wrapped Ether",
									Symbol:   "WETH",
									Decimals: 18,
									Standard: metadata.StandardERC20,
								},
							},
						},
					},
				},
				Status:    true,
				Timestamp: 1684108343,
			},
			wantError: require.NoError,
		},
		{
			name: "Add USDC and WETH liquidity to Uniswap Nonfungible Position Manager",
			arguments: arguments{
				task: &source.Task{
					Network: network.Ethereum,
					ChainID: 1,
					Header: &ethereum.Header{
						Hash:         common.HexToHash("0xf78ad62b69d4c8794857fca664f39718664a147e2634915c996c51ad83e53c84"),
						ParentHash:   common.HexToHash("0x905e4a0abb3c96e9f159694bde07cef09ca675d87f86ba4eb7452cb3c5b59c52"),
						UncleHash:    common.HexToHash("0x1dcc4de8dec75d7aab85b567b6ccd41ad312451b948a7413f0a142fd40d49347"),
						Coinbase:     common.HexToAddress("0x1f9090aaE28b8a3dCeaDf281B0F12828e676c326"),
						Number:       lo.Must(new(big.Int).SetString("17368660", 0)),
						GasLimit:     30000000,
						GasUsed:      12057662,
						Timestamp:    1685412191,
						BaseFee:      lo.Must(new(big.Int).SetString("25894859302", 0)),
						Transactions: nil,
					},
					Transaction: &ethereum.Transaction{
						BlockHash: common.HexToHash("0x955784fc31f3ab7e09f6c0bd0b174d386fc3ca97ecda1ce3e150335164eafa8f"),
						From:      common.HexToAddress("0x36E5A96c8d01803d2C48756AA7bde1c01d7D9f8A"),
						Gas:       565450,
						GasPrice:  lo.Must(new(big.Int).SetString("25944859302", 10)),
						Hash:      common.HexToHash("0x955784fc31f3ab7e09f6c0bd0b174d386fc3ca97ecda1ce3e150335164eafa8f"),
						Input:     hexutil.MustDecode("0xac9650d800000000000000000000000000000000000000000000000000000000000000200000000000000000000000000000000000000000000000000000000000000002000000000000000000000000000000000000000000000000000000000000004000000000000000000000000000000000000000000000000000000000000001e0000000000000000000000000000000000000000000000000000000000000016488316456000000000000000000000000a0b86991c6218b36c1d19d4a2e9eb0ce3606eb48000000000000000000000000c02aaa39b223fe8d0a0e5c4f27ead9083c756cc200000000000000000000000000000000000000000000000000000000000001f40000000000000000000000000000000000000000000000000000000000030f7a00000000000000000000000000000000000000000000000000000000000311960000000000000000000000000000000000000000000000000000007cdfbf217a00000000000000000000000000000000000000000000000ebeb4723bb803c228000000000000000000000000000000000000000000000000000000661ce42f4300000000000000000000000000000000000000000000000bf0540d132c0eedd100000000000000000000000036e5a96c8d01803d2c48756aa7bde1c01d7d9f8a000000000000000000000000000000000000000000000000000000006475604f00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000412210e8a00000000000000000000000000000000000000000000000000000000"),
						To:        lo.ToPtr(common.HexToAddress("0xC36442b4a4522E871399CD717aBDD847Ab11FE88")),
						Value:     lo.Must(new(big.Int).SetString("271996150995763839528", 0)),
						Type:      2,
						ChainID:   lo.Must(new(big.Int).SetString("1", 0)),
					},
					Receipt: &ethereum.Receipt{
						BlockHash:         common.HexToHash("0xf78ad62b69d4c8794857fca664f39718664a147e2634915c996c51ad83e53c84"),
						BlockNumber:       lo.Must(new(big.Int).SetString("17368660", 0)),
						ContractAddress:   nil,
						CumulativeGasUsed: 12036662,
						EffectiveGasPrice: hexutil.MustDecodeBig("0x60a6f22a6"),
						GasUsed:           453801,
						Logs: []*ethereum.Log{{
							Address: common.HexToAddress("0xA0b86991c6218b36c1d19D4a2e9Eb0cE3606eB48"),
							Topics: []common.Hash{
								common.HexToHash("0xddf252ad1be2c89b69c2b068fc378daa952ba7f163c4a11628f55a4df523b3ef"),
								common.HexToHash("0x00000000000000000000000036e5a96c8d01803d2c48756aa7bde1c01d7d9f8a"),
								common.HexToHash("0x00000000000000000000000088e6a0c2ddd26feeb64f039a2c41296fcb3f5640"),
							},
							Data:            hexutil.MustDecode("0x0000000000000000000000000000000000000000000000000000007cdf22271e"),
							BlockNumber:     lo.Must(new(big.Int).SetString("17368660", 0)),
							TransactionHash: common.HexToHash("0x955784fc31f3ab7e09f6c0bd0b174d386fc3ca97ecda1ce3e150335164eafa8f"),
							Index:           299,
							Removed:         false,
						}, {
							Address: common.HexToAddress("0xC02aaA39b223FE8D0A0e5C4F27eAD9083C756Cc2"),
							Topics: []common.Hash{
								common.HexToHash("0xe1fffcc4923d04b559f4d29a8bfc6cda04eb5b0d3c460751c2402c5c5cc9109c"),
								common.HexToHash("0x000000000000000000000000c36442b4a4522e871399cd717abdd847ab11fe88"),
							},
							Data:            hexutil.MustDecode("0x00000000000000000000000000000000000000000000000ebeb4723bb803c14c"),
							BlockNumber:     lo.Must(new(big.Int).SetString("17368660", 0)),
							TransactionHash: common.HexToHash("0x955784fc31f3ab7e09f6c0bd0b174d386fc3ca97ecda1ce3e150335164eafa8f"),
							Index:           300,
							Removed:         false,
						}, {
							Address: common.HexToAddress("0xC02aaA39b223FE8D0A0e5C4F27eAD9083C756Cc2"),
							Topics: []common.Hash{
								common.HexToHash("0xddf252ad1be2c89b69c2b068fc378daa952ba7f163c4a11628f55a4df523b3ef"),
								common.HexToHash("0x000000000000000000000000c36442b4a4522e871399cd717abdd847ab11fe88"),
								common.HexToHash("0x00000000000000000000000088e6a0c2ddd26feeb64f039a2c41296fcb3f5640"),
							},
							Data:            hexutil.MustDecode("0x00000000000000000000000000000000000000000000000ebeb4723bb803c14c"),
							BlockNumber:     lo.Must(new(big.Int).SetString("17368660", 0)),
							TransactionHash: common.HexToHash("0x955784fc31f3ab7e09f6c0bd0b174d386fc3ca97ecda1ce3e150335164eafa8f"),
							Index:           301,
							Removed:         false,
						}, {
							Address: common.HexToAddress("0x88e6A0c2dDD26FEEb64F039a2c41296FcB3f5640"),
							Topics: []common.Hash{
								common.HexToHash("0x7a53080ba414158be7ec69b987b5fb7d07dee101fe85488f0853ae16239d0bde"),
								common.HexToHash("0x000000000000000000000000c36442b4a4522e871399cd717abdd847ab11fe88"),
								common.HexToHash("0x0000000000000000000000000000000000000000000000000000000000030f7a"),
								common.HexToHash("0x0000000000000000000000000000000000000000000000000000000000031196"),
							},
							Data:            hexutil.MustDecode("0x000000000000000000000000c36442b4a4522e871399cd717abdd847ab11fe880000000000000000000000000000000000000000000000000c80bbae98ca36d30000000000000000000000000000000000000000000000000000007cdf22271e00000000000000000000000000000000000000000000000ebeb4723bb803c14c"),
							BlockNumber:     lo.Must(new(big.Int).SetString("17368660", 0)),
							TransactionHash: common.HexToHash("0x955784fc31f3ab7e09f6c0bd0b174d386fc3ca97ecda1ce3e150335164eafa8f"),
							Index:           302,
							Removed:         false,
						}, {
							Address: common.HexToAddress("0xC36442b4a4522E871399CD717aBDD847Ab11FE88"),
							Topics: []common.Hash{
								common.HexToHash("0xddf252ad1be2c89b69c2b068fc378daa952ba7f163c4a11628f55a4df523b3ef"),
								common.HexToHash("0x0000000000000000000000000000000000000000000000000000000000000000"),
								common.HexToHash("0x00000000000000000000000036e5a96c8d01803d2c48756aa7bde1c01d7d9f8a"),
								common.HexToHash("0x000000000000000000000000000000000000000000000000000000000007de31"),
							},
							Data:            nil,
							BlockNumber:     lo.Must(new(big.Int).SetString("17368660", 0)),
							TransactionHash: common.HexToHash("0x955784fc31f3ab7e09f6c0bd0b174d386fc3ca97ecda1ce3e150335164eafa8f"),
							Index:           303,
							Removed:         false,
						}, {
							Address: common.HexToAddress("0xC36442b4a4522E871399CD717aBDD847Ab11FE88"),
							Topics: []common.Hash{
								common.HexToHash("0x3067048beee31b25b2f1681f88dac838c8bba36af25bfb2b7cf7473a5847e35f"),
								common.HexToHash("0x000000000000000000000000000000000000000000000000000000000007de31"),
							},
							Data:            hexutil.MustDecode("0x0000000000000000000000000000000000000000000000000c80bbae98ca36d30000000000000000000000000000000000000000000000000000007cdf22271e00000000000000000000000000000000000000000000000ebeb4723bb803c14c"),
							BlockNumber:     lo.Must(new(big.Int).SetString("17368660", 0)),
							TransactionHash: common.HexToHash("0x955784fc31f3ab7e09f6c0bd0b174d386fc3ca97ecda1ce3e150335164eafa8f"),
							Index:           304,
							Removed:         false,
						}},
						Status:           1,
						TransactionHash:  common.HexToHash("0x955784fc31f3ab7e09f6c0bd0b174d386fc3ca97ecda1ce3e150335164eafa8f"),
						TransactionIndex: 117,
					},
				},
				config: &config.Module{
					Network: network.Ethereum,
					Endpoint: config.Endpoint{
						URL: endpoint.MustGet(network.Ethereum),
					},
				},
			},
			want: &activityx.Activity{
				ID:      "0x955784fc31f3ab7e09f6c0bd0b174d386fc3ca97ecda1ce3e150335164eafa8f",
				Network: network.Ethereum,
				Index:   117,
				From:    "0x36E5A96c8d01803d2C48756AA7bde1c01d7D9f8A",
				To:      uniswap.AddressNonfungiblePositionManager.String(),
				Type:    typex.ExchangeLiquidity,
				Calldata: &activityx.Calldata{
					FunctionHash: "0xac9650d8",
				},
				Platform: workerx.PlatformUniswap.String(),
				Fee: &activityx.Fee{
					Amount:  lo.Must(decimal.NewFromString("11773803096106902")),
					Decimal: 18,
				},
				Actions: []*activityx.Action{
					{
						Type:     typex.TransactionMint,
						Platform: workerx.PlatformUniswap.String(),
						From:     "0x0000000000000000000000000000000000000000",
						To:       "0x36E5A96c8d01803d2C48756AA7bde1c01d7D9f8A",
						Metadata: metadata.TransactionTransfer{
							Address:  lo.ToPtr("0xC36442b4a4522E871399CD717aBDD847Ab11FE88"),
							ID:       lo.ToPtr(decimal.NewFromInt(515633)),
							Value:    lo.ToPtr(decimal.NewFromInt(1)),
							Name:     "Uniswap V3 Positions NFT-V1",
							Symbol:   "UNI-V3-POS",
							Standard: metadata.StandardERC721,
						},
					},
					{
						Type:     typex.ExchangeLiquidity,
						Platform: workerx.PlatformUniswap.String(),
						From:     "0x36E5A96c8d01803d2C48756AA7bde1c01d7D9f8A",
						To:       uniswap.AddressNonfungiblePositionManager.String(),
						Metadata: metadata.ExchangeLiquidity{
							Action: metadata.ActionExchangeLiquidityAdd,
							Tokens: []metadata.Token{
								{
									Address:  lo.ToPtr("0xA0b86991c6218b36c1d19D4a2e9Eb0cE3606eB48"),
									Value:    lo.ToPtr(lo.Must(decimal.NewFromString("536319502110"))),
									Name:     "USD Coin",
									Symbol:   "USDC",
									Decimals: 6,
									Standard: metadata.StandardERC20,
								},
								{
									Address:  lo.ToPtr("0xC02aaA39b223FE8D0A0e5C4F27eAD9083C756Cc2"),
									Value:    lo.ToPtr(lo.Must(decimal.NewFromString("271996150995763839308"))),
									Name:     "Wrapped Ether",
									Symbol:   "WETH",
									Decimals: 18,
									Standard: metadata.StandardERC20,
								},
							},
						},
					},
				},
				Status:    true,
				Timestamp: 1685412191,
			},
			wantError: require.NoError,
		},
		{
			name: "Remove cbETH and WETH liquidity from Uniswap Nonfungible Position Manager",
			arguments: arguments{
				task: &source.Task{
					Network: network.Ethereum,
					ChainID: 1,
					Header: &ethereum.Header{
						Hash:         common.HexToHash("0xa7b709890eadb66d9abfb29269de27ff60d0264a584a5a2ffc0e235db80c5a57"),
						ParentHash:   common.HexToHash("0x3f58452390d36aea9c56ac17a0b7c6a97e5ceb0a0079baec52ceab0ba310c55f"),
						UncleHash:    common.HexToHash("0x1dcc4de8dec75d7aab85b567b6ccd41ad312451b948a7413f0a142fd40d49347"),
						Coinbase:     common.HexToAddress("0xDAFEA492D9c6733ae3d56b7Ed1ADB60692c98Bc5"),
						Number:       lo.Must(new(big.Int).SetString("17369296", 0)),
						GasLimit:     30000000,
						GasUsed:      18555460,
						Timestamp:    1685419931,
						BaseFee:      lo.Must(new(big.Int).SetString("56221583312", 0)),
						Transactions: nil,
					},
					Transaction: &ethereum.Transaction{
						BlockHash: common.HexToHash("0x1da1d585513eb27ac32020046e3b39b114311e934243b497a1af5be25e959410"),
						From:      common.HexToAddress("0x8E02247D3eE0E6153495c971FFd45Aa131f4D7cB"),
						Gas:       384962,
						GasPrice:  lo.Must(new(big.Int).SetString("56321583312", 10)),
						Hash:      common.HexToHash("0x1da1d585513eb27ac32020046e3b39b114311e934243b497a1af5be25e959410"),
						Input:     hexutil.MustDecode("0xac9650d80000000000000000000000000000000000000000000000000000000000000020000000000000000000000000000000000000000000000000000000000000000400000000000000000000000000000000000000000000000000000000000000800000000000000000000000000000000000000000000000000000000000000160000000000000000000000000000000000000000000000000000000000000022000000000000000000000000000000000000000000000000000000000000002a000000000000000000000000000000000000000000000000000000000000000a40c49ccbe000000000000000000000000000000000000000000000000000000000007bf3e000000000000000000000000000000000000000000001080bf78119c9f0f648a000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000064757c33000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000084fc6f7865000000000000000000000000000000000000000000000000000000000007bf3e000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000ffffffffffffffffffffffffffffffff00000000000000000000000000000000ffffffffffffffffffffffffffffffff00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000004449404b7c0000000000000000000000000000000000000000000000000237f2ba8ee880060000000000000000000000008e02247d3ee0e6153495c971ffd45aa131f4d7cb000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000064df2ab5bb000000000000000000000000be9895146f7af43049ca1c1ae358b0541ea4970400000000000000000000000000000000000000000000000001c897fd3422357b0000000000000000000000008e02247d3ee0e6153495c971ffd45aa131f4d7cb00000000000000000000000000000000000000000000000000000000"),
						To:        lo.ToPtr(common.HexToAddress("0xC36442b4a4522E871399CD717aBDD847Ab11FE88")),
						Value:     lo.Must(new(big.Int).SetString("0", 0)),
						Type:      2,
						ChainID:   lo.Must(new(big.Int).SetString("1", 0)),
					},
					Receipt: &ethereum.Receipt{
						BlockHash:         common.HexToHash("0xa7b709890eadb66d9abfb29269de27ff60d0264a584a5a2ffc0e235db80c5a57"),
						BlockNumber:       lo.Must(new(big.Int).SetString("17369296", 0)),
						ContractAddress:   nil,
						CumulativeGasUsed: 12612114,
						EffectiveGasPrice: hexutil.MustDecodeBig("0xd1d0728d0"),
						GasUsed:           256642,
						Logs: []*ethereum.Log{
							{
								Address: common.HexToAddress("0x840DEEef2f115Cf50DA625F7368C24af6fE74410"),
								Topics: []common.Hash{
									common.HexToHash("0x0c396cd989a39f4459b5fa1aed6a9a8dcdbc45908acfd67e028cd568da98982c"),
									common.HexToHash("0x000000000000000000000000c36442b4a4522e871399cd717abdd847ab11fe88"),
									common.HexToHash("0x0000000000000000000000000000000000000000000000000000000000000140"),
									common.HexToHash("0x0000000000000000000000000000000000000000000000000000000000000168"),
								},
								Data:            hexutil.MustDecode("0x000000000000000000000000000000000000000000001080bf78119c9f0f648a0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000008980bc58516d874b7"),
								BlockNumber:     lo.Must(new(big.Int).SetString("17369296", 0)),
								TransactionHash: common.HexToHash("0x1da1d585513eb27ac32020046e3b39b114311e934243b497a1af5be25e959410"),
								Index:           284,
								Removed:         false,
							},
							{
								Address: common.HexToAddress("0xC36442b4a4522E871399CD717aBDD847Ab11FE88"),
								Topics: []common.Hash{
									common.HexToHash("0x26f6a048ee9138f2c0ce266f322cb99228e8d619ae2bff30c67f8dcf9d2377b4"),
									common.HexToHash("0x000000000000000000000000000000000000000000000000000000000007bf3e"),
								},
								Data:            hexutil.MustDecode("0x000000000000000000000000000000000000000000001080bf78119c9f0f648a0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000008980bc58516d874b7"),
								BlockNumber:     lo.Must(new(big.Int).SetString("17369296", 0)),
								TransactionHash: common.HexToHash("0x1da1d585513eb27ac32020046e3b39b114311e934243b497a1af5be25e959410"),
								Index:           285,
								Removed:         false,
							},
							{
								Address: common.HexToAddress("0xBe9895146f7AF43049ca1c1AE358B0541Ea49704"),
								Topics: []common.Hash{
									common.HexToHash("0xddf252ad1be2c89b69c2b068fc378daa952ba7f163c4a11628f55a4df523b3ef"),
									common.HexToHash("0x000000000000000000000000840deeef2f115cf50da625f7368c24af6fe74410"),
									common.HexToHash("0x000000000000000000000000c36442b4a4522e871399cd717abdd847ab11fe88"),
								},
								Data:            hexutil.MustDecode("0x00000000000000000000000000000000000000000000000001c897fd3422357b"),
								BlockNumber:     lo.Must(new(big.Int).SetString("17369296", 0)),
								TransactionHash: common.HexToHash("0x1da1d585513eb27ac32020046e3b39b114311e934243b497a1af5be25e959410"),
								Index:           286,
								Removed:         false,
							},
							{
								Address: common.HexToAddress("0xC02aaA39b223FE8D0A0e5C4F27eAD9083C756Cc2"),
								Topics: []common.Hash{
									common.HexToHash("0xddf252ad1be2c89b69c2b068fc378daa952ba7f163c4a11628f55a4df523b3ef"),
									common.HexToHash("0x000000000000000000000000840deeef2f115cf50da625f7368c24af6fe74410"),
									common.HexToHash("0x000000000000000000000000c36442b4a4522e871399cd717abdd847ab11fe88"),
								},
								Data:            hexutil.MustDecode("0x0000000000000000000000000000000000000000000000089a43b83fa5c0f4bd"),
								BlockNumber:     lo.Must(new(big.Int).SetString("17369296", 0)),
								TransactionHash: common.HexToHash("0x1da1d585513eb27ac32020046e3b39b114311e934243b497a1af5be25e959410"),
								Index:           287,
								Removed:         false,
							},
							{
								Address: common.HexToAddress("0x840DEEef2f115Cf50DA625F7368C24af6fE74410"),
								Topics: []common.Hash{
									common.HexToHash("0x70935338e69775456a85ddef226c395fb668b63fa0115f5f20610b388e6ca9c0"),
									common.HexToHash("0x000000000000000000000000c36442b4a4522e871399cd717abdd847ab11fe88"),
									common.HexToHash("0x0000000000000000000000000000000000000000000000000000000000000140"),
									common.HexToHash("0x0000000000000000000000000000000000000000000000000000000000000168"),
								},
								Data:            hexutil.MustDecode("0x000000000000000000000000c36442b4a4522e871399cd717abdd847ab11fe8800000000000000000000000000000000000000000000000001c897fd3422357b0000000000000000000000000000000000000000000000089a43b83fa5c0f4bd"),
								BlockNumber:     lo.Must(new(big.Int).SetString("17369296", 0)),
								TransactionHash: common.HexToHash("0x1da1d585513eb27ac32020046e3b39b114311e934243b497a1af5be25e959410"),
								Index:           288,
								Removed:         false,
							},
							{
								Address: common.HexToAddress("0xC36442b4a4522E871399CD717aBDD847Ab11FE88"),
								Topics: []common.Hash{
									common.HexToHash("0x40d0efd1a53d60ecbf40971b9daf7dc90178c3aadc7aab1765632738fa8b8f01"),
									common.HexToHash("0x000000000000000000000000000000000000000000000000000000000007bf3e"),
								},
								Data:            hexutil.MustDecode("0x000000000000000000000000c36442b4a4522e871399cd717abdd847ab11fe8800000000000000000000000000000000000000000000000001c897fd3422357b0000000000000000000000000000000000000000000000089a43b83fa5c0f4bd"),
								BlockNumber:     lo.Must(new(big.Int).SetString("17369296", 0)),
								TransactionHash: common.HexToHash("0x1da1d585513eb27ac32020046e3b39b114311e934243b497a1af5be25e959410"),
								Index:           289,
								Removed:         false,
							},
							{
								Address: common.HexToAddress("0xC02aaA39b223FE8D0A0e5C4F27eAD9083C756Cc2"),
								Topics: []common.Hash{
									common.HexToHash("0x7fcf532c15f0a6db0bd6d0e038bea71d30d808c7d98cb3bf7268a95bf5081b65"),
									common.HexToHash("0x000000000000000000000000c36442b4a4522e871399cd717abdd847ab11fe88"),
								},
								Data:            hexutil.MustDecode("0x0000000000000000000000000000000000000000000000089a43b83fa5c0f4bd"),
								BlockNumber:     lo.Must(new(big.Int).SetString("17369296", 0)),
								TransactionHash: common.HexToHash("0x1da1d585513eb27ac32020046e3b39b114311e934243b497a1af5be25e959410"),
								Index:           290,
								Removed:         false,
							},
							{
								Address: common.HexToAddress("0xBe9895146f7AF43049ca1c1AE358B0541Ea49704"),
								Topics: []common.Hash{
									common.HexToHash("0xddf252ad1be2c89b69c2b068fc378daa952ba7f163c4a11628f55a4df523b3ef"),
									common.HexToHash("0x000000000000000000000000c36442b4a4522e871399cd717abdd847ab11fe88"),
									common.HexToHash("0x0000000000000000000000008e02247d3ee0e6153495c971ffd45aa131f4d7cb"),
								},
								Data:            hexutil.MustDecode("0x00000000000000000000000000000000000000000000000001c897fd3422357b"),
								BlockNumber:     lo.Must(new(big.Int).SetString("17369296", 0)),
								TransactionHash: common.HexToHash("0x1da1d585513eb27ac32020046e3b39b114311e934243b497a1af5be25e959410"),
								Index:           291,
								Removed:         false,
							},
						},
						Status:           1,
						TransactionHash:  common.HexToHash("0x1da1d585513eb27ac32020046e3b39b114311e934243b497a1af5be25e959410"),
						TransactionIndex: 222,
					},
				},
				config: &config.Module{
					Network: network.Ethereum,
					Endpoint: config.Endpoint{
						URL: endpoint.MustGet(network.Ethereum),
					},
				},
			},
			want: &activityx.Activity{
				ID:      "0x1da1d585513eb27ac32020046e3b39b114311e934243b497a1af5be25e959410",
				Network: network.Ethereum,
				Index:   222,
				From:    "0x8E02247D3eE0E6153495c971FFd45Aa131f4D7cB",
				To:      uniswap.AddressNonfungiblePositionManager.String(),
				Type:    typex.ExchangeLiquidity,
				Calldata: &activityx.Calldata{
					FunctionHash: "0xac9650d8",
				},
				Platform: workerx.PlatformUniswap.String(),
				Fee: &activityx.Fee{
					Amount:  lo.Must(decimal.NewFromString("14454483784358304")),
					Decimal: 18,
				},
				Actions: []*activityx.Action{
					{
						Type:     typex.ExchangeLiquidity,
						Platform: workerx.PlatformUniswap.String(),
						From:     uniswap.AddressNonfungiblePositionManager.String(),
						To:       "0x8E02247D3eE0E6153495c971FFd45Aa131f4D7cB",
						Metadata: metadata.ExchangeLiquidity{
							Action: metadata.ActionExchangeLiquidityRemove,
							Tokens: []metadata.Token{
								{
									Address:  lo.ToPtr("0xBe9895146f7AF43049ca1c1AE358B0541Ea49704"),
									Value:    lo.ToPtr(lo.Must(decimal.NewFromString("0"))),
									Name:     "Coinbase Wrapped Staked ETH",
									Symbol:   "cbETH",
									Decimals: 18,
									Standard: metadata.StandardERC20,
								},
								{
									Address:  lo.ToPtr("0xC02aaA39b223FE8D0A0e5C4F27eAD9083C756Cc2"),
									Value:    lo.ToPtr(lo.Must(decimal.NewFromString("158530020283589883063"))),
									Name:     "Wrapped Ether",
									Symbol:   "WETH",
									Decimals: 18,
									Standard: metadata.StandardERC20,
								},
							},
						},
					},
					{
						Type:     typex.ExchangeLiquidity,
						Platform: workerx.PlatformUniswap.String(),
						From:     uniswap.AddressNonfungiblePositionManager.String(),
						To:       "0x8E02247D3eE0E6153495c971FFd45Aa131f4D7cB",
						Metadata: metadata.ExchangeLiquidity{
							Action: metadata.ActionExchangeLiquidityCollect,
							Tokens: []metadata.Token{
								{
									Address:  lo.ToPtr("0xBe9895146f7AF43049ca1c1AE358B0541Ea49704"),
									Value:    lo.ToPtr(lo.Must(decimal.NewFromString("128519703137236347"))),
									Name:     "Coinbase Wrapped Staked ETH",
									Symbol:   "cbETH",
									Decimals: 18,
									Standard: metadata.StandardERC20,
								},
								{
									Address:  lo.ToPtr("0xC02aaA39b223FE8D0A0e5C4F27eAD9083C756Cc2"),
									Value:    lo.ToPtr(lo.Must(decimal.NewFromString("158689883478460265661"))),
									Name:     "Wrapped Ether",
									Symbol:   "WETH",
									Decimals: 18,
									Standard: metadata.StandardERC20,
								},
							},
						},
					},
				},
				Status:    true,
				Timestamp: 1685419931,
			},
			wantError: require.NoError,
		},
		{
			name: "Migrate DAI and ETH liquidity from Uniswap V2 Pair to Uniswap V3 Pool",
			arguments: arguments{
				task: &source.Task{
					Network: network.Ethereum,
					ChainID: 1,
					Header: &ethereum.Header{
						Hash:         common.HexToHash("0x4b00d4e7a4866d94035f418d3e041aa5c3470edf770988418059fb4f72ae3c1a"),
						ParentHash:   common.HexToHash("0x9cd8f73c3592d129620513798d01b8a1a2baced721d0a4b2b1a210c3918ceecc"),
						UncleHash:    common.HexToHash("0x1dcc4de8dec75d7aab85b567b6ccd41ad312451b948a7413f0a142fd40d49347"),
						Coinbase:     common.HexToAddress("0xDAFEA492D9c6733ae3d56b7Ed1ADB60692c98Bc5"),
						Number:       lo.Must(new(big.Int).SetString("17336353", 0)),
						GasLimit:     30000000,
						GasUsed:      14174404,
						Timestamp:    1685020067,
						BaseFee:      lo.Must(new(big.Int).SetString("45065032609", 0)),
						Transactions: nil,
					},
					Transaction: &ethereum.Transaction{
						BlockHash: common.HexToHash("0xbf77b991e7a17fbf5da6089f9a27ff2805d63b8d0b18ff48e1d6e118404a7864"),
						From:      common.HexToAddress("0xf69A8916669De197E84Cb39A38bA5115e8efCC77"),
						Gas:       830961,
						GasPrice:  lo.Must(new(big.Int).SetString("45165032609", 10)),
						Hash:      common.HexToHash("0xbf77b991e7a17fbf5da6089f9a27ff2805d63b8d0b18ff48e1d6e118404a7864"),
						Input:     hexutil.MustDecode("0xac9650d8000000000000000000000000000000000000000000000000000000000000002000000000000000000000000000000000000000000000000000000000000000020000000000000000000000000000000000000000000000000000000000000040000000000000000000000000000000000000000000000000000000000000014000000000000000000000000000000000000000000000000000000000000000c4f3995c67000000000000000000000000a478c2975ab1ea89e8196811f51a7b7ade33eb1100000000000000000000000000000000000000000000000a83ffa947500b0bc900000000000000000000000000000000000000000000000000000000646f6937000000000000000000000000000000000000000000000000000000000000001bddcabffa51f713a791723b093c45aefd9ab225a5bd2cdb95b7612332f40139a039630e26111b8e6c476516b19bb755b0b6e4b0b55773e30dbd7418bc98c4fc760000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001a4d44f2bf2000000000000000000000000a478c2975ab1ea89e8196811f51a7b7ade33eb1100000000000000000000000000000000000000000000000a83ffa947500b0bc900000000000000000000000000000000000000000000000000000000000000640000000000000000000000006b175474e89094c44da98b954eedeac495271d0f000000000000000000000000c02aaa39b223fe8d0a0e5c4f27ead9083c756cc20000000000000000000000000000000000000000000000000000000000000bb8fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffebbdcfffffffffffffffffffffffffffffffffffffffffffffffffffffffffffefaac0000000000000000000000000000000000000000000003256f234ea3013e503900000000000000000000000000000000000000000000000071d28d743f457ea5000000000000000000000000f69a8916669de197e84cb39a38ba5115e8efcc7700000000000000000000000000000000000000000000000000000000646f6937000000000000000000000000000000000000000000000000000000000000000100000000000000000000000000000000000000000000000000000000"),
						To:        lo.ToPtr(common.HexToAddress("0xA5644E29708357803b5A882D272c41cC0dF92B34")),
						Value:     lo.Must(new(big.Int).SetString("0", 0)),
						Type:      2,
						ChainID:   lo.Must(new(big.Int).SetString("1", 0)),
					},
					Receipt: &ethereum.Receipt{
						BlockHash:         common.HexToHash("0x4b00d4e7a4866d94035f418d3e041aa5c3470edf770988418059fb4f72ae3c1a"),
						BlockNumber:       lo.Must(new(big.Int).SetString("17336353", 0)),
						ContractAddress:   nil,
						CumulativeGasUsed: 8492545,
						EffectiveGasPrice: hexutil.MustDecodeBig("0xa840bb4a1"),
						GasUsed:           560928,
						Logs: []*ethereum.Log{
							{
								Address: common.HexToAddress("0xA478c2975Ab1Ea89e8196811F51A7B7Ade33eB11"),
								Topics: []common.Hash{
									common.HexToHash("0x8c5be1e5ebec7d5bd14f71427d1e84f3dd0314c0f7b2291e5b200ac8c7c3b925"),
									common.HexToHash("0x000000000000000000000000f69a8916669de197e84cb39a38ba5115e8efcc77"),
									common.HexToHash("0x000000000000000000000000a5644e29708357803b5a882d272c41cc0df92b34"),
								},
								Data:            hexutil.MustDecode("0x00000000000000000000000000000000000000000000000a83ffa947500b0bc9"),
								BlockNumber:     lo.Must(new(big.Int).SetString("17336353", 0)),
								TransactionHash: common.HexToHash("0xbf77b991e7a17fbf5da6089f9a27ff2805d63b8d0b18ff48e1d6e118404a7864"),
								Index:           202,
								Removed:         false,
							},
							{
								Address: common.HexToAddress("0xA478c2975Ab1Ea89e8196811F51A7B7Ade33eB11"),
								Topics: []common.Hash{
									common.HexToHash("0xddf252ad1be2c89b69c2b068fc378daa952ba7f163c4a11628f55a4df523b3ef"),
									common.HexToHash("0x000000000000000000000000f69a8916669de197e84cb39a38ba5115e8efcc77"),
									common.HexToHash("0x000000000000000000000000a478c2975ab1ea89e8196811f51a7b7ade33eb11"),
								},
								Data:            hexutil.MustDecode("0x00000000000000000000000000000000000000000000000a83ffa947500b0bc9"),
								BlockNumber:     lo.Must(new(big.Int).SetString("17336353", 0)),
								TransactionHash: common.HexToHash("0xbf77b991e7a17fbf5da6089f9a27ff2805d63b8d0b18ff48e1d6e118404a7864"),
								Index:           203,
								Removed:         false,
							},
							{
								Address: common.HexToAddress("0xA478c2975Ab1Ea89e8196811F51A7B7Ade33eB11"),
								Topics: []common.Hash{
									common.HexToHash("0xddf252ad1be2c89b69c2b068fc378daa952ba7f163c4a11628f55a4df523b3ef"),
									common.HexToHash("0x000000000000000000000000a478c2975ab1ea89e8196811f51a7b7ade33eb11"),
									common.HexToHash("0x0000000000000000000000000000000000000000000000000000000000000000"),
								},
								Data:            hexutil.MustDecode("0x00000000000000000000000000000000000000000000000a83ffa947500b0bc9"),
								BlockNumber:     lo.Must(new(big.Int).SetString("17336353", 0)),
								TransactionHash: common.HexToHash("0xbf77b991e7a17fbf5da6089f9a27ff2805d63b8d0b18ff48e1d6e118404a7864"),
								Index:           204,
								Removed:         false,
							},
							{
								Address: common.HexToAddress("0x6B175474E89094C44Da98b954EedeAC495271d0F"),
								Topics: []common.Hash{
									common.HexToHash("0xddf252ad1be2c89b69c2b068fc378daa952ba7f163c4a11628f55a4df523b3ef"),
									common.HexToHash("0x000000000000000000000000a478c2975ab1ea89e8196811f51a7b7ade33eb11"),
									common.HexToHash("0x000000000000000000000000a5644e29708357803b5a882d272c41cc0df92b34"),
								},
								Data:            hexutil.MustDecode("0x00000000000000000000000000000000000000000000032e919c9e2643a96a35"),
								BlockNumber:     lo.Must(new(big.Int).SetString("17336353", 0)),
								TransactionHash: common.HexToHash("0xbf77b991e7a17fbf5da6089f9a27ff2805d63b8d0b18ff48e1d6e118404a7864"),
								Index:           205,
								Removed:         false,
							},
							{
								Address: common.HexToAddress("0xC02aaA39b223FE8D0A0e5C4F27eAD9083C756Cc2"),
								Topics: []common.Hash{
									common.HexToHash("0xddf252ad1be2c89b69c2b068fc378daa952ba7f163c4a11628f55a4df523b3ef"),
									common.HexToHash("0x000000000000000000000000a478c2975ab1ea89e8196811f51a7b7ade33eb11"),
									common.HexToHash("0x000000000000000000000000a5644e29708357803b5a882d272c41cc0df92b34"),
								},
								Data:            hexutil.MustDecode("0x000000000000000000000000000000000000000000000000739b809eed260661"),
								BlockNumber:     lo.Must(new(big.Int).SetString("17336353", 0)),
								TransactionHash: common.HexToHash("0xbf77b991e7a17fbf5da6089f9a27ff2805d63b8d0b18ff48e1d6e118404a7864"),
								Index:           206,
								Removed:         false,
							},
							{
								Address: common.HexToAddress("0xA478c2975Ab1Ea89e8196811F51A7B7Ade33eB11"),
								Topics: []common.Hash{
									common.HexToHash("0x1c411e9a96e071241c2f21f7726b17ae89e3cab4c78be50e062b03a9fffbbad1"),
								},
								Data:            hexutil.MustDecode("0x0000000000000000000000000000000000000000000644de6084cf4f442843520000000000000000000000000000000000000000000000e3c53f9be267974261"),
								BlockNumber:     lo.Must(new(big.Int).SetString("17336353", 0)),
								TransactionHash: common.HexToHash("0xbf77b991e7a17fbf5da6089f9a27ff2805d63b8d0b18ff48e1d6e118404a7864"),
								Index:           207,
								Removed:         false,
							},
							{
								Address: common.HexToAddress("0xA478c2975Ab1Ea89e8196811F51A7B7Ade33eB11"),
								Topics: []common.Hash{
									common.HexToHash("0xdccd412f0b1252819cb1fd330b93224ca42612892bb3f4f789976e6d81936496"),
									common.HexToHash("0x000000000000000000000000a5644e29708357803b5a882d272c41cc0df92b34"),
									common.HexToHash("0x000000000000000000000000a5644e29708357803b5a882d272c41cc0df92b34"),
								},
								Data:            hexutil.MustDecode("0x00000000000000000000000000000000000000000000032e919c9e2643a96a35000000000000000000000000000000000000000000000000739b809eed260661"),
								BlockNumber:     lo.Must(new(big.Int).SetString("17336353", 0)),
								TransactionHash: common.HexToHash("0xbf77b991e7a17fbf5da6089f9a27ff2805d63b8d0b18ff48e1d6e118404a7864"),
								Index:           208,
								Removed:         false,
							},
							{
								Address: common.HexToAddress("0x6B175474E89094C44Da98b954EedeAC495271d0F"),
								Topics: []common.Hash{
									common.HexToHash("0x8c5be1e5ebec7d5bd14f71427d1e84f3dd0314c0f7b2291e5b200ac8c7c3b925"),
									common.HexToHash("0x000000000000000000000000a5644e29708357803b5a882d272c41cc0df92b34"),
									common.HexToHash("0x000000000000000000000000c36442b4a4522e871399cd717abdd847ab11fe88"),
								},
								Data:            hexutil.MustDecode("0x00000000000000000000000000000000000000000000032e919c9e2643a96a35"),
								BlockNumber:     lo.Must(new(big.Int).SetString("17336353", 0)),
								TransactionHash: common.HexToHash("0xbf77b991e7a17fbf5da6089f9a27ff2805d63b8d0b18ff48e1d6e118404a7864"),
								Index:           209,
								Removed:         false,
							},
							{
								Address: common.HexToAddress("0xC02aaA39b223FE8D0A0e5C4F27eAD9083C756Cc2"),
								Topics: []common.Hash{
									common.HexToHash("0x8c5be1e5ebec7d5bd14f71427d1e84f3dd0314c0f7b2291e5b200ac8c7c3b925"),
									common.HexToHash("0x000000000000000000000000a5644e29708357803b5a882d272c41cc0df92b34"),
									common.HexToHash("0x000000000000000000000000c36442b4a4522e871399cd717abdd847ab11fe88"),
								},
								Data:            hexutil.MustDecode("0x000000000000000000000000000000000000000000000000739b809eed260661"),
								BlockNumber:     lo.Must(new(big.Int).SetString("17336353", 0)),
								TransactionHash: common.HexToHash("0xbf77b991e7a17fbf5da6089f9a27ff2805d63b8d0b18ff48e1d6e118404a7864"),
								Index:           210,
								Removed:         false,
							},
							{
								Address: common.HexToAddress("0x6B175474E89094C44Da98b954EedeAC495271d0F"),
								Topics: []common.Hash{
									common.HexToHash("0xddf252ad1be2c89b69c2b068fc378daa952ba7f163c4a11628f55a4df523b3ef"),
									common.HexToHash("0x000000000000000000000000a5644e29708357803b5a882d272c41cc0df92b34"),
									common.HexToHash("0x000000000000000000000000c2e9f25be6257c210d7adf0d4cd6e3e881ba25f8"),
								},
								Data:            hexutil.MustDecode("0x00000000000000000000000000000000000000000000032e919c9e2643a96a2b"),
								BlockNumber:     lo.Must(new(big.Int).SetString("17336353", 0)),
								TransactionHash: common.HexToHash("0xbf77b991e7a17fbf5da6089f9a27ff2805d63b8d0b18ff48e1d6e118404a7864"),
								Index:           211,
								Removed:         false,
							},
							{
								Address: common.HexToAddress("0xC02aaA39b223FE8D0A0e5C4F27eAD9083C756Cc2"),
								Topics: []common.Hash{
									common.HexToHash("0xddf252ad1be2c89b69c2b068fc378daa952ba7f163c4a11628f55a4df523b3ef"),
									common.HexToHash("0x000000000000000000000000a5644e29708357803b5a882d272c41cc0df92b34"),
									common.HexToHash("0x000000000000000000000000c2e9f25be6257c210d7adf0d4cd6e3e881ba25f8"),
								},
								Data:            hexutil.MustDecode("0x000000000000000000000000000000000000000000000000732161b20c68e1ff"),
								BlockNumber:     lo.Must(new(big.Int).SetString("17336353", 0)),
								TransactionHash: common.HexToHash("0xbf77b991e7a17fbf5da6089f9a27ff2805d63b8d0b18ff48e1d6e118404a7864"),
								Index:           212,
								Removed:         false,
							},
							{
								Address: common.HexToAddress("0xC2e9F25Be6257c210d7Adf0D4Cd6E3E881ba25f8"),
								Topics: []common.Hash{
									common.HexToHash("0x7a53080ba414158be7ec69b987b5fb7d07dee101fe85488f0853ae16239d0bde"),
									common.HexToHash("0x000000000000000000000000c36442b4a4522e871399cd717abdd847ab11fe88"),
									common.HexToHash("0xfffffffffffffffffffffffffffffffffffffffffffffffffffffffffffebbdc"),
									common.HexToHash("0xfffffffffffffffffffffffffffffffffffffffffffffffffffffffffffefaac"),
								},
								Data:            hexutil.MustDecode("0x000000000000000000000000c36442b4a4522e871399cd717abdd847ab11fe88000000000000000000000000000000000000000000000039d2dc6f2d314c4d1600000000000000000000000000000000000000000000032e919c9e2643a96a2b000000000000000000000000000000000000000000000000732161b20c68e1ff"),
								BlockNumber:     lo.Must(new(big.Int).SetString("17336353", 0)),
								TransactionHash: common.HexToHash("0xbf77b991e7a17fbf5da6089f9a27ff2805d63b8d0b18ff48e1d6e118404a7864"),
								Index:           213,
								Removed:         false,
							},
							{
								Address: common.HexToAddress("0xC36442b4a4522E871399CD717aBDD847Ab11FE88"),
								Topics: []common.Hash{
									common.HexToHash("0xddf252ad1be2c89b69c2b068fc378daa952ba7f163c4a11628f55a4df523b3ef"),
									common.HexToHash("0x0000000000000000000000000000000000000000000000000000000000000000"),
									common.HexToHash("0x000000000000000000000000f69a8916669de197e84cb39a38ba5115e8efcc77"),
									common.HexToHash("0x000000000000000000000000000000000000000000000000000000000007d319"),
								},
								Data:            nil,
								BlockNumber:     lo.Must(new(big.Int).SetString("17336353", 0)),
								TransactionHash: common.HexToHash("0xbf77b991e7a17fbf5da6089f9a27ff2805d63b8d0b18ff48e1d6e118404a7864"),
								Index:           214,
								Removed:         false,
							},
							{
								Address: common.HexToAddress("0xC36442b4a4522E871399CD717aBDD847Ab11FE88"),
								Topics: []common.Hash{
									common.HexToHash("0x3067048beee31b25b2f1681f88dac838c8bba36af25bfb2b7cf7473a5847e35f"),
									common.HexToHash("0x000000000000000000000000000000000000000000000000000000000007d319"),
								},
								Data:            hexutil.MustDecode("0x000000000000000000000000000000000000000000000039d2dc6f2d314c4d1600000000000000000000000000000000000000000000032e919c9e2643a96a2b000000000000000000000000000000000000000000000000732161b20c68e1ff"),
								BlockNumber:     lo.Must(new(big.Int).SetString("17336353", 0)),
								TransactionHash: common.HexToHash("0xbf77b991e7a17fbf5da6089f9a27ff2805d63b8d0b18ff48e1d6e118404a7864"),
								Index:           215,
								Removed:         false,
							},
							{
								Address: common.HexToAddress("0x6B175474E89094C44Da98b954EedeAC495271d0F"),
								Topics: []common.Hash{
									common.HexToHash("0x8c5be1e5ebec7d5bd14f71427d1e84f3dd0314c0f7b2291e5b200ac8c7c3b925"),
									common.HexToHash("0x000000000000000000000000a5644e29708357803b5a882d272c41cc0df92b34"),
									common.HexToHash("0x000000000000000000000000c36442b4a4522e871399cd717abdd847ab11fe88"),
								},
								Data:            hexutil.MustDecode("0x0000000000000000000000000000000000000000000000000000000000000000"),
								BlockNumber:     lo.Must(new(big.Int).SetString("17336353", 0)),
								TransactionHash: common.HexToHash("0xbf77b991e7a17fbf5da6089f9a27ff2805d63b8d0b18ff48e1d6e118404a7864"),
								Index:           216,
								Removed:         false,
							},
							{
								Address: common.HexToAddress("0x6B175474E89094C44Da98b954EedeAC495271d0F"),
								Topics: []common.Hash{
									common.HexToHash("0xddf252ad1be2c89b69c2b068fc378daa952ba7f163c4a11628f55a4df523b3ef"),
									common.HexToHash("0x000000000000000000000000a5644e29708357803b5a882d272c41cc0df92b34"),
									common.HexToHash("0x000000000000000000000000f69a8916669de197e84cb39a38ba5115e8efcc77"),
								},
								Data:            hexutil.MustDecode("0x000000000000000000000000000000000000000000000000000000000000000a"),
								BlockNumber:     lo.Must(new(big.Int).SetString("17336353", 0)),
								TransactionHash: common.HexToHash("0xbf77b991e7a17fbf5da6089f9a27ff2805d63b8d0b18ff48e1d6e118404a7864"),
								Index:           217,
								Removed:         false,
							},
							{
								Address: common.HexToAddress("0xC02aaA39b223FE8D0A0e5C4F27eAD9083C756Cc2"),
								Topics: []common.Hash{
									common.HexToHash("0x8c5be1e5ebec7d5bd14f71427d1e84f3dd0314c0f7b2291e5b200ac8c7c3b925"),
									common.HexToHash("0x000000000000000000000000a5644e29708357803b5a882d272c41cc0df92b34"),
									common.HexToHash("0x000000000000000000000000c36442b4a4522e871399cd717abdd847ab11fe88"),
								},
								Data:            hexutil.MustDecode("0x0000000000000000000000000000000000000000000000000000000000000000"),
								BlockNumber:     lo.Must(new(big.Int).SetString("17336353", 0)),
								TransactionHash: common.HexToHash("0xbf77b991e7a17fbf5da6089f9a27ff2805d63b8d0b18ff48e1d6e118404a7864"),
								Index:           218,
								Removed:         false,
							},
							{
								Address: common.HexToAddress("0xC02aaA39b223FE8D0A0e5C4F27eAD9083C756Cc2"),
								Topics: []common.Hash{
									common.HexToHash("0x7fcf532c15f0a6db0bd6d0e038bea71d30d808c7d98cb3bf7268a95bf5081b65"),
									common.HexToHash("0x000000000000000000000000a5644e29708357803b5a882d272c41cc0df92b34"),
								},
								Data:            hexutil.MustDecode("0x000000000000000000000000000000000000000000000000007a1eece0bd2462"),
								BlockNumber:     lo.Must(new(big.Int).SetString("17336353", 0)),
								TransactionHash: common.HexToHash("0xbf77b991e7a17fbf5da6089f9a27ff2805d63b8d0b18ff48e1d6e118404a7864"),
								Index:           219,
								Removed:         false,
							},
						},
						Status:           1,
						TransactionHash:  common.HexToHash("0xbf77b991e7a17fbf5da6089f9a27ff2805d63b8d0b18ff48e1d6e118404a7864"),
						TransactionIndex: 90,
					},
				},
				config: &config.Module{
					Network: network.Ethereum,
					Endpoint: config.Endpoint{
						URL: endpoint.MustGet(network.Ethereum),
					},
				},
			},
			want: &activityx.Activity{
				ID:      "0xbf77b991e7a17fbf5da6089f9a27ff2805d63b8d0b18ff48e1d6e118404a7864",
				Network: network.Ethereum,
				Index:   90,
				From:    "0xf69A8916669De197E84Cb39A38bA5115e8efCC77",
				To:      uniswap.AddressV3Migrator.String(),
				Type:    typex.ExchangeLiquidity,
				Calldata: &activityx.Calldata{
					FunctionHash: "0xac9650d8",
				},
				Platform: workerx.PlatformUniswap.String(),
				Fee: &activityx.Fee{
					Amount:  lo.Must(decimal.NewFromString("25334331411301152")),
					Decimal: 18,
				},
				Actions: []*activityx.Action{
					{
						Type:     typex.ExchangeLiquidity,
						Platform: workerx.PlatformUniswap.String(),
						From:     "0xA478c2975Ab1Ea89e8196811F51A7B7Ade33eB11",
						To:       "0xf69A8916669De197E84Cb39A38bA5115e8efCC77",
						Metadata: metadata.ExchangeLiquidity{
							Action: metadata.ActionExchangeLiquidityRemove,
							Tokens: []metadata.Token{
								{
									Address:  lo.ToPtr("0x6B175474E89094C44Da98b954EedeAC495271d0F"),
									Value:    lo.ToPtr(lo.Must(decimal.NewFromString("15026142111118622550581"))),
									Name:     "Dai Stablecoin",
									Symbol:   "DAI",
									Decimals: 18,
									Standard: metadata.StandardERC20,
								},
								{
									Address:  lo.ToPtr("0xC02aaA39b223FE8D0A0e5C4F27eAD9083C756Cc2"),
									Value:    lo.ToPtr(lo.Must(decimal.NewFromString("8330393355823744609"))),
									Name:     "Wrapped Ether",
									Symbol:   "WETH",
									Decimals: 18,
									Standard: metadata.StandardERC20,
								},
							},
						},
					},
					{
						Type:     typex.TransactionMint,
						Platform: workerx.PlatformUniswap.String(),
						From:     "0x0000000000000000000000000000000000000000",
						To:       "0xf69A8916669De197E84Cb39A38bA5115e8efCC77",
						Metadata: metadata.TransactionTransfer{
							Address:  lo.ToPtr("0xC36442b4a4522E871399CD717aBDD847Ab11FE88"),
							ID:       lo.ToPtr(decimal.NewFromInt(512793)),
							Value:    lo.ToPtr(decimal.NewFromInt(1)),
							Name:     "Uniswap V3 Positions NFT-V1",
							Symbol:   "UNI-V3-POS",
							Standard: metadata.StandardERC721,
						},
					},
					{
						Type:     typex.ExchangeLiquidity,
						Platform: workerx.PlatformUniswap.String(),
						From:     "0xf69A8916669De197E84Cb39A38bA5115e8efCC77",
						To:       uniswap.AddressNonfungiblePositionManager.String(),
						Metadata: metadata.ExchangeLiquidity{
							Action: metadata.ActionExchangeLiquidityAdd,
							Tokens: []metadata.Token{
								{
									Address:  lo.ToPtr("0x6B175474E89094C44Da98b954EedeAC495271d0F"),
									Value:    lo.ToPtr(lo.Must(decimal.NewFromString("15026142111118622550571"))),
									Name:     "Dai Stablecoin",
									Symbol:   "DAI",
									Decimals: 18,
									Standard: metadata.StandardERC20,
								},
								{
									Address:  lo.ToPtr("0xC02aaA39b223FE8D0A0e5C4F27eAD9083C756Cc2"),
									Value:    lo.ToPtr(lo.Must(decimal.NewFromString("8296019405933437439"))),
									Name:     "Wrapped Ether",
									Symbol:   "WETH",
									Decimals: 18,
									Standard: metadata.StandardERC20,
								},
							},
						},
					},
				},
				Status:    true,
				Timestamp: 1685020067,
			},
			wantError: require.NoError,
		},
		//	Linea
		{
			name: "Swap WETH and USDC on Linea Uniswap V3 Router 2",
			arguments: arguments{
				task: &source.Task{
					Network: network.Linea,
					ChainID: 59144,
					Header: &ethereum.Header{
						Hash:         common.HexToHash("0x38ea1b7457420ee27f56a160d6e9498cf95ea1d551c8fc12b22c6e12eb4e907b"),
						ParentHash:   common.HexToHash("0xbc3acd2c01aeb1040649e8e80bbc786badee743397ff14da095de87a25cb311d"),
						UncleHash:    common.HexToHash("0x1dcc4de8dec75d7aab85b567b6ccd41ad312451b948a7413f0a142fd40d49347"),
						Coinbase:     common.HexToAddress("0x0000000000000000000000000000000000000000"),
						Number:       lo.Must(new(big.Int).SetString("2779792", 0)),
						GasLimit:     61000000,
						GasUsed:      9787058,
						Timestamp:    1709977090,
						BaseFee:      lo.Must(new(big.Int).SetString("7", 0)),
						Transactions: nil,
					},
					Transaction: &ethereum.Transaction{
						BlockHash: common.HexToHash("0x288cfdec91d3d590dd2eac108927b9e1b40ea5dc48765717ae1d233425aa9316"),
						From:      common.HexToAddress("0x576ffCfbD57D9406bBeb7D9CE24751620314858f"),
						Gas:       168083,
						GasPrice:  lo.Must(new(big.Int).SetString("1433256209", 10)),
						Hash:      common.HexToHash("0x288cfdec91d3d590dd2eac108927b9e1b40ea5dc48765717ae1d233425aa9316"),
						Input:     hexutil.MustDecode("0x5ae401dc0000000000000000000000000000000000000000000000000000000065ec2e370000000000000000000000000000000000000000000000000000000000000040000000000000000000000000000000000000000000000000000000000000000100000000000000000000000000000000000000000000000000000000000000200000000000000000000000000000000000000000000000000000000000000104b858183f00000000000000000000000000000000000000000000000000000000000000200000000000000000000000000000000000000000000000000000000000000080000000000000000000000000576ffcfbd57d9406bbeb7d9ce24751620314858f0000000000000000000000000000000000000000000000000000034630b8a0000000000000000000000000000000000000000000000000000000000000003304000000000000000000000000000000000000000000000000000000000000002be5d7c2a44ffddf6b295a15c148167daaaf5cf34f000bb8176211869ca2b568f2a7d4ee941e073a821ee1ff00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000"),
						To:        lo.ToPtr(common.HexToAddress("0x3d4e44Eb1374240CE5F1B871ab261CD16335B76a")),
						Value:     lo.Must(new(big.Int).SetString("3600000000000", 0)),
						Type:      2,
						ChainID:   lo.Must(new(big.Int).SetString("59144", 0)),
					},
					Receipt: &ethereum.Receipt{
						BlockHash:         common.HexToHash("0x38ea1b7457420ee27f56a160d6e9498cf95ea1d551c8fc12b22c6e12eb4e907b"),
						BlockNumber:       lo.Must(new(big.Int).SetString("2779792", 0)),
						ContractAddress:   nil,
						CumulativeGasUsed: 7279276,
						EffectiveGasPrice: hexutil.MustDecodeBig("0x556dc111"),
						GasUsed:           128301,

						Logs: []*ethereum.Log{{
							Address: common.HexToAddress("0x176211869cA2b568f2A7D4EE941E073a821EE1ff"),
							Topics: []common.Hash{
								common.HexToHash("0xddf252ad1be2c89b69c2b068fc378daa952ba7f163c4a11628f55a4df523b3ef"),
								common.HexToHash("0x00000000000000000000000093f626d0e471279bd8d1420959cc881bdacfdab1"),
								common.HexToHash("0x000000000000000000000000576ffcfbd57d9406bbeb7d9ce24751620314858f"),
							},
							Data:            hexutil.MustDecode("0x0000000000000000000000000000000000000000000000000000000000003346"),
							BlockNumber:     lo.Must(new(big.Int).SetString("2779792", 0)),
							TransactionHash: common.HexToHash("0x288cfdec91d3d590dd2eac108927b9e1b40ea5dc48765717ae1d233425aa9316"),
							Index:           89,
							Removed:         false,
						}, {
							Address: common.HexToAddress("0xe5D7C2a44FfDDf6b295A15c148167daaAf5Cf34f"),
							Topics: []common.Hash{
								common.HexToHash("0xe1fffcc4923d04b559f4d29a8bfc6cda04eb5b0d3c460751c2402c5c5cc9109c"),
								common.HexToHash("0x0000000000000000000000003d4e44eb1374240ce5f1b871ab261cd16335b76a"),
							},
							Data:            hexutil.MustDecode("0x0000000000000000000000000000000000000000000000000000034630b8a000"),
							BlockNumber:     lo.Must(new(big.Int).SetString("2779792", 0)),
							TransactionHash: common.HexToHash("0x288cfdec91d3d590dd2eac108927b9e1b40ea5dc48765717ae1d233425aa9316"),
							Index:           90,
							Removed:         false,
						}, {
							Address: common.HexToAddress("0xe5D7C2a44FfDDf6b295A15c148167daaAf5Cf34f"),
							Topics: []common.Hash{
								common.HexToHash("0xddf252ad1be2c89b69c2b068fc378daa952ba7f163c4a11628f55a4df523b3ef"),
								common.HexToHash("0x0000000000000000000000003d4e44eb1374240ce5f1b871ab261cd16335b76a"),
								common.HexToHash("0x00000000000000000000000093f626d0e471279bd8d1420959cc881bdacfdab1"),
							},
							Data:            hexutil.MustDecode("0x0000000000000000000000000000000000000000000000000000034630b8a000"),
							BlockNumber:     lo.Must(new(big.Int).SetString("2779792", 0)),
							TransactionHash: common.HexToHash("0x288cfdec91d3d590dd2eac108927b9e1b40ea5dc48765717ae1d233425aa9316"),
							Index:           91,
							Removed:         false,
						}, {
							Address: common.HexToAddress("0x93F626d0E471279bd8d1420959CC881BdacfDAB1"),
							Topics: []common.Hash{
								common.HexToHash("0xc42079f94a6350d7e6235f29174924f928cc2ac818eb64fed8004e115fbcca67"),
								common.HexToHash("0x0000000000000000000000003d4e44eb1374240ce5f1b871ab261cd16335b76a"),
								common.HexToHash("0x000000000000000000000000576ffcfbd57d9406bbeb7d9ce24751620314858f"),
							},
							Data:            hexutil.MustDecode("0xffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffccba0000000000000000000000000000000000000000000000000000034630b8a00000000000000000000000000000000000000040c9a0783edf7fb2a85c5b5a91fa000000000000000000000000000000000000000000000000000000087180c1d5000000000000000000000000000000000000000000000000000000000002f71f"),
							BlockNumber:     lo.Must(new(big.Int).SetString("2779792", 0)),
							TransactionHash: common.HexToHash("0x288cfdec91d3d590dd2eac108927b9e1b40ea5dc48765717ae1d233425aa9316"),
							Index:           92,
							Removed:         false,
						}},
						Status:           1,
						TransactionHash:  common.HexToHash("0x288cfdec91d3d590dd2eac108927b9e1b40ea5dc48765717ae1d233425aa9316"),
						TransactionIndex: 82,
					},
				},
				config: &config.Module{
					Network: network.Linea,
					Endpoint: config.Endpoint{
						URL: endpoint.MustGet(network.Linea),
					},
				},
			},
			want: &activityx.Activity{
				ID:      "0x288cfdec91d3d590dd2eac108927b9e1b40ea5dc48765717ae1d233425aa9316",
				Network: network.Linea,
				Index:   82,
				From:    "0x576ffCfbD57D9406bBeb7D9CE24751620314858f",
				To:      uniswap.AddressV3SwapRouter02Linea.String(),
				Type:    typex.ExchangeSwap,
				Calldata: &activityx.Calldata{
					FunctionHash: "0x5ae401dc",
				},
				Platform: workerx.PlatformUniswap.String(),
				Fee: &activityx.Fee{
					Amount:  lo.Must(decimal.NewFromString("183888204870909")),
					Decimal: 18,
				},
				Actions: []*activityx.Action{
					{
						Type:     typex.ExchangeSwap,
						Platform: workerx.PlatformUniswap.String(),
						From:     "0x576ffCfbD57D9406bBeb7D9CE24751620314858f",
						To:       "0x576ffCfbD57D9406bBeb7D9CE24751620314858f",
						Metadata: metadata.ExchangeSwap{
							From: metadata.Token{
								Address:  lo.ToPtr("0xe5D7C2a44FfDDf6b295A15c148167daaAf5Cf34f"),
								Value:    lo.ToPtr(lo.Must(decimal.NewFromString("3600000000000"))),
								Name:     "Wrapped Ether",
								Symbol:   "WETH",
								Decimals: 18,
								Standard: metadata.StandardERC20,
							},
							To: metadata.Token{
								Address:  lo.ToPtr("0x176211869cA2b568f2A7D4EE941E073a821EE1ff"),
								Value:    lo.ToPtr(lo.Must(decimal.NewFromString("13126"))),
								Name:     "USDC",
								Symbol:   "USDC",
								Decimals: 6,
								Standard: metadata.StandardERC20,
							},
						},
					},
				},
				Status:    true,
				Timestamp: 1709977090,
			},
			wantError: require.NoError,
		},
		{
			name: "Add DAI and USDT liquidity to Linea Uniswap Nonfungible Position Manager",
			arguments: arguments{
				task: &source.Task{
					Network: network.Linea,
					ChainID: 59144,
					Header: &ethereum.Header{
						Hash:         common.HexToHash("0x32b6573327f3564bb8cdbc37f6a5636f39c8d7559868d2cdbe0baccbaa169a44"),
						ParentHash:   common.HexToHash("0x6c53f4bae5ae9168b86a837f2e2cae6e252d957a7407769c0381f315fb0baded"),
						UncleHash:    common.HexToHash("0x1dcc4de8dec75d7aab85b567b6ccd41ad312451b948a7413f0a142fd40d49347"),
						Coinbase:     common.HexToAddress("0x0000000000000000000000000000000000000000"),
						Number:       lo.Must(new(big.Int).SetString("2484565", 0)),
						GasLimit:     61000000,
						GasUsed:      6145306,
						Timestamp:    1708796179,
						BaseFee:      lo.Must(new(big.Int).SetString("7", 0)),
						Transactions: nil,
					},
					Transaction: &ethereum.Transaction{
						BlockHash: common.HexToHash("0x18281b269e35e2bbd226ff8f370f3280dbf985ce115d0df37ec999f88c035fba"),
						From:      common.HexToAddress("0xB2603DBa60e997B4C3dF90B162E9c2D1aF77202C"),
						Gas:       619767,
						GasPrice:  lo.Must(new(big.Int).SetString("1214340880", 10)),
						Hash:      common.HexToHash("0x18281b269e35e2bbd226ff8f370f3280dbf985ce115d0df37ec999f88c035fba"),
						Input:     hexutil.MustDecode("0x883164560000000000000000000000004af15ec2a0bd43db75dd04e62faa3b8ef36b00d5000000000000000000000000a219439258ca9da29e9cc4ce5596924745e12b930000000000000000000000000000000000000000000000000000000000000bb8fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffbc878fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffbc8b400000000000000000000000000000000000000000000000016a52886ef77b0000000000000000000000000000000000000000000000000000000000000447a6b00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000b2603dba60e997b4c3df90b162e9c2d1af77202c0000000000000000000000000000000000000000000000000000000065da2946"),
						To:        lo.ToPtr(common.HexToAddress("0x4615C383F85D0a2BbED973d83ccecf5CB7121463")),
						Value:     lo.Must(new(big.Int).SetString("0", 0)),
						Type:      2,
						ChainID:   lo.Must(new(big.Int).SetString("59144", 0)),
					},
					Receipt: &ethereum.Receipt{
						BlockHash:         common.HexToHash("0x32b6573327f3564bb8cdbc37f6a5636f39c8d7559868d2cdbe0baccbaa169a44"),
						BlockNumber:       lo.Must(new(big.Int).SetString("2484565", 0)),
						ContractAddress:   nil,
						CumulativeGasUsed: 6145306,
						EffectiveGasPrice: hexutil.MustDecodeBig("0x48615f10"),
						GasUsed:           504073,

						Logs: []*ethereum.Log{{
							Address: common.HexToAddress("0x4AF15ec2A0BD43Db75dd04E62FAA3B8EF36b00d5"),
							Topics: []common.Hash{
								common.HexToHash("0x8c5be1e5ebec7d5bd14f71427d1e84f3dd0314c0f7b2291e5b200ac8c7c3b925"),
								common.HexToHash("0x000000000000000000000000b2603dba60e997b4c3df90b162e9c2d1af77202c"),
								common.HexToHash("0x0000000000000000000000004615c383f85d0a2bbed973d83ccecf5cb7121463"),
							},
							Data:            hexutil.MustDecode("0x000000000000000000000000000000000000000000000000010fa455bfbe957e"),
							BlockNumber:     lo.Must(new(big.Int).SetString("2484565", 0)),
							TransactionHash: common.HexToHash("0x18281b269e35e2bbd226ff8f370f3280dbf985ce115d0df37ec999f88c035fba"),
							Index:           71,
							Removed:         false,
						}, {
							Address: common.HexToAddress("0x4AF15ec2A0BD43Db75dd04E62FAA3B8EF36b00d5"),
							Topics: []common.Hash{
								common.HexToHash("0xddf252ad1be2c89b69c2b068fc378daa952ba7f163c4a11628f55a4df523b3ef"),
								common.HexToHash("0x000000000000000000000000b2603dba60e997b4c3df90b162e9c2d1af77202c"),
								common.HexToHash("0x000000000000000000000000f39ea7438c2933221d39c2fb38f39b1793a6ce68"),
							},
							Data:            hexutil.MustDecode("0x000000000000000000000000000000000000000000000000159584312fb91a82"),
							BlockNumber:     lo.Must(new(big.Int).SetString("2484565", 0)),
							TransactionHash: common.HexToHash("0x18281b269e35e2bbd226ff8f370f3280dbf985ce115d0df37ec999f88c035fba"),
							Index:           72,
							Removed:         false,
						}, {
							Address: common.HexToAddress("0xA219439258ca9da29E9Cc4cE5596924745e12B93"),
							Topics: []common.Hash{
								common.HexToHash("0x8c5be1e5ebec7d5bd14f71427d1e84f3dd0314c0f7b2291e5b200ac8c7c3b925"),
								common.HexToHash("0x000000000000000000000000b2603dba60e997b4c3df90b162e9c2d1af77202c"),
								common.HexToHash("0x0000000000000000000000004615c383f85d0a2bbed973d83ccecf5cb7121463"),
							},
							Data:            hexutil.MustDecode("0x0000000000000000000000000000000000000000000000000000000000000000"),
							BlockNumber:     lo.Must(new(big.Int).SetString("2484565", 0)),
							TransactionHash: common.HexToHash("0x18281b269e35e2bbd226ff8f370f3280dbf985ce115d0df37ec999f88c035fba"),
							Index:           73,
							Removed:         false,
						}, {
							Address: common.HexToAddress("0xA219439258ca9da29E9Cc4cE5596924745e12B93"),
							Topics: []common.Hash{
								common.HexToHash("0xddf252ad1be2c89b69c2b068fc378daa952ba7f163c4a11628f55a4df523b3ef"),
								common.HexToHash("0x000000000000000000000000b2603dba60e997b4c3df90b162e9c2d1af77202c"),
								common.HexToHash("0x000000000000000000000000f39ea7438c2933221d39c2fb38f39b1793a6ce68"),
							},
							Data:            hexutil.MustDecode("0x0000000000000000000000000000000000000000000000000000000000447a6b"),
							BlockNumber:     lo.Must(new(big.Int).SetString("2484565", 0)),
							TransactionHash: common.HexToHash("0x18281b269e35e2bbd226ff8f370f3280dbf985ce115d0df37ec999f88c035fba"),
							Index:           74,
							Removed:         false,
						}, {
							Address: common.HexToAddress("0xF39eA7438c2933221d39C2fB38f39B1793a6cE68"),
							Topics: []common.Hash{
								common.HexToHash("0x7a53080ba414158be7ec69b987b5fb7d07dee101fe85488f0853ae16239d0bde"),
								common.HexToHash("0x0000000000000000000000004615c383f85d0a2bbed973d83ccecf5cb7121463"),
								common.HexToHash("0xfffffffffffffffffffffffffffffffffffffffffffffffffffffffffffbc878"),
								common.HexToHash("0xfffffffffffffffffffffffffffffffffffffffffffffffffffffffffffbc8b4"),
							},
							Data:            hexutil.MustDecode("0x0000000000000000000000004615c383f85d0a2bbed973d83ccecf5cb71214630000000000000000000000000000000000000000000000000007297543458575000000000000000000000000000000000000000000000000159584312fb91a820000000000000000000000000000000000000000000000000000000000447a6b"),
							BlockNumber:     lo.Must(new(big.Int).SetString("2484565", 0)),
							TransactionHash: common.HexToHash("0x18281b269e35e2bbd226ff8f370f3280dbf985ce115d0df37ec999f88c035fba"),
							Index:           75,
							Removed:         false,
						}, {
							Address: common.HexToAddress("0x4615C383F85D0a2BbED973d83ccecf5CB7121463"),
							Topics: []common.Hash{
								common.HexToHash("0xddf252ad1be2c89b69c2b068fc378daa952ba7f163c4a11628f55a4df523b3ef"),
								common.HexToHash("0x0000000000000000000000000000000000000000000000000000000000000000"),
								common.HexToHash("0x000000000000000000000000b2603dba60e997b4c3df90b162e9c2d1af77202c"),
								common.HexToHash("0x000000000000000000000000000000000000000000000000000000000000005e"),
							},
							Data:            nil,
							BlockNumber:     lo.Must(new(big.Int).SetString("2484565", 0)),
							TransactionHash: common.HexToHash("0x18281b269e35e2bbd226ff8f370f3280dbf985ce115d0df37ec999f88c035fba"),
							Index:           76,
							Removed:         false,
						}, {
							Address: common.HexToAddress("0x4615C383F85D0a2BbED973d83ccecf5CB7121463"),
							Topics: []common.Hash{
								common.HexToHash("0x3067048beee31b25b2f1681f88dac838c8bba36af25bfb2b7cf7473a5847e35f"),
								common.HexToHash("0x000000000000000000000000000000000000000000000000000000000000005e"),
							},
							Data:            hexutil.MustDecode("0x0000000000000000000000000000000000000000000000000007297543458575000000000000000000000000000000000000000000000000159584312fb91a820000000000000000000000000000000000000000000000000000000000447a6b"),
							BlockNumber:     lo.Must(new(big.Int).SetString("2484565", 0)),
							TransactionHash: common.HexToHash("0x18281b269e35e2bbd226ff8f370f3280dbf985ce115d0df37ec999f88c035fba"),
							Index:           77,
							Removed:         false,
						}},
						Status:           1,
						TransactionHash:  common.HexToHash("0x18281b269e35e2bbd226ff8f370f3280dbf985ce115d0df37ec999f88c035fba"),
						TransactionIndex: 46,
					},
				},
				config: &config.Module{
					Network: network.Linea,
					Endpoint: config.Endpoint{
						URL: endpoint.MustGet(network.Linea),
					},
				},
			},
			want: &activityx.Activity{
				ID:      "0x18281b269e35e2bbd226ff8f370f3280dbf985ce115d0df37ec999f88c035fba",
				Network: network.Linea,
				Index:   46,
				From:    "0xB2603DBa60e997B4C3dF90B162E9c2D1aF77202C",
				To:      uniswap.AddressNonfungiblePositionManagerLinea.String(),
				Type:    typex.ExchangeLiquidity,
				Calldata: &activityx.Calldata{
					FunctionHash: "0x88316456",
				},
				Platform: workerx.PlatformUniswap.String(),
				Fee: &activityx.Fee{
					Amount:  lo.Must(decimal.NewFromString("612116450404240")),
					Decimal: 18,
				},
				Actions: []*activityx.Action{
					{
						Type:     typex.TransactionMint,
						Platform: workerx.PlatformUniswap.String(),
						From:     "0x0000000000000000000000000000000000000000",
						To:       "0xB2603DBa60e997B4C3dF90B162E9c2D1aF77202C",
						Metadata: metadata.TransactionTransfer{
							Address:  lo.ToPtr("0x4615C383F85D0a2BbED973d83ccecf5CB7121463"),
							ID:       lo.ToPtr(decimal.NewFromInt(94)),
							Value:    lo.ToPtr(decimal.NewFromInt(1)),
							Name:     "Uniswap V3 Positions NFT-V1",
							Symbol:   "UNI-V3-POS",
							Standard: metadata.StandardERC721,
						},
					},
					{
						Type:     typex.ExchangeLiquidity,
						Platform: workerx.PlatformUniswap.String(),
						From:     "0xB2603DBa60e997B4C3dF90B162E9c2D1aF77202C",
						To:       uniswap.AddressNonfungiblePositionManagerLinea.String(),
						Metadata: metadata.ExchangeLiquidity{
							Action: metadata.ActionExchangeLiquidityAdd,
							Tokens: []metadata.Token{
								{
									Address:  lo.ToPtr("0x4AF15ec2A0BD43Db75dd04E62FAA3B8EF36b00d5"),
									Value:    lo.ToPtr(lo.Must(decimal.NewFromString("1555294593115298434"))),
									Name:     "Dai Stablecoin",
									Symbol:   "DAI",
									Decimals: 18,
									Standard: metadata.StandardERC20,
								},
								{
									Address:  lo.ToPtr("0xA219439258ca9da29E9Cc4cE5596924745e12B93"),
									Value:    lo.ToPtr(lo.Must(decimal.NewFromString("4487787"))),
									Name:     "Tether USD",
									Symbol:   "USDT",
									Decimals: 6,
									Standard: metadata.StandardERC20,
								},
							},
						},
					},
				},
				Status:    true,
				Timestamp: 1708796179,
			},
			wantError: require.NoError,
		},
		{
			name: "Collect USDC and WETH liquidity from Linea Uniswap Nonfungible Position Manager",
			arguments: arguments{
				task: &source.Task{
					Network: network.Linea,
					ChainID: 59144,
					Header: &ethereum.Header{
						Hash:         common.HexToHash("0xa0813b3c869629efae316f60be55960c3d9182428bc5044ed580046b97c4d4f5"),
						ParentHash:   common.HexToHash("0x5e35560be35cd8c37cb740e50eb4d7cda695b84cbdbe4f351bd05dc13824817f"),
						UncleHash:    common.HexToHash("0x1dcc4de8dec75d7aab85b567b6ccd41ad312451b948a7413f0a142fd40d49347"),
						Coinbase:     common.HexToAddress("0x0000000000000000000000000000000000000000"),
						Number:       lo.Must(new(big.Int).SetString("2905138", 0)),
						GasLimit:     61000000,
						GasUsed:      3690007,
						Timestamp:    1710478474,
						BaseFee:      lo.Must(new(big.Int).SetString("7", 0)),
						Transactions: nil,
					},
					Transaction: &ethereum.Transaction{
						BlockHash: common.HexToHash("0xf84880b33363ca37be90566b9ae532a1c9f7fe99b5732fa73e300fbe9b7c769c"),
						From:      common.HexToAddress("0x97d35D3F6B7a303B8F40C7f61Ab90CAe5Bf71acB"),
						Gas:       209560,
						GasPrice:  lo.Must(new(big.Int).SetString("1658138409", 10)),
						Hash:      common.HexToHash("0xf84880b33363ca37be90566b9ae532a1c9f7fe99b5732fa73e300fbe9b7c769c"),
						Input:     hexutil.MustDecode("0xfc6f7865000000000000000000000000000000000000000000000000000000000000004e00000000000000000000000097d35d3f6b7a303b8f40c7f61ab90cae5bf71acb00000000000000000000000000000000ffffffffffffffffffffffffffffffff00000000000000000000000000000000ffffffffffffffffffffffffffffffff"),
						To:        lo.ToPtr(common.HexToAddress("0x4615C383F85D0a2BbED973d83ccecf5CB7121463")),
						Value:     lo.Must(new(big.Int).SetString("0", 0)),
						Type:      2,
						ChainID:   lo.Must(new(big.Int).SetString("59144", 0)),
					},
					Receipt: &ethereum.Receipt{
						BlockHash:         common.HexToHash("0xa0813b3c869629efae316f60be55960c3d9182428bc5044ed580046b97c4d4f5"),
						BlockNumber:       lo.Must(new(big.Int).SetString("2905138", 0)),
						ContractAddress:   nil,
						CumulativeGasUsed: 3014183,
						EffectiveGasPrice: hexutil.MustDecodeBig("0x62d52f29"),
						GasUsed:           202576,

						Logs: []*ethereum.Log{{
							Address: common.HexToAddress("0xA0c5684512c63B87025D004199Ed7e7358261f15"),
							Topics: []common.Hash{
								common.HexToHash("0x0c396cd989a39f4459b5fa1aed6a9a8dcdbc45908acfd67e028cd568da98982c"),
								common.HexToHash("0x0000000000000000000000004615c383f85d0a2bbed973d83ccecf5cb7121463"),
								common.HexToHash("0x0000000000000000000000000000000000000000000000000000000000030250"),
								common.HexToHash("0x0000000000000000000000000000000000000000000000000000000000030318"),
							},
							Data:            hexutil.MustDecode("0x000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000"),
							BlockNumber:     lo.Must(new(big.Int).SetString("2905138", 0)),
							TransactionHash: common.HexToHash("0xf84880b33363ca37be90566b9ae532a1c9f7fe99b5732fa73e300fbe9b7c769c"),
							Index:           34,
							Removed:         false,
						}, {
							Address: common.HexToAddress("0x176211869cA2b568f2A7D4EE941E073a821EE1ff"),
							Topics: []common.Hash{
								common.HexToHash("0xddf252ad1be2c89b69c2b068fc378daa952ba7f163c4a11628f55a4df523b3ef"),
								common.HexToHash("0x000000000000000000000000a0c5684512c63b87025d004199ed7e7358261f15"),
								common.HexToHash("0x00000000000000000000000097d35d3f6b7a303b8f40c7f61ab90cae5bf71acb"),
							},
							Data:            hexutil.MustDecode("0x0000000000000000000000000000000000000000000000000000000000330497"),
							BlockNumber:     lo.Must(new(big.Int).SetString("2905138", 0)),
							TransactionHash: common.HexToHash("0xf84880b33363ca37be90566b9ae532a1c9f7fe99b5732fa73e300fbe9b7c769c"),
							Index:           35,
							Removed:         false,
						}, {
							Address: common.HexToAddress("0xe5D7C2a44FfDDf6b295A15c148167daaAf5Cf34f"),
							Topics: []common.Hash{
								common.HexToHash("0xddf252ad1be2c89b69c2b068fc378daa952ba7f163c4a11628f55a4df523b3ef"),
								common.HexToHash("0x000000000000000000000000a0c5684512c63b87025d004199ed7e7358261f15"),
								common.HexToHash("0x00000000000000000000000097d35d3f6b7a303b8f40c7f61ab90cae5bf71acb"),
							},
							Data:            hexutil.MustDecode("0x00000000000000000000000000000000000000000000000000038f9913406bf8"),
							BlockNumber:     lo.Must(new(big.Int).SetString("2905138", 0)),
							TransactionHash: common.HexToHash("0xf84880b33363ca37be90566b9ae532a1c9f7fe99b5732fa73e300fbe9b7c769c"),
							Index:           36,
							Removed:         false,
						}, {
							Address: common.HexToAddress("0xA0c5684512c63B87025D004199Ed7e7358261f15"),
							Topics: []common.Hash{
								common.HexToHash("0x70935338e69775456a85ddef226c395fb668b63fa0115f5f20610b388e6ca9c0"),
								common.HexToHash("0x0000000000000000000000004615c383f85d0a2bbed973d83ccecf5cb7121463"),
								common.HexToHash("0x0000000000000000000000000000000000000000000000000000000000030250"),
								common.HexToHash("0x0000000000000000000000000000000000000000000000000000000000030318"),
							},
							Data:            hexutil.MustDecode("0x00000000000000000000000097d35d3f6b7a303b8f40c7f61ab90cae5bf71acb000000000000000000000000000000000000000000000000000000000033049700000000000000000000000000000000000000000000000000038f9913406bf8"),
							BlockNumber:     lo.Must(new(big.Int).SetString("2905138", 0)),
							TransactionHash: common.HexToHash("0xf84880b33363ca37be90566b9ae532a1c9f7fe99b5732fa73e300fbe9b7c769c"),
							Index:           37,
							Removed:         false,
						}, {
							Address: common.HexToAddress("0x4615C383F85D0a2BbED973d83ccecf5CB7121463"),
							Topics: []common.Hash{
								common.HexToHash("0x40d0efd1a53d60ecbf40971b9daf7dc90178c3aadc7aab1765632738fa8b8f01"),
								common.HexToHash("0x000000000000000000000000000000000000000000000000000000000000004e"),
							},
							Data:            hexutil.MustDecode("0x00000000000000000000000097d35d3f6b7a303b8f40c7f61ab90cae5bf71acb000000000000000000000000000000000000000000000000000000000033049700000000000000000000000000000000000000000000000000038f9913406bf8"),
							BlockNumber:     lo.Must(new(big.Int).SetString("2905138", 0)),
							TransactionHash: common.HexToHash("0xf84880b33363ca37be90566b9ae532a1c9f7fe99b5732fa73e300fbe9b7c769c"),
							Index:           38,
							Removed:         false,
						}},
						Status:           1,
						TransactionHash:  common.HexToHash("0xf84880b33363ca37be90566b9ae532a1c9f7fe99b5732fa73e300fbe9b7c769c"),
						TransactionIndex: 19,
					},
				},
				config: &config.Module{
					Network: network.Linea,
					Endpoint: config.Endpoint{
						URL: endpoint.MustGet(network.Linea),
					},
				},
			},
			want: &activityx.Activity{
				ID:      "0xf84880b33363ca37be90566b9ae532a1c9f7fe99b5732fa73e300fbe9b7c769c",
				Network: network.Linea,
				Index:   19,
				From:    "0x97d35D3F6B7a303B8F40C7f61Ab90CAe5Bf71acB",
				To:      uniswap.AddressNonfungiblePositionManagerLinea.String(),
				Type:    typex.ExchangeLiquidity,
				Calldata: &activityx.Calldata{
					FunctionHash: "0xfc6f7865",
				},
				Platform: workerx.PlatformUniswap.String(),
				Fee: &activityx.Fee{
					Amount:  lo.Must(decimal.NewFromString("335899046341584")),
					Decimal: 18,
				},
				Actions: []*activityx.Action{
					{
						Type:     typex.ExchangeLiquidity,
						Platform: workerx.PlatformUniswap.String(),
						From:     uniswap.AddressNonfungiblePositionManagerLinea.String(),
						To:       "0x97d35D3F6B7a303B8F40C7f61Ab90CAe5Bf71acB",
						Metadata: metadata.ExchangeLiquidity{
							Action: metadata.ActionExchangeLiquidityCollect,
							Tokens: []metadata.Token{
								{
									Address:  lo.ToPtr("0x176211869cA2b568f2A7D4EE941E073a821EE1ff"),
									Value:    lo.ToPtr(lo.Must(decimal.NewFromString("3343511"))),
									Name:     "USDC",
									Symbol:   "USDC",
									Decimals: 6,
									Standard: metadata.StandardERC20,
								},
								{
									Address:  lo.ToPtr("0xe5D7C2a44FfDDf6b295A15c148167daaAf5Cf34f"),
									Value:    lo.ToPtr(lo.Must(decimal.NewFromString("1002312545889272"))),
									Name:     "Wrapped Ether",
									Symbol:   "WETH",
									Decimals: 18,
									Standard: metadata.StandardERC20,
								},
							},
						},
					},
				},
				Status:    true,
				Timestamp: 1710478474,
			},
			wantError: require.NoError,
		},
	}

	for _, testcase := range testcases {
		testcase := testcase

		t.Run(testcase.name, func(t *testing.T) {
			t.Parallel()

			ctx := context.Background()

			instance, err := worker.NewWorker(testcase.arguments.config)
			require.NoError(t, err)

			activity, err := instance.Transform(ctx, testcase.arguments.task)
			testcase.wantError(t, err)

			// t.Log(string(lo.Must(json.MarshalIndent(activity, "", "\x20\x20"))))

			require.Equal(t, testcase.want, activity)
		})
	}
}
