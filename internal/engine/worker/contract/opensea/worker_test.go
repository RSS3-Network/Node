package opensea_test

import (
	"context"
	"math/big"
	"testing"

	"github.com/ethereum/go-ethereum/common"
	"github.com/ethereum/go-ethereum/common/hexutil"
	"github.com/rss3-network/node/config"
	source "github.com/rss3-network/node/internal/engine/source/ethereum"
	worker "github.com/rss3-network/node/internal/engine/worker/contract/opensea"
	"github.com/rss3-network/node/provider/ethereum"
	"github.com/rss3-network/node/provider/ethereum/endpoint"
	"github.com/rss3-network/protocol-go/schema"
	"github.com/rss3-network/protocol-go/schema/filter"
	"github.com/rss3-network/protocol-go/schema/metadata"
	"github.com/samber/lo"
	"github.com/shopspring/decimal"
	"github.com/stretchr/testify/require"
)

func TestWorker_Ethereum(t *testing.T) {
	t.Parallel()

	type arguments struct {
		task   *source.Task
		config *config.Module
	}

	testcases := []struct {
		name      string
		arguments arguments
		want      *schema.Feed
		wantError require.ErrorAssertionFunc
	}{
		{
			name: "Buy ZGC #5 on Seaport V1.1",
			arguments: arguments{
				task: &source.Task{
					Network: filter.NetworkEthereum,
					ChainID: 1,
					Header: &ethereum.Header{
						Hash:         common.HexToHash("0x3958c2c95e2048e95344dd4846d387b309edafbf96e0a9ac4c4f4152ff253c59"),
						ParentHash:   common.HexToHash("0x9da3486783daab23246967b3f067ef82238a687e6a6c3b229a7fb58e2ada5452"),
						UncleHash:    common.HexToHash("0x1dcc4de8dec75d7aab85b567b6ccd41ad312451b948a7413f0a142fd40d49347"),
						Coinbase:     common.HexToAddress("0x1959062D601c40Ef3B093a63f0954C6eE54A0a0F"),
						Number:       lo.Must(new(big.Int).SetString("16216786", 0)),
						GasLimit:     30000000,
						GasUsed:      24326175,
						Timestamp:    1671429323,
						BaseFee:      lo.Must(new(big.Int).SetString("11717147146", 0)),
						Transactions: nil,
					},
					Transaction: &ethereum.Transaction{
						BlockHash: common.HexToHash("0xab3b7cc0bdbe6bde86855c82adc59e65fef6b9fe5abc5ccd4966076637a90781"),
						From:      common.HexToAddress("0x934B510D4C9103E6a87AEf13b816fb080286D649"),
						Gas:       173902,
						Hash:      common.HexToHash("0xab3b7cc0bdbe6bde86855c82adc59e65fef6b9fe5abc5ccd4966076637a90781"),
						Input:     hexutil.MustDecode("0xfb0f3ee100000000000000000000000000000000000000000000000000000000000000200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000339a69195cd0000000000000000000000000006fec7e57a21c3594619ae3ccc72330d5c71e6d11000000000000000000000000004c00500000ad104d7dbd00e3ae0a5c00560c0000000000000000000000000074ee68a33f6c9f113e22b3b77418b75f85d07d2200000000000000000000000000000000000000000000000000000000000000050000000000000000000000000000000000000000000000000000000000000001000000000000000000000000000000000000000000000000000000000000000700000000000000000000000000000000000000000000000000000000639ff95e0000000000000000000000000000000000000000000000000000000063c8d7de0000000000000000000000000000000000000000000000000000000000000000360c6ebe0000000000000000000000000000000000000000976dfaaf14cabe1e0000007b02230091a7ed01230072f7006a004d60a8d4e71d599b8104250f00000000007b02230091a7ed01230072f7006a004d60a8d4e71d599b8104250f00000000000000000000000000000000000000000000000000000000000000000002000000000000000000000000000000000000000000000000000000000000024000000000000000000000000000000000000000000000000000000000000002e0000000000000000000000000000000000000000000000000000000000000000200000000000000000000000000000000000000000000000000017970b794f0000000000000000000000000000000a26b00c1f0df003000390027140000faa7190000000000000000000000000000000000000000000000000005e5c2de53c000000000000000000000000000d0f26bb9ec263b540e7eec7afb25ecfd10b9ceac0000000000000000000000000000000000000000000000000000000000000041ee8bde9e3ab60f91e25867b929e0a13627a516b9905a99dce3e3464c470c6a6403bf661671ffbb260e292b097d3cd61261c9646084d0d0bf7162782d64ac9b6d1b00000000000000000000000000000000000000000000000000000000000000"),
						To:        lo.ToPtr(common.HexToAddress("0x00000000006c3852cbEf3e08E8dF289169EdE581")),
						Value:     lo.Must(new(big.Int).SetString("16600000000000000", 0)),
						Type:      2,
						ChainID:   lo.Must(new(big.Int).SetString("1", 0)),
					},
					Receipt: &ethereum.Receipt{
						BlockHash:         common.HexToHash("0x3958c2c95e2048e95344dd4846d387b309edafbf96e0a9ac4c4f4152ff253c59"),
						BlockNumber:       lo.Must(new(big.Int).SetString("16216786", 0)),
						ContractAddress:   nil,
						CumulativeGasUsed: 24280078,
						EffectiveGasPrice: hexutil.MustDecodeBig("0x2bc9e86d5"),
						GasUsed:           153122,
						Logs: []*ethereum.Log{{
							Address: common.HexToAddress("0x00000000006c3852cbEf3e08E8dF289169EdE581"),
							Topics: []common.Hash{
								common.HexToHash("0x9d9af8e38d66c62e2c12f0225249fd9d721c54b83f48d9352c97c6cacdcb6f31"),
								common.HexToHash("0x0000000000000000000000006fec7e57a21c3594619ae3ccc72330d5c71e6d11"),
								common.HexToHash("0x000000000000000000000000004c00500000ad104d7dbd00e3ae0a5c00560c00"),
							},
							Data:            hexutil.MustDecode("0x4d99ffe7fcc5f7e0700f00afbc2db580bd1814ec0782fad330831f33d230051f000000000000000000000000934b510d4c9103e6a87aef13b816fb080286d649000000000000000000000000000000000000000000000000000000000000008000000000000000000000000000000000000000000000000000000000000001200000000000000000000000000000000000000000000000000000000000000001000000000000000000000000000000000000000000000000000000000000000300000000000000000000000074ee68a33f6c9f113e22b3b77418b75f85d07d2200000000000000000000000000000000000000000000000000000000000000050000000000000000000000000000000000000000000000000000000000000001000000000000000000000000000000000000000000000000000000000000000300000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000339a69195cd0000000000000000000000000006fec7e57a21c3594619ae3ccc72330d5c71e6d1100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000017970b794f0000000000000000000000000000000a26b00c1f0df003000390027140000faa7190000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000005e5c2de53c000000000000000000000000000d0f26bb9ec263b540e7eec7afb25ecfd10b9ceac"),
							BlockNumber:     lo.Must(new(big.Int).SetString("16216786", 0)),
							TransactionHash: common.HexToHash("0xab3b7cc0bdbe6bde86855c82adc59e65fef6b9fe5abc5ccd4966076637a90781"),
							Index:           138,
							Removed:         false,
						}, {
							Address: common.HexToAddress("0x74EE68a33f6c9f113e22B3B77418B75f85d07D22"),
							Topics: []common.Hash{
								common.HexToHash("0xc3d58168c5ae7397731d063d5bbf3d657854427343f4c083240f7aacaa2d0f62"),
								common.HexToHash("0x0000000000000000000000001e0049783f008a0085193e00003d00cd54003c71"),
								common.HexToHash("0x0000000000000000000000006fec7e57a21c3594619ae3ccc72330d5c71e6d11"),
								common.HexToHash("0x000000000000000000000000934b510d4c9103e6a87aef13b816fb080286d649"),
							},
							Data:            hexutil.MustDecode("0x00000000000000000000000000000000000000000000000000000000000000050000000000000000000000000000000000000000000000000000000000000001"),
							BlockNumber:     lo.Must(new(big.Int).SetString("16216786", 0)),
							TransactionHash: common.HexToHash("0xab3b7cc0bdbe6bde86855c82adc59e65fef6b9fe5abc5ccd4966076637a90781"),
							Index:           139,
							Removed:         false,
						}, {
							Address: common.HexToAddress("0xD0f26Bb9Ec263b540e7eEC7aFb25ecFd10B9CeAC"),
							Topics: []common.Hash{
								common.HexToHash("0x3d0ce9bfc3ed7d6862dbb28b2dea94561fe714a1b4d019aa8af39730d1ad7c3d"),
								common.HexToHash("0x00000000000000000000000000000000006c3852cbef3e08e8df289169ede581"),
							},
							Data:            hexutil.MustDecode("0x0000000000000000000000000000000000000000000000000005e5c2de53c000"),
							BlockNumber:     lo.Must(new(big.Int).SetString("16216786", 0)),
							TransactionHash: common.HexToHash("0xab3b7cc0bdbe6bde86855c82adc59e65fef6b9fe5abc5ccd4966076637a90781"),
							Index:           140,
							Removed:         false,
						}},
						Status:           1,
						TransactionHash:  common.HexToHash("0xab3b7cc0bdbe6bde86855c82adc59e65fef6b9fe5abc5ccd4966076637a90781"),
						TransactionIndex: 96,
					},
				},
				config: &config.Module{
					Network:  filter.NetworkEthereum,
					Endpoint: endpoint.MustGet(filter.NetworkEthereum),
				},
			},
			want: &schema.Feed{
				ID:      "0xab3b7cc0bdbe6bde86855c82adc59e65fef6b9fe5abc5ccd4966076637a90781",
				Network: filter.NetworkEthereum,
				Index:   96,
				From:    "0x934B510D4C9103E6a87AEf13b816fb080286D649",
				To:      "0x00000000006c3852cbEf3e08E8dF289169EdE581",
				Type:    filter.TypeCollectibleTrade,
				Calldata: &schema.Calldata{
					FunctionHash: "0xfb0f3ee1",
				},
				Platform: lo.ToPtr(filter.PlatformOpenSea),
				Fee: &schema.Fee{
					Amount:  lo.Must(decimal.NewFromString("1799863423694410")),
					Decimal: 18,
				},
				Actions: []*schema.Action{
					{
						Type:     filter.TypeCollectibleTrade,
						Platform: filter.PlatformOpenSea.String(),
						From:     "0x6FEC7E57A21C3594619ae3CCc72330D5C71e6d11",
						To:       "0x934B510D4C9103E6a87AEf13b816fb080286D649",
						Metadata: metadata.CollectibleTrade{
							Action: metadata.ActionCollectibleTradeBuy,
							Token: metadata.Token{
								Address:  lo.ToPtr("0x74EE68a33f6c9f113e22B3B77418B75f85d07D22"),
								ID:       lo.ToPtr(lo.Must(decimal.NewFromString("5"))),
								Value:    lo.ToPtr(lo.Must(decimal.NewFromString("1"))),
								Name:     "Zerion Genesis Collection",
								Symbol:   "ZGC",
								Standard: metadata.StandardERC1155,
								URI:      "ipfs://QmXBUGFTXuAeBfK9oB9G1NAhGq7AwosWjHFRHMdahETeRK",
							},

							Cost: &metadata.Token{
								Value:    lo.ToPtr(lo.Must(decimal.NewFromString("14525000000000000"))),
								Name:     "Ethereum",
								Symbol:   "ETH",
								Decimals: 18,
							},
						},
					},
				},
				Status:    true,
				Timestamp: 1671429323,
			},
			wantError: require.NoError,
		},
		{
			name: "Sell TurtlecaseGang #51 on Seaport V1.1",
			arguments: arguments{
				task: &source.Task{
					Network: filter.NetworkEthereum,
					ChainID: 1,
					Header: &ethereum.Header{
						Hash:         common.HexToHash("0x0a8b4de8221564ed79194421a709d84be2d333521bb43e53c244f3c41f132752"),
						ParentHash:   common.HexToHash("0xc71f2d6006a2780a3ff53f22767be62b7d892edfb448ed200d3cb8d9488f786f"),
						UncleHash:    common.HexToHash("0x1dcc4de8dec75d7aab85b567b6ccd41ad312451b948a7413f0a142fd40d49347"),
						Coinbase:     common.HexToAddress("0x0000000000000000000000000000000000000001"),
						Number:       lo.Must(new(big.Int).SetString("15809204", 0)),
						GasLimit:     30000000,
						GasUsed:      13747870,
						Timestamp:    1666508723,
						BaseFee:      lo.Must(new(big.Int).SetString("11898263569", 0)),
						Transactions: nil,
					},
					Transaction: &ethereum.Transaction{
						BlockHash: common.HexToHash("0x097c15e4ebe2cbaa8d0b565999795e5fefb71e3c5c7ef42e9ab7d92c2a25980d"),
						From:      common.HexToAddress("0x934B510D4C9103E6a87AEf13b816fb080286D649"),
						Gas:       205362,
						Hash:      common.HexToHash("0x097c15e4ebe2cbaa8d0b565999795e5fefb71e3c5c7ef42e9ab7d92c2a25980d"),
						Input:     hexutil.MustDecode("0xe7acab24000000000000000000000000000000000000000000000000000000000000008000000000000000000000000000000000000000000000000000000000000006600000007b02230091a7ed01230072f7006a004d60a8d4e71d599b8104250f0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000a000000000000000000000000000000000000000000000000000000000000000010000000000000000000000000000000000000000000000000000000000000001000000000000000000000000000000000000000000000000000000000000052000000000000000000000000000000000000000000000000000000000000005a0000000000000000000000000dae889230c6a20359d9aff984700c8a115ef8681000000000000000000000000004c00500000ad104d7dbd00e3ae0a5c00560c00000000000000000000000000000000000000000000000000000000000000016000000000000000000000000000000000000000000000000000000000000002200000000000000000000000000000000000000000000000000000000000000002000000000000000000000000000000000000000000000000000000006354e5f3000000000000000000000000000000000000000000000000000000006354ebcc0000000000000000000000000000000000000000000000000000000000000000360c6ebe0000000000000000000000000000000000000000d8799fd568bd4a1b0000007b02230091a7ed01230072f7006a004d60a8d4e71d599b8104250f0000000000000000000000000000000000000000000000000000000000000000000300000000000000000000000000000000000000000000000000000000000000010000000000000000000000000000000000000000000000000000000000000001000000000000000000000000c02aaa39b223fe8d0a0e5c4f27ead9083c756cc20000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000016123c5faac8000000000000000000000000000000000000000000000000000016123c5faac800000000000000000000000000000000000000000000000000000000000000000030000000000000000000000000000000000000000000000000000000000000004000000000000000000000000b6d241c6cb1e8d2fc65a012d51406138cb42801d000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000010000000000000000000000000000000000000000000000000000000000000001000000000000000000000000dae889230c6a20359d9aff984700c8a115ef86810000000000000000000000000000000000000000000000000000000000000001000000000000000000000000c02aaa39b223fe8d0a0e5c4f27ead9083c756cc200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000008d418264450000000000000000000000000000000000000000000000000000008d418264450000000000000000000000000000000a26b00c1f0df003000390027140000faa7190000000000000000000000000000000000000000000000000000000000000001000000000000000000000000c02aaa39b223fe8d0a0e5c4f27ead9083c756cc200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000011a8304c88a0000000000000000000000000000000000000000000000000000011a8304c88a000000000000000000000000000c6f926654428f0faf8d0878ab8f6f113140408fd00000000000000000000000000000000000000000000000000000000000000419c86525b57be4084f030ba708b706c9ecb6ac37fc143fffecde729f6ba0acd3573cdbb3f1b56b516266941f8718dfd4c046c504c8341d6a5e02d365766a4497a1c000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000010000000000000000000000000000000000000000000000000000000000000020000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000003300000000000000000000000000000000000000000000000000000000000000a00000000000000000000000000000000000000000000000000000000000000000360c6ebe"),
						To:        lo.ToPtr(common.HexToAddress("0x00000000006c3852cbEf3e08E8dF289169EdE581")),
						Value:     lo.Must(new(big.Int).SetString("0", 0)),
						Type:      2,
						ChainID:   lo.Must(new(big.Int).SetString("1", 0)),
					},
					Receipt: &ethereum.Receipt{
						BlockHash:         common.HexToHash("0x0a8b4de8221564ed79194421a709d84be2d333521bb43e53c244f3c41f132752"),
						BlockNumber:       lo.Must(new(big.Int).SetString("15809204", 0)),
						ContractAddress:   nil,
						CumulativeGasUsed: 7953745,
						EffectiveGasPrice: hexutil.MustDecodeBig("0x31e994711"),
						GasUsed:           200442,
						Logs: []*ethereum.Log{{
							Address: common.HexToAddress("0xC02aaA39b223FE8D0A0e5C4F27eAD9083C756Cc2"),
							Topics: []common.Hash{
								common.HexToHash("0xddf252ad1be2c89b69c2b068fc378daa952ba7f163c4a11628f55a4df523b3ef"),
								common.HexToHash("0x000000000000000000000000dae889230c6a20359d9aff984700c8a115ef8681"),
								common.HexToHash("0x000000000000000000000000934b510d4c9103e6a87aef13b816fb080286d649"),
							},
							Data:            hexutil.MustDecode("0x000000000000000000000000000000000000000000000000016123c5faac8000"),
							BlockNumber:     lo.Must(new(big.Int).SetString("15809204", 0)),
							TransactionHash: common.HexToHash("0x097c15e4ebe2cbaa8d0b565999795e5fefb71e3c5c7ef42e9ab7d92c2a25980d"),
							Index:           173,
							Removed:         false,
						}, {
							Address: common.HexToAddress("0xB6d241C6CB1E8d2Fc65a012D51406138CB42801D"),
							Topics: []common.Hash{
								common.HexToHash("0xddf252ad1be2c89b69c2b068fc378daa952ba7f163c4a11628f55a4df523b3ef"),
								common.HexToHash("0x000000000000000000000000934b510d4c9103e6a87aef13b816fb080286d649"),
								common.HexToHash("0x000000000000000000000000dae889230c6a20359d9aff984700c8a115ef8681"),
								common.HexToHash("0x0000000000000000000000000000000000000000000000000000000000000033"),
							},
							Data:            nil,
							BlockNumber:     lo.Must(new(big.Int).SetString("15809204", 0)),
							TransactionHash: common.HexToHash("0x097c15e4ebe2cbaa8d0b565999795e5fefb71e3c5c7ef42e9ab7d92c2a25980d"),
							Index:           174,
							Removed:         false,
						}, {
							Address: common.HexToAddress("0xC02aaA39b223FE8D0A0e5C4F27eAD9083C756Cc2"),
							Topics: []common.Hash{
								common.HexToHash("0xddf252ad1be2c89b69c2b068fc378daa952ba7f163c4a11628f55a4df523b3ef"),
								common.HexToHash("0x000000000000000000000000934b510d4c9103e6a87aef13b816fb080286d649"),
								common.HexToHash("0x0000000000000000000000000000a26b00c1f0df003000390027140000faa719"),
							},
							Data:            hexutil.MustDecode("0x0000000000000000000000000000000000000000000000000008d41826445000"),
							BlockNumber:     lo.Must(new(big.Int).SetString("15809204", 0)),
							TransactionHash: common.HexToHash("0x097c15e4ebe2cbaa8d0b565999795e5fefb71e3c5c7ef42e9ab7d92c2a25980d"),
							Index:           175,
							Removed:         false,
						}, {
							Address: common.HexToAddress("0xC02aaA39b223FE8D0A0e5C4F27eAD9083C756Cc2"),
							Topics: []common.Hash{
								common.HexToHash("0xddf252ad1be2c89b69c2b068fc378daa952ba7f163c4a11628f55a4df523b3ef"),
								common.HexToHash("0x000000000000000000000000934b510d4c9103e6a87aef13b816fb080286d649"),
								common.HexToHash("0x000000000000000000000000c6f926654428f0faf8d0878ab8f6f113140408fd"),
							},
							Data:            hexutil.MustDecode("0x0000000000000000000000000000000000000000000000000011a8304c88a000"),
							BlockNumber:     lo.Must(new(big.Int).SetString("15809204", 0)),
							TransactionHash: common.HexToHash("0x097c15e4ebe2cbaa8d0b565999795e5fefb71e3c5c7ef42e9ab7d92c2a25980d"),
							Index:           176,
							Removed:         false,
						}, {
							Address: common.HexToAddress("0x00000000006c3852cbEf3e08E8dF289169EdE581"),
							Topics: []common.Hash{
								common.HexToHash("0x9d9af8e38d66c62e2c12f0225249fd9d721c54b83f48d9352c97c6cacdcb6f31"),
								common.HexToHash("0x000000000000000000000000dae889230c6a20359d9aff984700c8a115ef8681"),
								common.HexToHash("0x000000000000000000000000004c00500000ad104d7dbd00e3ae0a5c00560c00"),
							},
							Data:            hexutil.MustDecode("0xf0437b2f6eae284c715e2336afab753f25ab96f768a60f66c5da8c5b1810fac4000000000000000000000000934b510d4c9103e6a87aef13b816fb080286d6490000000000000000000000000000000000000000000000000000000000000080000000000000000000000000000000000000000000000000000000000000012000000000000000000000000000000000000000000000000000000000000000010000000000000000000000000000000000000000000000000000000000000001000000000000000000000000c02aaa39b223fe8d0a0e5c4f27ead9083c756cc20000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000016123c5faac800000000000000000000000000000000000000000000000000000000000000000030000000000000000000000000000000000000000000000000000000000000002000000000000000000000000b6d241c6cb1e8d2fc65a012d51406138cb42801d00000000000000000000000000000000000000000000000000000000000000330000000000000000000000000000000000000000000000000000000000000001000000000000000000000000dae889230c6a20359d9aff984700c8a115ef86810000000000000000000000000000000000000000000000000000000000000001000000000000000000000000c02aaa39b223fe8d0a0e5c4f27ead9083c756cc200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000008d418264450000000000000000000000000000000a26b00c1f0df003000390027140000faa7190000000000000000000000000000000000000000000000000000000000000001000000000000000000000000c02aaa39b223fe8d0a0e5c4f27ead9083c756cc200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000011a8304c88a000000000000000000000000000c6f926654428f0faf8d0878ab8f6f113140408fd"),
							BlockNumber:     lo.Must(new(big.Int).SetString("15809204", 0)),
							TransactionHash: common.HexToHash("0x097c15e4ebe2cbaa8d0b565999795e5fefb71e3c5c7ef42e9ab7d92c2a25980d"),
							Index:           177,
							Removed:         false,
						}},
						Status:           1,
						TransactionHash:  common.HexToHash("0x097c15e4ebe2cbaa8d0b565999795e5fefb71e3c5c7ef42e9ab7d92c2a25980d"),
						TransactionIndex: 94,
					},
				},
				config: &config.Module{
					Network:  filter.NetworkEthereum,
					Endpoint: endpoint.MustGet(filter.NetworkEthereum),
				},
			},
			want: &schema.Feed{
				ID:      "0x097c15e4ebe2cbaa8d0b565999795e5fefb71e3c5c7ef42e9ab7d92c2a25980d",
				Network: filter.NetworkEthereum,
				Index:   94,
				From:    "0x934B510D4C9103E6a87AEf13b816fb080286D649",
				To:      "0x00000000006c3852cbEf3e08E8dF289169EdE581",
				Type:    filter.TypeCollectibleTrade,
				Calldata: &schema.Calldata{
					FunctionHash: "0xe7acab24",
				},
				Platform: lo.ToPtr(filter.PlatformOpenSea),
				Fee: &schema.Fee{
					Amount:  lo.Must(decimal.NewFromString("2685574746297498")),
					Decimal: 18,
				},
				Actions: []*schema.Action{
					{
						Type:     filter.TypeCollectibleTrade,
						Platform: filter.PlatformOpenSea.String(),
						From:     "0x934B510D4C9103E6a87AEf13b816fb080286D649",
						To:       "0xDae889230c6a20359d9AfF984700c8A115eF8681",
						Metadata: metadata.CollectibleTrade{
							Action: metadata.ActionCollectibleTradeSell,
							Token: metadata.Token{
								Address:  lo.ToPtr("0xB6d241C6CB1E8d2Fc65a012D51406138CB42801D"),
								ID:       lo.ToPtr(lo.Must(decimal.NewFromString("51"))),
								Value:    lo.ToPtr(lo.Must(decimal.NewFromString("1"))),
								Name:     "Turtle Case Gang",
								Symbol:   "TurtlecaseGang",
								Standard: metadata.StandardERC721,
								URI:      "ipfs://QmTzkoeQVxjMiAz6GtBzihW2gfgxp4dta21tcEvXwmMUoj/51.json",
							},

							Cost: &metadata.Token{
								Address:  lo.ToPtr("0xC02aaA39b223FE8D0A0e5C4F27eAD9083C756Cc2"),
								Value:    lo.ToPtr(lo.Must(decimal.NewFromString("99400000000000000"))),
								Name:     "Wrapped Ether",
								Symbol:   "WETH",
								Standard: metadata.StandardERC20,
								Decimals: 18,
							},
						},
					},
				},
				Status:    true,
				Timestamp: 1666508723,
			},
			wantError: require.NoError,
		},
		{
			name: "Buy AZUKI #4103 on Seaport V1.5",
			arguments: arguments{
				task: &source.Task{
					Network: filter.NetworkEthereum,
					ChainID: 1,
					Header: &ethereum.Header{
						Hash:         common.HexToHash("0x3c2a381bb4e4986f8a9192da83a92ee8d73a4d62da043f78000bc2d724c8ab13"),
						ParentHash:   common.HexToHash("0xe32da604a689e8d9001059e3dfb35bb78b7538e35c0be337171a919c3fbddcfe"),
						UncleHash:    common.HexToHash("0x1dcc4de8dec75d7aab85b567b6ccd41ad312451b948a7413f0a142fd40d49347"),
						Coinbase:     common.HexToAddress("0xC436Eb8AeD128275C8F224dE2F1dd202c0AB5830"),
						Number:       lo.Must(new(big.Int).SetString("17376112", 0)),
						GasLimit:     30000000,
						GasUsed:      22450972,
						Timestamp:    1685502779,
						BaseFee:      lo.Must(new(big.Int).SetString("26333067147", 0)),
						Transactions: nil,
					},
					Transaction: &ethereum.Transaction{
						BlockHash: common.HexToHash("0x0be33034ac7e329c544df6c26872444955e76a3d0c68e8446f2276a191bcda1c"),
						From:      common.HexToAddress("0xc5037734E8AcD41A4dB7A3A8FE8153b7eC920212"),
						Gas:       210230,
						Hash:      common.HexToHash("0x0be33034ac7e329c544df6c26872444955e76a3d0c68e8446f2276a191bcda1c"),
						Input:     hexutil.MustDecode("0xb3a34c4c0000000000000000000000000000000000000000000000000000000000000040000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000400000000000000000000000000000000000000000000000000000000000000400000000000000000000000000887578f7cec7291a957a38710073b1a2770e2c1f000000000000000000000000004c00500000ad104d7dbd00e3ae0a5c00560c000000000000000000000000000000000000000000000000000000000000000160000000000000000000000000000000000000000000000000000000000000022000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000064705bd900000000000000000000000000000000000000000000000000000000649559c10000000000000000000000000000000000000000000000000000000000000000360c6ebe00000000000000000000000000000000000000007220b1505dfaf0840000007b02230091a7ed01230072f7006a004d60a8d4e71d599b8104250f0000000000000000000000000000000000000000000000000000000000000000000200000000000000000000000000000000000000000000000000000000000000010000000000000000000000000000000000000000000000000000000000000002000000000000000000000000ed5af388653567af2f388e6224dc7c4b3241c5440000000000000000000000000000000000000000000000000000000000001007000000000000000000000000000000000000000000000000000000000000000100000000000000000000000000000000000000000000000000000000000000010000000000000000000000000000000000000000000000000000000000000002000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000caf6700370168000000000000000000000000000000000000000000000000000caf6700370168000000000000000000000000000887578f7cec7291a957a38710073b1a2770e2c1f000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000053444835ec58000000000000000000000000000000000000000000000000000053444835ec580000000000000000000000000000000a26b00c1f0df003000390027140000faa71900000000000000000000000000000000000000000000000000000000000000400c0ef1948d50fded1d28aadbd291a573ea03a11af40c59bf3759515c7e70bab16e9727236c6178f7924a87ce6cc127eddb5f2d91b8c4fd7bd77de4ee8eecfde7332d1229"),
						To:        lo.ToPtr(common.HexToAddress("0x00000000000000ADc04C56Bf30aC9d3c0aAF14dC")),
						Value:     lo.Must(new(big.Int).SetString("15000000000000000000", 0)),
						Type:      2,
						ChainID:   lo.Must(new(big.Int).SetString("1", 0)),
					},
					Receipt: &ethereum.Receipt{
						BlockHash:         common.HexToHash("0x3c2a381bb4e4986f8a9192da83a92ee8d73a4d62da043f78000bc2d724c8ab13"),
						BlockNumber:       lo.Must(new(big.Int).SetString("17376112", 0)),
						ContractAddress:   nil,
						CumulativeGasUsed: 22305206,
						EffectiveGasPrice: hexutil.MustDecodeBig("0x633745a8b"),
						GasUsed:           148376,
						Logs: []*ethereum.Log{{
							Address: common.HexToAddress("0xED5AF388653567Af2F388E6224dC7C4b3241C544"),
							Topics: []common.Hash{
								common.HexToHash("0x8c5be1e5ebec7d5bd14f71427d1e84f3dd0314c0f7b2291e5b200ac8c7c3b925"),
								common.HexToHash("0x000000000000000000000000887578f7cec7291a957a38710073b1a2770e2c1f"),
								common.HexToHash("0x0000000000000000000000000000000000000000000000000000000000000000"),
								common.HexToHash("0x0000000000000000000000000000000000000000000000000000000000001007"),
							},
							Data:            nil,
							BlockNumber:     lo.Must(new(big.Int).SetString("17376112", 0)),
							TransactionHash: common.HexToHash("0x0be33034ac7e329c544df6c26872444955e76a3d0c68e8446f2276a191bcda1c"),
							Index:           528,
							Removed:         false,
						}, {
							Address: common.HexToAddress("0xED5AF388653567Af2F388E6224dC7C4b3241C544"),
							Topics: []common.Hash{
								common.HexToHash("0xddf252ad1be2c89b69c2b068fc378daa952ba7f163c4a11628f55a4df523b3ef"),
								common.HexToHash("0x000000000000000000000000887578f7cec7291a957a38710073b1a2770e2c1f"),
								common.HexToHash("0x000000000000000000000000c5037734e8acd41a4db7a3a8fe8153b7ec920212"),
								common.HexToHash("0x0000000000000000000000000000000000000000000000000000000000001007"),
							},
							Data:            nil,
							BlockNumber:     lo.Must(new(big.Int).SetString("17376112", 0)),
							TransactionHash: common.HexToHash("0x0be33034ac7e329c544df6c26872444955e76a3d0c68e8446f2276a191bcda1c"),
							Index:           529,
							Removed:         false,
						}, {
							Address: common.HexToAddress("0x00000000000000ADc04C56Bf30aC9d3c0aAF14dC"),
							Topics: []common.Hash{
								common.HexToHash("0x9d9af8e38d66c62e2c12f0225249fd9d721c54b83f48d9352c97c6cacdcb6f31"),
								common.HexToHash("0x000000000000000000000000887578f7cec7291a957a38710073b1a2770e2c1f"),
								common.HexToHash("0x000000000000000000000000004c00500000ad104d7dbd00e3ae0a5c00560c00"),
							},
							Data:            hexutil.MustDecode("0x4e8d7d75abcf7e0d4da95452653ba881055c5770582cd239bf50bae88b544787000000000000000000000000c5037734e8acd41a4db7a3a8fe8153b7ec9202120000000000000000000000000000000000000000000000000000000000000080000000000000000000000000000000000000000000000000000000000000012000000000000000000000000000000000000000000000000000000000000000010000000000000000000000000000000000000000000000000000000000000002000000000000000000000000ed5af388653567af2f388e6224dc7c4b3241c544000000000000000000000000000000000000000000000000000000000000100700000000000000000000000000000000000000000000000000000000000000010000000000000000000000000000000000000000000000000000000000000002000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000caf6700370168000000000000000000000000000887578f7cec7291a957a38710073b1a2770e2c1f000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000053444835ec580000000000000000000000000000000a26b00c1f0df003000390027140000faa719"),
							BlockNumber:     lo.Must(new(big.Int).SetString("17376112", 0)),
							TransactionHash: common.HexToHash("0x0be33034ac7e329c544df6c26872444955e76a3d0c68e8446f2276a191bcda1c"),
							Index:           530,
							Removed:         false,
						}},
						Status:           1,
						TransactionHash:  common.HexToHash("0x0be33034ac7e329c544df6c26872444955e76a3d0c68e8446f2276a191bcda1c"),
						TransactionIndex: 172,
					},
				},
				config: &config.Module{
					Network:  filter.NetworkEthereum,
					Endpoint: endpoint.MustGet(filter.NetworkEthereum),
				},
			},
			want: &schema.Feed{
				ID:      "0x0be33034ac7e329c544df6c26872444955e76a3d0c68e8446f2276a191bcda1c",
				Network: filter.NetworkEthereum,
				Index:   172,
				From:    "0xc5037734E8AcD41A4dB7A3A8FE8153b7eC920212",
				To:      "0x00000000000000ADc04C56Bf30aC9d3c0aAF14dC",
				Type:    filter.TypeCollectibleTrade,
				Calldata: &schema.Calldata{
					FunctionHash: "0xb3a34c4c",
				},
				Platform: lo.ToPtr(filter.PlatformOpenSea),
				Fee: &schema.Fee{
					Amount:  lo.Must(decimal.NewFromString("3951707971003272")),
					Decimal: 18,
				},
				Actions: []*schema.Action{
					{
						Type:     filter.TypeCollectibleTrade,
						Platform: filter.PlatformOpenSea.String(),
						From:     "0x887578F7CeC7291a957a38710073b1a2770e2C1F",
						To:       "0xc5037734E8AcD41A4dB7A3A8FE8153b7eC920212",
						Metadata: metadata.CollectibleTrade{
							Action: metadata.ActionCollectibleTradeBuy,
							Token: metadata.Token{
								Address:  lo.ToPtr("0xED5AF388653567Af2F388E6224dC7C4b3241C544"),
								ID:       lo.ToPtr(lo.Must(decimal.NewFromString("4103"))),
								Value:    lo.ToPtr(lo.Must(decimal.NewFromString("1"))),
								Name:     "Azuki",
								Symbol:   "AZUKI",
								Standard: metadata.StandardERC721,
								URI:      "ipfs://QmZcH4YvBVVRJtdn4RdbaqgspFU8gH6P9vomDpBVpAL3u4/4103",
							},

							Cost: &metadata.Token{
								Value:    lo.ToPtr(lo.Must(decimal.NewFromString("14625000000000000000"))),
								Name:     "Ethereum",
								Symbol:   "ETH",
								Decimals: 18,
							},
						},
					},
				},
				Status:    true,
				Timestamp: 1685502779,
			},
			wantError: require.NoError,
		},
		{
			name: "Buy FANDAS #2892 and #1788 on Seaport V1.5",
			arguments: arguments{
				task: &source.Task{
					Network: filter.NetworkEthereum,
					ChainID: 1,
					Header: &ethereum.Header{
						Hash:         common.HexToHash("0xf9fb789dd716f5cc9b492857a81a3f65a41bbbbe79bf2aa2a416b3846257181b"),
						ParentHash:   common.HexToHash("0x01548dfec95c9718f9316f053df587c5b6985730840e1f3deea816b3cc2d0e93"),
						UncleHash:    common.HexToHash("0x1dcc4de8dec75d7aab85b567b6ccd41ad312451b948a7413f0a142fd40d49347"),
						Coinbase:     common.HexToAddress("0xDAFEA492D9c6733ae3d56b7Ed1ADB60692c98Bc5"),
						Number:       lo.Must(new(big.Int).SetString("17382979", 0)),
						GasLimit:     30000000,
						GasUsed:      11343258,
						Timestamp:    1685586287,
						BaseFee:      lo.Must(new(big.Int).SetString("42524200282", 0)),
						Transactions: nil,
					},
					Transaction: &ethereum.Transaction{
						BlockHash: common.HexToHash("0x6f2092bde5f2f64c6d085c379a861ea482783cd5868c0de02186a0fa79ee0c00"),
						From:      common.HexToAddress("0x2d368d6A84B791D634E6f9f81908D884849fd43d"),
						Gas:       333156,
						Hash:      common.HexToHash("0x6f2092bde5f2f64c6d085c379a861ea482783cd5868c0de02186a0fa79ee0c00"),
						Input:     hexutil.MustDecode("0x87201b4100000000000000000000000000000000000000000000000000000000000000e00000000000000000000000000000000000000000000000000000000000000dc00000000000000000000000000000000000000000000000000000000000000de00000000000000000000000000000000000000000000000000000000000000f000000007b02230091a7ed01230072f7006a004d60a8d4e71d599b8104250f00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000200000000000000000000000000000000000000000000000000000000000000020000000000000000000000000000000000000000000000000000000000000040000000000000000000000000000000000000000000000000000000000000068000000000000000000000000000000000000000000000000000000000000000a00000000000000000000000000000000000000000000000000000000000000001000000000000000000000000000000000000000000000000000000000000000100000000000000000000000000000000000000000000000000000000000005200000000000000000000000000000000000000000000000000000000000000620000000000000000000000000b34e4285de1a6d06e15964f84783ce1978df26a3000000000000000000000000004c00500000ad104d7dbd00e3ae0a5c00560c000000000000000000000000000000000000000000000000000000000000000160000000000000000000000000000000000000000000000000000000000000022000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000064686f4a0000000000000000000000000000000000000000000000000000000064914dca0000000000000000000000000000000000000000000000000000000000000000360c6ebe0000000000000000000000000000000000000000c0732613a8ffcca90000007b02230091a7ed01230072f7006a004d60a8d4e71d599b8104250f00000000000000000000000000000000000000000000000000000000000000000003000000000000000000000000000000000000000000000000000000000000000100000000000000000000000000000000000000000000000000000000000000020000000000000000000000004bb08998a697d0db666783ba5b56e85b33ba262f0000000000000000000000000000000000000000000000000000000000000b4c00000000000000000000000000000000000000000000000000000000000000010000000000000000000000000000000000000000000000000000000000000001000000000000000000000000000000000000000000000000000000000000000300000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000bce7a6fbff400000000000000000000000000000000000000000000000000000bce7a6fbff4000000000000000000000000000b34e4285de1a6d06e15964f84783ce1978df26a30000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000005543df729c0000000000000000000000000000000000000000000000000000005543df729c0000000000000000000000000000000a26b00c1f0df003000390027140000faa7190000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000012edc9ab5d00000000000000000000000000000000000000000000000000000012edc9ab5d00000000000000000000000000008feb0a16e6a97f78ebe6f1c0daabdb8f2457206600000000000000000000000000000000000000000000000000000000000000c3d91296266e99fb6b38fbbab25c165686d3155eb90faa2ae71e310c342ee46601bc426beb4f089c59609ae42a9e1fbf9265d5cb9f7db734a7b115314a60a7118d00000802f7785651f941dd748cc556af2d094d8e378243f7b52ea689f3bd1aeefe5547fe0d77cc81fcf2719082ef8e1e652880d9b1051437191847d96a7f4026cd5164b57ef4dacd9316acf92b8ee6fc92391a8fc6a059b5eba4a9f9cbe862cb2ee4bd23c9082e3416ad382b244f83ca33af90df98c4072c243dd441929c80c871298c0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000a00000000000000000000000000000000000000000000000000000000000000001000000000000000000000000000000000000000000000000000000000000000100000000000000000000000000000000000000000000000000000000000005200000000000000000000000000000000000000000000000000000000000000620000000000000000000000000b34e4285de1a6d06e15964f84783ce1978df26a3000000000000000000000000004c00500000ad104d7dbd00e3ae0a5c00560c000000000000000000000000000000000000000000000000000000000000000160000000000000000000000000000000000000000000000000000000000000022000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000064686f4a0000000000000000000000000000000000000000000000000000000064914dca0000000000000000000000000000000000000000000000000000000000000000360c6ebe0000000000000000000000000000000000000000fd539576f4f176ee0000007b02230091a7ed01230072f7006a004d60a8d4e71d599b8104250f00000000000000000000000000000000000000000000000000000000000000000003000000000000000000000000000000000000000000000000000000000000000100000000000000000000000000000000000000000000000000000000000000020000000000000000000000004bb08998a697d0db666783ba5b56e85b33ba262f00000000000000000000000000000000000000000000000000000000000006fc00000000000000000000000000000000000000000000000000000000000000010000000000000000000000000000000000000000000000000000000000000001000000000000000000000000000000000000000000000000000000000000000300000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000bce7a6fbff400000000000000000000000000000000000000000000000000000bce7a6fbff4000000000000000000000000000b34e4285de1a6d06e15964f84783ce1978df26a30000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000005543df729c0000000000000000000000000000000000000000000000000000005543df729c0000000000000000000000000000000a26b00c1f0df003000390027140000faa7190000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000012edc9ab5d00000000000000000000000000000000000000000000000000000012edc9ab5d00000000000000000000000000008feb0a16e6a97f78ebe6f1c0daabdb8f2457206600000000000000000000000000000000000000000000000000000000000000c3d91296266e99fb6b38fbbab25c165686d3155eb90faa2ae71e310c342ee46601bc426beb4f089c59609ae42a9e1fbf9265d5cb9f7db734a7b115314a60a7118d0000035287c86da34cae2301b736ce105f976236fc8649db0ef1c34b34b9a200a9ca9dd5c7b7cd0de3cdd0724bd9713003739011dfb5149cc42a9376cc9cf1355ffff01cf8ee84f3cb92945c808563eab21a53908a17875f90d63c9bd98998d39e0639695d6227df82bf7128a2febafb78fc033490ef571660d2d2d6b47f0383828b340000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000002000000000000000000000000000000000000000000000000000000000000004000000000000000000000000000000000000000000000000000000000000000a000000000000000000000000000000000000000000000000000000000000000010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000010000000000000000000000000000000000000000000000000000000000000001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000030000000000000000000000000000000000000000000000000000000000000060000000000000000000000000000000000000000000000000000000000000010000000000000000000000000000000000000000000000000000000000000001a0000000000000000000000000000000000000000000000000000000000000000200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000002000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000010000000000000000000000000000000000000000000000000000000000000001000000000000000000000000000000000000000000000000000000000000000100000000000000000000000000000000000000000000000000000000000000020000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000200000000000000000000000000000000000000000000000000000000000000010000000000000000000000000000000000000000000000000000000000000002ed549c1f360c6ebe"),
						To:        lo.ToPtr(common.HexToAddress("0x00000000000000ADc04C56Bf30aC9d3c0aAF14dC")),
						Value:     lo.Must(new(big.Int).SetString("120000000000000000", 0)),
						Type:      2,
						ChainID:   lo.Must(new(big.Int).SetString("1", 0)),
					},
					Receipt: &ethereum.Receipt{
						BlockHash:         common.HexToHash("0xf9fb789dd716f5cc9b492857a81a3f65a41bbbbe79bf2aa2a416b3846257181b"),
						BlockNumber:       lo.Must(new(big.Int).SetString("17382979", 0)),
						ContractAddress:   nil,
						CumulativeGasUsed: 5210812,
						EffectiveGasPrice: hexutil.MustDecodeBig("0xa5dd9615a"),
						GasUsed:           253474,
						Logs: []*ethereum.Log{{
							Address: common.HexToAddress("0x00000000000000ADc04C56Bf30aC9d3c0aAF14dC"),
							Topics: []common.Hash{
								common.HexToHash("0x9d9af8e38d66c62e2c12f0225249fd9d721c54b83f48d9352c97c6cacdcb6f31"),
								common.HexToHash("0x000000000000000000000000b34e4285de1a6d06e15964f84783ce1978df26a3"),
								common.HexToHash("0x000000000000000000000000004c00500000ad104d7dbd00e3ae0a5c00560c00"),
							},
							Data:            hexutil.MustDecode("0xfbea5a5e3f9f27a138dc41f917d8ac87b0239ea4cbfb25120f1c84d51260e8a10000000000000000000000002d368d6a84b791d634e6f9f81908d884849fd43d00000000000000000000000000000000000000000000000000000000000000800000000000000000000000000000000000000000000000000000000000000120000000000000000000000000000000000000000000000000000000000000000100000000000000000000000000000000000000000000000000000000000000020000000000000000000000004bb08998a697d0db666783ba5b56e85b33ba262f0000000000000000000000000000000000000000000000000000000000000b4c0000000000000000000000000000000000000000000000000000000000000001000000000000000000000000000000000000000000000000000000000000000300000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000bce7a6fbff4000000000000000000000000000b34e4285de1a6d06e15964f84783ce1978df26a30000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000005543df729c0000000000000000000000000000000a26b00c1f0df003000390027140000faa7190000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000012edc9ab5d00000000000000000000000000008feb0a16e6a97f78ebe6f1c0daabdb8f24572066"),
							BlockNumber:     lo.Must(new(big.Int).SetString("17382979", 0)),
							TransactionHash: common.HexToHash("0x6f2092bde5f2f64c6d085c379a861ea482783cd5868c0de02186a0fa79ee0c00"),
							Index:           179,
							Removed:         false,
						}, {
							Address: common.HexToAddress("0x00000000000000ADc04C56Bf30aC9d3c0aAF14dC"),
							Topics: []common.Hash{
								common.HexToHash("0x9d9af8e38d66c62e2c12f0225249fd9d721c54b83f48d9352c97c6cacdcb6f31"),
								common.HexToHash("0x000000000000000000000000b34e4285de1a6d06e15964f84783ce1978df26a3"),
								common.HexToHash("0x000000000000000000000000004c00500000ad104d7dbd00e3ae0a5c00560c00"),
							},
							Data:            hexutil.MustDecode("0x2c49634bd9b30e908422847688d62a653106f32d311ad4041518496553a2a1df0000000000000000000000002d368d6a84b791d634e6f9f81908d884849fd43d00000000000000000000000000000000000000000000000000000000000000800000000000000000000000000000000000000000000000000000000000000120000000000000000000000000000000000000000000000000000000000000000100000000000000000000000000000000000000000000000000000000000000020000000000000000000000004bb08998a697d0db666783ba5b56e85b33ba262f00000000000000000000000000000000000000000000000000000000000006fc0000000000000000000000000000000000000000000000000000000000000001000000000000000000000000000000000000000000000000000000000000000300000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000bce7a6fbff4000000000000000000000000000b34e4285de1a6d06e15964f84783ce1978df26a30000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000005543df729c0000000000000000000000000000000a26b00c1f0df003000390027140000faa7190000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000012edc9ab5d00000000000000000000000000008feb0a16e6a97f78ebe6f1c0daabdb8f24572066"),
							BlockNumber:     lo.Must(new(big.Int).SetString("17382979", 0)),
							TransactionHash: common.HexToHash("0x6f2092bde5f2f64c6d085c379a861ea482783cd5868c0de02186a0fa79ee0c00"),
							Index:           180,
							Removed:         false,
						}, {
							Address: common.HexToAddress("0x4BB08998a697d0db666783Ba5B56E85B33ba262f"),
							Topics: []common.Hash{
								common.HexToHash("0x8c5be1e5ebec7d5bd14f71427d1e84f3dd0314c0f7b2291e5b200ac8c7c3b925"),
								common.HexToHash("0x000000000000000000000000b34e4285de1a6d06e15964f84783ce1978df26a3"),
								common.HexToHash("0x0000000000000000000000000000000000000000000000000000000000000000"),
								common.HexToHash("0x0000000000000000000000000000000000000000000000000000000000000b4c"),
							},
							Data:            nil,
							BlockNumber:     lo.Must(new(big.Int).SetString("17382979", 0)),
							TransactionHash: common.HexToHash("0x6f2092bde5f2f64c6d085c379a861ea482783cd5868c0de02186a0fa79ee0c00"),
							Index:           181,
							Removed:         false,
						}, {
							Address: common.HexToAddress("0x4BB08998a697d0db666783Ba5B56E85B33ba262f"),
							Topics: []common.Hash{
								common.HexToHash("0xddf252ad1be2c89b69c2b068fc378daa952ba7f163c4a11628f55a4df523b3ef"),
								common.HexToHash("0x000000000000000000000000b34e4285de1a6d06e15964f84783ce1978df26a3"),
								common.HexToHash("0x0000000000000000000000002d368d6a84b791d634e6f9f81908d884849fd43d"),
								common.HexToHash("0x0000000000000000000000000000000000000000000000000000000000000b4c"),
							},
							Data:            nil,
							BlockNumber:     lo.Must(new(big.Int).SetString("17382979", 0)),
							TransactionHash: common.HexToHash("0x6f2092bde5f2f64c6d085c379a861ea482783cd5868c0de02186a0fa79ee0c00"),
							Index:           182,
							Removed:         false,
						}, {
							Address: common.HexToAddress("0x4BB08998a697d0db666783Ba5B56E85B33ba262f"),
							Topics: []common.Hash{
								common.HexToHash("0x8c5be1e5ebec7d5bd14f71427d1e84f3dd0314c0f7b2291e5b200ac8c7c3b925"),
								common.HexToHash("0x000000000000000000000000b34e4285de1a6d06e15964f84783ce1978df26a3"),
								common.HexToHash("0x0000000000000000000000000000000000000000000000000000000000000000"),
								common.HexToHash("0x00000000000000000000000000000000000000000000000000000000000006fc"),
							},
							Data:            nil,
							BlockNumber:     lo.Must(new(big.Int).SetString("17382979", 0)),
							TransactionHash: common.HexToHash("0x6f2092bde5f2f64c6d085c379a861ea482783cd5868c0de02186a0fa79ee0c00"),
							Index:           183,
							Removed:         false,
						}, {
							Address: common.HexToAddress("0x4BB08998a697d0db666783Ba5B56E85B33ba262f"),
							Topics: []common.Hash{
								common.HexToHash("0xddf252ad1be2c89b69c2b068fc378daa952ba7f163c4a11628f55a4df523b3ef"),
								common.HexToHash("0x000000000000000000000000b34e4285de1a6d06e15964f84783ce1978df26a3"),
								common.HexToHash("0x0000000000000000000000002d368d6a84b791d634e6f9f81908d884849fd43d"),
								common.HexToHash("0x00000000000000000000000000000000000000000000000000000000000006fc"),
							},
							Data:            nil,
							BlockNumber:     lo.Must(new(big.Int).SetString("17382979", 0)),
							TransactionHash: common.HexToHash("0x6f2092bde5f2f64c6d085c379a861ea482783cd5868c0de02186a0fa79ee0c00"),
							Index:           184,
							Removed:         false,
						}},
						Status:           1,
						TransactionHash:  common.HexToHash("0x6f2092bde5f2f64c6d085c379a861ea482783cd5868c0de02186a0fa79ee0c00"),
						TransactionIndex: 57,
					},
				},
				config: &config.Module{
					Network:  filter.NetworkEthereum,
					Endpoint: endpoint.MustGet(filter.NetworkEthereum),
				},
			},
			want: &schema.Feed{
				ID:      "0x6f2092bde5f2f64c6d085c379a861ea482783cd5868c0de02186a0fa79ee0c00",
				Network: filter.NetworkEthereum,
				Index:   57,
				From:    "0x2d368d6A84B791D634E6f9f81908D884849fd43d",
				To:      "0x00000000000000ADc04C56Bf30aC9d3c0aAF14dC",
				Type:    filter.TypeCollectibleTrade,
				Calldata: &schema.Calldata{
					FunctionHash: "0x87201b41",
				},
				Platform: lo.ToPtr(filter.PlatformOpenSea),
				Fee: &schema.Fee{
					Amount:  lo.Must(decimal.NewFromString("11285727142279668")),
					Decimal: 18,
				},
				Actions: []*schema.Action{
					{
						Type:     filter.TypeCollectibleTrade,
						Platform: filter.PlatformOpenSea.String(),
						From:     "0xb34E4285DE1a6D06e15964f84783cE1978df26A3",
						To:       "0x2d368d6A84B791D634E6f9f81908D884849fd43d",
						Metadata: metadata.CollectibleTrade{
							Action: metadata.ActionCollectibleTradeBuy,
							Token: metadata.Token{
								Address:  lo.ToPtr("0x4BB08998a697d0db666783Ba5B56E85B33ba262f"),
								ID:       lo.ToPtr(lo.Must(decimal.NewFromString("2892"))),
								Value:    lo.ToPtr(lo.Must(decimal.NewFromString("1"))),
								Name:     "Frenly Pandas",
								Symbol:   "FANDAS",
								Standard: metadata.StandardERC721,
								URI:      "https://ipfs.io/ipfs/QmNcoaNf9rnyhsDkyt9aB9vvEb5uEdG1bHx62AtfbWpEJF/2892.json",
							},

							Cost: &metadata.Token{
								Value:    lo.ToPtr(lo.Must(decimal.NewFromString("53172000000000000"))),
								Name:     "Ethereum",
								Symbol:   "ETH",
								Decimals: 18,
							},
						},
					},
					{
						Type:     filter.TypeCollectibleTrade,
						Platform: filter.PlatformOpenSea.String(),
						From:     "0xb34E4285DE1a6D06e15964f84783cE1978df26A3",
						To:       "0x2d368d6A84B791D634E6f9f81908D884849fd43d",
						Metadata: metadata.CollectibleTrade{
							Action: metadata.ActionCollectibleTradeBuy,
							Token: metadata.Token{
								Address:  lo.ToPtr("0x4BB08998a697d0db666783Ba5B56E85B33ba262f"),
								ID:       lo.ToPtr(lo.Must(decimal.NewFromString("1788"))),
								Value:    lo.ToPtr(lo.Must(decimal.NewFromString("1"))),
								Name:     "Frenly Pandas",
								Symbol:   "FANDAS",
								Standard: metadata.StandardERC721,
								URI:      "https://ipfs.io/ipfs/QmNcoaNf9rnyhsDkyt9aB9vvEb5uEdG1bHx62AtfbWpEJF/1788.json",
							},

							Cost: &metadata.Token{
								Value:    lo.ToPtr(lo.Must(decimal.NewFromString("53172000000000000"))),
								Name:     "Ethereum",
								Symbol:   "ETH",
								Decimals: 18,
							},
						},
					},
				},
				Status:    true,
				Timestamp: 1685586287,
			},
			wantError: require.NoError,
		},
		{
			name: "Zero-dollar purchase on Seaport V1.1",
			arguments: arguments{
				task: &source.Task{
					Network: filter.NetworkEthereum,
					ChainID: 1,
					Header: &ethereum.Header{
						Hash:         common.HexToHash("0xe07d4ff758e9174812ec4f5f7d081f74e92e3543a4254de9b8400b49cdd96700"),
						ParentHash:   common.HexToHash("0x47d736043d8902433c9d3b81ae5091849fcee2b25ce10af24960aa3575166f42"),
						UncleHash:    common.HexToHash("0x1dcc4de8dec75d7aab85b567b6ccd41ad312451b948a7413f0a142fd40d49347"),
						Coinbase:     common.HexToAddress("0xEA674fdDe714fd979de3EdF0F56AA9716B898ec8"),
						Number:       lo.Must(new(big.Int).SetString("15521132", 0)),
						GasLimit:     30000000,
						GasUsed:      21495577,
						Timestamp:    1662989818,
						BaseFee:      lo.Must(new(big.Int).SetString("24860148653", 0)),
						Transactions: nil,
					},
					Transaction: &ethereum.Transaction{
						BlockHash: common.HexToHash("0x04492eb7d380588f7a8f00221e51f8fbbec738b53e50bbcdcb14c2e21a12547b"),
						From:      common.HexToAddress("0x45719eCcE878E7E2d376F7dfA6f4Bd20fdA55458"),
						Gas:       470000,
						Hash:      common.HexToHash("0x04492eb7d380588f7a8f00221e51f8fbbec738b53e50bbcdcb14c2e21a12547b"),
						Input:     hexutil.MustDecode("0xb3a34c4c00000000000000000000000000000000000000000000000000000000000000400000007b02230091a7ed01230072f7006a004d60a8d4e71d599b8104250f0000000000000000000000000000000000000000000000000000000000000000004000000000000000000000000000000000000000000000000000000000000007600000000000000000000000007645d76b91806f6f2796f0a901c2eeba7ade3a2c000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001600000000000000000000000000000000000000000000000000000000000000400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000631f35f8ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff30000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000085ce2b635edd646d414c25005c27c14b0000007b02230091a7ed01230072f7006a004d60a8d4e71d599b8104250f00000000000000000000000000000000000000000000000000000000000000000004000000000000000000000000000000000000000000000000000000000000000400000000000000000000000000000000000000000000000000000000000000020000000000000000000000000a1e21c169ff261fe6f370068a4f71c25f096a5500000000000000000000000000000000000000000000000000000000000010d10000000000000000000000000000000000000000000000000000000000000001000000000000000000000000000000000000000000000000000000000000000100000000000000000000000000000000000000000000000000000000000000020000000000000000000000000a1e21c169ff261fe6f370068a4f71c25f096a55000000000000000000000000000000000000000000000000000000000000008100000000000000000000000000000000000000000000000000000000000000010000000000000000000000000000000000000000000000000000000000000001000000000000000000000000000000000000000000000000000000000000000200000000000000000000000035f044966a5fc1329e957e1bb465699d5953621c00000000000000000000000000000000000000000000000000000000000000410000000000000000000000000000000000000000000000000000000000000001000000000000000000000000000000000000000000000000000000000000000100000000000000000000000000000000000000000000000000000000000000020000000000000000000000005ff0a71977584d9cbe5d5f56e9843cd672672ddd0000000000000000000000000000000000000000000000000000000000001c0500000000000000000000000000000000000000000000000000000000000000010000000000000000000000000000000000000000000000000000000000000001000000000000000000000000000000000000000000000000000000000000000400000000000000000000000000000000000000000000000000000000000000020000000000000000000000000a1e21c169ff261fe6f370068a4f71c25f096a5500000000000000000000000000000000000000000000000000000000000010d10000000000000000000000000000000000000000000000000000000000000001000000000000000000000000000000000000000000000000000000000000000100000000000000000000000045719ecce878e7e2d376f7dfa6f4bd20fda5545800000000000000000000000000000000000000000000000000000000000000020000000000000000000000000a1e21c169ff261fe6f370068a4f71c25f096a5500000000000000000000000000000000000000000000000000000000000000810000000000000000000000000000000000000000000000000000000000000001000000000000000000000000000000000000000000000000000000000000000100000000000000000000000045719ecce878e7e2d376f7dfa6f4bd20fda55458000000000000000000000000000000000000000000000000000000000000000200000000000000000000000035f044966a5fc1329e957e1bb465699d5953621c00000000000000000000000000000000000000000000000000000000000000410000000000000000000000000000000000000000000000000000000000000001000000000000000000000000000000000000000000000000000000000000000100000000000000000000000045719ecce878e7e2d376f7dfa6f4bd20fda5545800000000000000000000000000000000000000000000000000000000000000020000000000000000000000005ff0a71977584d9cbe5d5f56e9843cd672672ddd0000000000000000000000000000000000000000000000000000000000001c050000000000000000000000000000000000000000000000000000000000000001000000000000000000000000000000000000000000000000000000000000000100000000000000000000000045719ecce878e7e2d376f7dfa6f4bd20fda5545800000000000000000000000000000000000000000000000000000000000000402eb1caacface8f9d55c04a5fe80738318eee2072846eecdfd6eff2df39d9f00ed8f9a5cfaa2a46af23019acd741babbc154cca51a2c199eba55fe6fd721d45b1"),
						To:        lo.ToPtr(common.HexToAddress("0x00000000006c3852cbEf3e08E8dF289169EdE581")),
						Value:     lo.Must(new(big.Int).SetString("0", 0)),
						Type:      2,
						ChainID:   lo.Must(new(big.Int).SetString("1", 0)),
					},
					Receipt: &ethereum.Receipt{
						BlockHash:         common.HexToHash("0xe07d4ff758e9174812ec4f5f7d081f74e92e3543a4254de9b8400b49cdd96700"),
						BlockNumber:       lo.Must(new(big.Int).SetString("15521132", 0)),
						ContractAddress:   nil,
						CumulativeGasUsed: 11246727,
						EffectiveGasPrice: hexutil.MustDecodeBig("0x6232ff2ad"),
						GasUsed:           320620,
						Logs: []*ethereum.Log{{
							Address: common.HexToAddress("0x0A1e21C169FF261Fe6f370068A4f71C25f096a55"),
							Topics: []common.Hash{
								common.HexToHash("0xddf252ad1be2c89b69c2b068fc378daa952ba7f163c4a11628f55a4df523b3ef"),
								common.HexToHash("0x0000000000000000000000007645d76b91806f6f2796f0a901c2eeba7ade3a2c"),
								common.HexToHash("0x00000000000000000000000045719ecce878e7e2d376f7dfa6f4bd20fda55458"),
								common.HexToHash("0x00000000000000000000000000000000000000000000000000000000000010d1"),
							},
							Data:            nil,
							BlockNumber:     lo.Must(new(big.Int).SetString("15521132", 0)),
							TransactionHash: common.HexToHash("0x04492eb7d380588f7a8f00221e51f8fbbec738b53e50bbcdcb14c2e21a12547b"),
							Index:           275,
							Removed:         false,
						}, {
							Address: common.HexToAddress("0x0A1e21C169FF261Fe6f370068A4f71C25f096a55"),
							Topics: []common.Hash{
								common.HexToHash("0xddf252ad1be2c89b69c2b068fc378daa952ba7f163c4a11628f55a4df523b3ef"),
								common.HexToHash("0x0000000000000000000000007645d76b91806f6f2796f0a901c2eeba7ade3a2c"),
								common.HexToHash("0x00000000000000000000000045719ecce878e7e2d376f7dfa6f4bd20fda55458"),
								common.HexToHash("0x0000000000000000000000000000000000000000000000000000000000000081"),
							},
							Data:            nil,
							BlockNumber:     lo.Must(new(big.Int).SetString("15521132", 0)),
							TransactionHash: common.HexToHash("0x04492eb7d380588f7a8f00221e51f8fbbec738b53e50bbcdcb14c2e21a12547b"),
							Index:           276,
							Removed:         false,
						}, {
							Address: common.HexToAddress("0x35f044966A5fc1329E957e1Bb465699d5953621C"),
							Topics: []common.Hash{
								common.HexToHash("0x8c5be1e5ebec7d5bd14f71427d1e84f3dd0314c0f7b2291e5b200ac8c7c3b925"),
								common.HexToHash("0x0000000000000000000000007645d76b91806f6f2796f0a901c2eeba7ade3a2c"),
								common.HexToHash("0x0000000000000000000000000000000000000000000000000000000000000000"),
								common.HexToHash("0x0000000000000000000000000000000000000000000000000000000000000041"),
							},
							Data:            nil,
							BlockNumber:     lo.Must(new(big.Int).SetString("15521132", 0)),
							TransactionHash: common.HexToHash("0x04492eb7d380588f7a8f00221e51f8fbbec738b53e50bbcdcb14c2e21a12547b"),
							Index:           277,
							Removed:         false,
						}, {
							Address: common.HexToAddress("0x35f044966A5fc1329E957e1Bb465699d5953621C"),
							Topics: []common.Hash{
								common.HexToHash("0xddf252ad1be2c89b69c2b068fc378daa952ba7f163c4a11628f55a4df523b3ef"),
								common.HexToHash("0x0000000000000000000000007645d76b91806f6f2796f0a901c2eeba7ade3a2c"),
								common.HexToHash("0x00000000000000000000000045719ecce878e7e2d376f7dfa6f4bd20fda55458"),
								common.HexToHash("0x0000000000000000000000000000000000000000000000000000000000000041"),
							},
							Data:            nil,
							BlockNumber:     lo.Must(new(big.Int).SetString("15521132", 0)),
							TransactionHash: common.HexToHash("0x04492eb7d380588f7a8f00221e51f8fbbec738b53e50bbcdcb14c2e21a12547b"),
							Index:           278,
							Removed:         false,
						}, {
							Address: common.HexToAddress("0x5Ff0a71977584d9CBE5d5F56E9843cD672672dDD"),
							Topics: []common.Hash{
								common.HexToHash("0x8c5be1e5ebec7d5bd14f71427d1e84f3dd0314c0f7b2291e5b200ac8c7c3b925"),
								common.HexToHash("0x0000000000000000000000007645d76b91806f6f2796f0a901c2eeba7ade3a2c"),
								common.HexToHash("0x0000000000000000000000000000000000000000000000000000000000000000"),
								common.HexToHash("0x0000000000000000000000000000000000000000000000000000000000001c05"),
							},
							Data:            nil,
							BlockNumber:     lo.Must(new(big.Int).SetString("15521132", 0)),
							TransactionHash: common.HexToHash("0x04492eb7d380588f7a8f00221e51f8fbbec738b53e50bbcdcb14c2e21a12547b"),
							Index:           279,
							Removed:         false,
						}, {
							Address: common.HexToAddress("0x5Ff0a71977584d9CBE5d5F56E9843cD672672dDD"),
							Topics: []common.Hash{
								common.HexToHash("0xddf252ad1be2c89b69c2b068fc378daa952ba7f163c4a11628f55a4df523b3ef"),
								common.HexToHash("0x0000000000000000000000007645d76b91806f6f2796f0a901c2eeba7ade3a2c"),
								common.HexToHash("0x00000000000000000000000045719ecce878e7e2d376f7dfa6f4bd20fda55458"),
								common.HexToHash("0x0000000000000000000000000000000000000000000000000000000000001c05"),
							},
							Data:            nil,
							BlockNumber:     lo.Must(new(big.Int).SetString("15521132", 0)),
							TransactionHash: common.HexToHash("0x04492eb7d380588f7a8f00221e51f8fbbec738b53e50bbcdcb14c2e21a12547b"),
							Index:           280,
							Removed:         false,
						}, {
							Address: common.HexToAddress("0x0A1e21C169FF261Fe6f370068A4f71C25f096a55"),
							Topics: []common.Hash{
								common.HexToHash("0xddf252ad1be2c89b69c2b068fc378daa952ba7f163c4a11628f55a4df523b3ef"),
								common.HexToHash("0x00000000000000000000000045719ecce878e7e2d376f7dfa6f4bd20fda55458"),
								common.HexToHash("0x00000000000000000000000045719ecce878e7e2d376f7dfa6f4bd20fda55458"),
								common.HexToHash("0x00000000000000000000000000000000000000000000000000000000000010d1"),
							},
							Data:            nil,
							BlockNumber:     lo.Must(new(big.Int).SetString("15521132", 0)),
							TransactionHash: common.HexToHash("0x04492eb7d380588f7a8f00221e51f8fbbec738b53e50bbcdcb14c2e21a12547b"),
							Index:           281,
							Removed:         false,
						}, {
							Address: common.HexToAddress("0x0A1e21C169FF261Fe6f370068A4f71C25f096a55"),
							Topics: []common.Hash{
								common.HexToHash("0xddf252ad1be2c89b69c2b068fc378daa952ba7f163c4a11628f55a4df523b3ef"),
								common.HexToHash("0x00000000000000000000000045719ecce878e7e2d376f7dfa6f4bd20fda55458"),
								common.HexToHash("0x00000000000000000000000045719ecce878e7e2d376f7dfa6f4bd20fda55458"),
								common.HexToHash("0x0000000000000000000000000000000000000000000000000000000000000081"),
							},
							Data:            nil,
							BlockNumber:     lo.Must(new(big.Int).SetString("15521132", 0)),
							TransactionHash: common.HexToHash("0x04492eb7d380588f7a8f00221e51f8fbbec738b53e50bbcdcb14c2e21a12547b"),
							Index:           282,
							Removed:         false,
						}, {
							Address: common.HexToAddress("0x35f044966A5fc1329E957e1Bb465699d5953621C"),
							Topics: []common.Hash{
								common.HexToHash("0x8c5be1e5ebec7d5bd14f71427d1e84f3dd0314c0f7b2291e5b200ac8c7c3b925"),
								common.HexToHash("0x00000000000000000000000045719ecce878e7e2d376f7dfa6f4bd20fda55458"),
								common.HexToHash("0x0000000000000000000000000000000000000000000000000000000000000000"),
								common.HexToHash("0x0000000000000000000000000000000000000000000000000000000000000041"),
							},
							Data:            nil,
							BlockNumber:     lo.Must(new(big.Int).SetString("15521132", 0)),
							TransactionHash: common.HexToHash("0x04492eb7d380588f7a8f00221e51f8fbbec738b53e50bbcdcb14c2e21a12547b"),
							Index:           283,
							Removed:         false,
						}, {
							Address: common.HexToAddress("0x35f044966A5fc1329E957e1Bb465699d5953621C"),
							Topics: []common.Hash{
								common.HexToHash("0xddf252ad1be2c89b69c2b068fc378daa952ba7f163c4a11628f55a4df523b3ef"),
								common.HexToHash("0x00000000000000000000000045719ecce878e7e2d376f7dfa6f4bd20fda55458"),
								common.HexToHash("0x00000000000000000000000045719ecce878e7e2d376f7dfa6f4bd20fda55458"),
								common.HexToHash("0x0000000000000000000000000000000000000000000000000000000000000041"),
							},
							Data:            nil,
							BlockNumber:     lo.Must(new(big.Int).SetString("15521132", 0)),
							TransactionHash: common.HexToHash("0x04492eb7d380588f7a8f00221e51f8fbbec738b53e50bbcdcb14c2e21a12547b"),
							Index:           284,
							Removed:         false,
						}, {
							Address: common.HexToAddress("0x5Ff0a71977584d9CBE5d5F56E9843cD672672dDD"),
							Topics: []common.Hash{
								common.HexToHash("0x8c5be1e5ebec7d5bd14f71427d1e84f3dd0314c0f7b2291e5b200ac8c7c3b925"),
								common.HexToHash("0x00000000000000000000000045719ecce878e7e2d376f7dfa6f4bd20fda55458"),
								common.HexToHash("0x0000000000000000000000000000000000000000000000000000000000000000"),
								common.HexToHash("0x0000000000000000000000000000000000000000000000000000000000001c05"),
							},
							Data:            nil,
							BlockNumber:     lo.Must(new(big.Int).SetString("15521132", 0)),
							TransactionHash: common.HexToHash("0x04492eb7d380588f7a8f00221e51f8fbbec738b53e50bbcdcb14c2e21a12547b"),
							Index:           285,
							Removed:         false,
						}, {
							Address: common.HexToAddress("0x5Ff0a71977584d9CBE5d5F56E9843cD672672dDD"),
							Topics: []common.Hash{
								common.HexToHash("0xddf252ad1be2c89b69c2b068fc378daa952ba7f163c4a11628f55a4df523b3ef"),
								common.HexToHash("0x00000000000000000000000045719ecce878e7e2d376f7dfa6f4bd20fda55458"),
								common.HexToHash("0x00000000000000000000000045719ecce878e7e2d376f7dfa6f4bd20fda55458"),
								common.HexToHash("0x0000000000000000000000000000000000000000000000000000000000001c05"),
							},
							Data:            nil,
							BlockNumber:     lo.Must(new(big.Int).SetString("15521132", 0)),
							TransactionHash: common.HexToHash("0x04492eb7d380588f7a8f00221e51f8fbbec738b53e50bbcdcb14c2e21a12547b"),
							Index:           286,
							Removed:         false,
						}, {
							Address: common.HexToAddress("0x00000000006c3852cbEf3e08E8dF289169EdE581"),
							Topics: []common.Hash{
								common.HexToHash("0x9d9af8e38d66c62e2c12f0225249fd9d721c54b83f48d9352c97c6cacdcb6f31"),
								common.HexToHash("0x0000000000000000000000007645d76b91806f6f2796f0a901c2eeba7ade3a2c"),
								common.HexToHash("0x0000000000000000000000000000000000000000000000000000000000000000"),
							},
							Data:            hexutil.MustDecode("0x824e26e515a02fb0029784d475fec895158f7b17db85355df9a148cd7ea3ef9e00000000000000000000000045719ecce878e7e2d376f7dfa6f4bd20fda55458000000000000000000000000000000000000000000000000000000000000008000000000000000000000000000000000000000000000000000000000000002a0000000000000000000000000000000000000000000000000000000000000000400000000000000000000000000000000000000000000000000000000000000020000000000000000000000000a1e21c169ff261fe6f370068a4f71c25f096a5500000000000000000000000000000000000000000000000000000000000010d1000000000000000000000000000000000000000000000000000000000000000100000000000000000000000000000000000000000000000000000000000000020000000000000000000000000a1e21c169ff261fe6f370068a4f71c25f096a5500000000000000000000000000000000000000000000000000000000000000810000000000000000000000000000000000000000000000000000000000000001000000000000000000000000000000000000000000000000000000000000000200000000000000000000000035f044966a5fc1329e957e1bb465699d5953621c0000000000000000000000000000000000000000000000000000000000000041000000000000000000000000000000000000000000000000000000000000000100000000000000000000000000000000000000000000000000000000000000020000000000000000000000005ff0a71977584d9cbe5d5f56e9843cd672672ddd0000000000000000000000000000000000000000000000000000000000001c050000000000000000000000000000000000000000000000000000000000000001000000000000000000000000000000000000000000000000000000000000000400000000000000000000000000000000000000000000000000000000000000020000000000000000000000000a1e21c169ff261fe6f370068a4f71c25f096a5500000000000000000000000000000000000000000000000000000000000010d1000000000000000000000000000000000000000000000000000000000000000100000000000000000000000045719ecce878e7e2d376f7dfa6f4bd20fda5545800000000000000000000000000000000000000000000000000000000000000020000000000000000000000000a1e21c169ff261fe6f370068a4f71c25f096a550000000000000000000000000000000000000000000000000000000000000081000000000000000000000000000000000000000000000000000000000000000100000000000000000000000045719ecce878e7e2d376f7dfa6f4bd20fda55458000000000000000000000000000000000000000000000000000000000000000200000000000000000000000035f044966a5fc1329e957e1bb465699d5953621c0000000000000000000000000000000000000000000000000000000000000041000000000000000000000000000000000000000000000000000000000000000100000000000000000000000045719ecce878e7e2d376f7dfa6f4bd20fda5545800000000000000000000000000000000000000000000000000000000000000020000000000000000000000005ff0a71977584d9cbe5d5f56e9843cd672672ddd0000000000000000000000000000000000000000000000000000000000001c05000000000000000000000000000000000000000000000000000000000000000100000000000000000000000045719ecce878e7e2d376f7dfa6f4bd20fda55458"),
							BlockNumber:     lo.Must(new(big.Int).SetString("15521132", 0)),
							TransactionHash: common.HexToHash("0x04492eb7d380588f7a8f00221e51f8fbbec738b53e50bbcdcb14c2e21a12547b"),
							Index:           287,
							Removed:         false,
						}},
						Status:           1,
						TransactionHash:  common.HexToHash("0x04492eb7d380588f7a8f00221e51f8fbbec738b53e50bbcdcb14c2e21a12547b"),
						TransactionIndex: 167,
					},
				},
				config: &config.Module{
					Network:  filter.NetworkEthereum,
					Endpoint: endpoint.MustGet(filter.NetworkEthereum),
				},
			},
			want: &schema.Feed{
				ID:      "0x04492eb7d380588f7a8f00221e51f8fbbec738b53e50bbcdcb14c2e21a12547b",
				Network: filter.NetworkEthereum,
				Index:   167,
				From:    "0x45719eCcE878E7E2d376F7dfA6f4Bd20fdA55458",
				To:      "0x00000000006c3852cbEf3e08E8dF289169EdE581",
				Type:    filter.TypeCollectibleTrade,
				Calldata: &schema.Calldata{
					FunctionHash: "0xb3a34c4c",
				},
				Platform: lo.ToPtr(filter.PlatformOpenSea),
				Fee: &schema.Fee{
					Amount:  lo.Must(decimal.NewFromString("8451590861124860")),
					Decimal: 18,
				},
				Actions: []*schema.Action{
					{
						Type:     filter.TypeCollectibleTrade,
						Platform: filter.PlatformOpenSea.String(),
						From:     "0x7645D76b91806f6F2796F0A901C2Eeba7Ade3A2c",
						To:       "0x45719eCcE878E7E2d376F7dfA6f4Bd20fdA55458",
						Metadata: metadata.CollectibleTrade{
							Action: metadata.ActionCollectibleTradeBuy,
							Token: metadata.Token{
								Address:  lo.ToPtr("0x5Ff0a71977584d9CBE5d5F56E9843cD672672dDD"),
								ID:       lo.ToPtr(lo.Must(decimal.NewFromString("7173"))),
								Value:    lo.ToPtr(lo.Must(decimal.NewFromString("1"))),
								Name:     "Women of Crypto",
								Symbol:   "WOC",
								Standard: metadata.StandardERC721,
								URI:      "ipfs://QmWHiAaPXHmk4RJg4f2W2FVtC4vqDXGWCnnUtSRLV3bKcK/7173",
							},

							Cost: &metadata.Token{
								Value:    lo.ToPtr(lo.Must(decimal.NewFromString("0"))),
								Name:     "Ethereum",
								Symbol:   "ETH",
								Decimals: 18,
							},
						},
					},
				},
				Status:    true,
				Timestamp: 1662989818,
			},
			wantError: require.NoError,
		},
		{
			name: "Buy and mint a NFT on WyvernExchange v2",
			arguments: arguments{
				task: &source.Task{
					Network: filter.NetworkEthereum,
					ChainID: 1,
					Header: &ethereum.Header{
						Hash:         common.HexToHash("0x7d38d0bffb9cafad24aeadd09feca7e7f9b1588907039bad7e1897f8ba7abd7e"),
						ParentHash:   common.HexToHash("0x9cdb4b3d783119af10c2b6bd155545bd9f1b6978034295ed568508ee980f8d71"),
						UncleHash:    common.HexToHash("0x1dcc4de8dec75d7aab85b567b6ccd41ad312451b948a7413f0a142fd40d49347"),
						Coinbase:     common.HexToAddress("0x1aD91ee08f21bE3dE0BA2ba6918E714dA6B45836"),
						Number:       lo.Must(new(big.Int).SetString("14970483", 0)),
						GasLimit:     30000000,
						GasUsed:      26675497,
						Timestamp:    1655340374,
						BaseFee:      lo.Must(new(big.Int).SetString("46532541026", 0)),
						Transactions: nil,
					},
					Transaction: &ethereum.Transaction{
						BlockHash: common.HexToHash("0x0004f3ee70968d7df86e198ff7c3d6df6b30751a821c701c302b83a71ec72858"),
						From:      common.HexToAddress("0x535B76436bE15c70DE947585672df01c25a6e966"),
						Gas:       560934,
						Hash:      common.HexToHash("0x0004f3ee70968d7df86e198ff7c3d6df6b30751a821c701c302b83a71ec72858"),
						Input:     hexutil.MustDecode("0xab834bab0000000000000000000000007f268357a8c2552623316e2562d90e642bb538e5000000000000000000000000535b76436be15c70de947585672df01c25a6e966000000000000000000000000fb3aeefe6fb1645c3c8b5f6db50be812e746c21f0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000baf2127b49fc93cbca6269fade0f7f31df4c88a7000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000007f268357a8c2552623316e2562d90e642bb538e5000000000000000000000000fb3aeefe6fb1645c3c8b5f6db50be812e746c21f00000000000000000000000000000000000000000000000000000000000000000000000000000000000000005b3256965e7c3cf26e11fcaf296dfc8807c01073000000000000000000000000baf2127b49fc93cbca6269fade0f7f31df4c88a70000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000002ee00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000b1a2bc2ec5000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000062aa7cbf00000000000000000000000000000000000000000000000000000000000000003683cac562521ecea8b3e537b28961615edea24287dc908115213955ad3f40fa00000000000000000000000000000000000000000000000000000000000002ee00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000b1a2bc2ec5000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000062a8e8c00000000000000000000000000000000000000000000000000000000062f802c0204fe453af146dd8f5d0bee43b0f9b15b97a083f2d018fa34b90e30f13eec4eb0000000000000000000000000000000000000000000000000000000000000001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001000000000000000000000000000000000000000000000000000000000000000100000000000000000000000000000000000000000000000000000000000000010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000100000000000000000000000000000000000000000000000000000000000006a000000000000000000000000000000000000000000000000000000000000007c000000000000000000000000000000000000000000000000000000000000008e00000000000000000000000000000000000000000000000000000000000000a000000000000000000000000000000000000000000000000000000000000000b200000000000000000000000000000000000000000000000000000000000000b20000000000000000000000000000000000000000000000000000000000000001c000000000000000000000000000000000000000000000000000000000000001c396a824d7fc703ce51a9513b61d975858114f114b43714f5424a703c068eb124097761d8dfcb1ccbd05def843331b823e47fc4c13cd6c24227cb8aa0d7610447396a824d7fc703ce51a9513b61d975858114f114b43714f5424a703c068eb124097761d8dfcb1ccbd05def843331b823e47fc4c13cd6c24227cb8aa0d7610447000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000e4fb16a5950000000000000000000000000000000000000000000000000000000000000000000000000000000000000000535b76436be15c70de947585672df01c25a6e96600000000000000000000000002fa88718f365313e65b406cb39a8fe9e82d1bee0000000000000000000000000000000000000000000000000000000000000001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000c000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000e4fb16a595000000000000000000000000fb3aeefe6fb1645c3c8b5f6db50be812e746c21f000000000000000000000000000000000000000000000000000000000000000000000000000000000000000002fa88718f365313e65b406cb39a8fe9e82d1bee0000000000000000000000000000000000000000000000000000000000000001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000c000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000e400000000ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000e4000000000000000000000000000000000000000000000000000000000000000000000000ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000"),
						To:        lo.ToPtr(common.HexToAddress("0x7f268357A8c2552623316e2562D90e642bB538E5")),
						Value:     lo.Must(new(big.Int).SetString("50000000000000000", 0)),
						Type:      2,
						ChainID:   lo.Must(new(big.Int).SetString("1", 0)),
					},
					Receipt: &ethereum.Receipt{
						BlockHash:         common.HexToHash("0x7d38d0bffb9cafad24aeadd09feca7e7f9b1588907039bad7e1897f8ba7abd7e"),
						BlockNumber:       lo.Must(new(big.Int).SetString("14970483", 0)),
						ContractAddress:   nil,
						CumulativeGasUsed: 13449833,
						EffectiveGasPrice: hexutil.MustDecodeBig("0xb2ef66962"),
						GasUsed:           407906,
						Logs: []*ethereum.Log{{
							Address: common.HexToAddress("0xFC8a98C22A9E32948aB028414d67C62c49B16864"),
							Topics: []common.Hash{
								common.HexToHash("0xddf252ad1be2c89b69c2b068fc378daa952ba7f163c4a11628f55a4df523b3ef"),
								common.HexToHash("0x0000000000000000000000000000000000000000000000000000000000000000"),
								common.HexToHash("0x000000000000000000000000535b76436be15c70de947585672df01c25a6e966"),
								common.HexToHash("0x0000000000000000000000000000000000000000000000000000000000000962"),
							},
							Data:            nil,
							BlockNumber:     lo.Must(new(big.Int).SetString("14970483", 0)),
							TransactionHash: common.HexToHash("0x0004f3ee70968d7df86e198ff7c3d6df6b30751a821c701c302b83a71ec72858"),
							Index:           274,
							Removed:         false,
						}, {
							Address: common.HexToAddress("0xFC8a98C22A9E32948aB028414d67C62c49B16864"),
							Topics: []common.Hash{
								common.HexToHash("0x69c1a9d399cea184b5fa200c8f9ec12b935507bad848e5ee895b8e8b56661ac8"),
							},
							Data:            hexutil.MustDecode("0x0000000000000000000000000000000000000000000000000000000000000001000000000000000000000000535b76436be15c70de947585672df01c25a6e9660000000000000000000000000000000000000000000000000000000000000962"),
							BlockNumber:     lo.Must(new(big.Int).SetString("14970483", 0)),
							TransactionHash: common.HexToHash("0x0004f3ee70968d7df86e198ff7c3d6df6b30751a821c701c302b83a71ec72858"),
							Index:           275,
							Removed:         false,
						}, {
							Address: common.HexToAddress("0x7f268357A8c2552623316e2562D90e642bB538E5"),
							Topics: []common.Hash{
								common.HexToHash("0xc4109843e0b7d514e4c093114b863f8e7d8d9a458c372cd51bfe526b588006c9"),
								common.HexToHash("0x000000000000000000000000fb3aeefe6fb1645c3c8b5f6db50be812e746c21f"),
								common.HexToHash("0x000000000000000000000000535b76436be15c70de947585672df01c25a6e966"),
								common.HexToHash("0x0000000000000000000000000000000000000000000000000000000000000000"),
							},
							Data:            hexutil.MustDecode("0x0000000000000000000000000000000000000000000000000000000000000000b511425454f6e7f91f5703cdba6d92de28d3d9d83ee7630decab7441f1118fb700000000000000000000000000000000000000000000000000b1a2bc2ec50000"),
							BlockNumber:     lo.Must(new(big.Int).SetString("14970483", 0)),
							TransactionHash: common.HexToHash("0x0004f3ee70968d7df86e198ff7c3d6df6b30751a821c701c302b83a71ec72858"),
							Index:           276,
							Removed:         false,
						}},
						Status:           1,
						TransactionHash:  common.HexToHash("0x0004f3ee70968d7df86e198ff7c3d6df6b30751a821c701c302b83a71ec72858"),
						TransactionIndex: 133,
					},
				},
				config: &config.Module{
					Network:  filter.NetworkEthereum,
					Endpoint: endpoint.MustGet(filter.NetworkEthereum),
				},
			},
			want: &schema.Feed{
				ID:      "0x0004f3ee70968d7df86e198ff7c3d6df6b30751a821c701c302b83a71ec72858",
				Network: filter.NetworkEthereum,
				Index:   133,
				From:    "0x535B76436bE15c70DE947585672df01c25a6e966",
				To:      "0x7f268357A8c2552623316e2562D90e642bB538E5",
				Type:    filter.TypeCollectibleTrade,
				Calldata: &schema.Calldata{
					FunctionHash: "0xab834bab",
				},
				Platform: lo.ToPtr(filter.PlatformOpenSea),
				Fee: &schema.Fee{
					Amount:  lo.Must(decimal.NewFromString("19592761679751556")),
					Decimal: 18,
				},
				Actions: []*schema.Action{
					{
						Type:     filter.TypeCollectibleTrade,
						Platform: filter.PlatformOpenSea.String(),
						From:     "0xfb3AEefE6fb1645C3c8B5f6db50BE812E746C21F",
						To:       "0x535B76436bE15c70DE947585672df01c25a6e966",
						Metadata: metadata.CollectibleTrade{
							Action: metadata.ActionCollectibleTradeBuy,
							Token: metadata.Token{
								Address:  lo.ToPtr("0xFC8a98C22A9E32948aB028414d67C62c49B16864"),
								ID:       lo.ToPtr(lo.Must(decimal.NewFromString("2402"))),
								Value:    lo.ToPtr(lo.Must(decimal.NewFromString("1"))),
								Name:     "Shrapnel Operators Collection",
								Symbol:   "SOC",
								Standard: metadata.StandardERC721,
								URI:      "ipfs://QmTUfSLbqqpwix4WyfnUeMAeLGgdz9NuS7oPnL92MK9oUt/2",
							},

							Cost: &metadata.Token{
								Value:    lo.ToPtr(lo.Must(decimal.NewFromString("50000000000000000"))),
								Name:     "Ethereum",
								Symbol:   "ETH",
								Decimals: 18,
							},
						},
					},
				},
				Status:    true,
				Timestamp: 1655340374,
			},
			wantError: require.NoError,
		},
		{
			name: "Accept a offer on WyvernExchange",
			arguments: arguments{
				task: &source.Task{
					Network: filter.NetworkEthereum,
					ChainID: 1,
					Header: &ethereum.Header{
						Hash:         common.HexToHash("0x4d9605c5d32553dc62b3452ad84eb0cb6abed38eaaeecaac46e7b25499e504d0"),
						ParentHash:   common.HexToHash("0xfe5bb0c642eaaf683f4279ca6a6e61c81819f32e2fd275a6e60dcba73a325e3a"),
						UncleHash:    common.HexToHash("0x1dcc4de8dec75d7aab85b567b6ccd41ad312451b948a7413f0a142fd40d49347"),
						Coinbase:     common.HexToAddress("0x52bc44d5378309EE2abF1539BF71dE1b7d7bE3b5"),
						Number:       lo.Must(new(big.Int).SetString("14884330", 0)),
						GasLimit:     30000000,
						GasUsed:      18602614,
						Timestamp:    1654079903,
						BaseFee:      lo.Must(new(big.Int).SetString("26341017221", 0)),
						Transactions: nil,
					},
					Transaction: &ethereum.Transaction{
						BlockHash: common.HexToHash("0x0003e5c7e62d982552a6ae3b15c4035872747cb07e72f5fb9d2f690942e7d36e"),
						From:      common.HexToAddress("0x93167077B4a072F939323AE8c9B0dCB23EDb3789"),
						Gas:       296304,
						GasPrice:  lo.Must(new(big.Int).SetString("43000000000", 10)),
						Hash:      common.HexToHash("0x0003e5c7e62d982552a6ae3b15c4035872747cb07e72f5fb9d2f690942e7d36e"),
						Input:     hexutil.MustDecode("0xab834bab0000000000000000000000007f268357a8c2552623316e2562d90e642bb538e50000000000000000000000006ed6629101989283a1f01fdf9178ad6f3443567200000000000000000000000000000000000000000000000000000000000000000000000000000000000000005b3256965e7c3cf26e11fcaf296dfc8807c01073000000000000000000000000baf2127b49fc93cbca6269fade0f7f31df4c88a70000000000000000000000000000000000000000000000000000000000000000000000000000000000000000c02aaa39b223fe8d0a0e5c4f27ead9083c756cc20000000000000000000000007f268357a8c2552623316e2562d90e642bb538e500000000000000000000000093167077b4a072f939323ae8c9b0dcb23edb37890000000000000000000000006ed6629101989283a1f01fdf9178ad6f344356720000000000000000000000000000000000000000000000000000000000000000000000000000000000000000baf2127b49fc93cbca6269fade0f7f31df4c88a70000000000000000000000000000000000000000000000000000000000000000000000000000000000000000c02aaa39b223fe8d0a0e5c4f27ead9083c756cc2000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000003e80000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001cc13905a69c0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000006297407400000000000000000000000000000000000000000000000000000000629b35501d7d4e1159b7d6ac8ff7155ba1878b84346b0bdb86dca61dec2c6863b133be0f000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000003e80000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001cc13905a69c000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000629740e3000000000000000000000000000000000000000000000000000000000000000050dbf3a94e9d2f9419430c056d1730433dcf86a5bef65721fdd49868ca9dd6ec0000000000000000000000000000000000000000000000000000000000000001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001000000000000000000000000000000000000000000000000000000000000000100000000000000000000000000000000000000000000000000000000000000010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000100000000000000000000000000000000000000000000000000000000000006a000000000000000000000000000000000000000000000000000000000000007e000000000000000000000000000000000000000000000000000000000000009200000000000000000000000000000000000000000000000000000000000000a600000000000000000000000000000000000000000000000000000000000000ba00000000000000000000000000000000000000000000000000000000000000ba0000000000000000000000000000000000000000000000000000000000000001c000000000000000000000000000000000000000000000000000000000000001cb3399ee1bafb64dbf25b1345d91c516dca0672c6799f2d699ef21ea907a93b68603e34b70f6408a45d649da7b9dc6aa4f64d05e474cd82fbeba9e5f164fca06fb3399ee1bafb64dbf25b1345d91c516dca0672c6799f2d699ef21ea907a93b68603e34b70f6408a45d649da7b9dc6aa4f64d05e474cd82fbeba9e5f164fca06f0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000010496809f9000000000000000000000000000000000000000000000000000000000000000000000000000000000000000006ed6629101989283a1f01fdf9178ad6f344356720000000000000000000000009cc05bdc13dc65223623fecd20fa1f34109f820600000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000e0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000010496809f9000000000000000000000000093167077b4a072f939323ae8c9b0dcb23edb378900000000000000000000000000000000000000000000000000000000000000000000000000000000000000009cc05bdc13dc65223623fecd20fa1f34109f820600000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000e0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000010400000000ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000104000000000000000000000000000000000000000000000000000000000000000000000000ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000"),
						To:        lo.ToPtr(common.HexToAddress("0x7f268357A8c2552623316e2562D90e642bB538E5")),
						Value:     lo.Must(new(big.Int).SetString("0", 0)),
						Type:      0,
						ChainID:   lo.Must(new(big.Int).SetString("1", 0)),
					},
					Receipt: &ethereum.Receipt{
						BlockHash:         common.HexToHash("0x4d9605c5d32553dc62b3452ad84eb0cb6abed38eaaeecaac46e7b25499e504d0"),
						BlockNumber:       lo.Must(new(big.Int).SetString("14884330", 0)),
						ContractAddress:   nil,
						CumulativeGasUsed: 2284628,
						EffectiveGasPrice: hexutil.MustDecodeBig("0xa02ffee00"),
						GasUsed:           213385,
						Logs: []*ethereum.Log{{
							Address: common.HexToAddress("0xC02aaA39b223FE8D0A0e5C4F27eAD9083C756Cc2"),
							Topics: []common.Hash{
								common.HexToHash("0xddf252ad1be2c89b69c2b068fc378daa952ba7f163c4a11628f55a4df523b3ef"),
								common.HexToHash("0x0000000000000000000000006ed6629101989283a1f01fdf9178ad6f34435672"),
								common.HexToHash("0x00000000000000000000000093167077b4a072f939323ae8c9b0dcb23edb3789"),
							},
							Data:            hexutil.MustDecode("0x00000000000000000000000000000000000000000000000001cc13905a69c000"),
							BlockNumber:     lo.Must(new(big.Int).SetString("14884330", 0)),
							TransactionHash: common.HexToHash("0x0003e5c7e62d982552a6ae3b15c4035872747cb07e72f5fb9d2f690942e7d36e"),
							Index:           73,
							Removed:         false,
						}, {
							Address: common.HexToAddress("0xC02aaA39b223FE8D0A0e5C4F27eAD9083C756Cc2"),
							Topics: []common.Hash{
								common.HexToHash("0xddf252ad1be2c89b69c2b068fc378daa952ba7f163c4a11628f55a4df523b3ef"),
								common.HexToHash("0x00000000000000000000000093167077b4a072f939323ae8c9b0dcb23edb3789"),
								common.HexToHash("0x0000000000000000000000005b3256965e7c3cf26e11fcaf296dfc8807c01073"),
							},
							Data:            hexutil.MustDecode("0x000000000000000000000000000000000000000000000000002e01f4d5d76000"),
							BlockNumber:     lo.Must(new(big.Int).SetString("14884330", 0)),
							TransactionHash: common.HexToHash("0x0003e5c7e62d982552a6ae3b15c4035872747cb07e72f5fb9d2f690942e7d36e"),
							Index:           74,
							Removed:         false,
						}, {
							Address: common.HexToAddress("0x9cC05Bdc13dC65223623FECD20Fa1F34109f8206"),
							Topics: []common.Hash{
								common.HexToHash("0xc3d58168c5ae7397731d063d5bbf3d657854427343f4c083240f7aacaa2d0f62"),
								common.HexToHash("0x000000000000000000000000d0ef8d1d409a8586268b20e27b6529f63a36a728"),
								common.HexToHash("0x00000000000000000000000093167077b4a072f939323ae8c9b0dcb23edb3789"),
								common.HexToHash("0x0000000000000000000000006ed6629101989283a1f01fdf9178ad6f34435672"),
							},
							Data:            hexutil.MustDecode("0x00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001"),
							BlockNumber:     lo.Must(new(big.Int).SetString("14884330", 0)),
							TransactionHash: common.HexToHash("0x0003e5c7e62d982552a6ae3b15c4035872747cb07e72f5fb9d2f690942e7d36e"),
							Index:           75,
							Removed:         false,
						}, {
							Address: common.HexToAddress("0x7f268357A8c2552623316e2562D90e642bB538E5"),
							Topics: []common.Hash{
								common.HexToHash("0xc4109843e0b7d514e4c093114b863f8e7d8d9a458c372cd51bfe526b588006c9"),
								common.HexToHash("0x0000000000000000000000006ed6629101989283a1f01fdf9178ad6f34435672"),
								common.HexToHash("0x00000000000000000000000093167077b4a072f939323ae8c9b0dcb23edb3789"),
								common.HexToHash("0x0000000000000000000000000000000000000000000000000000000000000000"),
							},
							Data:            hexutil.MustDecode("0xe5c7f44d7f41ad992776f4565ce76ca2d5956db2cc5c4f503420c921beef6473000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001cc13905a69c000"),
							BlockNumber:     lo.Must(new(big.Int).SetString("14884330", 0)),
							TransactionHash: common.HexToHash("0x0003e5c7e62d982552a6ae3b15c4035872747cb07e72f5fb9d2f690942e7d36e"),
							Index:           76,
							Removed:         false,
						}},
						Status:           1,
						TransactionHash:  common.HexToHash("0x0003e5c7e62d982552a6ae3b15c4035872747cb07e72f5fb9d2f690942e7d36e"),
						TransactionIndex: 21,
					},
				},
				config: &config.Module{
					Network:  filter.NetworkEthereum,
					Endpoint: endpoint.MustGet(filter.NetworkEthereum),
				},
			},
			want: &schema.Feed{
				ID:      "0x0003e5c7e62d982552a6ae3b15c4035872747cb07e72f5fb9d2f690942e7d36e",
				Network: filter.NetworkEthereum,
				Index:   21,
				From:    "0x93167077B4a072F939323AE8c9B0dCB23EDb3789",
				To:      "0x7f268357A8c2552623316e2562D90e642bB538E5",
				Type:    filter.TypeCollectibleTrade,
				Calldata: &schema.Calldata{
					FunctionHash: "0xab834bab",
				},
				Platform: lo.ToPtr(filter.PlatformOpenSea),
				Fee: &schema.Fee{
					Amount:  lo.Must(decimal.NewFromString("9175555000000000")),
					Decimal: 18,
				},
				Actions: []*schema.Action{
					{
						Type:     filter.TypeCollectibleTrade,
						Platform: filter.PlatformOpenSea.String(),
						From:     "0x93167077B4a072F939323AE8c9B0dCB23EDb3789",
						To:       "0x6Ed6629101989283a1f01fdF9178ad6F34435672",
						Metadata: metadata.CollectibleTrade{
							Action: metadata.ActionCollectibleTradeSell,
							Token: metadata.Token{
								Address:  lo.ToPtr("0x9cC05Bdc13dC65223623FECD20Fa1F34109f8206"),
								ID:       lo.ToPtr(lo.Must(decimal.NewFromString("0"))),
								Value:    lo.ToPtr(lo.Must(decimal.NewFromString("1"))),
								Name:     "Flippr Access Pass",
								Symbol:   "FLIPPR",
								Standard: metadata.StandardERC1155,
								URI:      "ipfs://QmerHKcZLVTxN3Y7S7P2vo2XfN7dGHZnYDQcsrvubvHJKM",
							},

							Cost: &metadata.Token{
								Value:    lo.ToPtr(lo.Must(decimal.NewFromString("129500000000000000"))),
								Name:     "Ethereum",
								Symbol:   "ETH",
								Decimals: 18,
							},
						},
					},
				},
				Status:    true,
				Timestamp: 1654079903,
			},
			wantError: require.NoError,
		},
		{
			name: "Buy ENS #74423267982534601206598717130436619001173770632196343728263400099197042616208 on WyvernExchange V2",
			arguments: arguments{
				task: &source.Task{
					Network: filter.NetworkEthereum,
					ChainID: 1,
					Header: &ethereum.Header{
						Hash:         common.HexToHash("0x53f7b5ddac580ec4c3a68b4c35cbe07bc36257ca0ae90287f1e44d28761f8823"),
						ParentHash:   common.HexToHash("0x4a890f634630fef347bda37064ead897daf57050f38ef055b50a7d137559c406"),
						UncleHash:    common.HexToHash("0x1dcc4de8dec75d7aab85b567b6ccd41ad312451b948a7413f0a142fd40d49347"),
						Coinbase:     common.HexToAddress("0xEA674fdDe714fd979de3EdF0F56AA9716B898ec8"),
						Number:       lo.Must(new(big.Int).SetString("15193150", 0)),
						GasLimit:     29999972,
						GasUsed:      29984818,
						Timestamp:    1658503200,
						BaseFee:      lo.Must(new(big.Int).SetString("23618595265", 0)),
						Transactions: nil,
					},
					Transaction: &ethereum.Transaction{
						BlockHash: common.HexToHash("0x6f567e52bcd8af7ea89718b3141896b9c32f5436994d0de4c348fc749d6b5ce4"),
						From:      common.HexToAddress("0xa1aafb06268f3396c4683e3F635A4AFf0E040e46"),
						Gas:       265167,
						GasPrice:  lo.Must(new(big.Int).SetString("25118595265", 10)),
						Hash:      common.HexToHash("0x6f567e52bcd8af7ea89718b3141896b9c32f5436994d0de4c348fc749d6b5ce4"),
						Input:     hexutil.MustDecode("0xab834bab0000000000000000000000007f268357a8c2552623316e2562d90e642bb538e5000000000000000000000000a1aafb06268f3396c4683e3f635a4aff0e040e460000000000000000000000007e4bb04f32207cb4fb06a8acd97ee90d9756ff580000000000000000000000000000000000000000000000000000000000000000000000000000000000000000baf2127b49fc93cbca6269fade0f7f31df4c88a7000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000007f268357a8c2552623316e2562d90e642bb538e50000000000000000000000007e4bb04f32207cb4fb06a8acd97ee90d9756ff5800000000000000000000000000000000000000000000000000000000000000000000000000000000000000005b3256965e7c3cf26e11fcaf296dfc8807c01073000000000000000000000000baf2127b49fc93cbca6269fade0f7f31df4c88a70000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000fa0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000007ce66c50e284000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000062dabfa9000000000000000000000000000000000000000000000000000000000000000023a48fde3c43aef5315f1098cacd3635fcfc1df065d81d151d3a37f5640c371800000000000000000000000000000000000000000000000000000000000000fa0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000007ce66c50e284000000000000000000000000000000000000000000000000000030b60667399f0000000000000000000000000000000000000000000000000000000000006242d84f0000000000000000000000000000000000000000000000000000000063301b986e9e7a64c80ab5437f92cb183b66a5c9461a5c389548038541c87dd76de323580000000000000000000000000000000000000000000000000000000000000001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001000000000000000000000000000000000000000000000000000000000000000100000000000000000000000000000000000000000000000000000000000000010000000000000000000000000000000000000000000000000000000000000001000000000000000000000000000000000000000000000000000000000000000100000000000000000000000000000000000000000000000000000000000006a000000000000000000000000000000000000000000000000000000000000007c000000000000000000000000000000000000000000000000000000000000008e00000000000000000000000000000000000000000000000000000000000000a000000000000000000000000000000000000000000000000000000000000000b200000000000000000000000000000000000000000000000000000000000000b20000000000000000000000000000000000000000000000000000000000000001b000000000000000000000000000000000000000000000000000000000000001bd5018a57352d30150b0cbd5612eb07f03ad9d45882b04746ccf7775a3bcba603441e6d4c98aa50406663b2b73bbfc7933cc9592e84a797f6d057035a648937d0d5018a57352d30150b0cbd5612eb07f03ad9d45882b04746ccf7775a3bcba603441e6d4c98aa50406663b2b73bbfc7933cc9592e84a797f6d057035a648937d0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000e4fb16a5950000000000000000000000000000000000000000000000000000000000000000000000000000000000000000a1aafb06268f3396c4683e3f635a4aff0e040e4600000000000000000000000057f1887a8bf19b14fc0df6fd9b2acc9af147ea85a48a13b18cfe5540ce5983b5903409e174ba5f698fee7f5ce881dd11f860e790000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000c000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000e4fb16a5950000000000000000000000007e4bb04f32207cb4fb06a8acd97ee90d9756ff58000000000000000000000000000000000000000000000000000000000000000000000000000000000000000057f1887a8bf19b14fc0df6fd9b2acc9af147ea85a48a13b18cfe5540ce5983b5903409e174ba5f698fee7f5ce881dd11f860e790000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000c000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000e400000000ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000e4000000000000000000000000000000000000000000000000000000000000000000000000ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000"),
						To:        lo.ToPtr(common.HexToAddress("0x7f268357A8c2552623316e2562D90e642bB538E5")),
						Value:     lo.Must(new(big.Int).SetString("6752763085721716479", 0)),
						Type:      2,
						ChainID:   lo.Must(new(big.Int).SetString("1", 0)),
					},
					Receipt: &ethereum.Receipt{
						BlockHash:         common.HexToHash("0x53f7b5ddac580ec4c3a68b4c35cbe07bc36257ca0ae90287f1e44d28761f8823"),
						BlockNumber:       lo.Must(new(big.Int).SetString("15193150", 0)),
						ContractAddress:   nil,
						CumulativeGasUsed: 21022854,
						EffectiveGasPrice: hexutil.MustDecodeBig("0x5d92f58c1"),
						GasUsed:           194233,
						Logs: []*ethereum.Log{{
							Address: common.HexToAddress("0x57f1887a8BF19b14fC0dF6Fd9B2acc9Af147eA85"),
							Topics: []common.Hash{
								common.HexToHash("0xddf252ad1be2c89b69c2b068fc378daa952ba7f163c4a11628f55a4df523b3ef"),
								common.HexToHash("0x0000000000000000000000007e4bb04f32207cb4fb06a8acd97ee90d9756ff58"),
								common.HexToHash("0x000000000000000000000000a1aafb06268f3396c4683e3f635a4aff0e040e46"),
								common.HexToHash("0xa48a13b18cfe5540ce5983b5903409e174ba5f698fee7f5ce881dd11f860e790"),
							},
							Data:            nil,
							BlockNumber:     lo.Must(new(big.Int).SetString("15193150", 0)),
							TransactionHash: common.HexToHash("0x6f567e52bcd8af7ea89718b3141896b9c32f5436994d0de4c348fc749d6b5ce4"),
							Index:           401,
							Removed:         false,
						}, {
							Address: common.HexToAddress("0x7f268357A8c2552623316e2562D90e642bB538E5"),
							Topics: []common.Hash{
								common.HexToHash("0xc4109843e0b7d514e4c093114b863f8e7d8d9a458c372cd51bfe526b588006c9"),
								common.HexToHash("0x0000000000000000000000007e4bb04f32207cb4fb06a8acd97ee90d9756ff58"),
								common.HexToHash("0x000000000000000000000000a1aafb06268f3396c4683e3f635a4aff0e040e46"),
								common.HexToHash("0x0000000000000000000000000000000000000000000000000000000000000000"),
							},
							Data:            hexutil.MustDecode("0x00000000000000000000000000000000000000000000000000000000000000007c62a801dad5c8223463f752c6feb3060f655d9b38d6873857e03869b1265db70000000000000000000000000000000000000000000000005db698305b1bf028"),
							BlockNumber:     lo.Must(new(big.Int).SetString("15193150", 0)),
							TransactionHash: common.HexToHash("0x6f567e52bcd8af7ea89718b3141896b9c32f5436994d0de4c348fc749d6b5ce4"),
							Index:           402,
							Removed:         false,
						}},
						Status:           1,
						TransactionHash:  common.HexToHash("0x6f567e52bcd8af7ea89718b3141896b9c32f5436994d0de4c348fc749d6b5ce4"),
						TransactionIndex: 304,
					},
				},
				config: &config.Module{
					Network:  filter.NetworkEthereum,
					Endpoint: endpoint.MustGet(filter.NetworkEthereum),
				},
			},
			want: &schema.Feed{
				ID:      "0x6f567e52bcd8af7ea89718b3141896b9c32f5436994d0de4c348fc749d6b5ce4",
				Network: filter.NetworkEthereum,
				Index:   304,
				From:    "0xa1aafb06268f3396c4683e3F635A4AFf0E040e46",
				To:      "0x7f268357A8c2552623316e2562D90e642bB538E5",
				Type:    filter.TypeCollectibleTrade,
				Calldata: &schema.Calldata{
					FunctionHash: "0xab834bab",
				},
				Platform: lo.ToPtr(filter.PlatformOpenSea),
				Fee: &schema.Fee{
					Amount:  lo.Must(decimal.NewFromString("4878860114106745")),
					Decimal: 18,
				},
				Actions: []*schema.Action{
					{
						Type:     filter.TypeCollectibleTrade,
						Platform: filter.PlatformOpenSea.String(),
						From:     "0x7E4Bb04f32207Cb4FB06A8AcD97EE90d9756ff58",
						To:       "0xa1aafb06268f3396c4683e3F635A4AFf0E040e46",
						Metadata: metadata.CollectibleTrade{
							Action: metadata.ActionCollectibleTradeBuy,
							Token: metadata.Token{
								Address:  lo.ToPtr("0x57f1887a8BF19b14fC0dF6Fd9B2acc9Af147eA85"),
								ID:       lo.ToPtr(lo.Must(decimal.NewFromString("74423267982534601206598717130436619001173770632196343728263400099197042616208"))),
								Value:    lo.ToPtr(lo.Must(decimal.NewFromString("1"))),
								Symbol:   "ENS",
								Standard: metadata.StandardERC721,
								URI:      "https://metadata.ens.domains/mainnet/0x57f1887a8BF19b14fC0dF6Fd9B2acc9Af147eA85/74423267982534601206598717130436619001173770632196343728263400099197042616208",
							},

							Cost: &metadata.Token{
								Value:    lo.ToPtr(lo.Must(decimal.NewFromString("6752752024743047208"))),
								Name:     "Ethereum",
								Symbol:   "ETH",
								Decimals: 18,
							},
						},
					},
				},
				Status:    true,
				Timestamp: 1658503200,
			},
			wantError: require.NoError,
		},
	}

	for _, testcase := range testcases {
		testcase := testcase

		t.Run(testcase.name, func(t *testing.T) {
			t.Parallel()

			ctx := context.Background()

			instance, err := worker.NewWorker(testcase.arguments.config)
			require.NoError(t, err)

			matched, err := instance.Match(ctx, testcase.arguments.task)
			testcase.wantError(t, err)
			require.True(t, matched)

			feed, err := instance.Transform(ctx, testcase.arguments.task)
			testcase.wantError(t, err)

			//t.Log(string(lo.Must(json.MarshalIndent(feed, "", "\x20\x20"))))

			require.Equal(t, testcase.want, feed)
		})
	}
}
