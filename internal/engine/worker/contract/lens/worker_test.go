package lens_test

import (
	"context"
	"math/big"
	"testing"

	"github.com/ethereum/go-ethereum/common"
	"github.com/ethereum/go-ethereum/common/hexutil"
	"github.com/rss3-network/node/config"
	source "github.com/rss3-network/node/internal/engine/source/ethereum"
	worker "github.com/rss3-network/node/internal/engine/worker/contract/lens"
	"github.com/rss3-network/node/provider/ethereum"
	"github.com/rss3-network/node/provider/ethereum/endpoint"
	"github.com/rss3-network/protocol-go/schema"
	"github.com/rss3-network/protocol-go/schema/filter"
	"github.com/rss3-network/protocol-go/schema/metadata"
	"github.com/samber/lo"
	"github.com/shopspring/decimal"
	"github.com/stretchr/testify/require"
)

func TestWorker_Ethereum(t *testing.T) {
	t.Parallel()

	type arguments struct {
		task   *source.Task
		config *config.Module
	}

	testcases := []struct {
		name      string
		arguments arguments
		want      *schema.Feed
		wantError require.ErrorAssertionFunc
	}{
		// V1
		{
			name: "Lens V1 Post",
			arguments: arguments{
				task: &source.Task{
					Network: filter.NetworkPolygon,
					ChainID: 137,
					Header: &ethereum.Header{
						Hash:         common.HexToHash("0x4453f44d391358825a6c00922ee0126c033aafe85258ec913cff61f26da48c92"),
						ParentHash:   common.HexToHash("0xb8c42dd921c150bb2283167d4e980062b019985e332b0695ca0d0e479a9d0adb"),
						UncleHash:    common.HexToHash("0x1dcc4de8dec75d7aab85b567b6ccd41ad312451b948a7413f0a142fd40d49347"),
						Coinbase:     common.HexToAddress("0xb9EDE6f94D192073D8eaF85f8db677133d483249"),
						Number:       lo.Must(new(big.Int).SetString("39312003", 0)),
						GasLimit:     30000000,
						GasUsed:      7653945,
						Timestamp:    1676445288,
						BaseFee:      lo.Must(new(big.Int).SetString("185783717525", 0)),
						Transactions: nil,
					},
					Transaction: &ethereum.Transaction{
						BlockHash: common.HexToHash("0x1d4dc90c35d75df96b04e53f3949bad991f432a78dfa2196df39ad60d657e525"),
						From:      common.HexToAddress("0xD1FecCF6881970105dfb2b654054174007f0e07E"),
						Gas:       1500000,
						GasPrice:  lo.Must(new(big.Int).SetString("268151093434", 10)),
						Hash:      common.HexToHash("0x1d4dc90c35d75df96b04e53f3949bad991f432a78dfa2196df39ad60d657e525"),
						Input:     hexutil.MustDecode("0x963ff14100000000000000000000000000000000000000000000000000000000000000200000000000000000000000000000000000000000000000000000000000015fc300000000000000000000000000000000000000000000000000000000000000c0000000000000000000000000a31ff85e840ed117e172bc9ad89e55128a999205000000000000000000000000000000000000000000000000000000000000012000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000140000000000000000000000000000000000000000000000000000000000000003f68747470733a2f2f617277656176652e6e65742f466534302d2d4f726646746f57464e775165336361524f7735577255334e416646796b52795343583339590000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000"),
						To:        lo.ToPtr(common.HexToAddress("0xDb46d1Dc155634FbC732f92E853b10B288AD5a1d")),
						Value:     lo.Must(new(big.Int).SetString("0", 0)),
						Type:      0,
						ChainID:   lo.Must(new(big.Int).SetString("137", 0)),
					},
					Receipt: &ethereum.Receipt{
						BlockHash:         common.HexToHash("0x4453f44d391358825a6c00922ee0126c033aafe85258ec913cff61f26da48c92"),
						BlockNumber:       lo.Must(new(big.Int).SetString("39312003", 0)),
						ContractAddress:   nil,
						CumulativeGasUsed: 2409090,
						EffectiveGasPrice: hexutil.MustDecodeBig("0x3e6f0cf8ba"),
						GasUsed:           152136,
						Logs: []*ethereum.Log{{
							Address: common.HexToAddress("0xDb46d1Dc155634FbC732f92E853b10B288AD5a1d"),
							Topics: []common.Hash{
								common.HexToHash("0xc672c38b4d26c3c978228e99164105280410b144af24dd3ed8e4f9d211d96a50"),
								common.HexToHash("0x0000000000000000000000000000000000000000000000000000000000015fc3"),
								common.HexToHash("0x0000000000000000000000000000000000000000000000000000000000000004"),
							},
							Data:            hexutil.MustDecode("0x00000000000000000000000000000000000000000000000000000000000000c0000000000000000000000000a31ff85e840ed117e172bc9ad89e55128a9992050000000000000000000000000000000000000000000000000000000000000120000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001400000000000000000000000000000000000000000000000000000000063ec8668000000000000000000000000000000000000000000000000000000000000003f68747470733a2f2f617277656176652e6e65742f466534302d2d4f726646746f57464e775165336361524f7735577255334e416646796b52795343583339590000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000"),
							BlockNumber:     lo.Must(new(big.Int).SetString("39312003", 0)),
							TransactionHash: common.HexToHash("0x1d4dc90c35d75df96b04e53f3949bad991f432a78dfa2196df39ad60d657e525"),
							Index:           85,
							Removed:         false,
						}, {
							Address: common.HexToAddress("0x0000000000000000000000000000000000001010"),
							Topics: []common.Hash{
								common.HexToHash("0x4dfe1bbbcf077ddc3e01291eea2d5c70c2b422b415d95645b9adcfd678cb1d63"),
								common.HexToHash("0x0000000000000000000000000000000000000000000000000000000000001010"),
								common.HexToHash("0x000000000000000000000000d1feccf6881970105dfb2b654054174007f0e07e"),
								common.HexToHash("0x000000000000000000000000b9ede6f94d192073d8eaf85f8db677133d483249"),
							},
							Data:            hexutil.MustDecode("0x000000000000000000000000000000000000000000000000002c84ead4b7b4680000000000000000000000000000000000000000000000b6b628a132c217cfc70000000000000000000000000000000000000000000005bbf31840652c144eb30000000000000000000000000000000000000000000000b6b5fc1c47ed601b5f0000000000000000000000000000000000000000000005bbf344c55000cc031b"),
							BlockNumber:     lo.Must(new(big.Int).SetString("39312003", 0)),
							TransactionHash: common.HexToHash("0x1d4dc90c35d75df96b04e53f3949bad991f432a78dfa2196df39ad60d657e525"),
							Index:           86,
							Removed:         false,
						}},
						Status:           1,
						TransactionHash:  common.HexToHash("0x1d4dc90c35d75df96b04e53f3949bad991f432a78dfa2196df39ad60d657e525"),
						TransactionIndex: 17,
					},
				},
				config: &config.Module{
					Network:  filter.NetworkPolygon,
					Endpoint: endpoint.MustGet(filter.NetworkPolygon),
				},
			},
			want: &schema.Feed{
				ID:      "0x1d4dc90c35d75df96b04e53f3949bad991f432a78dfa2196df39ad60d657e525",
				Network: filter.NetworkPolygon,
				Index:   17,
				From:    "0xD1FecCF6881970105dfb2b654054174007f0e07E",
				To:      "0xDb46d1Dc155634FbC732f92E853b10B288AD5a1d",
				Type:    filter.TypeSocialPost,
				Calldata: &schema.Calldata{
					FunctionHash: "0x963ff141",
				},
				Platform: lo.ToPtr(filter.PlatformLens),
				Fee: &schema.Fee{
					Amount:  lo.Must(decimal.NewFromString("40795434750675024")),
					Decimal: 18,
				},
				Actions: []*schema.Action{
					{
						Type:     filter.TypeSocialPost,
						Platform: "Lenster",
						From:     "0xe9c57C291340Ef34DB3646A10af99FE2A0E03827",
						To:       "0xDb46d1Dc155634FbC732f92E853b10B288AD5a1d",
						Metadata: metadata.SocialPost{
							Body: "big head",
							Media: []metadata.Media{
								{
									MimeType: "image/jpeg",
									Address:  "ipfs://bafybeihjz7wh2uexzuwlnumtcr7ptjyglicg4ura43z4cnn3pganwiqifa",
								},
							},
							Handle:        "polebug.lens",
							ProfileID:     "0x015fc3",
							PublicationID: "0x04",
							ContentURI:    "https://arweave.net/Fe40--OrfFtoWFNwQe3caROw5WrU3NAfFykRySCX39Y",
							Tags:          nil,
							Timestamp:     1676445288,
						},
					},
				},
				Status:    true,
				Timestamp: 1676445288,
			},
			wantError: require.NoError,
		},
		{
			name: "Lens V1 Comment",
			arguments: arguments{
				task: &source.Task{
					Network: filter.NetworkPolygon,
					ChainID: 137,
					Header: &ethereum.Header{
						Hash:         common.HexToHash("0xab959cdfaaf69f3f2a240f81324420a3a93b3711f01fe4fe5db2dc7e15b511b4"),
						ParentHash:   common.HexToHash("0x0767c8e69f69828e74326e8ab955cb5976cb77e84e8f78a2686391526279835b"),
						UncleHash:    common.HexToHash("0x1dcc4de8dec75d7aab85b567b6ccd41ad312451b948a7413f0a142fd40d49347"),
						Coinbase:     common.HexToAddress("0x959C65B72147Faf3450D8b50A0de57E72FFC5e0d"),
						Number:       lo.Must(new(big.Int).SetString("42292460", 0)),
						GasLimit:     30000000,
						GasUsed:      7319811,
						Timestamp:    1683197214,
						BaseFee:      lo.Must(new(big.Int).SetString("218803653873", 0)),
						Transactions: nil,
					},
					Transaction: &ethereum.Transaction{
						BlockHash: common.HexToHash("0xe64abd08fecf171163192cd793c6bb2897f4a10c36cd915dd2f98be2a43b3848"),
						From:      common.HexToAddress("0xD1FecCF6881970105dfb2b654054174007f0e07E"),
						Gas:       1500000,
						GasPrice:  lo.Must(new(big.Int).SetString("253506097291", 10)),
						Hash:      common.HexToHash("0xe64abd08fecf171163192cd793c6bb2897f4a10c36cd915dd2f98be2a43b3848"),
						Input:     hexutil.MustDecode("0xb6f32d2b00000000000000000000000000000000000000000000000000000000000000200000000000000000000000000000000000000000000000000000000000002e620000000000000000000000000000000000000000000000000000000000000120000000000000000000000000000000000000000000000000000000000001823f00000000000000000000000000000000000000000000000000000000000002ca0000000000000000000000000000000000000000000000000000000000000180000000000000000000000000a31ff85e840ed117e172bc9ad89e55128a99920500000000000000000000000000000000000000000000000000000000000001a0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001c0000000000000000000000000000000000000000000000000000000000000003f68747470733a2f2f617277656176652e6e65742f316272303074477062394d4c6a5038707930494b62675f547a396e757576302d6f41766c4d536e7231784100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000"),
						To:        lo.ToPtr(common.HexToAddress("0xDb46d1Dc155634FbC732f92E853b10B288AD5a1d")),
						Value:     lo.Must(new(big.Int).SetString("0", 0)),
						Type:      0,
						ChainID:   lo.Must(new(big.Int).SetString("137", 0)),
					},
					Receipt: &ethereum.Receipt{
						BlockHash:         common.HexToHash("0xab959cdfaaf69f3f2a240f81324420a3a93b3711f01fe4fe5db2dc7e15b511b4"),
						BlockNumber:       lo.Must(new(big.Int).SetString("42292460", 0)),
						ContractAddress:   nil,
						CumulativeGasUsed: 6227984,
						EffectiveGasPrice: hexutil.MustDecodeBig("0x3b0624108b"),
						GasUsed:           205742,
						Logs: []*ethereum.Log{{
							Address: common.HexToAddress("0xDb46d1Dc155634FbC732f92E853b10B288AD5a1d"),
							Topics: []common.Hash{
								common.HexToHash("0x7b4d1aa33773161799847429e4fbf29f56dbf1a3fe815f5070231cbfba402c37"),
								common.HexToHash("0x0000000000000000000000000000000000000000000000000000000000002e62"),
								common.HexToHash("0x0000000000000000000000000000000000000000000000000000000000000028"),
							},
							Data:            hexutil.MustDecode("0x0000000000000000000000000000000000000000000000000000000000000120000000000000000000000000000000000000000000000000000000000001823f00000000000000000000000000000000000000000000000000000000000002ca0000000000000000000000000000000000000000000000000000000000000180000000000000000000000000a31ff85e840ed117e172bc9ad89e55128a99920500000000000000000000000000000000000000000000000000000000000001a0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001c00000000000000000000000000000000000000000000000000000000064538d1e000000000000000000000000000000000000000000000000000000000000003f68747470733a2f2f617277656176652e6e65742f316272303074477062394d4c6a5038707930494b62675f547a396e757576302d6f41766c4d536e7231784100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000"),
							BlockNumber:     lo.Must(new(big.Int).SetString("42292460", 0)),
							TransactionHash: common.HexToHash("0xe64abd08fecf171163192cd793c6bb2897f4a10c36cd915dd2f98be2a43b3848"),
							Index:           176,
							Removed:         false,
						}, {
							Address: common.HexToAddress("0x0000000000000000000000000000000000001010"),
							Topics: []common.Hash{
								common.HexToHash("0x4dfe1bbbcf077ddc3e01291eea2d5c70c2b422b415d95645b9adcfd678cb1d63"),
								common.HexToHash("0x0000000000000000000000000000000000000000000000000000000000001010"),
								common.HexToHash("0x000000000000000000000000d1feccf6881970105dfb2b654054174007f0e07e"),
								common.HexToHash("0x000000000000000000000000959c65b72147faf3450d8b50a0de57e72ffc5e0d"),
							},
							Data:            hexutil.MustDecode("0x00000000000000000000000000000000000000000000000000195d909d5000ac0000000000000000000000000000000000000000000000a4933a3b0f94685ddd000000000000000000000000000000000000000000000367fd4e9d55e118deb10000000000000000000000000000000000000000000000a49320dd7ef7185d31000000000000000000000000000000000000000000000367fd67fae67e68df5d"),
							BlockNumber:     lo.Must(new(big.Int).SetString("42292460", 0)),
							TransactionHash: common.HexToHash("0xe64abd08fecf171163192cd793c6bb2897f4a10c36cd915dd2f98be2a43b3848"),
							Index:           177,
							Removed:         false,
						}},
						Status:           1,
						TransactionHash:  common.HexToHash("0xe64abd08fecf171163192cd793c6bb2897f4a10c36cd915dd2f98be2a43b3848"),
						TransactionIndex: 29,
					},
				},
				config: &config.Module{
					Network:  filter.NetworkPolygon,
					Endpoint: endpoint.MustGet(filter.NetworkPolygon),
				},
			},
			want: &schema.Feed{
				ID:      "0xe64abd08fecf171163192cd793c6bb2897f4a10c36cd915dd2f98be2a43b3848",
				Network: filter.NetworkPolygon,
				Index:   29,
				From:    "0xD1FecCF6881970105dfb2b654054174007f0e07E",
				To:      "0xDb46d1Dc155634FbC732f92E853b10B288AD5a1d",
				Type:    filter.TypeSocialComment,
				Calldata: &schema.Calldata{
					FunctionHash: "0xb6f32d2b",
				},
				Platform: lo.ToPtr(filter.PlatformLens),
				Fee: &schema.Fee{
					Amount:  lo.Must(decimal.NewFromString("52156851468844922")),
					Decimal: 18,
				},
				Actions: []*schema.Action{
					{
						Type:     filter.TypeSocialComment,
						Platform: "orb",
						From:     "0x934B510D4C9103E6a87AEf13b816fb080286D649",
						To:       "0xa9aeE5ed1b5fF1cC503298328dEfe11f6C0D2A8e",
						Metadata: metadata.SocialPost{
							Body:          "wow",
							Handle:        "sujiyan.lens",
							ProfileID:     "0x2e62",
							PublicationID: "0x28",
							Media:         []metadata.Media{},
							Target: &metadata.SocialPost{
								Body: "Do you still think about me? #music",
								Media: []metadata.Media{
									{
										MimeType: "audio/mpeg",
										Address:  "ipfs://bafybeieaoatiqdkpcghcietq7lqws477hwen42ihvtx72utcmnmvqdovuy",
									},
								},
								Handle:        "infinati.lens",
								ProfileID:     "0x01823f",
								PublicationID: "0x02ca",
								ContentURI:    "ar://ge5_a4Ayivu-PG_VIk9nIRR8xT6R1sOiSVM6340jBuk",
								Tags:          []string{"music"},
							},
							ContentURI: "https://arweave.net/1br00tGpb9MLjP8py0IKbg_Tz9nuuv0-oAvlMSnr1xA",
							Tags:       nil,
							Timestamp:  1683197214,
						},
					},
				},
				Status:    true,
				Timestamp: 1683197214,
			},
			wantError: require.NoError,
		},
		{
			name: "Lens V1 Mirror",
			arguments: arguments{
				task: &source.Task{
					Network: filter.NetworkPolygon,
					ChainID: 137,
					Header: &ethereum.Header{
						Hash:         common.HexToHash("0xfe1c1896c884c53514c87395317b0b8b0fd0565d62bdf0b240e89a4f2f156cb7"),
						ParentHash:   common.HexToHash("0xf5634b5d3bfb10fc9683bf0f004072029f24ece0893628946c25587bd918d9da"),
						UncleHash:    common.HexToHash("0x1dcc4de8dec75d7aab85b567b6ccd41ad312451b948a7413f0a142fd40d49347"),
						Coinbase:     common.HexToAddress("0x8BbF92F4da9Be0478464A077F582ABD7b6dF193c"),
						Number:       lo.Must(new(big.Int).SetString("42292407", 0)),
						GasLimit:     30000000,
						GasUsed:      9149010,
						Timestamp:    1683197102,
						BaseFee:      lo.Must(new(big.Int).SetString("209350257418", 0)),
						Transactions: nil,
					},
					Transaction: &ethereum.Transaction{
						BlockHash: common.HexToHash("0xf986396e917af5ef5df171660d6f081e9bd5de621f4d14d186c16cac86402202"),
						From:      common.HexToAddress("0xD1FecCF6881970105dfb2b654054174007f0e07E"),
						Gas:       1500000,
						GasPrice:  lo.Must(new(big.Int).SetString("247161021128", 10)),
						Hash:      common.HexToHash("0xf986396e917af5ef5df171660d6f081e9bd5de621f4d14d186c16cac86402202"),
						Input:     hexutil.MustDecode("0x2faeed8100000000000000000000000000000000000000000000000000000000000000200000000000000000000000000000000000000000000000000000000000002e62000000000000000000000000000000000000000000000000000000000001a8ae000000000000000000000000000000000000000000000000000000000000001400000000000000000000000000000000000000000000000000000000000000c0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000e000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000"),
						To:        lo.ToPtr(common.HexToAddress("0xDb46d1Dc155634FbC732f92E853b10B288AD5a1d")),
						Value:     lo.Must(new(big.Int).SetString("0", 0)),
						Type:      0,
						ChainID:   lo.Must(new(big.Int).SetString("137", 0)),
					},
					Receipt: &ethereum.Receipt{
						BlockHash:         common.HexToHash("0xfe1c1896c884c53514c87395317b0b8b0fd0565d62bdf0b240e89a4f2f156cb7"),
						BlockNumber:       lo.Must(new(big.Int).SetString("42292407", 0)),
						ContractAddress:   nil,
						CumulativeGasUsed: 5996006,
						EffectiveGasPrice: hexutil.MustDecodeBig("0x398bf1e2c8"),
						GasUsed:           102305,
						Logs: []*ethereum.Log{{
							Address: common.HexToAddress("0xDb46d1Dc155634FbC732f92E853b10B288AD5a1d"),
							Topics: []common.Hash{
								common.HexToHash("0x9ea5dedb85bd9da4e264ee5a39b7ba0982e5d4d035d55edfa98a36b00e770b5a"),
								common.HexToHash("0x0000000000000000000000000000000000000000000000000000000000002e62"),
								common.HexToHash("0x0000000000000000000000000000000000000000000000000000000000000027"),
							},
							Data:            hexutil.MustDecode("0x000000000000000000000000000000000000000000000000000000000001a8ae000000000000000000000000000000000000000000000000000000000000001400000000000000000000000000000000000000000000000000000000000000c0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000e00000000000000000000000000000000000000000000000000000000064538cae00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000"),
							BlockNumber:     lo.Must(new(big.Int).SetString("42292407", 0)),
							TransactionHash: common.HexToHash("0xf986396e917af5ef5df171660d6f081e9bd5de621f4d14d186c16cac86402202"),
							Index:           142,
							Removed:         false,
						}, {
							Address: common.HexToAddress("0x0000000000000000000000000000000000001010"),
							Topics: []common.Hash{
								common.HexToHash("0x4dfe1bbbcf077ddc3e01291eea2d5c70c2b422b415d95645b9adcfd678cb1d63"),
								common.HexToHash("0x0000000000000000000000000000000000000000000000000000000000001010"),
								common.HexToHash("0x000000000000000000000000d1feccf6881970105dfb2b654054174007f0e07e"),
								common.HexToHash("0x0000000000000000000000008bbf92f4da9be0478464a077f582abd7b6df193c"),
							},
							Data:            hexutil.MustDecode("0x000000000000000000000000000000000000000000000000000dbe2285de707e0000000000000000000000000000000000000000000000a49394105e97fdb5a50000000000000000000000000000000000000000000002827fceea0b84450ea80000000000000000000000000000000000000000000000a49386523c121f45270000000000000000000000000000000000000000000002827fdca82e0a237f26"),
							BlockNumber:     lo.Must(new(big.Int).SetString("42292407", 0)),
							TransactionHash: common.HexToHash("0xf986396e917af5ef5df171660d6f081e9bd5de621f4d14d186c16cac86402202"),
							Index:           143,
							Removed:         false,
						}},
						Status:           1,
						TransactionHash:  common.HexToHash("0xf986396e917af5ef5df171660d6f081e9bd5de621f4d14d186c16cac86402202"),
						TransactionIndex: 39,
					},
				},
				config: &config.Module{
					Network:  filter.NetworkPolygon,
					Endpoint: endpoint.MustGet(filter.NetworkPolygon),
				},
			},
			want: &schema.Feed{
				ID:      "0xf986396e917af5ef5df171660d6f081e9bd5de621f4d14d186c16cac86402202",
				Network: filter.NetworkPolygon,
				Index:   39,
				From:    "0xD1FecCF6881970105dfb2b654054174007f0e07E",
				To:      "0xDb46d1Dc155634FbC732f92E853b10B288AD5a1d",
				Type:    filter.TypeSocialShare,
				Calldata: &schema.Calldata{
					FunctionHash: "0x2faeed81",
				},
				Platform: lo.ToPtr(filter.PlatformLens),
				Fee: &schema.Fee{
					Amount:  lo.Must(decimal.NewFromString("25285808266500040")),
					Decimal: 18,
				},
				Actions: []*schema.Action{
					{
						Type:     filter.TypeSocialShare,
						Platform: "orb",
						From:     "0x934B510D4C9103E6a87AEf13b816fb080286D649",
						To:       "0xDb46d1Dc155634FbC732f92E853b10B288AD5a1d",
						Metadata: metadata.SocialPost{
							Body:          "",
							Handle:        "sujiyan.lens",
							ProfileID:     "0x2e62",
							PublicationID: "0x27",
							Media:         []metadata.Media{},
							Target: &metadata.SocialPost{
								Body: "@sujiyan.lens ðŸ‡¯ðŸ‡µ",
								Media: []metadata.Media{
									{
										MimeType: "image/jpeg",
										Address:  "ipfs://QmPs5HNkak9CmXguyaYUiH4ypRgzaKQAxkVXnhq8UjaJ3r",
									},
								},
								Handle:        "lindao.lens",
								ProfileID:     "0x01a8ae",
								PublicationID: "0x14",
								ContentURI:    "https://arweave.net/8QcdcOITWAOiel6ZBE7MzlztD0gmrssLfspKCiWpXfY",
								Tags:          nil,
							},
							Tags:      nil,
							Timestamp: 1683197102,
						},
					},
				},
				Status:    true,
				Timestamp: 1683197102,
			},
			wantError: require.NoError,
		},
		{
			name: "Lens Collect V1 Mint",
			arguments: arguments{
				task: &source.Task{
					Network: filter.NetworkPolygon,
					ChainID: 137,
					Header: &ethereum.Header{
						Hash:         common.HexToHash("0x929496e850ebfd3a881f62a9bd6c07c4de65a19fb720f592c0175ee344dfb296"),
						ParentHash:   common.HexToHash("0xb1eab4d96da6f4bd0f09a75c0a896d37daf1cb7cb8974486e23b3d34ed6e1765"),
						UncleHash:    common.HexToHash("0x1dcc4de8dec75d7aab85b567b6ccd41ad312451b948a7413f0a142fd40d49347"),
						Coinbase:     common.HexToAddress("0xeC20607aa654D823DD01BEB8780a44863c57Ed07"),
						Number:       lo.Must(new(big.Int).SetString("40816920", 0)),
						GasLimit:     29736462,
						GasUsed:      18506039,
						Timestamp:    1679902646,
						BaseFee:      lo.Must(new(big.Int).SetString("167702248113", 0)),
						Transactions: nil,
					},
					Transaction: &ethereum.Transaction{
						BlockHash: common.HexToHash("0xe815a7bd8a23691b4d20c3a07d1aea4cbd702b28746047c01da0a4e82f6577dc"),
						From:      common.HexToAddress("0x77582a98132c2BE11a6C0F85Ca6361555A030A68"),
						Gas:       1500000,
						GasPrice:  lo.Must(new(big.Int).SetString("287373960455", 10)),
						Hash:      common.HexToHash("0xe815a7bd8a23691b4d20c3a07d1aea4cbd702b28746047c01da0a4e82f6577dc"),
						Input:     hexutil.MustDecode("0x9d6f320e00000000000000000000000000000000000000000000000000000000000000200000000000000000000000000000000000000000000000000000000000000001000000000000000000000000e9c57c291340ef34db3646a10af99fe2a0e0382700000000000000000000000000000000000000000000000000000000000083a60000000000000000000000000000000000000000000000000000000000000008"),
						To:        lo.ToPtr(common.HexToAddress("0x5a84eC20F88e94dC3EB96cE77695997f8446a22D")),
						Value:     lo.Must(new(big.Int).SetString("0", 0)),
						Type:      0,
						ChainID:   lo.Must(new(big.Int).SetString("137", 0)),
					},
					Receipt: &ethereum.Receipt{
						BlockHash:         common.HexToHash("0x929496e850ebfd3a881f62a9bd6c07c4de65a19fb720f592c0175ee344dfb296"),
						BlockNumber:       lo.Must(new(big.Int).SetString("40816920", 0)),
						ContractAddress:   nil,
						CumulativeGasUsed: 1794749,
						EffectiveGasPrice: hexutil.MustDecodeBig("0x42e8d2a507"),
						GasUsed:           444428,
						Logs: []*ethereum.Log{{
							Address: common.HexToAddress("0x648B342302f9CE4BCcE7Eb6a3E837D1Ab9553Cc1"),
							Topics: []common.Hash{
								common.HexToHash("0x414cd0b34676984f09a5f76ce9718d4062e50283abe0e7e274a9a5b4e0c99c30"),
							},
							Data:            hexutil.MustDecode("0x000000000000000000000000000000000000000000000000000000000000006000000000000000000000000000000000000000000000000000000000000000a000000000000000000000000000000000000000000000000000000000642147b6000000000000000000000000000000000000000000000000000000000000001668656e727971772e6c656e732d436f6c6c6563742d3800000000000000000000000000000000000000000000000000000000000000000000000000000000000968656e722d436c2d380000000000000000000000000000000000000000000000"),
							BlockNumber:     lo.Must(new(big.Int).SetString("40816920", 0)),
							TransactionHash: common.HexToHash("0xe815a7bd8a23691b4d20c3a07d1aea4cbd702b28746047c01da0a4e82f6577dc"),
							Index:           52,
							Removed:         false,
						}, {
							Address: common.HexToAddress("0x648B342302f9CE4BCcE7Eb6a3E837D1Ab9553Cc1"),
							Topics: []common.Hash{
								common.HexToHash("0x898a2dec95856255977a0fb48cebc30051d50c0d8d33f93dea1e3ddb2e342442"),
								common.HexToHash("0x00000000000000000000000000000000000000000000000000000000000083a6"),
								common.HexToHash("0x0000000000000000000000000000000000000000000000000000000000000008"),
							},
							Data:            hexutil.MustDecode("0x00000000000000000000000000000000000000000000000000000000642147b6"),
							BlockNumber:     lo.Must(new(big.Int).SetString("40816920", 0)),
							TransactionHash: common.HexToHash("0xe815a7bd8a23691b4d20c3a07d1aea4cbd702b28746047c01da0a4e82f6577dc"),
							Index:           53,
							Removed:         false,
						}, {
							Address: common.HexToAddress("0xDb46d1Dc155634FbC732f92E853b10B288AD5a1d"),
							Topics: []common.Hash{
								common.HexToHash("0x0b227b550ffed48af813b32e246f787e99581ee13206ba8f9d90d63615269b3f"),
								common.HexToHash("0x00000000000000000000000000000000000000000000000000000000000083a6"),
								common.HexToHash("0x0000000000000000000000000000000000000000000000000000000000000008"),
								common.HexToHash("0x000000000000000000000000648b342302f9ce4bcce7eb6a3e837d1ab9553cc1"),
							},
							Data:            hexutil.MustDecode("0x00000000000000000000000000000000000000000000000000000000642147b6"),
							BlockNumber:     lo.Must(new(big.Int).SetString("40816920", 0)),
							TransactionHash: common.HexToHash("0xe815a7bd8a23691b4d20c3a07d1aea4cbd702b28746047c01da0a4e82f6577dc"),
							Index:           54,
							Removed:         false,
						}, {
							Address: common.HexToAddress("0xDb46d1Dc155634FbC732f92E853b10B288AD5a1d"),
							Topics: []common.Hash{
								common.HexToHash("0x68edb7ec2c37d21b3b72233960b487f2966f4ac82b7430d39f24d1f8d6f99106"),
								common.HexToHash("0x00000000000000000000000000000000000000000000000000000000000083a6"),
								common.HexToHash("0x0000000000000000000000000000000000000000000000000000000000000008"),
								common.HexToHash("0x0000000000000000000000000000000000000000000000000000000000000001"),
							},
							Data:            hexutil.MustDecode("0x00000000000000000000000000000000000000000000000000000000000000000000000000000000000000005a84ec20f88e94dc3eb96ce77695997f8446a22d00000000000000000000000000000000000000000000000000000000642147b6"),
							BlockNumber:     lo.Must(new(big.Int).SetString("40816920", 0)),
							TransactionHash: common.HexToHash("0xe815a7bd8a23691b4d20c3a07d1aea4cbd702b28746047c01da0a4e82f6577dc"),
							Index:           55,
							Removed:         false,
						}, {
							Address: common.HexToAddress("0x648B342302f9CE4BCcE7Eb6a3E837D1Ab9553Cc1"),
							Topics: []common.Hash{
								common.HexToHash("0xddf252ad1be2c89b69c2b068fc378daa952ba7f163c4a11628f55a4df523b3ef"),
								common.HexToHash("0x0000000000000000000000000000000000000000000000000000000000000000"),
								common.HexToHash("0x0000000000000000000000005a84ec20f88e94dc3eb96ce77695997f8446a22d"),
								common.HexToHash("0x0000000000000000000000000000000000000000000000000000000000000001"),
							},
							Data:            nil,
							BlockNumber:     lo.Must(new(big.Int).SetString("40816920", 0)),
							TransactionHash: common.HexToHash("0xe815a7bd8a23691b4d20c3a07d1aea4cbd702b28746047c01da0a4e82f6577dc"),
							Index:           56,
							Removed:         false,
						}, {
							Address: common.HexToAddress("0xDb46d1Dc155634FbC732f92E853b10B288AD5a1d"),
							Topics: []common.Hash{
								common.HexToHash("0xed39bf0d9afa849610b901c9d7f4d00751ba20de2db023428065bec153833218"),
								common.HexToHash("0x0000000000000000000000005a84ec20f88e94dc3eb96ce77695997f8446a22d"),
								common.HexToHash("0x00000000000000000000000000000000000000000000000000000000000083a6"),
								common.HexToHash("0x0000000000000000000000000000000000000000000000000000000000000008"),
							},
							Data:            hexutil.MustDecode("0x00000000000000000000000000000000000000000000000000000000000083a60000000000000000000000000000000000000000000000000000000000000008000000000000000000000000000000000000000000000000000000000000008000000000000000000000000000000000000000000000000000000000642147b60000000000000000000000000000000000000000000000000000000000000000"),
							BlockNumber:     lo.Must(new(big.Int).SetString("40816920", 0)),
							TransactionHash: common.HexToHash("0xe815a7bd8a23691b4d20c3a07d1aea4cbd702b28746047c01da0a4e82f6577dc"),
							Index:           57,
							Removed:         false,
						}, {
							Address: common.HexToAddress("0xDb46d1Dc155634FbC732f92E853b10B288AD5a1d"),
							Topics: []common.Hash{
								common.HexToHash("0x68edb7ec2c37d21b3b72233960b487f2966f4ac82b7430d39f24d1f8d6f99106"),
								common.HexToHash("0x00000000000000000000000000000000000000000000000000000000000083a6"),
								common.HexToHash("0x0000000000000000000000000000000000000000000000000000000000000008"),
								common.HexToHash("0x0000000000000000000000000000000000000000000000000000000000000001"),
							},
							Data:            hexutil.MustDecode("0x0000000000000000000000005a84ec20f88e94dc3eb96ce77695997f8446a22d000000000000000000000000e9c57c291340ef34db3646a10af99fe2a0e0382700000000000000000000000000000000000000000000000000000000642147b6"),
							BlockNumber:     lo.Must(new(big.Int).SetString("40816920", 0)),
							TransactionHash: common.HexToHash("0xe815a7bd8a23691b4d20c3a07d1aea4cbd702b28746047c01da0a4e82f6577dc"),
							Index:           58,
							Removed:         false,
						}, {
							Address: common.HexToAddress("0x648B342302f9CE4BCcE7Eb6a3E837D1Ab9553Cc1"),
							Topics: []common.Hash{
								common.HexToHash("0x8c5be1e5ebec7d5bd14f71427d1e84f3dd0314c0f7b2291e5b200ac8c7c3b925"),
								common.HexToHash("0x0000000000000000000000005a84ec20f88e94dc3eb96ce77695997f8446a22d"),
								common.HexToHash("0x0000000000000000000000000000000000000000000000000000000000000000"),
								common.HexToHash("0x0000000000000000000000000000000000000000000000000000000000000001"),
							},
							Data:            nil,
							BlockNumber:     lo.Must(new(big.Int).SetString("40816920", 0)),
							TransactionHash: common.HexToHash("0xe815a7bd8a23691b4d20c3a07d1aea4cbd702b28746047c01da0a4e82f6577dc"),
							Index:           59,
							Removed:         false,
						}, {
							Address: common.HexToAddress("0x648B342302f9CE4BCcE7Eb6a3E837D1Ab9553Cc1"),
							Topics: []common.Hash{
								common.HexToHash("0xddf252ad1be2c89b69c2b068fc378daa952ba7f163c4a11628f55a4df523b3ef"),
								common.HexToHash("0x0000000000000000000000005a84ec20f88e94dc3eb96ce77695997f8446a22d"),
								common.HexToHash("0x000000000000000000000000e9c57c291340ef34db3646a10af99fe2a0e03827"),
								common.HexToHash("0x0000000000000000000000000000000000000000000000000000000000000001"),
							},
							Data:            nil,
							BlockNumber:     lo.Must(new(big.Int).SetString("40816920", 0)),
							TransactionHash: common.HexToHash("0xe815a7bd8a23691b4d20c3a07d1aea4cbd702b28746047c01da0a4e82f6577dc"),
							Index:           60,
							Removed:         false,
						}, {
							Address: common.HexToAddress("0x0000000000000000000000000000000000001010"),
							Topics: []common.Hash{
								common.HexToHash("0x4dfe1bbbcf077ddc3e01291eea2d5c70c2b422b415d95645b9adcfd678cb1d63"),
								common.HexToHash("0x0000000000000000000000000000000000000000000000000000000000001010"),
								common.HexToHash("0x00000000000000000000000077582a98132c2be11a6c0f85ca6361555a030a68"),
								common.HexToHash("0x000000000000000000000000ec20607aa654d823dd01beb8780a44863c57ed07"),
							},
							Data:            hexutil.MustDecode("0x00000000000000000000000000000000000000000000000000bcf3e4d4f82c0800000000000000000000000000000000000000000000003f1acab3b86c34f28900000000000000000000000000000000000000000000064ec48ebb530c7154ea00000000000000000000000000000000000000000000003f1a0dbfd3973cc68100000000000000000000000000000000000000000000064ec54baf37e16980f2"),
							BlockNumber:     lo.Must(new(big.Int).SetString("40816920", 0)),
							TransactionHash: common.HexToHash("0xe815a7bd8a23691b4d20c3a07d1aea4cbd702b28746047c01da0a4e82f6577dc"),
							Index:           61,
							Removed:         false,
						}},
						Status:           1,
						TransactionHash:  common.HexToHash("0xe815a7bd8a23691b4d20c3a07d1aea4cbd702b28746047c01da0a4e82f6577dc"),
						TransactionIndex: 8,
					},
				},
				config: &config.Module{
					Network:  filter.NetworkPolygon,
					Endpoint: endpoint.MustGet(filter.NetworkPolygon),
				},
			},
			want: &schema.Feed{
				ID:      "0xe815a7bd8a23691b4d20c3a07d1aea4cbd702b28746047c01da0a4e82f6577dc",
				Network: filter.NetworkPolygon,
				Index:   8,
				From:    "0x77582a98132c2BE11a6C0F85Ca6361555A030A68",
				To:      "0x5a84eC20F88e94dC3EB96cE77695997f8446a22D",
				Type:    filter.TypeSocialMint,
				Calldata: &schema.Calldata{
					FunctionHash: "0x9d6f320e",
				},
				Platform: lo.ToPtr(filter.PlatformLens),
				Fee: &schema.Fee{
					Amount:  lo.Must(decimal.NewFromString("127717034497094740")),
					Decimal: 18,
				},
				Actions: []*schema.Action{
					{
						Type:     filter.TypeSocialMint,
						Platform: "Lenster",
						From:     "0xe9c57C291340Ef34DB3646A10af99FE2A0E03827",
						To:       "0x5a84eC20F88e94dC3EB96cE77695997f8446a22D",
						Metadata: metadata.SocialPost{
							Body:          "\"demos\", meaning people, and \"kratos\" meaning power; so democracy can be thought of as \"power of the people\": a way of governing which depends on the will of the people.",
							Media:         []metadata.Media{},
							Handle:        "henryqw.lens",
							ProfileID:     "0x83a6",
							PublicationID: "0x08",
							ContentURI:    "https://arweave.net/aMAYipJXf9rVHnwRYnNF7eUCxBc1zfkaopBt5TJwLWw",
							Tags:          nil,
							Timestamp:     1679902646,
						},
					},
				},
				Status:    true,
				Timestamp: 1679902646,
			},
			wantError: require.NoError,
		},
		{
			name: "Lens V1 Create Profile",
			arguments: arguments{
				task: &source.Task{
					Network: filter.NetworkPolygon,
					ChainID: 137,
					Header: &ethereum.Header{
						Hash:         common.HexToHash("0xf251ad9cad115b9e16d25c156ecb70fb6558d3474bfc1ef584fea5724da5489c"),
						ParentHash:   common.HexToHash("0x67900c0f22c2ad99600de62ad39f45dd429fef913f7a162f5725dd556a8f563e"),
						UncleHash:    common.HexToHash("0x1dcc4de8dec75d7aab85b567b6ccd41ad312451b948a7413f0a142fd40d49347"),
						Coinbase:     common.HexToAddress("0x140fd0D4D52dd43FD691118E6518b6E9cdE55503"),
						Number:       lo.Must(new(big.Int).SetString("34494848", 0)),
						GasLimit:     29970705,
						GasUsed:      29969543,
						Timestamp:    1666092266,
						BaseFee:      lo.Must(new(big.Int).SetString("62746597065", 0)),
						Transactions: nil,
					},
					Transaction: &ethereum.Transaction{
						BlockHash: common.HexToHash("0x58cd98a80249aaf74e7296a2017c6c92ef08f5ae24976c16ff548bd720dd64a4"),
						From:      common.HexToAddress("0xD1FecCF6881970105dfb2b654054174007f0e07E"),
						Gas:       321677,
						GasPrice:  lo.Must(new(big.Int).SetString("171242978091", 10)),
						Hash:      common.HexToHash("0x58cd98a80249aaf74e7296a2017c6c92ef08f5ae24976c16ff548bd720dd64a4"),
						Input:     hexutil.MustDecode("0x07e5f9480000000000000000000000000000000000000000000000000000000000000020000000000000000000000000e9c57c291340ef34db3646a10af99fe2a0e0382700000000000000000000000000000000000000000000000000000000000000c000000000000000000000000000000000000000000000000000000000000001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000012000000000000000000000000000000000000000000000000000000000000001400000000000000000000000000000000000000000000000000000000000000007706f6c6562756700000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000035697066733a2f2f516d664b374535705553344c537755375a6251384b444352676943677a534c64417a7274756570644e4577536f420000000000000000000000"),
						To:        lo.ToPtr(common.HexToAddress("0x1eeC6ecCaA4625da3Fa6Cd6339DBcc2418710E8a")),
						Value:     lo.Must(new(big.Int).SetString("0", 0)),
						Type:      0,
						ChainID:   lo.Must(new(big.Int).SetString("137", 0)),
					},
					Receipt: &ethereum.Receipt{
						BlockHash:         common.HexToHash("0xf251ad9cad115b9e16d25c156ecb70fb6558d3474bfc1ef584fea5724da5489c"),
						BlockNumber:       lo.Must(new(big.Int).SetString("34494848", 0)),
						ContractAddress:   nil,
						CumulativeGasUsed: 3565298,
						EffectiveGasPrice: hexutil.MustDecodeBig("0x27dee07b2b"),
						GasUsed:           311135,
						Logs: []*ethereum.Log{{
							Address: common.HexToAddress("0xDb46d1Dc155634FbC732f92E853b10B288AD5a1d"),
							Topics: []common.Hash{
								common.HexToHash("0xddf252ad1be2c89b69c2b068fc378daa952ba7f163c4a11628f55a4df523b3ef"),
								common.HexToHash("0x0000000000000000000000000000000000000000000000000000000000000000"),
								common.HexToHash("0x000000000000000000000000e9c57c291340ef34db3646a10af99fe2a0e03827"),
								common.HexToHash("0x0000000000000000000000000000000000000000000000000000000000015fc3"),
							},
							Data:            nil,
							BlockNumber:     lo.Must(new(big.Int).SetString("34494848", 0)),
							TransactionHash: common.HexToHash("0x58cd98a80249aaf74e7296a2017c6c92ef08f5ae24976c16ff548bd720dd64a4"),
							Index:           113,
							Removed:         false,
						}, {
							Address: common.HexToAddress("0xDb46d1Dc155634FbC732f92E853b10B288AD5a1d"),
							Topics: []common.Hash{
								common.HexToHash("0x4e14f57cff7910416f2ef43cf05019b5a97a313de71fec9344be11b9b88fed12"),
								common.HexToHash("0x0000000000000000000000000000000000000000000000000000000000015fc3"),
								common.HexToHash("0x0000000000000000000000001eec6eccaa4625da3fa6cd6339dbcc2418710e8a"),
								common.HexToHash("0x000000000000000000000000e9c57c291340ef34db3646a10af99fe2a0e03827"),
							},
							Data:            hexutil.MustDecode("0x00000000000000000000000000000000000000000000000000000000000000c0000000000000000000000000000000000000000000000000000000000000010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000120000000000000000000000000000000000000000000000000000000000000014000000000000000000000000000000000000000000000000000000000634e8cea000000000000000000000000000000000000000000000000000000000000000c706f6c656275672e6c656e730000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000035697066733a2f2f516d664b374535705553344c537755375a6251384b444352676943677a534c64417a7274756570644e4577536f420000000000000000000000"),
							BlockNumber:     lo.Must(new(big.Int).SetString("34494848", 0)),
							TransactionHash: common.HexToHash("0x58cd98a80249aaf74e7296a2017c6c92ef08f5ae24976c16ff548bd720dd64a4"),
							Index:           114,
							Removed:         false,
						}, {
							Address: common.HexToAddress("0x0000000000000000000000000000000000001010"),
							Topics: []common.Hash{
								common.HexToHash("0x4dfe1bbbcf077ddc3e01291eea2d5c70c2b422b415d95645b9adcfd678cb1d63"),
								common.HexToHash("0x0000000000000000000000000000000000000000000000000000000000001010"),
								common.HexToHash("0x000000000000000000000000d1feccf6881970105dfb2b654054174007f0e07e"),
								common.HexToHash("0x000000000000000000000000140fd0d4d52dd43fd691118e6518b6e9cde55503"),
							},
							Data:            hexutil.MustDecode("0x0000000000000000000000000000000000000000000000000077edd50bcf5e5e0000000000000000000000000000000000000000000002d03fb9a4bd5a85785000000000000000000000000000000000000000000000046fbb39a3fdc57c5ffd0000000000000000000000000000000000000000000002d03f41b6e84eb619f200000000000000000000000000000000000000000000046fbbb191d2d14bbe5b"),
							BlockNumber:     lo.Must(new(big.Int).SetString("34494848", 0)),
							TransactionHash: common.HexToHash("0x58cd98a80249aaf74e7296a2017c6c92ef08f5ae24976c16ff548bd720dd64a4"),
							Index:           115,
							Removed:         false,
						}},
						Status:           1,
						TransactionHash:  common.HexToHash("0x58cd98a80249aaf74e7296a2017c6c92ef08f5ae24976c16ff548bd720dd64a4"),
						TransactionIndex: 32,
					},
				},
				config: &config.Module{
					Network:  filter.NetworkPolygon,
					Endpoint: endpoint.MustGet(filter.NetworkPolygon),
				},
			},
			want: &schema.Feed{
				ID:      "0x58cd98a80249aaf74e7296a2017c6c92ef08f5ae24976c16ff548bd720dd64a4",
				Network: filter.NetworkPolygon,
				Index:   32,
				From:    "0xD1FecCF6881970105dfb2b654054174007f0e07E",
				To:      "0x1eeC6ecCaA4625da3Fa6Cd6339DBcc2418710E8a",
				Type:    filter.TypeSocialProfile,
				Calldata: &schema.Calldata{
					FunctionHash: "0x07e5f948",
				},
				Platform: lo.ToPtr(filter.PlatformLens),
				Fee: &schema.Fee{
					Amount:  lo.Must(decimal.NewFromString("53279683988343285")),
					Decimal: 18,
				},
				Actions: []*schema.Action{
					{
						Type:     filter.TypeSocialProfile,
						Platform: "Lens",
						From:     "0x1eeC6ecCaA4625da3Fa6Cd6339DBcc2418710E8a",
						To:       "0xe9c57C291340Ef34DB3646A10af99FE2A0E03827",
						Metadata: metadata.SocialProfile{
							ProfileID: "0x015fc3",
							Action:    metadata.ActionSocialProfileCreate,
							Address:   common.HexToAddress("0xe9c57C291340Ef34DB3646A10af99FE2A0E03827"),
							Handle:    "polebug.lens",
							ImageURI:  "",
						},
					},
				},
				Status:    true,
				Timestamp: 1666092266,
			},
			wantError: require.NoError,
		},
		{
			name: "Lens V1 Update Profile Metadata",
			arguments: arguments{
				task: &source.Task{
					Network: filter.NetworkPolygon,
					ChainID: 137,
					Header: &ethereum.Header{
						Hash:         common.HexToHash("0x7fa12b7020806745a4218b3e72de3237dc0394a42752cc61da415db5ba6b25c0"),
						ParentHash:   common.HexToHash("0x7e5884731e7510804f412915b24e960302dd7242a1714d748f2a33aa639fd13d"),
						UncleHash:    common.HexToHash("0x1dcc4de8dec75d7aab85b567b6ccd41ad312451b948a7413f0a142fd40d49347"),
						Coinbase:     common.HexToAddress("0x4df34FAc8313DCD3442064b90E22129ad82B5103"),
						Number:       lo.Must(new(big.Int).SetString("50102845", 0)),
						GasLimit:     30412749,
						GasUsed:      30403071,
						Timestamp:    1700332970,
						BaseFee:      lo.Must(new(big.Int).SetString("54437577", 0)),
						Transactions: nil,
					},
					Transaction: &ethereum.Transaction{
						BlockHash: common.HexToHash("0x9ddb847657a957fc81fd06fc6231ad2d8d8f4c077956273b94e74e66a4e33c76"),
						From:      common.HexToAddress("0x58aA9a651d7CE87c4FbFB767405502864cD4e5EE"),
						Gas:       81771,
						GasPrice:  lo.Must(new(big.Int).SetString("2009088873", 10)),
						Hash:      common.HexToHash("0x9ddb847657a957fc81fd06fc6231ad2d8d8f4c077956273b94e74e66a4e33c76"),
						Input:     hexutil.MustDecode("0xefe4fd83000000000000000000000000000000000000000000000000000000000001e8e10000000000000000000000000000000000000000000000000000000000000040000000000000000000000000000000000000000000000000000000000000003f68747470733a2f2f617277656176652e6e65742f6275355450537156616134643543736a687769666d7a49304f764c384a5844484744554b544334414e436300"),
						To:        lo.ToPtr(common.HexToAddress("0xeff187b4190E551FC25a7fA4dFC6cf7fDeF7194f")),
						Value:     lo.Must(new(big.Int).SetString("0", 0)),
						Type:      2,
						ChainID:   lo.Must(new(big.Int).SetString("137", 0)),
					},
					Receipt: &ethereum.Receipt{
						BlockHash:         common.HexToHash("0x7fa12b7020806745a4218b3e72de3237dc0394a42752cc61da415db5ba6b25c0"),
						BlockNumber:       lo.Must(new(big.Int).SetString("50102845", 0)),
						ContractAddress:   nil,
						CumulativeGasUsed: 29153474,
						EffectiveGasPrice: hexutil.MustDecodeBig("0x77c04369"),
						GasUsed:           54925,
						Logs: []*ethereum.Log{{
							Address: common.HexToAddress("0xeff187b4190E551FC25a7fA4dFC6cf7fDeF7194f"),
							Topics: []common.Hash{
								common.HexToHash("0xf901a8b3832914a45999dd4c425fbe42eb4182724d394100401e633d9f0b286a"),
								common.HexToHash("0x000000000000000000000000000000000000000000000000000000000001e8e1"),
							},
							Data:            hexutil.MustDecode("0x000000000000000000000000000000000000000000000000000000000000004000000000000000000000000000000000000000000000000000000000655905aa000000000000000000000000000000000000000000000000000000000000003f68747470733a2f2f617277656176652e6e65742f6275355450537156616134643543736a687769666d7a49304f764c384a5844484744554b544334414e436300"),
							BlockNumber:     lo.Must(new(big.Int).SetString("50102845", 0)),
							TransactionHash: common.HexToHash("0x9ddb847657a957fc81fd06fc6231ad2d8d8f4c077956273b94e74e66a4e33c76"),
							Index:           925,
							Removed:         false,
						}, {
							Address: common.HexToAddress("0x0000000000000000000000000000000000001010"),
							Topics: []common.Hash{
								common.HexToHash("0x4dfe1bbbcf077ddc3e01291eea2d5c70c2b422b415d95645b9adcfd678cb1d63"),
								common.HexToHash("0x0000000000000000000000000000000000000000000000000000000000001010"),
								common.HexToHash("0x00000000000000000000000058aa9a651d7ce87c4fbfb767405502864cd4e5ee"),
								common.HexToHash("0x0000000000000000000000004df34fac8313dcd3442064b90e22129ad82b5103"),
							},
							Data:            hexutil.MustDecode("0x000000000000000000000000000000000000000000000000000061a4845104200000000000000000000000000000000000000000000000000b686310c9c1c8520000000000000000000000000000000000000000000001031863cc3cfcc9be240000000000000000000000000000000000000000000000000b68016c4570c43200000000000000000000000000000000000000000000010318642de1811ac244"),
							BlockNumber:     lo.Must(new(big.Int).SetString("50102845", 0)),
							TransactionHash: common.HexToHash("0x9ddb847657a957fc81fd06fc6231ad2d8d8f4c077956273b94e74e66a4e33c76"),
							Index:           926,
							Removed:         false,
						}},
						Status:           1,
						TransactionHash:  common.HexToHash("0x9ddb847657a957fc81fd06fc6231ad2d8d8f4c077956273b94e74e66a4e33c76"),
						TransactionIndex: 108,
					},
				},
				config: &config.Module{
					Network:  filter.NetworkPolygon,
					Endpoint: endpoint.MustGet(filter.NetworkPolygon),
				},
			},
			want: &schema.Feed{
				ID:      "0x9ddb847657a957fc81fd06fc6231ad2d8d8f4c077956273b94e74e66a4e33c76",
				Network: filter.NetworkPolygon,
				Index:   108,
				From:    "0x58aA9a651d7CE87c4FbFB767405502864cD4e5EE",
				To:      "0xeff187b4190E551FC25a7fA4dFC6cf7fDeF7194f",
				Type:    filter.TypeSocialProfile,
				Calldata: &schema.Calldata{
					FunctionHash: "0xefe4fd83",
				},
				Platform: lo.ToPtr(filter.PlatformLens),
				Fee: &schema.Fee{
					Amount:  lo.Must(decimal.NewFromString("110349206349525")),
					Decimal: 18,
				},
				Actions: []*schema.Action{
					{
						Type:     filter.TypeSocialProfile,
						Platform: "Lens",
						From:     "0x58aA9a651d7CE87c4FbFB767405502864cD4e5EE",
						To:       "0x58aA9a651d7CE87c4FbFB767405502864cD4e5EE",
						Metadata: metadata.SocialProfile{
							ProfileID: "0x01e8e1",
							Action:    metadata.ActionSocialProfileUpdate,
							Address:   common.HexToAddress("0x58aA9a651d7CE87c4FbFB767405502864cD4e5EE"),
							Handle:    "pijushji420.lens",
							Name:      "Pijush",
							Bio:       "Web3 community mod",
						},
					},
				},
				Status:    true,
				Timestamp: 1700332970,
			},
			wantError: require.NoError,
		},
		{
			name: "Lens V1 Update Profile Image URI",
			arguments: arguments{
				task: &source.Task{
					Network: filter.NetworkPolygon,
					ChainID: 137,
					Header: &ethereum.Header{
						Hash:         common.HexToHash("0xbb1d79088a918c610d252fc84add216652ce07f89876f618f0d4a015a2d22e5e"),
						ParentHash:   common.HexToHash("0xba65893db62e14320f886301d21da7663871227d15ae764159440c648f14684e"),
						UncleHash:    common.HexToHash("0x1dcc4de8dec75d7aab85b567b6ccd41ad312451b948a7413f0a142fd40d49347"),
						Coinbase:     common.HexToAddress("0x67B94473D81D0cd00849D563C94d0432Ac988B49"),
						Number:       lo.Must(new(big.Int).SetString("44868887", 0)),
						GasLimit:     29765755,
						GasUsed:      12955990,
						Timestamp:    1688902766,
						BaseFee:      lo.Must(new(big.Int).SetString("67219055539", 0)),
						Transactions: nil,
					},
					Transaction: &ethereum.Transaction{
						BlockHash: common.HexToHash("0xc6f1a39aaaf20476384087b958a3c07eb7f1657b145cfc1b6b77b25e70e9fabb"),
						From:      common.HexToAddress("0xeCE7edDc02FB8F0010420D0d76911826b1536655"),
						Gas:       1500000,
						GasPrice:  lo.Must(new(big.Int).SetString("334273986260", 10)),
						Hash:      common.HexToHash("0xc6f1a39aaaf20476384087b958a3c07eb7f1657b145cfc1b6b77b25e70e9fabb"),
						Input:     hexutil.MustDecode("0x054871b8000000000000000000000000000000000000000000000000000000000001a01800000000000000000000000000000000000000000000000000000000000000400000000000000000000000000000000000000000000000000000000000000042697066733a2f2f626166796265696471786a6f6970616a6f6175637464623372696f67327864737662756d696b6a716733796c67646664767a6c356c7933676b7671000000000000000000000000000000000000000000000000000000000000"),
						To:        lo.ToPtr(common.HexToAddress("0xDb46d1Dc155634FbC732f92E853b10B288AD5a1d")),
						Value:     lo.Must(new(big.Int).SetString("0", 0)),
						Type:      0,
						ChainID:   lo.Must(new(big.Int).SetString("137", 0)),
					},
					Receipt: &ethereum.Receipt{
						BlockHash:         common.HexToHash("0xbb1d79088a918c610d252fc84add216652ce07f89876f618f0d4a015a2d22e5e"),
						BlockNumber:       lo.Must(new(big.Int).SetString("44868887", 0)),
						ContractAddress:   nil,
						CumulativeGasUsed: 347700,
						EffectiveGasPrice: hexutil.MustDecodeBig("0x4dd4483ed4"),
						GasUsed:           58200,
						Logs: []*ethereum.Log{{
							Address: common.HexToAddress("0xDb46d1Dc155634FbC732f92E853b10B288AD5a1d"),
							Topics: []common.Hash{
								common.HexToHash("0xd5a5879cad33c830cc1432c1850107029a09c80c60e9bce1ecd08d24880bd46c"),
								common.HexToHash("0x000000000000000000000000000000000000000000000000000000000001a018"),
							},
							Data:            hexutil.MustDecode("0x00000000000000000000000000000000000000000000000000000000000000400000000000000000000000000000000000000000000000000000000064aa9c6e0000000000000000000000000000000000000000000000000000000000000042697066733a2f2f626166796265696471786a6f6970616a6f6175637464623372696f67327864737662756d696b6a716733796c67646664767a6c356c7933676b7671000000000000000000000000000000000000000000000000000000000000"),
							BlockNumber:     lo.Must(new(big.Int).SetString("44868887", 0)),
							TransactionHash: common.HexToHash("0xc6f1a39aaaf20476384087b958a3c07eb7f1657b145cfc1b6b77b25e70e9fabb"),
							Index:           6,
							Removed:         false,
						}, {
							Address: common.HexToAddress("0x0000000000000000000000000000000000001010"),
							Topics: []common.Hash{
								common.HexToHash("0x4dfe1bbbcf077ddc3e01291eea2d5c70c2b422b415d95645b9adcfd678cb1d63"),
								common.HexToHash("0x0000000000000000000000000000000000000000000000000000000000001010"),
								common.HexToHash("0x000000000000000000000000ece7eddc02fb8f0010420d0d76911826b1536655"),
								common.HexToHash("0x00000000000000000000000067b94473d81d0cd00849d563c94d0432ac988b49"),
							},
							Data:            hexutil.MustDecode("0x000000000000000000000000000000000000000000000000003737e8db29965800000000000000000000000000000000000000000000004d4466b72e002c4b75000000000000000000000000000000000000000000000cb28c95b7f4803beb5f00000000000000000000000000000000000000000000004d442f7f452502b51d000000000000000000000000000000000000000000000cb28cccefdd5b6581b7"),
							BlockNumber:     lo.Must(new(big.Int).SetString("44868887", 0)),
							TransactionHash: common.HexToHash("0xc6f1a39aaaf20476384087b958a3c07eb7f1657b145cfc1b6b77b25e70e9fabb"),
							Index:           7,
							Removed:         false,
						}},
						Status:           1,
						TransactionHash:  common.HexToHash("0xc6f1a39aaaf20476384087b958a3c07eb7f1657b145cfc1b6b77b25e70e9fabb"),
						TransactionIndex: 1,
					},
				},
				config: &config.Module{
					Network:  filter.NetworkPolygon,
					Endpoint: endpoint.MustGet(filter.NetworkPolygon),
				},
			},
			want: &schema.Feed{
				ID:      "0xc6f1a39aaaf20476384087b958a3c07eb7f1657b145cfc1b6b77b25e70e9fabb",
				Network: filter.NetworkPolygon,
				Index:   1,
				From:    "0xeCE7edDc02FB8F0010420D0d76911826b1536655",
				To:      "0xDb46d1Dc155634FbC732f92E853b10B288AD5a1d",
				Type:    filter.TypeSocialProfile,
				Calldata: &schema.Calldata{
					FunctionHash: "0x054871b8",
				},
				Platform: lo.ToPtr(filter.PlatformLens),
				Fee: &schema.Fee{
					Amount:  lo.Must(decimal.NewFromString("19454746000332000")),
					Decimal: 18,
				},
				Actions: []*schema.Action{
					{
						Type:     filter.TypeSocialProfile,
						Platform: "Lens",
						From:     "0xeCE7edDc02FB8F0010420D0d76911826b1536655",
						To:       "0xeCE7edDc02FB8F0010420D0d76911826b1536655",
						Metadata: metadata.SocialProfile{
							ProfileID: "0x01a018",
							Action:    metadata.ActionSocialProfileUpdate,
							Address:   common.HexToAddress("0xeCE7edDc02FB8F0010420D0d76911826b1536655"),
							ImageURI:  "ipfs://bafybeidqxjoipajoauctdb3riog2xdsvbumikjqg3ylgdfdvzl5ly3gkvq",
						},
					},
				},
				Status:    true,
				Timestamp: 1688902766,
			},
			wantError: require.NoError,
		},
		// V2
		{
			name: "Lens V2 Post",
			arguments: arguments{
				task: &source.Task{
					Network: filter.NetworkPolygon,
					ChainID: 137,
					Header: &ethereum.Header{
						Hash:         common.HexToHash("0x6014a610bead90c56500aebc46f6f18de38baf278eb7ab10bce6dc61f4e1d16d"),
						ParentHash:   common.HexToHash("0xacc79e044704623fdb032b8d672400f1c899d8ff1def54f2a31d8005f8115b3f"),
						UncleHash:    common.HexToHash("0x1dcc4de8dec75d7aab85b567b6ccd41ad312451b948a7413f0a142fd40d49347"),
						Coinbase:     common.HexToAddress("0x7c7379531b2aEE82e4Ca06D4175D13b9CBEafd49"),
						Number:       lo.Must(new(big.Int).SetString("49638714", 0)),
						GasLimit:     30000000,
						GasUsed:      7903052,
						Timestamp:    1699329250,
						BaseFee:      lo.Must(new(big.Int).SetString("171819158666", 0)),
						Transactions: nil,
					},
					Transaction: &ethereum.Transaction{
						BlockHash: common.HexToHash("0x16a4eb2616f3e5cbdb19901fe3478870cf4d61fd76790f4ab9692bdd2e08d118"),
						From:      common.HexToAddress("0x76D4fFdA8c66864FA07f0a285B8E01E11b4Bb7b3"),
						Gas:       327707,
						GasPrice:  lo.Must(new(big.Int).SetString("334273986260", 10)),
						Hash:      common.HexToHash("0x16a4eb2616f3e5cbdb19901fe3478870cf4d61fd76790f4ab9692bdd2e08d118"),
						Input:     hexutil.MustDecode("0x66b0dcd300000000000000000000000000000000000000000000000000000000000000200000000000000000000000000000000000000000000000000000000000019c1400000000000000000000000000000000000000000000000000000000000000c00000000000000000000000000000000000000000000000000000000000000120000000000000000000000000000000000000000000000000000000000000016000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000300000000000000000000000000000000000000000000000000000000000000003061723a2f2f4a6173644e77506e324c6f74754d314d6a71754569487245797a70655f6139656a6e43744e72334b41496f0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000010000000000000000000000000d90c58cbe787cd70b5effe94ce58185d72143fb000000000000000000000000000000000000000000000000000000000000000100000000000000000000000000000000000000000000000000000000000000200000000000000000000000000000000000000000000000000000000000000140000000000000000000000000060f5448ae8acf0bc06d040400c6a89f45b488bb000000000000000000000000000000000000000000000000000000000000004000000000000000000000000000000000000000000000000000000000000000e00000000000000000000000000000000000000000000000004563918244f4000000000000000000000000000000000000000000000000000000000000000000010000000000000000000000000d500b1d8e8ef31e21c99d1db9a6444d3adf127000000000000000000000000000000000000000000000000000000000000009c4000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000006ce9ac48be646295027fe609829248de968860030000000000000000000000000000000000000000000000000000000000000000"),
						To:        lo.ToPtr(common.HexToAddress("0xDb46d1Dc155634FbC732f92E853b10B288AD5a1d")),
						Value:     lo.Must(new(big.Int).SetString("0", 0)),
						Type:      0,
						ChainID:   lo.Must(new(big.Int).SetString("137", 0)),
					},
					Receipt: &ethereum.Receipt{
						BlockHash:         common.HexToHash("0x6014a610bead90c56500aebc46f6f18de38baf278eb7ab10bce6dc61f4e1d16d"),
						BlockNumber:       lo.Must(new(big.Int).SetString("49638714", 0)),
						ContractAddress:   nil,
						CumulativeGasUsed: 775364,
						EffectiveGasPrice: hexutil.MustDecodeBig("0x4dd4483ed4"),
						GasUsed:           319240,
						Logs: []*ethereum.Log{{
							Address: common.HexToAddress("0xDb46d1Dc155634FbC732f92E853b10B288AD5a1d"),
							Topics: []common.Hash{
								common.HexToHash("0xe18912378f90aa372fc9ab7ab5ff7e4744182bdef133ccad56d5a18864456742"),
								common.HexToHash("0x0000000000000000000000000000000000000000000000000000000000000080"),
							},
							Data:            hexutil.MustDecode("0x00000000000000000000000000000000000000000000000000000000000000a000000000000000000000000000000000000000000000000000000000000003c0000000000000000000000000000000000000000000000000000000000000042000000000000000000000000076d4ffda8c66864fa07f0a285b8e01e11b4bb7b3000000000000000000000000000000000000000000000000000000006549b4e20000000000000000000000000000000000000000000000000000000000019c1400000000000000000000000000000000000000000000000000000000000000c00000000000000000000000000000000000000000000000000000000000000120000000000000000000000000000000000000000000000000000000000000016000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000300000000000000000000000000000000000000000000000000000000000000003061723a2f2f4a6173644e77506e324c6f74754d314d6a71754569487245797a70655f6139656a6e43744e72334b41496f0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000010000000000000000000000000d90c58cbe787cd70b5effe94ce58185d72143fb000000000000000000000000000000000000000000000000000000000000000100000000000000000000000000000000000000000000000000000000000000200000000000000000000000000000000000000000000000000000000000000140000000000000000000000000060f5448ae8acf0bc06d040400c6a89f45b488bb000000000000000000000000000000000000000000000000000000000000004000000000000000000000000000000000000000000000000000000000000000e00000000000000000000000000000000000000000000000004563918244f4000000000000000000000000000000000000000000000000000000000000000000010000000000000000000000000d500b1d8e8ef31e21c99d1db9a6444d3adf127000000000000000000000000000000000000000000000000000000000000009c4000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000006ce9ac48be646295027fe609829248de9688600300000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001000000000000000000000000000000000000000000000000000000000000002000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000"),
							BlockNumber:     lo.Must(new(big.Int).SetString("49638714", 0)),
							TransactionHash: common.HexToHash("0x16a4eb2616f3e5cbdb19901fe3478870cf4d61fd76790f4ab9692bdd2e08d118"),
							Index:           14,
							Removed:         false,
						}, {
							Address: common.HexToAddress("0x0000000000000000000000000000000000001010"),
							Topics: []common.Hash{
								common.HexToHash("0x4dfe1bbbcf077ddc3e01291eea2d5c70c2b422b415d95645b9adcfd678cb1d63"),
								common.HexToHash("0x0000000000000000000000000000000000000000000000000000000000001010"),
								common.HexToHash("0x00000000000000000000000076d4ffda8c66864fa07f0a285b8e01e11b4bb7b3"),
								common.HexToHash("0x0000000000000000000000007c7379531b2aee82e4ca06d4175d13b9cbeafd49"),
							},
							Data:            hexutil.MustDecode("0x00000000000000000000000000000000000000000000000000b8404945b6085000000000000000000000000000000000000000000000005196ff6e4d8dfe377e000000000000000000000000000000000000000000027782470ecae9f301852b00000000000000000000000000000000000000000000005196472e0448482f2e00000000000000000000000000000000000000000002778247c70b3338b78d7b"),
							BlockNumber:     lo.Must(new(big.Int).SetString("49638714", 0)),
							TransactionHash: common.HexToHash("0x16a4eb2616f3e5cbdb19901fe3478870cf4d61fd76790f4ab9692bdd2e08d118"),
							Index:           15,
							Removed:         false,
						}},
						Status:           1,
						TransactionHash:  common.HexToHash("0x16a4eb2616f3e5cbdb19901fe3478870cf4d61fd76790f4ab9692bdd2e08d118"),
						TransactionIndex: 5,
					},
				},
				config: &config.Module{
					Network:  filter.NetworkPolygon,
					Endpoint: endpoint.MustGet(filter.NetworkPolygon),
				},
			},
			want: &schema.Feed{
				ID:      "0x16a4eb2616f3e5cbdb19901fe3478870cf4d61fd76790f4ab9692bdd2e08d118",
				Network: filter.NetworkPolygon,
				Index:   5,
				From:    "0x76D4fFdA8c66864FA07f0a285B8E01E11b4Bb7b3",
				To:      "0xDb46d1Dc155634FbC732f92E853b10B288AD5a1d",
				Type:    filter.TypeSocialPost,
				Calldata: &schema.Calldata{
					FunctionHash: "0x66b0dcd3",
				},
				Platform: lo.ToPtr(filter.PlatformLens),
				Fee: &schema.Fee{
					Amount:  lo.Must(decimal.NewFromString("106713627373642400")),
					Decimal: 18,
				},
				Actions: []*schema.Action{
					{
						Type:     filter.TypeSocialPost,
						Platform: "orb",
						From:     "0x6ce9Ac48be646295027Fe609829248DE96886003",
						To:       "0xDb46d1Dc155634FbC732f92E853b10B288AD5a1d",
						Metadata: metadata.SocialPost{
							Handle: "mstrbstrd.lens",
							Body:   "Missed my lens frens :) happy to be back.",
							Media: []metadata.Media{
								{
									MimeType: "image/jpeg",
									Address:  "ipfs://QmVKY2PnqeeRgtbzPqPuXhJokkV2TmfVeu9kk81fE93UqB",
								},
							},
							ProfileID:     "0x019c14",
							PublicationID: "0x80",
							ContentURI:    "ar://JasdNwPn2LotuM1MjquEiHrEyzpe_a9ejnCtNr3KAIo",
							Tags: []string{
								"orbpaidcollect",
							},
							Timestamp: 1699329250,
						},
					},
				},
				Status:    true,
				Timestamp: 1699329250,
			},
			wantError: require.NoError,
		},
		{
			name: "Lens V2 Comment",
			arguments: arguments{
				task: &source.Task{
					Network: filter.NetworkPolygon,
					ChainID: 137,
					Header: &ethereum.Header{
						Hash:         common.HexToHash("0x17747a2562cf919d5c2339855a4448fb5398418d82c1f4fa83530652f316d287"),
						ParentHash:   common.HexToHash("0x82e9fc3950fdcf52264d4c859ed476ea7fdfb2f43d20a21689bf8717086b2a8a"),
						UncleHash:    common.HexToHash("0x1dcc4de8dec75d7aab85b567b6ccd41ad312451b948a7413f0a142fd40d49347"),
						Coinbase:     common.HexToAddress("0x742d13F0b2A19C823bdd362b16305e4704b97A38"),
						Number:       lo.Must(new(big.Int).SetString("49644464", 0)),
						GasLimit:     30000000,
						GasUsed:      24987278,
						Timestamp:    1699341732,
						BaseFee:      lo.Must(new(big.Int).SetString("37201728399", 0)),
						Transactions: nil,
					},
					Transaction: &ethereum.Transaction{
						BlockHash: common.HexToHash("0x14b4130b4b0e5b2454c9e3b2a951c037e2d254015df7b6747dae2f73f43214bc"),
						From:      common.HexToAddress("0x479b18C5c5cd07777D97c523983779Bb6b4f8312"),
						Gas:       287782,
						GasPrice:  lo.Must(new(big.Int).SetString("78172177571", 10)),
						Hash:      common.HexToHash("0x14b4130b4b0e5b2454c9e3b2a951c037e2d254015df7b6747dae2f73f43214bc"),
						Input:     hexutil.MustDecode("0xb42df51a00000000000000000000000000000000000000000000000000000000000000c0000000000000000000000000028a158d9b47ebedeaa17b67c7444ae1c82405d0000000000000000000000000000000000000000000000000000000000000001c236127250a50961ec9ef3a2ffdeb40427d23777415d5250d348110262e1f8da0270524e8eba8c24f09c4e26726b54c48dcd01abb7eb1bf012dbf8c4ff6ff11bd000000000000000000000000000000000000000000000000000000006549e7f1000000000000000000000000000000000000000000000000000000000001ce63000000000000000000000000000000000000000000000000000000000000016000000000000000000000000000000000000000000000000000000000000073b10000000000000000000000000000000000000000000000000000000000003d8100000000000000000000000000000000000000000000000000000000000001c000000000000000000000000000000000000000000000000000000000000001e000000000000000000000000000000000000000000000000000000000000002000000000000000000000000000000000000000000000000000000000000000220000000000000000000000000000000000000000000000000000000000000024000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000260000000000000000000000000000000000000000000000000000000000000003061723a2f2f736e594b4d64315735487a70365134716b432d496e66537a4556575a447833394d5f374d755934526c643400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000"),
						To:        lo.ToPtr(common.HexToAddress("0xDb46d1Dc155634FbC732f92E853b10B288AD5a1d")),
						Value:     lo.Must(new(big.Int).SetString("0", 0)),
						Type:      0,
						ChainID:   lo.Must(new(big.Int).SetString("137", 0)),
					},
					Receipt: &ethereum.Receipt{
						BlockHash:         common.HexToHash("0x17747a2562cf919d5c2339855a4448fb5398418d82c1f4fa83530652f316d287"),
						BlockNumber:       lo.Must(new(big.Int).SetString("49644464", 0)),
						ContractAddress:   nil,
						CumulativeGasUsed: 19055331,
						EffectiveGasPrice: hexutil.MustDecodeBig("0x12336cc4a3"),
						GasUsed:           280846,
						Logs: []*ethereum.Log{{
							Address: common.HexToAddress("0xDb46d1Dc155634FbC732f92E853b10B288AD5a1d"),
							Topics: []common.Hash{
								common.HexToHash("0xc906270cebe7667882104effe64262a73c422ab9176a111e05ea837b021065fc"),
								common.HexToHash("0x000000000000000000000000028a158d9b47ebedeaa17b67c7444ae1c82405d0"),
							},
							Data:            hexutil.MustDecode("0x000000000000000000000000000000000000000000000000000000000000002c000000000000000000000000000000000000000000000000000000006549e5a4"),
							BlockNumber:     lo.Must(new(big.Int).SetString("49644464", 0)),
							TransactionHash: common.HexToHash("0x14b4130b4b0e5b2454c9e3b2a951c037e2d254015df7b6747dae2f73f43214bc"),
							Index:           375,
							Removed:         false,
						}, {
							Address: common.HexToAddress("0xDb46d1Dc155634FbC732f92E853b10B288AD5a1d"),
							Topics: []common.Hash{
								common.HexToHash("0x6730c5edd594025e9d1057522801addabbb26fe8ec0acb70a658002f75684388"),
								common.HexToHash("0x0000000000000000000000000000000000000000000000000000000000000073"),
							},
							Data:            hexutil.MustDecode("0x00000000000000000000000000000000000000000000000000000000000000c0000000000000000000000000000000000000000000000000000000000000034000000000000000000000000000000000000000000000000000000000000003600000000000000000000000000000000000000000000000000000000000000380000000000000000000000000028a158d9b47ebedeaa17b67c7444ae1c82405d0000000000000000000000000000000000000000000000000000000006549e5a4000000000000000000000000000000000000000000000000000000000001ce63000000000000000000000000000000000000000000000000000000000000016000000000000000000000000000000000000000000000000000000000000073b10000000000000000000000000000000000000000000000000000000000003d8100000000000000000000000000000000000000000000000000000000000001c000000000000000000000000000000000000000000000000000000000000001e000000000000000000000000000000000000000000000000000000000000002000000000000000000000000000000000000000000000000000000000000000220000000000000000000000000000000000000000000000000000000000000024000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000260000000000000000000000000000000000000000000000000000000000000003061723a2f2f736e594b4d64315735487a70365134716b432d496e66537a4556575a447833394d5f374d755934526c643400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000"),
							BlockNumber:     lo.Must(new(big.Int).SetString("49644464", 0)),
							TransactionHash: common.HexToHash("0x14b4130b4b0e5b2454c9e3b2a951c037e2d254015df7b6747dae2f73f43214bc"),
							Index:           376,
							Removed:         false,
						}, {
							Address: common.HexToAddress("0x0000000000000000000000000000000000001010"),
							Topics: []common.Hash{
								common.HexToHash("0x4dfe1bbbcf077ddc3e01291eea2d5c70c2b422b415d95645b9adcfd678cb1d63"),
								common.HexToHash("0x0000000000000000000000000000000000000000000000000000000000001010"),
								common.HexToHash("0x000000000000000000000000479b18c5c5cd07777d97c523983779bb6b4f8312"),
								common.HexToHash("0x000000000000000000000000742d13f0b2a19c823bdd362b16305e4704b97a38"),
							},
							Data:            hexutil.MustDecode("0x0000000000000000000000000000000000000000000000000028e0ff6ff6e3180000000000000000000000000000000000000000000000385889d4fbe1ddc470000000000000000000000000000000000000000000001a3242100e1debed10970000000000000000000000000000000000000000000000385860f3fc71e6e158000000000000000000000000000000000000000000001a324238ef1d5be3f3af"),
							BlockNumber:     lo.Must(new(big.Int).SetString("49644464", 0)),
							TransactionHash: common.HexToHash("0x14b4130b4b0e5b2454c9e3b2a951c037e2d254015df7b6747dae2f73f43214bc"),
							Index:           377,
							Removed:         false,
						}},
						Status:           1,
						TransactionHash:  common.HexToHash("0x14b4130b4b0e5b2454c9e3b2a951c037e2d254015df7b6747dae2f73f43214bc"),
						TransactionIndex: 112,
					},
				},
				config: &config.Module{
					Network:  filter.NetworkPolygon,
					Endpoint: endpoint.MustGet(filter.NetworkPolygon),
				},
			},
			want: &schema.Feed{
				ID:      "0x14b4130b4b0e5b2454c9e3b2a951c037e2d254015df7b6747dae2f73f43214bc",
				Network: filter.NetworkPolygon,
				Index:   112,
				From:    "0x479b18C5c5cd07777D97c523983779Bb6b4f8312",
				To:      "0xDb46d1Dc155634FbC732f92E853b10B288AD5a1d",
				Type:    filter.TypeSocialComment,
				Calldata: &schema.Calldata{
					FunctionHash: "0xb42df51a",
				},
				Platform: lo.ToPtr(filter.PlatformLens),
				Fee: &schema.Fee{
					Amount:  lo.Must(decimal.NewFromString("21954343382105066")),
					Decimal: 18,
				},
				Actions: []*schema.Action{
					{
						Type:     filter.TypeSocialComment,
						Platform: "Hey",
						From:     "0x028a158d9B47Ebedeaa17b67c7444ae1c82405D0",
						To:       "0x3D5e9077ef8F9C6B0e10D6c62C1A022a49675Cc3",
						Metadata: metadata.SocialPost{
							Body:          "You are not far, soon ahead...",
							Handle:        "romain_millon.lens",
							ProfileID:     "0x01ce63",
							PublicationID: "0x73",
							Media:         []metadata.Media{},
							Target: &metadata.SocialPost{
								Body: "Jessy is a queen.you want it or not. ðŸ‘¸ðŸ»ðŸŸðŸ™Š \n\nI feel Fakemous being in the top 3 key with highest price value after @lens/stani \n\nIt gives me Britney b*tch vibes ðŸ˜ðŸ˜‚ðŸŸ",
								Media: []metadata.Media{
									{
										MimeType: "image/jpeg",
										Address:  "ipfs://QmT5tE8WeLYgjCkxJwJHAdw9HtkiAGWRuUKEGKkQwtLkat",
									},
								},
								Handle:        "jessyjeanne.lens",
								ProfileID:     "0x73b1",
								PublicationID: "0x3d81",
								ContentURI:    "ar://ggN86IfdpZL15nln0Zk3kLWVVt3lnxZOL2REaRhD9Qs",
							},
							ContentURI: "ar://snYKMd1W5Hzp6Q4qkC-InfSzEVWZDx39M_7MuY4Rld4",
							Tags:       nil,
							Timestamp:  1699341732,
						},
					},
				},
				Status:    true,
				Timestamp: 1699341732,
			},
			wantError: require.NoError,
		},
		{
			name: "Lens V2 Mirror",
			arguments: arguments{
				task: &source.Task{
					Network: filter.NetworkPolygon,
					ChainID: 137,
					Header: &ethereum.Header{
						Hash:         common.HexToHash("0xae599ffb4ab9a4947c54c1f18b819f76fc58a89dd8ee4d8ba02d2193310fbded"),
						ParentHash:   common.HexToHash("0x118ecb00f4f53636f104607933be122086b2e43423370e2ee3e4548586bc70ce"),
						UncleHash:    common.HexToHash("0x1dcc4de8dec75d7aab85b567b6ccd41ad312451b948a7413f0a142fd40d49347"),
						Coinbase:     common.HexToAddress("0x7c7379531b2aEE82e4Ca06D4175D13b9CBEafd49"),
						Number:       lo.Must(new(big.Int).SetString("49685200", 0)),
						GasLimit:     30000000,
						GasUsed:      22244457,
						Timestamp:    1699428795,
						BaseFee:      lo.Must(new(big.Int).SetString("181838636433", 0)),
						Transactions: nil,
					},
					Transaction: &ethereum.Transaction{
						BlockHash: common.HexToHash("0x4b25808683a856604fd9aeafd0b492263c284c39933480a792ca78d10caeb255"),
						From:      common.HexToAddress("0xFb304896014a9B9393281B2D6dA281843015Cd14"),
						Gas:       274807,
						GasPrice:  lo.Must(new(big.Int).SetString("211838636433", 10)),
						Hash:      common.HexToHash("0x4b25808683a856604fd9aeafd0b492263c284c39933480a792ca78d10caeb255"),
						Input:     hexutil.MustDecode("0xf90604d10000000000000000000000000000000000000000000000000000000000000020000000000000000000000000000000000000000000000000000000000000e38e00000000000000000000000000000000000000000000000000000000000000e0000000000000000000000000000000000000000000000000000000000000000100000000000000000000000000000000000000000000000000000000000002a10000000000000000000000000000000000000000000000000000000000000100000000000000000000000000000000000000000000000000000000000000012000000000000000000000000000000000000000000000000000000000000001400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000"),
						To:        lo.ToPtr(common.HexToAddress("0xDb46d1Dc155634FbC732f92E853b10B288AD5a1d")),
						Value:     lo.Must(new(big.Int).SetString("0", 0)),
						Type:      2,
						ChainID:   lo.Must(new(big.Int).SetString("137", 0)),
					},
					Receipt: &ethereum.Receipt{
						BlockHash:         common.HexToHash("0xae599ffb4ab9a4947c54c1f18b819f76fc58a89dd8ee4d8ba02d2193310fbded"),
						BlockNumber:       lo.Must(new(big.Int).SetString("49685200", 0)),
						ContractAddress:   nil,
						CumulativeGasUsed: 10390781,
						EffectiveGasPrice: hexutil.MustDecodeBig("0x3152911191"),
						GasUsed:           178992,
						Logs: []*ethereum.Log{{
							Address: common.HexToAddress("0xDb46d1Dc155634FbC732f92E853b10B288AD5a1d"),
							Topics: []common.Hash{
								common.HexToHash("0x19822529a03d77bbe525763dd7064f5c182a5ede1bdd88e73a07221d3f3feb6d"),
								common.HexToHash("0x000000000000000000000000000000000000000000000000000000000000014f"),
							},
							Data:            hexutil.MustDecode("0x000000000000000000000000000000000000000000000000000000000000008000000000000000000000000000000000000000000000000000000000000001e0000000000000000000000000fb304896014a9b9393281b2d6da281843015cd1400000000000000000000000000000000000000000000000000000000654b39bb000000000000000000000000000000000000000000000000000000000000e38e00000000000000000000000000000000000000000000000000000000000000e0000000000000000000000000000000000000000000000000000000000000000100000000000000000000000000000000000000000000000000000000000002a100000000000000000000000000000000000000000000000000000000000001000000000000000000000000000000000000000000000000000000000000000120000000000000000000000000000000000000000000000000000000000000014000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000"),
							BlockNumber:     lo.Must(new(big.Int).SetString("49685200", 0)),
							TransactionHash: common.HexToHash("0x4b25808683a856604fd9aeafd0b492263c284c39933480a792ca78d10caeb255"),
							Index:           285,
							Removed:         false,
						}, {
							Address: common.HexToAddress("0x0000000000000000000000000000000000001010"),
							Topics: []common.Hash{
								common.HexToHash("0x4dfe1bbbcf077ddc3e01291eea2d5c70c2b422b415d95645b9adcfd678cb1d63"),
								common.HexToHash("0x0000000000000000000000000000000000000000000000000000000000001010"),
								common.HexToHash("0x000000000000000000000000fb304896014a9b9393281b2d6da281843015cd14"),
								common.HexToHash("0x0000000000000000000000007c7379531b2aee82e4ca06d4175d13b9cbeafd49"),
							},
							Data:            hexutil.MustDecode("0x000000000000000000000000000000000000000000000000001313c4ad5440000000000000000000000000000000000000000000000000040616e3176ada6105000000000000000000000000000000000000000000027864e88953d0ca4b2aa80000000000000000000000000000000000000000000000040603cf52bd862105000000000000000000000000000000000000000000027864e89c6795779f6aa8"),
							BlockNumber:     lo.Must(new(big.Int).SetString("49685200", 0)),
							TransactionHash: common.HexToHash("0x4b25808683a856604fd9aeafd0b492263c284c39933480a792ca78d10caeb255"),
							Index:           286,
							Removed:         false,
						}},
						Status:           1,
						TransactionHash:  common.HexToHash("0x4b25808683a856604fd9aeafd0b492263c284c39933480a792ca78d10caeb255"),
						TransactionIndex: 62,
					},
				},
				config: &config.Module{
					Network:  filter.NetworkPolygon,
					Endpoint: endpoint.MustGet(filter.NetworkPolygon),
				},
			},
			want: &schema.Feed{
				ID:      "0x4b25808683a856604fd9aeafd0b492263c284c39933480a792ca78d10caeb255",
				Network: filter.NetworkPolygon,
				Index:   62,
				From:    "0xFb304896014a9B9393281B2D6dA281843015Cd14",
				To:      "0xDb46d1Dc155634FbC732f92E853b10B288AD5a1d",
				Type:    filter.TypeSocialShare,
				Calldata: &schema.Calldata{
					FunctionHash: "0xf90604d1",
				},
				Platform: lo.ToPtr(filter.PlatformLens),
				Fee: &schema.Fee{
					Amount:  lo.Must(decimal.NewFromString("37917421212415536")),
					Decimal: 18,
				},
				Actions: []*schema.Action{
					{
						Type:     filter.TypeSocialShare,
						Platform: "Hey",
						From:     "0xFb304896014a9B9393281B2D6dA281843015Cd14",
						To:       "0xDb46d1Dc155634FbC732f92E853b10B288AD5a1d",
						Metadata: metadata.SocialPost{
							Body:          "",
							Handle:        "noracist.lens",
							ProfileID:     "0xe38e",
							PublicationID: "0x014f",
							Media:         []metadata.Media{},
							Target: &metadata.SocialPost{
								Body: "Lenny is heading to Devconnect and @lens/ethglobal Ä°stanbul ",
								Media: []metadata.Media{
									{
										MimeType: "image/jpeg",
										Address:  "ipfs://bafybeidtmeuseaczaxqpl7tvypbhfodt2arw3mgfbaa4dhld7kpejxmk4e",
									},
								},
								Handle:        "lensprotocol.lens",
								ProfileID:     "0x01",
								PublicationID: "0x02a1",
								ContentURI:    "ar://oi0Un8P77W2FmTmupTEgsT4vvwwsCeuITo0iPkc1jyg",
								Tags:          nil,
							},
							Tags:      nil,
							Timestamp: 1699428795,
						},
					},
				},
				Status:    true,
				Timestamp: 1699428795,
			},
			wantError: require.NoError,
		},
		{
			name: "Lens V2 Quote",
			arguments: arguments{
				task: &source.Task{
					Network: filter.NetworkPolygon,
					ChainID: 137,
					Header: &ethereum.Header{
						Hash:         common.HexToHash("0x05d318536856c3f8f22f0943f7bf33df4879dfbf8721dfeb9aeb7d027233fe15"),
						ParentHash:   common.HexToHash("0x0bf6796bacc1e2bb2ce01c0759f6e96b589b7b1cf3d23339396938be8dc8d20a"),
						UncleHash:    common.HexToHash("0x1dcc4de8dec75d7aab85b567b6ccd41ad312451b948a7413f0a142fd40d49347"),
						Coinbase:     common.HexToAddress("0xa8B52F02108AA5F4B675bDcC973760022D7C6020"),
						Number:       lo.Must(new(big.Int).SetString("49686107", 0)),
						GasLimit:     30000000,
						GasUsed:      9175520,
						Timestamp:    1699430727,
						BaseFee:      lo.Must(new(big.Int).SetString("196237283362", 0)),
						Transactions: nil,
					},
					Transaction: &ethereum.Transaction{
						BlockHash: common.HexToHash("0x793769b3e6145e4c62939bd74e1dcb9c01ff231d13fe3295c7732ccad0e6f844"),
						From:      common.HexToAddress("0x900caB7bB11Ae04B943496FD6Ae686Fb15f4d98E"),
						Gas:       287309,
						GasPrice:  lo.Must(new(big.Int).SetString("249638139890", 10)),
						Hash:      common.HexToHash("0x793769b3e6145e4c62939bd74e1dcb9c01ff231d13fe3295c7732ccad0e6f844"),
						Input:     hexutil.MustDecode("0x65f29f2700000000000000000000000000000000000000000000000000000000000000c0000000000000000000000000da65156390a551e1651d62df698d330c819387ff000000000000000000000000000000000000000000000000000000000000001c2a3e4842c41b3956d2c3a690a1e21bf2c6a7e40a576d3c2c62bcf22304c716572b493e14f5d245739257b5c4ff448993abdf6720c7bdbb4e042f9a2040ccd97c00000000000000000000000000000000000000000000000000000000654b439500000000000000000000000000000000000000000000000000000000000121f900000000000000000000000000000000000000000000000000000000000001600000000000000000000000000000000000000000000000000000000000012166000000000000000000000000000000000000000000000000000000000000003600000000000000000000000000000000000000000000000000000000000001c000000000000000000000000000000000000000000000000000000000000001e000000000000000000000000000000000000000000000000000000000000002000000000000000000000000000000000000000000000000000000000000000220000000000000000000000000000000000000000000000000000000000000024000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000260000000000000000000000000000000000000000000000000000000000000003061723a2f2f334d7767424b38374b79596844706f4e6a6e535059655977394676796b644c396b7745305664567345663000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000"),
						To:        lo.ToPtr(common.HexToAddress("0xDb46d1Dc155634FbC732f92E853b10B288AD5a1d")),
						Value:     lo.Must(new(big.Int).SetString("0", 0)),
						Type:      0,
						ChainID:   lo.Must(new(big.Int).SetString("137", 0)),
					},
					Receipt: &ethereum.Receipt{
						BlockHash:         common.HexToHash("0x05d318536856c3f8f22f0943f7bf33df4879dfbf8721dfeb9aeb7d027233fe15"),
						BlockNumber:       lo.Must(new(big.Int).SetString("49686107", 0)),
						ContractAddress:   nil,
						CumulativeGasUsed: 3455008,
						EffectiveGasPrice: hexutil.MustDecodeBig("0x3a1f97b7f2"),
						GasUsed:           280379,
						Logs: []*ethereum.Log{{
							Address: common.HexToAddress("0xDb46d1Dc155634FbC732f92E853b10B288AD5a1d"),
							Topics: []common.Hash{
								common.HexToHash("0xc906270cebe7667882104effe64262a73c422ab9176a111e05ea837b021065fc"),
								common.HexToHash("0x000000000000000000000000da65156390a551e1651d62df698d330c819387ff"),
							},
							Data:            hexutil.MustDecode("0x000000000000000000000000000000000000000000000000000000000000001000000000000000000000000000000000000000000000000000000000654b4147"),
							BlockNumber:     lo.Must(new(big.Int).SetString("49686107", 0)),
							TransactionHash: common.HexToHash("0x793769b3e6145e4c62939bd74e1dcb9c01ff231d13fe3295c7732ccad0e6f844"),
							Index:           70,
							Removed:         false,
						}, {
							Address: common.HexToAddress("0xDb46d1Dc155634FbC732f92E853b10B288AD5a1d"),
							Topics: []common.Hash{
								common.HexToHash("0x90991d5410a24294cd806880f6e27b11ebe48fbb0cea07cdd566a073bc6ff71d"),
								common.HexToHash("0x0000000000000000000000000000000000000000000000000000000000000029"),
							},
							Data:            hexutil.MustDecode("0x00000000000000000000000000000000000000000000000000000000000000c0000000000000000000000000000000000000000000000000000000000000034000000000000000000000000000000000000000000000000000000000000003600000000000000000000000000000000000000000000000000000000000000380000000000000000000000000da65156390a551e1651d62df698d330c819387ff00000000000000000000000000000000000000000000000000000000654b414700000000000000000000000000000000000000000000000000000000000121f900000000000000000000000000000000000000000000000000000000000001600000000000000000000000000000000000000000000000000000000000012166000000000000000000000000000000000000000000000000000000000000003600000000000000000000000000000000000000000000000000000000000001c000000000000000000000000000000000000000000000000000000000000001e000000000000000000000000000000000000000000000000000000000000002000000000000000000000000000000000000000000000000000000000000000220000000000000000000000000000000000000000000000000000000000000024000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000260000000000000000000000000000000000000000000000000000000000000003061723a2f2f334d7767424b38374b79596844706f4e6a6e535059655977394676796b644c396b7745305664567345663000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000"),
							BlockNumber:     lo.Must(new(big.Int).SetString("49686107", 0)),
							TransactionHash: common.HexToHash("0x793769b3e6145e4c62939bd74e1dcb9c01ff231d13fe3295c7732ccad0e6f844"),
							Index:           71,
							Removed:         false,
						}, {
							Address: common.HexToAddress("0x0000000000000000000000000000000000001010"),
							Topics: []common.Hash{
								common.HexToHash("0x4dfe1bbbcf077ddc3e01291eea2d5c70c2b422b415d95645b9adcfd678cb1d63"),
								common.HexToHash("0x0000000000000000000000000000000000000000000000000000000000001010"),
								common.HexToHash("0x000000000000000000000000900cab7bb11ae04b943496fd6ae686fb15f4d98e"),
								common.HexToHash("0x000000000000000000000000a8b52f02108aa5f4b675bdcc973760022d7c6020"),
							},
							Data:            hexutil.MustDecode("0x00000000000000000000000000000000000000000000000000353163dd729cf00000000000000000000000000000000000000000000000487f261614c857ee910000000000000000000000000000000000000000000000c2e77f76b1ccd4a94a0000000000000000000000000000000000000000000000487ef0e4b0eae551a10000000000000000000000000000000000000000000000c2e7b4a815aa47463a"),
							BlockNumber:     lo.Must(new(big.Int).SetString("49686107", 0)),
							TransactionHash: common.HexToHash("0x793769b3e6145e4c62939bd74e1dcb9c01ff231d13fe3295c7732ccad0e6f844"),
							Index:           72,
							Removed:         false,
						}},
						Status:           1,
						TransactionHash:  common.HexToHash("0x793769b3e6145e4c62939bd74e1dcb9c01ff231d13fe3295c7732ccad0e6f844"),
						TransactionIndex: 19,
					},
				},
				config: &config.Module{
					Network:  filter.NetworkPolygon,
					Endpoint: endpoint.MustGet(filter.NetworkPolygon),
				},
			},
			want: &schema.Feed{
				ID:      "0x793769b3e6145e4c62939bd74e1dcb9c01ff231d13fe3295c7732ccad0e6f844",
				Network: filter.NetworkPolygon,
				Index:   19,
				From:    "0x900caB7bB11Ae04B943496FD6Ae686Fb15f4d98E",
				To:      "0xDb46d1Dc155634FbC732f92E853b10B288AD5a1d",
				Type:    filter.TypeSocialShare,
				Calldata: &schema.Calldata{
					FunctionHash: "0x65f29f27",
				},
				Platform: lo.ToPtr(filter.PlatformLens),
				Fee: &schema.Fee{
					Amount:  lo.Must(decimal.NewFromString("69993292024218310")),
					Decimal: 18,
				},
				Actions: []*schema.Action{
					{
						Type:     filter.TypeSocialShare,
						Platform: "Hey",
						From:     "0xDA65156390A551e1651d62Df698d330C819387Ff",
						To:       "0xDb46d1Dc155634FbC732f92E853b10B288AD5a1d",
						Metadata: metadata.SocialPost{
							Body:          "just web wallet is it",
							Handle:        "fcukfcukfcuk.lens",
							ProfileID:     "0x0121f9",
							PublicationID: "0x29",
							Media:         []metadata.Media{},
							ContentURI:    "ar://3MwgBK87KyYhDpoNjnSPYeYw9FvykdL9kwE0VdVsEf0",
							Target: &metadata.SocialPost{
								Body:          "all eyes are on Binance",
								Handle:        "y00tt.lens",
								ProfileID:     "0x012166",
								PublicationID: "0x36",
								ContentURI:    "ar://aBHmayNUTOAv_Qb6i-kFh0FlEDtNnHzZ4vPLjLVKHdE",
								Tags:          nil,
								Media:         []metadata.Media{},
							},
							Tags:      nil,
							Timestamp: 1699430727,
						},
					},
				},
				Status:    true,
				Timestamp: 1699430727,
			},
			wantError: require.NoError,
		},
		{
			name: "Lens Collect V2 Mint",
			arguments: arguments{
				task: &source.Task{
					Network: filter.NetworkPolygon,
					ChainID: 137,
					Header: &ethereum.Header{
						Hash:         common.HexToHash("0x0e065247c7eaebae9cfce4917d3b179ffe048bff89caebdc2e554ba01c768a36"),
						ParentHash:   common.HexToHash("0xd3031c7d3ed15bde838491def747eeb9d9904ded5b191f699651eb1f4415ed4f"),
						UncleHash:    common.HexToHash("0x1dcc4de8dec75d7aab85b567b6ccd41ad312451b948a7413f0a142fd40d49347"),
						Coinbase:     common.HexToAddress("0x1EFEcb61A2f80Aa34d3b9218B564a64D05946290"),
						Number:       lo.Must(new(big.Int).SetString("44943344", 0)),
						GasLimit:     29563532,
						GasUsed:      12991919,
						Timestamp:    1689064466,
						BaseFee:      lo.Must(new(big.Int).SetString("75659596838", 0)),
						Transactions: nil,
					},
					Transaction: &ethereum.Transaction{
						BlockHash: common.HexToHash("0x1e7041f4401381ca8b091dd0e77fd2a4bf762f5be077c531140f965e26696faf"),
						From:      common.HexToAddress("0x765F899Cc972768cd0440e7aaB112C26afbEE7cA"),
						Gas:       1500000,
						GasPrice:  lo.Must(new(big.Int).SetString("334273986260", 10)),
						Hash:      common.HexToHash("0x1e7041f4401381ca8b091dd0e77fd2a4bf762f5be077c531140f965e26696faf"),
						Input:     hexutil.MustDecode("0xa4d3f52e000000000000000000000000000000000000000000000000000000000000002000000000000000000000000000000000000000000000000000000000000000010000000000000000000000000000000000000000000000000000000000000020000000000000000000000000a5423481cdaf678ef24fddb9bf4584f9d0e120720000000000000000000000000000000000000000000000000000000000015f3400000000000000000000000000000000000000000000000000000000000000800000000000000000000000000000000000000000000000000000000000000d840000000000000000000000000000000000000000000000000000000000000000"),
						To:        lo.ToPtr(common.HexToAddress("0xDD3f6C22eCc68007cc9f76dA18984995DA4b7B82")),
						Value:     lo.Must(new(big.Int).SetString("0", 0)),
						Type:      0,
						ChainID:   lo.Must(new(big.Int).SetString("137", 0)),
					},
					Receipt: &ethereum.Receipt{
						BlockHash:         common.HexToHash("0x0e065247c7eaebae9cfce4917d3b179ffe048bff89caebdc2e554ba01c768a36"),
						BlockNumber:       lo.Must(new(big.Int).SetString("44943344", 0)),
						ContractAddress:   nil,
						CumulativeGasUsed: 480606,
						EffectiveGasPrice: hexutil.MustDecodeBig("0x4dd4483ed4"),
						GasUsed:           234894,
						Logs: []*ethereum.Log{{
							Address: common.HexToAddress("0xDb46d1Dc155634FbC732f92E853b10B288AD5a1d"),
							Topics: []common.Hash{
								common.HexToHash("0x68edb7ec2c37d21b3b72233960b487f2966f4ac82b7430d39f24d1f8d6f99106"),
								common.HexToHash("0x0000000000000000000000000000000000000000000000000000000000015f34"),
								common.HexToHash("0x0000000000000000000000000000000000000000000000000000000000000d84"),
								common.HexToHash("0x0000000000000000000000000000000000000000000000000000000000000017"),
							},
							Data:            hexutil.MustDecode("0x0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000dd3f6c22ecc68007cc9f76da18984995da4b7b820000000000000000000000000000000000000000000000000000000064ad1412"),
							BlockNumber:     lo.Must(new(big.Int).SetString("44943344", 0)),
							TransactionHash: common.HexToHash("0x1e7041f4401381ca8b091dd0e77fd2a4bf762f5be077c531140f965e26696faf"),
							Index:           3,
							Removed:         false,
						}, {
							Address: common.HexToAddress("0x92F3621711B60753706d8D7de235569Cf34384a9"),
							Topics: []common.Hash{
								common.HexToHash("0xddf252ad1be2c89b69c2b068fc378daa952ba7f163c4a11628f55a4df523b3ef"),
								common.HexToHash("0x0000000000000000000000000000000000000000000000000000000000000000"),
								common.HexToHash("0x000000000000000000000000dd3f6c22ecc68007cc9f76da18984995da4b7b82"),
								common.HexToHash("0x0000000000000000000000000000000000000000000000000000000000000017"),
							},
							Data:            nil,
							BlockNumber:     lo.Must(new(big.Int).SetString("44943344", 0)),
							TransactionHash: common.HexToHash("0x1e7041f4401381ca8b091dd0e77fd2a4bf762f5be077c531140f965e26696faf"),
							Index:           4,
							Removed:         false,
						}, {
							Address: common.HexToAddress("0xDb46d1Dc155634FbC732f92E853b10B288AD5a1d"),
							Topics: []common.Hash{
								common.HexToHash("0xed39bf0d9afa849610b901c9d7f4d00751ba20de2db023428065bec153833218"),
								common.HexToHash("0x000000000000000000000000dd3f6c22ecc68007cc9f76da18984995da4b7b82"),
								common.HexToHash("0x0000000000000000000000000000000000000000000000000000000000015f34"),
								common.HexToHash("0x0000000000000000000000000000000000000000000000000000000000000d84"),
							},
							Data:            hexutil.MustDecode("0x0000000000000000000000000000000000000000000000000000000000015f340000000000000000000000000000000000000000000000000000000000000d8400000000000000000000000000000000000000000000000000000000000000800000000000000000000000000000000000000000000000000000000064ad14120000000000000000000000000000000000000000000000000000000000000000"),
							BlockNumber:     lo.Must(new(big.Int).SetString("44943344", 0)),
							TransactionHash: common.HexToHash("0x1e7041f4401381ca8b091dd0e77fd2a4bf762f5be077c531140f965e26696faf"),
							Index:           5,
							Removed:         false,
						}, {
							Address: common.HexToAddress("0xDb46d1Dc155634FbC732f92E853b10B288AD5a1d"),
							Topics: []common.Hash{
								common.HexToHash("0x68edb7ec2c37d21b3b72233960b487f2966f4ac82b7430d39f24d1f8d6f99106"),
								common.HexToHash("0x0000000000000000000000000000000000000000000000000000000000015f34"),
								common.HexToHash("0x0000000000000000000000000000000000000000000000000000000000000d84"),
								common.HexToHash("0x0000000000000000000000000000000000000000000000000000000000000017"),
							},
							Data:            hexutil.MustDecode("0x000000000000000000000000dd3f6c22ecc68007cc9f76da18984995da4b7b82000000000000000000000000a5423481cdaf678ef24fddb9bf4584f9d0e120720000000000000000000000000000000000000000000000000000000064ad1412"),
							BlockNumber:     lo.Must(new(big.Int).SetString("44943344", 0)),
							TransactionHash: common.HexToHash("0x1e7041f4401381ca8b091dd0e77fd2a4bf762f5be077c531140f965e26696faf"),
							Index:           6,
							Removed:         false,
						}, {
							Address: common.HexToAddress("0x92F3621711B60753706d8D7de235569Cf34384a9"),
							Topics: []common.Hash{
								common.HexToHash("0x8c5be1e5ebec7d5bd14f71427d1e84f3dd0314c0f7b2291e5b200ac8c7c3b925"),
								common.HexToHash("0x000000000000000000000000dd3f6c22ecc68007cc9f76da18984995da4b7b82"),
								common.HexToHash("0x0000000000000000000000000000000000000000000000000000000000000000"),
								common.HexToHash("0x0000000000000000000000000000000000000000000000000000000000000017"),
							},
							Data:            nil,
							BlockNumber:     lo.Must(new(big.Int).SetString("44943344", 0)),
							TransactionHash: common.HexToHash("0x1e7041f4401381ca8b091dd0e77fd2a4bf762f5be077c531140f965e26696faf"),
							Index:           7,
							Removed:         false,
						}, {
							Address: common.HexToAddress("0x92F3621711B60753706d8D7de235569Cf34384a9"),
							Topics: []common.Hash{
								common.HexToHash("0xddf252ad1be2c89b69c2b068fc378daa952ba7f163c4a11628f55a4df523b3ef"),
								common.HexToHash("0x000000000000000000000000dd3f6c22ecc68007cc9f76da18984995da4b7b82"),
								common.HexToHash("0x000000000000000000000000a5423481cdaf678ef24fddb9bf4584f9d0e12072"),
								common.HexToHash("0x0000000000000000000000000000000000000000000000000000000000000017"),
							},
							Data:            nil,
							BlockNumber:     lo.Must(new(big.Int).SetString("44943344", 0)),
							TransactionHash: common.HexToHash("0x1e7041f4401381ca8b091dd0e77fd2a4bf762f5be077c531140f965e26696faf"),
							Index:           8,
							Removed:         false,
						}, {
							Address: common.HexToAddress("0x0000000000000000000000000000000000001010"),
							Topics: []common.Hash{
								common.HexToHash("0x4dfe1bbbcf077ddc3e01291eea2d5c70c2b422b415d95645b9adcfd678cb1d63"),
								common.HexToHash("0x0000000000000000000000000000000000000000000000000000000000001010"),
								common.HexToHash("0x000000000000000000000000765f899cc972768cd0440e7aab112c26afbee7ca"),
								common.HexToHash("0x0000000000000000000000001efecb61a2f80aa34d3b9218b564a64d05946290"),
							},
							Data:            hexutil.MustDecode("0x00000000000000000000000000000000000000000000000000d7d10bc000728400000000000000000000000000000000000000000000004036d2db162ca82f75000000000000000000000000000000000000000000003e74739637b34254943300000000000000000000000000000000000000000000004035fb0a0a6ca7bcf1000000000000000000000000000000000000000000003e74746e08bf025506b7"),
							BlockNumber:     lo.Must(new(big.Int).SetString("44943344", 0)),
							TransactionHash: common.HexToHash("0x1e7041f4401381ca8b091dd0e77fd2a4bf762f5be077c531140f965e26696faf"),
							Index:           9,
							Removed:         false,
						}},
						Status:           1,
						TransactionHash:  common.HexToHash("0x1e7041f4401381ca8b091dd0e77fd2a4bf762f5be077c531140f965e26696faf"),
						TransactionIndex: 2,
					},
				},
				config: &config.Module{
					Network:  filter.NetworkPolygon,
					Endpoint: endpoint.MustGet(filter.NetworkPolygon),
				},
			},
			want: &schema.Feed{
				ID:      "0x1e7041f4401381ca8b091dd0e77fd2a4bf762f5be077c531140f965e26696faf",
				Network: filter.NetworkPolygon,
				Index:   2,
				From:    "0x765F899Cc972768cd0440e7aaB112C26afbEE7cA",
				To:      "0xDD3f6C22eCc68007cc9f76dA18984995DA4b7B82",
				Type:    filter.TypeSocialMint,
				Calldata: &schema.Calldata{
					FunctionHash: "0xa4d3f52e",
				},
				Platform: lo.ToPtr(filter.PlatformLens),
				Fee: &schema.Fee{
					Amount:  lo.Must(decimal.NewFromString("78518953728556440")),
					Decimal: 18,
				},
				Actions: []*schema.Action{
					{
						Type:     filter.TypeSocialMint,
						Platform: "wav3s",
						From:     "0xa5423481cdaf678eF24FDDb9bf4584f9D0E12072",
						To:       "0xDD3f6C22eCc68007cc9f76dA18984995DA4b7B82",
						Metadata: metadata.SocialPost{
							Body:          "â €                â €â£€â£¤â£´â£¶â£¾â£¿â£¿â£¿â£¿â£·â£¶â£¦â£¤â£€â €â €â €â €â €â €â €â €\nâ €â €â €â €â €â£ â£´â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¦â£„â €â €â €â €â €\nâ €â €â €â£ â£¾â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â¡¿â ¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£·â£„â €â €â €\nâ €â €â£´â£¿â£¿â£¿â£¿â£¿â£¿â£¿â Ÿâ ¿â ¿â¡¿â €â¢°â£¿â â¢ˆâ£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¦â €â €\nâ €â£¼â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¤â£„â €â €â €â ˆâ ‰â €â ¸â ¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£§â €\nâ¢°â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â¡â €â €â¢ â£¶â£¶â£¤â¡€â €â ˆâ¢»â£¿â£¿â£¿â£¿â£¿â£¿â£¿â¡†\nâ£¾â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â ƒâ €â €â ¼â£¿â£¿â¡¿â ƒâ €â €â¢¸â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£·\nâ£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â¡Ÿâ €â € â¢€â£€â£€â €â €â €â €â¢´â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿\nâ¢¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â¢¿â£¿â â €â €â£¼â£¿â£¿â£¿â£¦â €â €â ˆâ¢»â£¿â£¿â£¿â£¿â£¿â£¿â£¿â¡¿\nâ ¸â£¿â£¿â£¿â£¿â£¿â£¿â£â €â €â €â €â €â ›â ›â ¿â Ÿâ ‹â €â €â €â£¾â£¿â£¿â£¿â£¿â£¿â£¿â£¿â ‡\nâ €â¢»â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â ‡â €â£¤â¡„â €â£€â£€â£€â£€â£ â£¾â£¿â£¿â£¿â£¿â£¿â£¿â£¿â¡Ÿâ €\nâ €â €â »â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£„â£°â£¿â â¢€â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â Ÿâ €â €\nâ €â €â €â ™â¢¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â¡¿â ‹â €â €â €\nâ €â €â €â €â €â ™â »â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â Ÿâ ‹â €â €â €â €â €\nâ €â €â €â €â €â €â €â €â ‰â ›â »â ¿â¢¿â£¿â£¿â£¿â£¿â¡¿â ¿â Ÿâ ›â ‰â €â €\n\n              #art #lensprotocol #lensart",
							Media:         []metadata.Media{},
							Handle:        "datartist.lens",
							ProfileID:     "0x015f34",
							PublicationID: "0x0d84",
							ContentURI:    "https://arweave.net/AO8swi1_jg5uaBZS6MRyQRqeZ-lusvOF8dVDukksruk",
							Tags: []string{
								"art",
								"lensprotocol",
								"lensart",
							},
							Timestamp: 1689064466,
						},
					},
				},
				Status:    true,
				Timestamp: 1689064466,
			},
			wantError: require.NoError,
		},
		{
			name: "Lens V2 Create Profile",
			arguments: arguments{
				task: &source.Task{
					Network: filter.NetworkPolygon,
					ChainID: 137,
					Header: &ethereum.Header{
						Hash:         common.HexToHash("0x4fe2f445f4b0fa34818092965e495965d0ddb1abadc11c34522e06a580173e4b"),
						ParentHash:   common.HexToHash("0xd1134be25d4e6897b7fa7ba268c4949b4c5190a95304b073f6cc2e195eda4437"),
						UncleHash:    common.HexToHash("0x1dcc4de8dec75d7aab85b567b6ccd41ad312451b948a7413f0a142fd40d49347"),
						Coinbase:     common.HexToAddress("0x9eaD03F7136Fc6b4bDb0780B00a1c14aE5A8B6d0"),
						Number:       lo.Must(new(big.Int).SetString("49688455", 0)),
						GasLimit:     30000000,
						GasUsed:      17225637,
						Timestamp:    1699435732,
						BaseFee:      lo.Must(new(big.Int).SetString("173656948442", 0)),
						Transactions: nil,
					},
					Transaction: &ethereum.Transaction{
						BlockHash: common.HexToHash("0xf8929e7ceaf2168c715ba40f1a75158944edcb9a3076fab1fb9daee4cab5552a"),
						From:      common.HexToAddress("0xe7Af8325aA443F7678B651d4f0De23663E818691"),
						Gas:       413116,
						GasPrice:  lo.Must(new(big.Int).SetString("250133878654", 10)),
						Hash:      common.HexToHash("0xf8929e7ceaf2168c715ba40f1a75158944edcb9a3076fab1fb9daee4cab5552a"),
						Input:     hexutil.MustDecode("0x50d425f9000000000000000000000000000000000000000000000000000000000000004000000000000000000000000000000000000000000000000000000000000000c000000000000000000000000073abd408811f4daf25d7ae6bca42cd71b07d011600000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000060000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000067839393030780000000000000000000000000000000000000000000000000000"),
						To:        lo.ToPtr(common.HexToAddress("0xdCB72aaB62d52aBC2E6be99BEEe535C2D1361fc0")),
						Value:     lo.Must(new(big.Int).SetString("0", 0)),
						Type:      0,
						ChainID:   lo.Must(new(big.Int).SetString("137", 0)),
					},
					Receipt: &ethereum.Receipt{
						BlockHash:         common.HexToHash("0x4fe2f445f4b0fa34818092965e495965d0ddb1abadc11c34522e06a580173e4b"),
						BlockNumber:       lo.Must(new(big.Int).SetString("49688455", 0)),
						ContractAddress:   nil,
						CumulativeGasUsed: 2535243,
						EffectiveGasPrice: hexutil.MustDecodeBig("0x3a3d24177e"),
						GasUsed:           371291,
						Logs: []*ethereum.Log{{
							Address: common.HexToAddress("0xDb46d1Dc155634FbC732f92E853b10B288AD5a1d"),
							Topics: []common.Hash{
								common.HexToHash("0xddf252ad1be2c89b69c2b068fc378daa952ba7f163c4a11628f55a4df523b3ef"),
								common.HexToHash("0x0000000000000000000000000000000000000000000000000000000000000000"),
								common.HexToHash("0x000000000000000000000000dcb72aab62d52abc2e6be99beee535c2d1361fc0"),
								common.HexToHash("0x000000000000000000000000000000000000000000000000000000000001ec68"),
							},
							Data:            nil,
							BlockNumber:     lo.Must(new(big.Int).SetString("49688455", 0)),
							TransactionHash: common.HexToHash("0xf8929e7ceaf2168c715ba40f1a75158944edcb9a3076fab1fb9daee4cab5552a"),
							Index:           67,
							Removed:         false,
						}, {
							Address: common.HexToAddress("0xDb46d1Dc155634FbC732f92E853b10B288AD5a1d"),
							Topics: []common.Hash{
								common.HexToHash("0xf642d82f9bf073e3403d88853e8ee1a91d4fff05e11bcdf593f09ce442c6b247"),
								common.HexToHash("0x000000000000000000000000000000000000000000000000000000000001ec68"),
								common.HexToHash("0x000000000000000000000000dcb72aab62d52abc2e6be99beee535c2d1361fc0"),
								common.HexToHash("0x000000000000000000000000dcb72aab62d52abc2e6be99beee535c2d1361fc0"),
							},
							Data:            hexutil.MustDecode("0x00000000000000000000000000000000000000000000000000000000654b54d4"),
							BlockNumber:     lo.Must(new(big.Int).SetString("49688455", 0)),
							TransactionHash: common.HexToHash("0xf8929e7ceaf2168c715ba40f1a75158944edcb9a3076fab1fb9daee4cab5552a"),
							Index:           68,
							Removed:         false,
						}, {
							Address: common.HexToAddress("0xDb46d1Dc155634FbC732f92E853b10B288AD5a1d"),
							Topics: []common.Hash{
								common.HexToHash("0x47f050f9e2779af58ee28eb99af69c3168632fbf7a45f97317137e2098e538f3"),
								common.HexToHash("0x000000000000000000000000000000000000000000000000000000000001ec68"),
								common.HexToHash("0x0000000000000000000000000000000000000000000000000000000000000000"),
							},
							Data:            hexutil.MustDecode("0x00000000000000000000000000000000000000000000000000000000654b54d4"),
							BlockNumber:     lo.Must(new(big.Int).SetString("49688455", 0)),
							TransactionHash: common.HexToHash("0xf8929e7ceaf2168c715ba40f1a75158944edcb9a3076fab1fb9daee4cab5552a"),
							Index:           69,
							Removed:         false,
						}, {
							Address: common.HexToAddress("0xDb46d1Dc155634FbC732f92E853b10B288AD5a1d"),
							Topics: []common.Hash{
								common.HexToHash("0x160458ccae41f9f8e4bc14a37e1fc3d900f768c5c12991c5140490aae8292600"),
								common.HexToHash("0x000000000000000000000000000000000000000000000000000000000001ec68"),
							},
							Data:            hexutil.MustDecode("0x000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000a000000000000000000000000000000000000000000000000000000000000000c0000000000000000000000000dcb72aab62d52abc2e6be99beee535c2d1361fc000000000000000000000000000000000000000000000000000000000654b54d400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000"),
							BlockNumber:     lo.Must(new(big.Int).SetString("49688455", 0)),
							TransactionHash: common.HexToHash("0xf8929e7ceaf2168c715ba40f1a75158944edcb9a3076fab1fb9daee4cab5552a"),
							Index:           70,
							Removed:         false,
						}, {
							Address: common.HexToAddress("0xe7E7EaD361f3AaCD73A61A9bD6C10cA17F38E945"),
							Topics: []common.Hash{
								common.HexToHash("0xddf252ad1be2c89b69c2b068fc378daa952ba7f163c4a11628f55a4df523b3ef"),
								common.HexToHash("0x0000000000000000000000000000000000000000000000000000000000000000"),
								common.HexToHash("0x000000000000000000000000dcb72aab62d52abc2e6be99beee535c2d1361fc0"),
								common.HexToHash("0x20e83f45677f1cea1a1df33f467ef4adb5d270fedf7455d136127404e4841812"),
							},
							Data:            nil,
							BlockNumber:     lo.Must(new(big.Int).SetString("49688455", 0)),
							TransactionHash: common.HexToHash("0xf8929e7ceaf2168c715ba40f1a75158944edcb9a3076fab1fb9daee4cab5552a"),
							Index:           71,
							Removed:         false,
						}, {
							Address: common.HexToAddress("0xe7E7EaD361f3AaCD73A61A9bD6C10cA17F38E945"),
							Topics: []common.Hash{
								common.HexToHash("0x30a132e912787e50de6193fe56a96ea6188c0bbf676679d630a25d3293c3e19a"),
							},
							Data:            hexutil.MustDecode("0x00000000000000000000000000000000000000000000000000000000000000a000000000000000000000000000000000000000000000000000000000000000e020e83f45677f1cea1a1df33f467ef4adb5d270fedf7455d136127404e4841812000000000000000000000000dcb72aab62d52abc2e6be99beee535c2d1361fc000000000000000000000000000000000000000000000000000000000654b54d40000000000000000000000000000000000000000000000000000000000000006783939303078000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000046c656e7300000000000000000000000000000000000000000000000000000000"),
							BlockNumber:     lo.Must(new(big.Int).SetString("49688455", 0)),
							TransactionHash: common.HexToHash("0xf8929e7ceaf2168c715ba40f1a75158944edcb9a3076fab1fb9daee4cab5552a"),
							Index:           72,
							Removed:         false,
						}, {
							Address: common.HexToAddress("0xD4F2F33680FCCb36748FA9831851643781608844"),
							Topics: []common.Hash{
								common.HexToHash("0xc33717b10968a153b6fa59edb9356cc86846bd3be6f416f4410338e25bb28d3c"),
							},
							Data:            hexutil.MustDecode("0x20e83f45677f1cea1a1df33f467ef4adb5d270fedf7455d136127404e4841812000000000000000000000000e7e7ead361f3aacd73a61a9bd6c10ca17f38e945000000000000000000000000000000000000000000000000000000000001ec68000000000000000000000000db46d1dc155634fbc732f92e853b10b288ad5a1d000000000000000000000000dcb72aab62d52abc2e6be99beee535c2d1361fc000000000000000000000000000000000000000000000000000000000654b54d4"),
							BlockNumber:     lo.Must(new(big.Int).SetString("49688455", 0)),
							TransactionHash: common.HexToHash("0xf8929e7ceaf2168c715ba40f1a75158944edcb9a3076fab1fb9daee4cab5552a"),
							Index:           73,
							Removed:         false,
						}, {
							Address: common.HexToAddress("0xe7E7EaD361f3AaCD73A61A9bD6C10cA17F38E945"),
							Topics: []common.Hash{
								common.HexToHash("0xddf252ad1be2c89b69c2b068fc378daa952ba7f163c4a11628f55a4df523b3ef"),
								common.HexToHash("0x000000000000000000000000dcb72aab62d52abc2e6be99beee535c2d1361fc0"),
								common.HexToHash("0x00000000000000000000000073abd408811f4daf25d7ae6bca42cd71b07d0116"),
								common.HexToHash("0x20e83f45677f1cea1a1df33f467ef4adb5d270fedf7455d136127404e4841812"),
							},
							Data:            nil,
							BlockNumber:     lo.Must(new(big.Int).SetString("49688455", 0)),
							TransactionHash: common.HexToHash("0xf8929e7ceaf2168c715ba40f1a75158944edcb9a3076fab1fb9daee4cab5552a"),
							Index:           74,
							Removed:         false,
						}, {
							Address: common.HexToAddress("0xDb46d1Dc155634FbC732f92E853b10B288AD5a1d"),
							Topics: []common.Hash{
								common.HexToHash("0xfd73bf07ef75af85f5dec85a987a10fc4a54c330dd4d13ae0f619cf59d96e506"),
								common.HexToHash("0x000000000000000000000000000000000000000000000000000000000001ec68"),
								common.HexToHash("0x0000000000000000000000000000000000000000000000000000000000000001"),
							},
							Data:            hexutil.MustDecode("0x0000000000000000000000000000000000000000000000000000000000000060000000000000000000000000000000000000000000000000000000000000008000000000000000000000000000000000000000000000000000000000654b54d400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000"),
							BlockNumber:     lo.Must(new(big.Int).SetString("49688455", 0)),
							TransactionHash: common.HexToHash("0xf8929e7ceaf2168c715ba40f1a75158944edcb9a3076fab1fb9daee4cab5552a"),
							Index:           75,
							Removed:         false,
						}, {
							Address: common.HexToAddress("0xDb46d1Dc155634FbC732f92E853b10B288AD5a1d"),
							Topics: []common.Hash{
								common.HexToHash("0x47f050f9e2779af58ee28eb99af69c3168632fbf7a45f97317137e2098e538f3"),
								common.HexToHash("0x000000000000000000000000000000000000000000000000000000000001ec68"),
								common.HexToHash("0x0000000000000000000000000000000000000000000000000000000000000001"),
							},
							Data:            hexutil.MustDecode("0x00000000000000000000000000000000000000000000000000000000654b54d4"),
							BlockNumber:     lo.Must(new(big.Int).SetString("49688455", 0)),
							TransactionHash: common.HexToHash("0xf8929e7ceaf2168c715ba40f1a75158944edcb9a3076fab1fb9daee4cab5552a"),
							Index:           76,
							Removed:         false,
						}, {
							Address: common.HexToAddress("0xDb46d1Dc155634FbC732f92E853b10B288AD5a1d"),
							Topics: []common.Hash{
								common.HexToHash("0x8c5be1e5ebec7d5bd14f71427d1e84f3dd0314c0f7b2291e5b200ac8c7c3b925"),
								common.HexToHash("0x000000000000000000000000dcb72aab62d52abc2e6be99beee535c2d1361fc0"),
								common.HexToHash("0x0000000000000000000000000000000000000000000000000000000000000000"),
								common.HexToHash("0x000000000000000000000000000000000000000000000000000000000001ec68"),
							},
							Data:            nil,
							BlockNumber:     lo.Must(new(big.Int).SetString("49688455", 0)),
							TransactionHash: common.HexToHash("0xf8929e7ceaf2168c715ba40f1a75158944edcb9a3076fab1fb9daee4cab5552a"),
							Index:           77,
							Removed:         false,
						}, {
							Address: common.HexToAddress("0xDb46d1Dc155634FbC732f92E853b10B288AD5a1d"),
							Topics: []common.Hash{
								common.HexToHash("0xddf252ad1be2c89b69c2b068fc378daa952ba7f163c4a11628f55a4df523b3ef"),
								common.HexToHash("0x000000000000000000000000dcb72aab62d52abc2e6be99beee535c2d1361fc0"),
								common.HexToHash("0x00000000000000000000000073abd408811f4daf25d7ae6bca42cd71b07d0116"),
								common.HexToHash("0x000000000000000000000000000000000000000000000000000000000001ec68"),
							},
							Data:            nil,
							BlockNumber:     lo.Must(new(big.Int).SetString("49688455", 0)),
							TransactionHash: common.HexToHash("0xf8929e7ceaf2168c715ba40f1a75158944edcb9a3076fab1fb9daee4cab5552a"),
							Index:           78,
							Removed:         false,
						}, {
							Address: common.HexToAddress("0x0000000000000000000000000000000000001010"),
							Topics: []common.Hash{
								common.HexToHash("0x4dfe1bbbcf077ddc3e01291eea2d5c70c2b422b415d95645b9adcfd678cb1d63"),
								common.HexToHash("0x0000000000000000000000000000000000000000000000000000000000001010"),
								common.HexToHash("0x000000000000000000000000e7af8325aa443f7678b651d4f0de23663e818691"),
								common.HexToHash("0x0000000000000000000000009ead03f7136fc6b4bdb0780b00a1c14ae5a8b6d0"),
							},
							Data:            hexutil.MustDecode("0x0000000000000000000000000000000000000000000000000064e147bcab6a4c00000000000000000000000000000000000000000000004b7d11a6f1e5a850be000000000000000000000000000000000000000000000072155c754888fce1e000000000000000000000000000000000000000000000004b7cacc5aa28fce67200000000000000000000000000000000000000000000007215c1569045a84c2c"),
							BlockNumber:     lo.Must(new(big.Int).SetString("49688455", 0)),
							TransactionHash: common.HexToHash("0xf8929e7ceaf2168c715ba40f1a75158944edcb9a3076fab1fb9daee4cab5552a"),
							Index:           79,
							Removed:         false,
						}},
						Status:           1,
						TransactionHash:  common.HexToHash("0xf8929e7ceaf2168c715ba40f1a75158944edcb9a3076fab1fb9daee4cab5552a"),
						TransactionIndex: 13,
					},
				},
				config: &config.Module{
					Network:  filter.NetworkPolygon,
					Endpoint: endpoint.MustGet(filter.NetworkPolygon),
				},
			},
			want: &schema.Feed{
				ID:      "0xf8929e7ceaf2168c715ba40f1a75158944edcb9a3076fab1fb9daee4cab5552a",
				Network: filter.NetworkPolygon,
				Index:   13,
				From:    "0xe7Af8325aA443F7678B651d4f0De23663E818691",
				To:      "0xdCB72aaB62d52aBC2E6be99BEEe535C2D1361fc0",
				Type:    filter.TypeSocialProfile,
				Calldata: &schema.Calldata{
					FunctionHash: "0x50d425f9",
				},
				Platform: lo.ToPtr(filter.PlatformLens),
				Fee: &schema.Fee{
					Amount:  lo.Must(decimal.NewFromString("92872457939322314")),
					Decimal: 18,
				},
				Actions: []*schema.Action{
					{
						Type:     filter.TypeSocialProfile,
						Platform: "Lens",
						From:     "0xdCB72aaB62d52aBC2E6be99BEEe535C2D1361fc0",
						To:       "0xdCB72aaB62d52aBC2E6be99BEEe535C2D1361fc0",
						Metadata: metadata.SocialProfile{
							ProfileID: "0x01ec68",
							Action:    metadata.ActionSocialProfileCreate,
							Address:   common.HexToAddress("0xdcb72aab62d52abc2e6be99beee535c2d1361fc0"),
							Handle:    "x9900x.lens",
							ImageURI:  "",
						},
					},
				},
				Status:    true,
				Timestamp: 1699435732,
			},
			wantError: require.NoError,
		},
		{
			name: "Lens V2 Update Profile",
			arguments: arguments{
				task: &source.Task{
					Network: filter.NetworkPolygon,
					ChainID: 137,
					Header: &ethereum.Header{
						Hash:         common.HexToHash("0xc20381c14bea35c37ca71de96aa271045c81006b1db186ef36eae1d5bf3adbc4"),
						ParentHash:   common.HexToHash("0x943e50cf7a808cd5a2ea8f345692accd29324998e3b99d674057f80e0159bd9d"),
						UncleHash:    common.HexToHash("0x1dcc4de8dec75d7aab85b567b6ccd41ad312451b948a7413f0a142fd40d49347"),
						Coinbase:     common.HexToAddress("0x794e44D1334A56Fea7f4df12633b88820D0c5888"),
						Number:       lo.Must(new(big.Int).SetString("52074837", 0)),
						GasLimit:     30000000,
						GasUsed:      10932998,
						Timestamp:    1704697767,
						BaseFee:      lo.Must(new(big.Int).SetString("38188551707", 0)),
						Transactions: nil,
					},
					Transaction: &ethereum.Transaction{
						BlockHash: common.HexToHash("0x1f92b0335aa39b0c42df1cef83971749e80411f087149a3123e340dd1e1795f5"),
						From:      common.HexToAddress("0xeCE7edDc02FB8F0010420D0d76911826b1536655"),
						Gas:       62175,
						GasPrice:  lo.Must(new(big.Int).SetString("92858078379", 10)),
						Hash:      common.HexToHash("0x1f92b0335aa39b0c42df1cef83971749e80411f087149a3123e340dd1e1795f5"),
						Input:     hexutil.MustDecode("0xefe4fd830000000000000000000000000000000000000000000000000000000000020a730000000000000000000000000000000000000000000000000000000000000040000000000000000000000000000000000000000000000000000000000000003061723a2f2f4c6778556630444e6465714b6378724a492d672d3645456f33463130704f5759506c326b4a7a4c4655676300000000000000000000000000000000"),
						To:        lo.ToPtr(common.HexToAddress("0xDb46d1Dc155634FbC732f92E853b10B288AD5a1d")),
						Value:     lo.Must(new(big.Int).SetString("0", 0)),
						Type:      0,
						ChainID:   lo.Must(new(big.Int).SetString("137", 0)),
					},
					Receipt: &ethereum.Receipt{
						BlockHash:         common.HexToHash("0xc20381c14bea35c37ca71de96aa271045c81006b1db186ef36eae1d5bf3adbc4"),
						BlockNumber:       lo.Must(new(big.Int).SetString("52074837", 0)),
						ContractAddress:   nil,
						CumulativeGasUsed: 1704372,
						EffectiveGasPrice: hexutil.MustDecodeBig("0x159ec5d4ab"),
						GasUsed:           61546,
						Logs: []*ethereum.Log{{
							Address: common.HexToAddress("0xDb46d1Dc155634FbC732f92E853b10B288AD5a1d"),
							Topics: []common.Hash{
								common.HexToHash("0x1202cc90de8ecfb21f883e5a5257eb6cd0deabf48ef14dbf146c1225b3c50abb"),
								common.HexToHash("0x0000000000000000000000000000000000000000000000000000000000020a73"),
							},
							Data:            hexutil.MustDecode("0x0000000000000000000000000000000000000000000000000000000000000060000000000000000000000000ece7eddc02fb8f0010420d0d76911826b153665500000000000000000000000000000000000000000000000000000000659b9fa7000000000000000000000000000000000000000000000000000000000000003061723a2f2f4c6778556630444e6465714b6378724a492d672d3645456f33463130704f5759506c326b4a7a4c4655676300000000000000000000000000000000"),
							BlockNumber:     lo.Must(new(big.Int).SetString("52074837", 0)),
							TransactionHash: common.HexToHash("0x1f92b0335aa39b0c42df1cef83971749e80411f087149a3123e340dd1e1795f5"),
							Index:           31,
							Removed:         false,
						}, {
							Address: common.HexToAddress("0x0000000000000000000000000000000000001010"),
							Topics: []common.Hash{
								common.HexToHash("0x4dfe1bbbcf077ddc3e01291eea2d5c70c2b422b415d95645b9adcfd678cb1d63"),
								common.HexToHash("0x0000000000000000000000000000000000000000000000000000000000001010"),
								common.HexToHash("0x000000000000000000000000ece7eddc02fb8f0010420d0d76911826b1536655"),
								common.HexToHash("0x000000000000000000000000794e44d1334a56fea7f4df12633b88820d0c5888"),
							},
							Data:            hexutil.MustDecode("0x000000000000000000000000000000000000000000000000000bf42b194537a000000000000000000000000000000000000000000000005b21bf80f9acadb63200000000000000000000000000000000000000000000036f815c2a87481c150700000000000000000000000000000000000000000000005b21b38cce93687e9200000000000000000000000000000000000000000000036f81681eb261614ca7"),
							BlockNumber:     lo.Must(new(big.Int).SetString("52074837", 0)),
							TransactionHash: common.HexToHash("0x1f92b0335aa39b0c42df1cef83971749e80411f087149a3123e340dd1e1795f5"),
							Index:           32,
							Removed:         false,
						}},
						Status:           1,
						TransactionHash:  common.HexToHash("0x1f92b0335aa39b0c42df1cef83971749e80411f087149a3123e340dd1e1795f5"),
						TransactionIndex: 9,
					},
				},
				config: &config.Module{
					Network:  filter.NetworkPolygon,
					Endpoint: endpoint.MustGet(filter.NetworkPolygon),
				},
			},
			want: &schema.Feed{
				ID:      "0x1f92b0335aa39b0c42df1cef83971749e80411f087149a3123e340dd1e1795f5",
				Network: filter.NetworkPolygon,
				Index:   9,
				From:    "0xeCE7edDc02FB8F0010420D0d76911826b1536655",
				To:      "0xDb46d1Dc155634FbC732f92E853b10B288AD5a1d",
				Type:    filter.TypeSocialProfile,
				Calldata: &schema.Calldata{
					FunctionHash: "0xefe4fd83",
				},
				Platform: lo.ToPtr(filter.PlatformLens),
				Fee: &schema.Fee{
					Amount:  lo.Must(decimal.NewFromString("5715043291913934")),
					Decimal: 18,
				},
				Actions: []*schema.Action{
					{
						Type:     filter.TypeSocialProfile,
						Platform: "Lens",
						From:     "0xeCE7edDc02FB8F0010420D0d76911826b1536655",
						To:       "0xeCE7edDc02FB8F0010420D0d76911826b1536655",
						Metadata: metadata.SocialProfile{
							ProfileID: "0x020a73",
							Action:    metadata.ActionSocialProfileUpdate,
							Address:   common.HexToAddress("0xeCE7edDc02FB8F0010420D0d76911826b1536655"),
							Handle:    "gupta.lens",
							ImageURI:  "ipfs://bafybeih5jwshcxwa73mtfdhwqs2rtevrbhl6t3blrtlb4n5dpea4iqplpu",
							Bio:       "I'm trader.",
							Name:      "PETE",
						},
					},
				},
				Status:    true,
				Timestamp: 1704697767,
			},
			wantError: require.NoError,
		},
	}

	for _, testcase := range testcases {
		testcase := testcase

		t.Run(testcase.name, func(t *testing.T) {
			t.Parallel()

			ctx := context.Background()

			instance, err := worker.NewWorker(testcase.arguments.config)
			require.NoError(t, err)

			matched, err := instance.Match(ctx, testcase.arguments.task)
			testcase.wantError(t, err)
			require.True(t, matched)

			feed, err := instance.Transform(ctx, testcase.arguments.task)
			testcase.wantError(t, err)

			//t.Log(string(lo.Must(json.MarshalIndent(feed, "", "\x20\x20"))))

			require.Equal(t, testcase.want, feed)
		})
	}
}
