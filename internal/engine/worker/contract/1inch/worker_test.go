package oneinch_test

import (
	"context"
	"math/big"
	"testing"

	"github.com/ethereum/go-ethereum/common"
	"github.com/ethereum/go-ethereum/common/hexutil"
	"github.com/rss3-network/node/config"
	source "github.com/rss3-network/node/internal/engine/source/ethereum"
	worker "github.com/rss3-network/node/internal/engine/worker/contract/1inch"
	"github.com/rss3-network/node/provider/ethereum"
	"github.com/rss3-network/node/provider/ethereum/contract/1inch"
	"github.com/rss3-network/node/provider/ethereum/endpoint"
	"github.com/rss3-network/protocol-go/schema"
	"github.com/rss3-network/protocol-go/schema/filter"
	"github.com/rss3-network/protocol-go/schema/metadata"
	"github.com/samber/lo"
	"github.com/shopspring/decimal"
	"github.com/stretchr/testify/require"
)

func TestWorker_Oneinch(t *testing.T) {
	t.Parallel()

	type arguments struct {
		task   *source.Task
		config *config.Module
	}

	testcases := []struct {
		name      string
		arguments arguments
		want      *schema.Feed
		wantError require.ErrorAssertionFunc
	}{
		{
			name: "Swap ETH for WETH on Exchange 2",
			arguments: arguments{
				task: &source.Task{
					Network: filter.NetworkEthereum,
					ChainID: 1,
					Header: &ethereum.Header{
						Hash:         common.HexToHash("0xf10f2e1e6e6afbecfe2906137f813aae14d2e1d4478138f926917c083173e96e"),
						ParentHash:   common.HexToHash("0x9f97d15886a4f77789dda729cfab5ed0dae3b672b9d48cfc7b6b287de2bdb0d4"),
						UncleHash:    common.HexToHash("0x1dcc4de8dec75d7aab85b567b6ccd41ad312451b948a7413f0a142fd40d49347"),
						Coinbase:     common.HexToAddress("0x1f9090aaE28b8a3dCeaDf281B0F12828e676c326"),
						Number:       lo.Must(new(big.Int).SetString("17388943", 0)),
						GasLimit:     30000000,
						GasUsed:      10923351,
						Timestamp:    1685658839,
						BaseFee:      lo.Must(new(big.Int).SetString("40943976527", 0)),
						Transactions: nil,
					},
					Transaction: &ethereum.Transaction{
						BlockHash: common.HexToHash("0xb6db808536850dced5557fee043fcea42025c5a84b95939632cf8a6f03505aea"),
						From:      common.HexToAddress("0x940E5a9f9695b4A9EBab4821aBb075041336eeE0"),
						Gas:       251711,
						GasPrice:  lo.Must(new(big.Int).SetString("41043976527", 10)),
						Hash:      common.HexToHash("0xb6db808536850dced5557fee043fcea42025c5a84b95939632cf8a6f03505aea"),
						Input:     hexutil.MustDecode("0xf88309d7000000000000000000000000eeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeee000000000000000000000000c02aaa39b223fe8d0a0e5c4f27ead9083c756cc2000000000000000000000000000000000000000000000000002386f26fc100000000000000000000000000000000000000000000000000000022d10c4ecc8000000000000000000000000000000000000000000000000000002386f26fc100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000014000000000000000000000000000000000000000000000000000000000000001800000000000000000000000000000000000000000000000000000000000000aa00000000000000000000000000000000000000000000000000000000000000b000000000000000000000000000000000000000000000000000000000000000001000000000000000000000000728bbe9bbee3af78ad611315076621865950b34400000000000000000000000000000000000000000000000000000000000008e4e6adce0b0000000000000000000000000000000000000000000000000000000000000020000000000000000000000000728bbe9bbee3af78ad611315076621865950b34400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000100000000000000000000000000000000000000000000000000000000000000a000000000000000000000000000000000000000000000000000000000000007e4c2239eb0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000400000000000000000000000000000000000000000000000000000000000000764f4e3b2ed00000000000000000000000000000000000000000000000000000000000000e0000000000000000000000000c02aaa39b223fe8d0a0e5c4f27ead9083c756cc20000000000000000000000000000000000000000000000000000000000000001000000000000000000000000000000000000000000000000002386f26fc100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000100000000000000000000000000000000000000000000000000000000000001a0000000000000000000000000eeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeee000000000000000000000000000000000000000000000000002386f26fc10000000000000000000000000000728bbe9bbee3af78ad611315076621865950b344000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000a00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000200000000000000000000000000000000000000000000000000000000000000400000000000000000000000000000000000000000000000000000000000000280000000000000000000000000728bbe9bbee3af78ad611315076621865950b34400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000a0000000000000000000000000000000000000000000000000000000000000016455b181bb00000000000000000000000000000000000000000000000000000000000000804000000000000000000000000000000000000000000000000000000000000004000000000000000000000000eeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeee0000000000000000000000000000006400000000000000000000000000000064000000000000000000000000c02aaa39b223fe8d0a0e5c4f27ead9083c756cc200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000100000000000000000000000000000000000000000000000000000000000000a00000000000000000000000000000000000000000000000000000000000000004d0e30db00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000728bbe9bbee3af78ad611315076621865950b34400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000a0000000000000000000000000000000000000000000000000000000000000024476a612750000000000000000000000000000000000000000000000000000000000000080800000000000000000000000000000000000000000000000000000000000004400000000000000000000000011cbb51eb0af993e70394272c177ae657820a65000000000000000000000000000000000000000000000000000000000000001c0000000000000000000000000728bbe9bbee3af78ad611315076621865950b34400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000100000000000000000000000000000000000000000000000000000000000000a00000000000000000000000000000000000000000000000000000000000000064d1660f99000000000000000000000000c02aaa39b223fe8d0a0e5c4f27ead9083c756cc200000000000000000000000068a17b587caf4f9329f0e372e3a78d23a46de6b5000000000000000000000000000000000000000000000000000000000000000100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000004470bdb947000000000000000000000000c02aaa39b223fe8d0a0e5c4f27ead9083c756cc2000000000000000000000000000000000000000000000000002386f26fc1000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000002000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000008e40000000000000000000000000000000000000000000000000000000000000001000000000000000000000000000000000000000000000000002386f26fc10000"),
						To:        lo.ToPtr(common.HexToAddress("0x11111254369792b2Ca5d084aB5eEA397cA8fa48B")),
						Value:     lo.Must(new(big.Int).SetString("10000000000000000", 0)),
						Type:      2,
						ChainID:   lo.Must(new(big.Int).SetString("1", 0)),
					},
					Receipt: &ethereum.Receipt{
						BlockHash:         common.HexToHash("0xf10f2e1e6e6afbecfe2906137f813aae14d2e1d4478138f926917c083173e96e"),
						BlockNumber:       lo.Must(new(big.Int).SetString("17388943", 0)),
						ContractAddress:   nil,
						CumulativeGasUsed: 9003445,
						EffectiveGasPrice: hexutil.MustDecodeBig("0x98e69614f"),
						GasUsed:           159524,
						Logs: []*ethereum.Log{{
							Address: common.HexToAddress("0xC02aaA39b223FE8D0A0e5C4F27eAD9083C756Cc2"),
							Topics: []common.Hash{
								common.HexToHash("0xe1fffcc4923d04b559f4d29a8bfc6cda04eb5b0d3c460751c2402c5c5cc9109c"),
								common.HexToHash("0x000000000000000000000000728bbe9bbee3af78ad611315076621865950b344"),
							},
							Data:            hexutil.MustDecode("0x000000000000000000000000000000000000000000000000002386f26fc10000"),
							BlockNumber:     lo.Must(new(big.Int).SetString("17388943", 0)),
							TransactionHash: common.HexToHash("0xb6db808536850dced5557fee043fcea42025c5a84b95939632cf8a6f03505aea"),
							Index:           195,
							Removed:         false,
						}, {
							Address: common.HexToAddress("0xC02aaA39b223FE8D0A0e5C4F27eAD9083C756Cc2"),
							Topics: []common.Hash{
								common.HexToHash("0xddf252ad1be2c89b69c2b068fc378daa952ba7f163c4a11628f55a4df523b3ef"),
								common.HexToHash("0x000000000000000000000000728bbe9bbee3af78ad611315076621865950b344"),
								common.HexToHash("0x00000000000000000000000011111254369792b2ca5d084ab5eea397ca8fa48b"),
							},
							Data:            hexutil.MustDecode("0x000000000000000000000000000000000000000000000000002386f26fc10000"),
							BlockNumber:     lo.Must(new(big.Int).SetString("17388943", 0)),
							TransactionHash: common.HexToHash("0xb6db808536850dced5557fee043fcea42025c5a84b95939632cf8a6f03505aea"),
							Index:           196,
							Removed:         false,
						}, {
							Address: common.HexToAddress("0x728BbE9bbee3Af78Ad611315076621865950B344"),
							Topics: []common.Hash{
								common.HexToHash("0x1a8338f0f9fe7527cf74bf2d594e5d3b40d8d7bbd4f62e2d79a2c7dd31286acd"),
								common.HexToHash("0x00000000000000000000000011111254369792b2ca5d084ab5eea397ca8fa48b"),
								common.HexToHash("0x000000000000000000000000eeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeee"),
								common.HexToHash("0x000000000000000000000000c02aaa39b223fe8d0a0e5c4f27ead9083c756cc2"),
							},
							Data:            hexutil.MustDecode("0x0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000002386f26fc100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000002386f26fc100000000000000000000000000000000000000000000000000000000000000000001000000000000000000000000000000000000000000000000002386f26fc10000"),
							BlockNumber:     lo.Must(new(big.Int).SetString("17388943", 0)),
							TransactionHash: common.HexToHash("0xb6db808536850dced5557fee043fcea42025c5a84b95939632cf8a6f03505aea"),
							Index:           197,
							Removed:         false,
						}, {
							Address: common.HexToAddress("0xC02aaA39b223FE8D0A0e5C4F27eAD9083C756Cc2"),
							Topics: []common.Hash{
								common.HexToHash("0xddf252ad1be2c89b69c2b068fc378daa952ba7f163c4a11628f55a4df523b3ef"),
								common.HexToHash("0x00000000000000000000000011111254369792b2ca5d084ab5eea397ca8fa48b"),
								common.HexToHash("0x000000000000000000000000940e5a9f9695b4a9ebab4821abb075041336eee0"),
							},
							Data:            hexutil.MustDecode("0x000000000000000000000000000000000000000000000000002386f26fc10000"),
							BlockNumber:     lo.Must(new(big.Int).SetString("17388943", 0)),
							TransactionHash: common.HexToHash("0xb6db808536850dced5557fee043fcea42025c5a84b95939632cf8a6f03505aea"),
							Index:           198,
							Removed:         false,
						}, {
							Address: common.HexToAddress("0x11111254369792b2Ca5d084aB5eEA397cA8fa48B"),
							Topics: []common.Hash{
								common.HexToHash("0x894dbf1262199c24e1750298a384c709160f49d163422cc6cee694c73713f1d2"),
								common.HexToHash("0x000000000000000000000000940e5a9f9695b4a9ebab4821abb075041336eee0"),
							},
							Data:            hexutil.MustDecode("0x000000000000000000000000eeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeee000000000000000000000000c02aaa39b223fe8d0a0e5c4f27ead9083c756cc2000000000000000000000000000000000000000000000000002386f26fc10000000000000000000000000000000000000000000000000000002386f26fc10000"),
							BlockNumber:     lo.Must(new(big.Int).SetString("17388943", 0)),
							TransactionHash: common.HexToHash("0xb6db808536850dced5557fee043fcea42025c5a84b95939632cf8a6f03505aea"),
							Index:           199,
							Removed:         false,
						}, {
							Address: common.HexToAddress("0x11111254369792b2Ca5d084aB5eEA397cA8fa48B"),
							Topics: []common.Hash{
								common.HexToHash("0xe2cee3f6836059820b673943853afebd9b3026125dab0d774284e6f28a4855be"),
								common.HexToHash("0x000000000000000000000000eeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeee"),
								common.HexToHash("0x000000000000000000000000c02aaa39b223fe8d0a0e5c4f27ead9083c756cc2"),
								common.HexToHash("0x0000000000000000000000000000000000000000000000000000000000000000"),
							},
							Data:            hexutil.MustDecode("0x000000000000000000000000000000000000000000000000002386f26fc10000000000000000000000000000000000000000000000000000002386f26fc1000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000"),
							BlockNumber:     lo.Must(new(big.Int).SetString("17388943", 0)),
							TransactionHash: common.HexToHash("0xb6db808536850dced5557fee043fcea42025c5a84b95939632cf8a6f03505aea"),
							Index:           200,
							Removed:         false,
						}},
						Status:           1,
						TransactionHash:  common.HexToHash("0xb6db808536850dced5557fee043fcea42025c5a84b95939632cf8a6f03505aea"),
						TransactionIndex: 95,
					},
				},
				config: &config.Module{
					Network:  filter.NetworkEthereum,
					Endpoint: endpoint.MustGet(filter.NetworkEthereum),
				},
			},
			want: &schema.Feed{
				ID:      "0xb6db808536850dced5557fee043fcea42025c5a84b95939632cf8a6f03505aea",
				Network: filter.NetworkEthereum,
				Index:   95,
				From:    "0x940E5a9f9695b4A9EBab4821aBb075041336eeE0",
				To:      oneinch.AddressExchange2.String(),
				Type:    filter.TypeExchangeSwap,
				Calldata: &schema.Calldata{
					FunctionHash: "0xf88309d7",
				},
				Platform: lo.ToPtr(filter.Platform1inch),
				Fee: &schema.Fee{
					Amount:  lo.Must(decimal.NewFromString("6547499311493148")),
					Decimal: 18,
				},
				Actions: []*schema.Action{
					{
						Type:     filter.TypeExchangeSwap,
						Tag:      filter.TagExchange,
						Platform: filter.Platform1inch.String(),
						From:     "0x940E5a9f9695b4A9EBab4821aBb075041336eeE0",
						To:       "0x940E5a9f9695b4A9EBab4821aBb075041336eeE0",
						Metadata: metadata.ExchangeSwap{
							From: metadata.Token{
								Value:    lo.ToPtr(lo.Must(decimal.NewFromString("10000000000000000"))),
								Name:     "Ethereum",
								Symbol:   "ETH",
								Decimals: 18,
							},
							To: metadata.Token{
								Address:  lo.ToPtr("0xC02aaA39b223FE8D0A0e5C4F27eAD9083C756Cc2"),
								Value:    lo.ToPtr(lo.Must(decimal.NewFromString("10000000000000000"))),
								Name:     "Wrapped Ether",
								Symbol:   "WETH",
								Decimals: 18,
								Standard: metadata.StandardERC20,
							},
						},
					},
				},
				Status:    true,
				Timestamp: 1685658839,
			},
			wantError: require.NoError,
		},
		{
			name: "Swap ETH for AAVE on AggregationRouter V2",
			arguments: arguments{
				task: &source.Task{
					Network: filter.NetworkEthereum,
					ChainID: 1,
					Header: &ethereum.Header{
						Hash:         common.HexToHash("0x1d4a00257b30458726aa188d678ad581cc63fc75982d1e40d54aaef48c2d48fb"),
						ParentHash:   common.HexToHash("0x80e72047ec2f63a570d6917f71d94e489c4fe400ff2c11e960b8db8a6e4d8a83"),
						UncleHash:    common.HexToHash("0x1dcc4de8dec75d7aab85b567b6ccd41ad312451b948a7413f0a142fd40d49347"),
						Coinbase:     common.HexToAddress("0x690B9A9E9aa1C9dB991C7721a92d351Db4FaC990"),
						Number:       lo.Must(new(big.Int).SetString("15901162", 0)),
						GasLimit:     30000000,
						GasUsed:      29980946,
						Timestamp:    1667619287,
						BaseFee:      lo.Must(new(big.Int).SetString("12513570894", 0)),
						Transactions: nil,
					},
					Transaction: &ethereum.Transaction{
						BlockHash: common.HexToHash("0x211ced54b5318c548fe5c1ed89393fd9dafb2ef2b69c1d13cd3724ea34564661"),
						From:      common.HexToAddress("0x3d8eB64C1CBFa5Bba1d8217D6c6AE3e40460D8f4"),
						Gas:       307410,
						GasPrice:  lo.Must(new(big.Int).SetString("13980218286", 10)),
						Hash:      common.HexToHash("0x211ced54b5318c548fe5c1ed89393fd9dafb2ef2b69c1d13cd3724ea34564661"),
						Input:     hexutil.MustDecode("0x90411a32000000000000000000000000b3c9669a5706477a2b237d98edb9b57678926f04000000000000000000000000000000000000000000000000000000000000006000000000000000000000000000000000000000000000000000000000000001c0000000000000000000000000eeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeee00000000000000000000000057ab1ec28d129707052df4df418d58a2d46d5f51000000000000000000000000b3c9669a5706477a2b237d98edb9b57678926f040000000000000000000000003d8eb64c1cbfa5bba1d8217d6c6ae3e40460d8f40000000000000000000000000000000000000000000000000007ef2b3653e68400000000000000000000000000000000000000000000000031f16fbcf992876200000000000000000000000000000000000000000000000032729511a196984400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000014000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000003000000000000000000000000000000000000000000000000000000000000006000000000000000000000000000000000000000000000000000000000000001200000000000000000000000000000000000000000000000000000000000000220000000000000000000000000c02aaa39b223fe8d0a0e5c4f27ead9083c756cc200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000007ef2b3653e68400000000000000000000000000000000000000000000000000000000000000800000000000000000000000000000000000000000000000000000000000000004d0e30db000000000000000000000000000000000000000000000000000000000000000000000000000000000c02aaa39b223fe8d0a0e5c4f27ead9083c756cc20000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000800000000000000000000000000000000000000000000000000000000000000044a9059cbb000000000000000000000000f80758ab42c3b07da84053fd88804bcb6baa4b5c0000000000000000000000000000000000000000000000000007ef2b3653e68400000000000000000000000000000000000000000000000000000000800000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000008000000000000000000000000000000000000000000000000000000000000000a4c9f12e9d000000000000000000000000f80758ab42c3b07da84053fd88804bcb6baa4b5c000000000000000000000000c02aaa39b223fe8d0a0e5c4f27ead9083c756cc200000000000000000000000057ab1ec28d129707052df4df418d58a2d46d5f510000000000000000000000033d8eb64c1cbfa5bba1d8217d6c6ae3e40460d8f4000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000cfee7c08"),
						To:        lo.ToPtr(common.HexToAddress("0x111111125434b319222CdBf8C261674aDB56F3ae")),
						Value:     lo.Must(new(big.Int).SetString("2233293711074948", 0)),
						Type:      2,
						ChainID:   lo.Must(new(big.Int).SetString("1", 0)),
					},
					Receipt: &ethereum.Receipt{
						BlockHash:         common.HexToHash("0x1d4a00257b30458726aa188d678ad581cc63fc75982d1e40d54aaef48c2d48fb"),
						BlockNumber:       lo.Must(new(big.Int).SetString("15901162", 0)),
						ContractAddress:   nil,
						CumulativeGasUsed: 9751918,
						EffectiveGasPrice: hexutil.MustDecodeBig("0x3414933ae"),
						GasUsed:           231829,

						Logs: []*ethereum.Log{{
							Address: common.HexToAddress("0xC02aaA39b223FE8D0A0e5C4F27eAD9083C756Cc2"),
							Topics: []common.Hash{
								common.HexToHash("0xe1fffcc4923d04b559f4d29a8bfc6cda04eb5b0d3c460751c2402c5c5cc9109c"),
								common.HexToHash("0x000000000000000000000000b3c9669a5706477a2b237d98edb9b57678926f04"),
							},
							Data:            hexutil.MustDecode("0x0000000000000000000000000000000000000000000000000007ef2b3653e684"),
							BlockNumber:     lo.Must(new(big.Int).SetString("15901162", 0)),
							TransactionHash: common.HexToHash("0x211ced54b5318c548fe5c1ed89393fd9dafb2ef2b69c1d13cd3724ea34564661"),
							Index:           253,
							Removed:         false,
						}, {
							Address: common.HexToAddress("0xC02aaA39b223FE8D0A0e5C4F27eAD9083C756Cc2"),
							Topics: []common.Hash{
								common.HexToHash("0xddf252ad1be2c89b69c2b068fc378daa952ba7f163c4a11628f55a4df523b3ef"),
								common.HexToHash("0x000000000000000000000000b3c9669a5706477a2b237d98edb9b57678926f04"),
								common.HexToHash("0x000000000000000000000000f80758ab42c3b07da84053fd88804bcb6baa4b5c"),
							},
							Data:            hexutil.MustDecode("0x0000000000000000000000000000000000000000000000000007ef2b3653e684"),
							BlockNumber:     lo.Must(new(big.Int).SetString("15901162", 0)),
							TransactionHash: common.HexToHash("0x211ced54b5318c548fe5c1ed89393fd9dafb2ef2b69c1d13cd3724ea34564661"),
							Index:           254,
							Removed:         false,
						}, {
							Address: common.HexToAddress("0x57Ab1ec28D129707052df4dF418D58a2D46d5f51"),
							Topics: []common.Hash{
								common.HexToHash("0xddf252ad1be2c89b69c2b068fc378daa952ba7f163c4a11628f55a4df523b3ef"),
								common.HexToHash("0x000000000000000000000000f80758ab42c3b07da84053fd88804bcb6baa4b5c"),
								common.HexToHash("0x0000000000000000000000003d8eb64c1cbfa5bba1d8217d6c6ae3e40460d8f4"),
							},
							Data:            hexutil.MustDecode("0x00000000000000000000000000000000000000000000000032729511a1969943"),
							BlockNumber:     lo.Must(new(big.Int).SetString("15901162", 0)),
							TransactionHash: common.HexToHash("0x211ced54b5318c548fe5c1ed89393fd9dafb2ef2b69c1d13cd3724ea34564661"),
							Index:           255,
							Removed:         false,
						}, {
							Address: common.HexToAddress("0xf80758aB42C3B07dA84053Fd88804bCB6BAA4b5c"),
							Topics: []common.Hash{
								common.HexToHash("0x1c411e9a96e071241c2f21f7726b17ae89e3cab4c78be50e062b03a9fffbbad1"),
							},
							Data:            hexutil.MustDecode("0x00000000000000000000000000000000000000000000214e5366c79b7070bc6100000000000000000000000000000000000000000000000539011928f6b78a04"),
							BlockNumber:     lo.Must(new(big.Int).SetString("15901162", 0)),
							TransactionHash: common.HexToHash("0x211ced54b5318c548fe5c1ed89393fd9dafb2ef2b69c1d13cd3724ea34564661"),
							Index:           256,
							Removed:         false,
						}, {
							Address: common.HexToAddress("0xf80758aB42C3B07dA84053Fd88804bCB6BAA4b5c"),
							Topics: []common.Hash{
								common.HexToHash("0xd78ad95fa46c994b6551d0da85fc275fe613ce37657fb8d5e3d130840159d822"),
								common.HexToHash("0x000000000000000000000000b3c9669a5706477a2b237d98edb9b57678926f04"),
								common.HexToHash("0x0000000000000000000000003d8eb64c1cbfa5bba1d8217d6c6ae3e40460d8f4"),
							},
							Data:            hexutil.MustDecode("0x00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000007ef2b3653e68400000000000000000000000000000000000000000000000032729511a19699430000000000000000000000000000000000000000000000000000000000000000"),
							BlockNumber:     lo.Must(new(big.Int).SetString("15901162", 0)),
							TransactionHash: common.HexToHash("0x211ced54b5318c548fe5c1ed89393fd9dafb2ef2b69c1d13cd3724ea34564661"),
							Index:           257,
							Removed:         false,
						}, {
							Address: common.HexToAddress("0x111111125434b319222CdBf8C261674aDB56F3ae"),
							Topics: []common.Hash{
								common.HexToHash("0x76af224a143865a50b41496e1a73622698692c565c1214bc862f18e22d829c5e"),
								common.HexToHash("0x0000000000000000000000003d8eb64c1cbfa5bba1d8217d6c6ae3e40460d8f4"),
								common.HexToHash("0x000000000000000000000000eeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeee"),
								common.HexToHash("0x00000000000000000000000057ab1ec28d129707052df4df418d58a2d46d5f51"),
							},
							Data:            hexutil.MustDecode("0x0000000000000000000000003d8eb64c1cbfa5bba1d8217d6c6ae3e40460d8f40000000000000000000000000000000000000000000000000007ef2b3653e6840000000000000000000000000000000000000000000000000007ef2b3653e68400000000000000000000000000000000000000000000000032729511a196994300000000000000000000000000000000000000000000000031f16fbcf992876200000000000000000000000000000000000000000000000032729511a19698440000000000000000000000000000000000000000000000000000000000000000"),
							BlockNumber:     lo.Must(new(big.Int).SetString("15901162", 0)),
							TransactionHash: common.HexToHash("0x211ced54b5318c548fe5c1ed89393fd9dafb2ef2b69c1d13cd3724ea34564661"),
							Index:           258,
							Removed:         false,
						}},
						Status:           1,
						TransactionHash:  common.HexToHash("0x211ced54b5318c548fe5c1ed89393fd9dafb2ef2b69c1d13cd3724ea34564661"),
						TransactionIndex: 87,
					},
				},
				config: &config.Module{
					Network:  filter.NetworkEthereum,
					Endpoint: endpoint.MustGet(filter.NetworkEthereum),
				},
			},
			want: &schema.Feed{
				ID:      "0x211ced54b5318c548fe5c1ed89393fd9dafb2ef2b69c1d13cd3724ea34564661",
				Network: filter.NetworkEthereum,
				Index:   87,
				From:    "0x3d8eB64C1CBFa5Bba1d8217D6c6AE3e40460D8f4",
				To:      oneinch.AddressAggregationRouterV2.String(),
				Type:    filter.TypeExchangeSwap,
				Calldata: &schema.Calldata{
					FunctionHash: "0x90411a32",
				},
				Platform: lo.ToPtr(filter.Platform1inch),
				Fee: &schema.Fee{
					Amount:  lo.Must(decimal.NewFromString("3241020025025094")),
					Decimal: 18,
				},
				Actions: []*schema.Action{
					{
						Type:     filter.TypeExchangeSwap,
						Tag:      filter.TagExchange,
						Platform: filter.Platform1inch.String(),
						From:     "0x3d8eB64C1CBFa5Bba1d8217D6c6AE3e40460D8f4",
						To:       "0x3d8eB64C1CBFa5Bba1d8217D6c6AE3e40460D8f4",
						Metadata: metadata.ExchangeSwap{
							From: metadata.Token{
								Value:    lo.ToPtr(lo.Must(decimal.NewFromString("2233293711074948"))),
								Name:     "Ethereum",
								Symbol:   "ETH",
								Decimals: 18,
							},
							To: metadata.Token{
								Address:  lo.ToPtr("0x57Ab1ec28D129707052df4dF418D58a2D46d5f51"),
								Value:    lo.ToPtr(lo.Must(decimal.NewFromString("3635131752199395651"))),
								Name:     "Synth sUSD",
								Symbol:   "sUSD",
								Decimals: 18,
								Standard: metadata.StandardERC20,
							},
						},
					},
				},
				Status:    true,
				Timestamp: 1667619287,
			},
			wantError: require.NoError,
		},
		{
			name: "Swap ETH for USDC on AggregationRouter V3",
			arguments: arguments{
				task: &source.Task{
					Network: filter.NetworkEthereum,
					ChainID: 1,
					Header: &ethereum.Header{
						Hash:         common.HexToHash("0x407410215df27fc858c359bb2789c1cce37658fd5af03d3a70f87846db9cb441"),
						ParentHash:   common.HexToHash("0xa1dc1f983f948be80db1409a8ea15ae7310781804bdd4de7a3a9d974dc019657"),
						UncleHash:    common.HexToHash("0x1dcc4de8dec75d7aab85b567b6ccd41ad312451b948a7413f0a142fd40d49347"),
						Coinbase:     common.HexToAddress("0x1f9090aaE28b8a3dCeaDf281B0F12828e676c326"),
						Number:       lo.Must(new(big.Int).SetString("16996630", 0)),
						GasLimit:     30000000,
						GasUsed:      12154264,
						Timestamp:    1680870731,
						BaseFee:      lo.Must(new(big.Int).SetString("22630556743", 0)),
						Transactions: nil,
					},
					Transaction: &ethereum.Transaction{
						BlockHash: common.HexToHash("0xd2c37acd588f088402d5f203080c61ac6473f3f4ff09c78d3dd8ecde1cbeb482"),
						From:      common.HexToAddress("0x2A0a81e257a2f5D6eD4F07b81DbDa09F107bd027"),
						Gas:       236478,
						GasPrice:  lo.Must(new(big.Int).SetString("23155240782", 10)),
						Hash:      common.HexToHash("0xd2c37acd588f088402d5f203080c61ac6473f3f4ff09c78d3dd8ecde1cbeb482"),
						Input:     hexutil.MustDecode("0x7c0252000000000000000000000000007122db0ebe4eb9b434a9f2ffe6760bc03bfbd0e000000000000000000000000000000000000000000000000000000000000000600000000000000000000000000000000000000000000000000000000000000180000000000000000000000000eeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeee000000000000000000000000a0b86991c6218b36c1d19d4a2e9eb0ce3606eb480000000000000000000000007122db0ebe4eb9b434a9f2ffe6760bc03bfbd0e0000000000000000000000000550f589100e379c8530c0564566d6e270ff1345700000000000000000000000000000000000000000000000025849488c242a6ea000000000000000000000000000000000000000000000000000000011c0bbef800000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000d500000000000000000000000000000000000000000000009700006900001a4041c02aaa39b223fe8d0a0e5c4f27ead9083c756cc2d0e30db002a0000000000000000000000000000000000000000000000000000000011c0bbef8ee63c1e50088e6a0c2ddd26feeb64f039a2c41296fcb3f5640c02aaa39b223fe8d0a0e5c4f27ead9083c756cc280a06c4eca27a0b86991c6218b36c1d19d4a2e9eb0ce3606eb48550f589100e379c8530c0564566d6e270ff1345700000000000000000000000000000000000000000000000025849488c242a6ea0000000000000000000000cfee7c08"),
						To:        lo.ToPtr(common.HexToAddress("0x11111112542D85B3EF69AE05771c2dCCff4fAa26")),
						Value:     lo.Must(new(big.Int).SetString("2703448991424751338", 0)),
						Type:      0,
						ChainID:   lo.Must(new(big.Int).SetString("1", 0)),
					},
					Receipt: &ethereum.Receipt{
						BlockHash:         common.HexToHash("0x407410215df27fc858c359bb2789c1cce37658fd5af03d3a70f87846db9cb441"),
						BlockNumber:       lo.Must(new(big.Int).SetString("16996630", 0)),
						ContractAddress:   nil,
						CumulativeGasUsed: 5183806,
						EffectiveGasPrice: hexutil.MustDecodeBig("0x56428ef4e"),
						GasUsed:           148594,

						Logs: []*ethereum.Log{{
							Address: common.HexToAddress("0xC02aaA39b223FE8D0A0e5C4F27eAD9083C756Cc2"),
							Topics: []common.Hash{
								common.HexToHash("0xe1fffcc4923d04b559f4d29a8bfc6cda04eb5b0d3c460751c2402c5c5cc9109c"),
								common.HexToHash("0x0000000000000000000000007122db0ebe4eb9b434a9f2ffe6760bc03bfbd0e0"),
							},
							Data:            hexutil.MustDecode("0x00000000000000000000000000000000000000000000000025849488c242a6ea"),
							BlockNumber:     lo.Must(new(big.Int).SetString("16996630", 0)),
							TransactionHash: common.HexToHash("0xd2c37acd588f088402d5f203080c61ac6473f3f4ff09c78d3dd8ecde1cbeb482"),
							Index:           114,
							Removed:         false,
						}, {
							Address: common.HexToAddress("0xA0b86991c6218b36c1d19D4a2e9Eb0cE3606eB48"),
							Topics: []common.Hash{
								common.HexToHash("0xddf252ad1be2c89b69c2b068fc378daa952ba7f163c4a11628f55a4df523b3ef"),
								common.HexToHash("0x00000000000000000000000088e6a0c2ddd26feeb64f039a2c41296fcb3f5640"),
								common.HexToHash("0x0000000000000000000000007122db0ebe4eb9b434a9f2ffe6760bc03bfbd0e0"),
							},
							Data:            hexutil.MustDecode("0x000000000000000000000000000000000000000000000000000000012af01b71"),
							BlockNumber:     lo.Must(new(big.Int).SetString("16996630", 0)),
							TransactionHash: common.HexToHash("0xd2c37acd588f088402d5f203080c61ac6473f3f4ff09c78d3dd8ecde1cbeb482"),
							Index:           115,
							Removed:         false,
						}, {
							Address: common.HexToAddress("0xC02aaA39b223FE8D0A0e5C4F27eAD9083C756Cc2"),
							Topics: []common.Hash{
								common.HexToHash("0xddf252ad1be2c89b69c2b068fc378daa952ba7f163c4a11628f55a4df523b3ef"),
								common.HexToHash("0x0000000000000000000000007122db0ebe4eb9b434a9f2ffe6760bc03bfbd0e0"),
								common.HexToHash("0x00000000000000000000000088e6a0c2ddd26feeb64f039a2c41296fcb3f5640"),
							},
							Data:            hexutil.MustDecode("0x00000000000000000000000000000000000000000000000025849488c242a6ea"),
							BlockNumber:     lo.Must(new(big.Int).SetString("16996630", 0)),
							TransactionHash: common.HexToHash("0xd2c37acd588f088402d5f203080c61ac6473f3f4ff09c78d3dd8ecde1cbeb482"),
							Index:           116,
							Removed:         false,
						}, {
							Address: common.HexToAddress("0x88e6A0c2dDD26FEEb64F039a2c41296FcB3f5640"),
							Topics: []common.Hash{
								common.HexToHash("0xc42079f94a6350d7e6235f29174924f928cc2ac818eb64fed8004e115fbcca67"),
								common.HexToHash("0x0000000000000000000000007122db0ebe4eb9b434a9f2ffe6760bc03bfbd0e0"),
								common.HexToHash("0x0000000000000000000000007122db0ebe4eb9b434a9f2ffe6760bc03bfbd0e0"),
							},
							Data:            hexutil.MustDecode("0xfffffffffffffffffffffffffffffffffffffffffffffffffffffffed50fe48f00000000000000000000000000000000000000000000000025849488c242a6ea0000000000000000000000000000000000005aab612cdb27c5d51db1c67a47290000000000000000000000000000000000000000000000017ef0eee51d4657dd0000000000000000000000000000000000000000000000000000000000031162"),
							BlockNumber:     lo.Must(new(big.Int).SetString("16996630", 0)),
							TransactionHash: common.HexToHash("0xd2c37acd588f088402d5f203080c61ac6473f3f4ff09c78d3dd8ecde1cbeb482"),
							Index:           117,
							Removed:         false,
						}, {
							Address: common.HexToAddress("0xA0b86991c6218b36c1d19D4a2e9Eb0cE3606eB48"),
							Topics: []common.Hash{
								common.HexToHash("0xddf252ad1be2c89b69c2b068fc378daa952ba7f163c4a11628f55a4df523b3ef"),
								common.HexToHash("0x0000000000000000000000007122db0ebe4eb9b434a9f2ffe6760bc03bfbd0e0"),
								common.HexToHash("0x000000000000000000000000550f589100e379c8530c0564566d6e270ff13457"),
							},
							Data:            hexutil.MustDecode("0x000000000000000000000000000000000000000000000000000000012af01b71"),
							BlockNumber:     lo.Must(new(big.Int).SetString("16996630", 0)),
							TransactionHash: common.HexToHash("0xd2c37acd588f088402d5f203080c61ac6473f3f4ff09c78d3dd8ecde1cbeb482"),
							Index:           118,
							Removed:         false,
						}, {
							Address: common.HexToAddress("0x11111112542D85B3EF69AE05771c2dCCff4fAa26"),
							Topics: []common.Hash{
								common.HexToHash("0xd6d4f5681c246c9f42c203e287975af1601f8df8035a9251f79aab5c8f09e2f8"),
							},
							Data:            hexutil.MustDecode("0x0000000000000000000000002a0a81e257a2f5d6ed4f07b81dbda09f107bd027000000000000000000000000eeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeee000000000000000000000000a0b86991c6218b36c1d19d4a2e9eb0ce3606eb48000000000000000000000000550f589100e379c8530c0564566d6e270ff1345700000000000000000000000000000000000000000000000025849488c242a6ea000000000000000000000000000000000000000000000000000000012af01b71"),
							BlockNumber:     lo.Must(new(big.Int).SetString("16996630", 0)),
							TransactionHash: common.HexToHash("0xd2c37acd588f088402d5f203080c61ac6473f3f4ff09c78d3dd8ecde1cbeb482"),
							Index:           119,
							Removed:         false,
						}},
						Status:           1,
						TransactionHash:  common.HexToHash("0xd2c37acd588f088402d5f203080c61ac6473f3f4ff09c78d3dd8ecde1cbeb482"),
						TransactionIndex: 59,
					},
				},
				config: &config.Module{
					Network:  filter.NetworkEthereum,
					Endpoint: endpoint.MustGet(filter.NetworkEthereum),
				},
			},
			want: &schema.Feed{
				ID:      "0xd2c37acd588f088402d5f203080c61ac6473f3f4ff09c78d3dd8ecde1cbeb482",
				Network: filter.NetworkEthereum,
				Index:   59,
				From:    "0x2A0a81e257a2f5D6eD4F07b81DbDa09F107bd027",
				To:      oneinch.AddressAggregationRouterV3.String(),
				Type:    filter.TypeExchangeSwap,
				Calldata: &schema.Calldata{
					FunctionHash: "0x7c025200",
				},
				Platform: lo.ToPtr(filter.Platform1inch),
				Fee: &schema.Fee{
					Amount:  lo.Must(decimal.NewFromString("3440729848760508")),
					Decimal: 18,
				},
				Actions: []*schema.Action{
					{
						Type:     filter.TypeExchangeSwap,
						Tag:      filter.TagExchange,
						Platform: filter.Platform1inch.String(),
						From:     "0x2A0a81e257a2f5D6eD4F07b81DbDa09F107bd027",
						To:       "0x550F589100E379C8530c0564566D6e270ff13457",
						Metadata: metadata.ExchangeSwap{
							From: metadata.Token{
								Value:    lo.ToPtr(lo.Must(decimal.NewFromString("2703448991424751338"))),
								Name:     "Ethereum",
								Symbol:   "ETH",
								Decimals: 18,
							},
							To: metadata.Token{
								Address:  lo.ToPtr("0xA0b86991c6218b36c1d19D4a2e9Eb0cE3606eB48"),
								Value:    lo.ToPtr(lo.Must(decimal.NewFromString("5015346033"))),
								Name:     "USD Coin",
								Symbol:   "USDC",
								Decimals: 6,
								Standard: metadata.StandardERC20,
							},
						},
					},
				},
				Status:    true,
				Timestamp: 1680870731,
			},
			wantError: require.NoError,
		},
		{
			name: "Swap ETH for rETH on AggregationRouter V4",
			arguments: arguments{
				task: &source.Task{
					Network: filter.NetworkEthereum,
					ChainID: 1,
					Header: &ethereum.Header{
						Hash:         common.HexToHash("0xa6cd543e11da09c0a34f672336068f7bd7506fc6d2426a50af1075974506be1e"),
						ParentHash:   common.HexToHash("0x5e9421d830c4cb7f8fea68e01aa2ca7296caf2b785e55c7ff4b7eaf729781318"),
						UncleHash:    common.HexToHash("0x1dcc4de8dec75d7aab85b567b6ccd41ad312451b948a7413f0a142fd40d49347"),
						Coinbase:     common.HexToAddress("0xCE0BaBc8398144Aa98D9210d595E3A9714910748"),
						Number:       lo.Must(new(big.Int).SetString("17375953", 0)),
						GasLimit:     30000000,
						GasUsed:      18950597,
						Timestamp:    1685500847,
						BaseFee:      lo.Must(new(big.Int).SetString("29721380971", 0)),
						Transactions: nil,
					},
					Transaction: &ethereum.Transaction{
						BlockHash: common.HexToHash("0xae8fa2b053cf69a80648622620dd84ce2d27c6ca092f6fe049a4712bbea1a205"),
						From:      common.HexToAddress("0x09c149843fd6a6085e1E677f744314ab9eC768Cb"),
						Gas:       1312358,
						GasPrice:  lo.Must(new(big.Int).SetString("33000000000", 10)),
						Hash:      common.HexToHash("0xae8fa2b053cf69a80648622620dd84ce2d27c6ca092f6fe049a4712bbea1a205"),
						Input:     hexutil.MustDecode("0x7c0252000000000000000000000000001136b25047e142fa3018184793aec68fbb173ce400000000000000000000000000000000000000000000000000000000000000600000000000000000000000000000000000000000000000000000000000000180000000000000000000000000eeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeee000000000000000000000000ae78736cd615f374d3085123a210448e74fc63930000000000000000000000001136b25047e142fa3018184793aec68fbb173ce400000000000000000000000009c149843fd6a6085e1e677f744314ab9ec768cb0000000000000000000000000000000000000000000000022a6ae955f8db0000000000000000000000000000000000000000000000000002042f1f41acca77be00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000a000000000000000000000000000000000000000000000006200003400001a40e0dd3f50f8a6cafbe9b31a427582963f465e745af8d0e30db00020d6bdbf78ae78736cd615f374d3085123a210448e74fc639380a06c4eca27ae78736cd615f374d3085123a210448e74fc63931111111254fb6c44bac0bed2854e76f90643097d0000000000000000000000000000000000000000000000022a6ae955f8db0000f012a792"),
						To:        lo.ToPtr(common.HexToAddress("0x1111111254fb6c44bAC0beD2854e76F90643097d")),
						Value:     lo.Must(new(big.Int).SetString("39950000000000000000", 0)),
						Type:      2,
						ChainID:   lo.Must(new(big.Int).SetString("1", 0)),
					},
					Receipt: &ethereum.Receipt{
						BlockHash:         common.HexToHash("0xa6cd543e11da09c0a34f672336068f7bd7506fc6d2426a50af1075974506be1e"),
						BlockNumber:       lo.Must(new(big.Int).SetString("17375953", 0)),
						ContractAddress:   nil,
						CumulativeGasUsed: 3633626,
						EffectiveGasPrice: hexutil.MustDecodeBig("0x7aef40a00"),
						GasUsed:           619079,

						Logs: []*ethereum.Log{{
							Address: common.HexToAddress("0xae78736Cd615f374D3085123A210448E74Fc6393"),
							Topics: []common.Hash{
								common.HexToHash("0xddf252ad1be2c89b69c2b068fc378daa952ba7f163c4a11628f55a4df523b3ef"),
								common.HexToHash("0x0000000000000000000000000000000000000000000000000000000000000000"),
								common.HexToHash("0x0000000000000000000000001136b25047e142fa3018184793aec68fbb173ce4"),
							},
							Data:            hexutil.MustDecode("0x00000000000000000000000000000000000000000000000204b365c22005dd99"),
							BlockNumber:     lo.Must(new(big.Int).SetString("17375953", 0)),
							TransactionHash: common.HexToHash("0xae8fa2b053cf69a80648622620dd84ce2d27c6ca092f6fe049a4712bbea1a205"),
							Index:           85,
							Removed:         false,
						}, {
							Address: common.HexToAddress("0xae78736Cd615f374D3085123A210448E74Fc6393"),
							Topics: []common.Hash{
								common.HexToHash("0x6155cfd0fd028b0ca77e8495a60cbe563e8bce8611f0aad6fedbdaafc05d44a2"),
								common.HexToHash("0x0000000000000000000000001136b25047e142fa3018184793aec68fbb173ce4"),
							},
							Data:            hexutil.MustDecode("0x00000000000000000000000000000000000000000000000204b365c22005dd990000000000000000000000000000000000000000000000022a23f22ddd779000000000000000000000000000000000000000000000000000000000006476b3af"),
							BlockNumber:     lo.Must(new(big.Int).SetString("17375953", 0)),
							TransactionHash: common.HexToHash("0xae8fa2b053cf69a80648622620dd84ce2d27c6ca092f6fe049a4712bbea1a205"),
							Index:           86,
							Removed:         false,
						}, {
							Address: common.HexToAddress("0xDD3f50F8A6CafbE9b31a427582963f465E745AF8"),
							Topics: []common.Hash{
								common.HexToHash("0x7aa1a8eb998c779420645fc14513bf058edb347d95c2fc2e6845bdc22f888631"),
								common.HexToHash("0x0000000000000000000000001136b25047e142fa3018184793aec68fbb173ce4"),
							},
							Data:            hexutil.MustDecode("0x0000000000000000000000000000000000000000000000022a6ae955f8db0000000000000000000000000000000000000000000000000000000000006476b3af"),
							BlockNumber:     lo.Must(new(big.Int).SetString("17375953", 0)),
							TransactionHash: common.HexToHash("0xae8fa2b053cf69a80648622620dd84ce2d27c6ca092f6fe049a4712bbea1a205"),
							Index:           87,
							Removed:         false,
						}, {
							Address: common.HexToAddress("0x3bDC69C4E5e13E52A65f5583c23EFB9636b469d6"),
							Topics: []common.Hash{
								common.HexToHash("0xbf25d6cb74c97a403cfab1c4c0abc9ffe3edd964de9924de0565f5ffe3d6ca79"),
								common.HexToHash("0xd76aaac3ecd5ced13bbab3b240a426352f76a6fffd583c3b15f4ddae2b754e4e"),
							},
							Data:            hexutil.MustDecode("0x0000000000000000000000000000000000000000000000022a6ae955f8db0000000000000000000000000000000000000000000000000000000000006476b3af"),
							BlockNumber:     lo.Must(new(big.Int).SetString("17375953", 0)),
							TransactionHash: common.HexToHash("0xae8fa2b053cf69a80648622620dd84ce2d27c6ca092f6fe049a4712bbea1a205"),
							Index:           88,
							Removed:         false,
						}, {
							Address: common.HexToAddress("0x9e966733e3E9BFA56aF95f762921859417cF6FaA"),
							Topics: []common.Hash{
								common.HexToHash("0xc7d9de0aecd8d5829d96dfdb22c26b4625da22c5098c557e8b034a58015f189a"),
								common.HexToHash("0x00000000000000000000000042fd4e038a2c36bf72824d321021d08a69e4b434"),
								common.HexToHash("0xa7c30d79bac38383b63cf527b2a68c8a7efff3ba22dfd5b81d98030643ef0fca"),
							},
							Data:            hexutil.MustDecode("0x000000000000000000000000000000000000000000000000000000006476b3af"),
							BlockNumber:     lo.Must(new(big.Int).SetString("17375953", 0)),
							TransactionHash: common.HexToHash("0xae8fa2b053cf69a80648622620dd84ce2d27c6ca092f6fe049a4712bbea1a205"),
							Index:           89,
							Removed:         false,
						}, {
							Address: common.HexToAddress("0x9e966733e3E9BFA56aF95f762921859417cF6FaA"),
							Topics: []common.Hash{
								common.HexToHash("0xc7d9de0aecd8d5829d96dfdb22c26b4625da22c5098c557e8b034a58015f189a"),
								common.HexToHash("0x000000000000000000000000e1f192ccfcac3870d8afce67fa4ac756a51184a8"),
								common.HexToHash("0xa7c30d79bac38383b63cf527b2a68c8a7efff3ba22dfd5b81d98030643ef0fca"),
							},
							Data:            hexutil.MustDecode("0x000000000000000000000000000000000000000000000000000000006476b3af"),
							BlockNumber:     lo.Must(new(big.Int).SetString("17375953", 0)),
							TransactionHash: common.HexToHash("0xae8fa2b053cf69a80648622620dd84ce2d27c6ca092f6fe049a4712bbea1a205"),
							Index:           90,
							Removed:         false,
						}, {
							Address: common.HexToAddress("0x9e966733e3E9BFA56aF95f762921859417cF6FaA"),
							Topics: []common.Hash{
								common.HexToHash("0xc7d9de0aecd8d5829d96dfdb22c26b4625da22c5098c557e8b034a58015f189a"),
								common.HexToHash("0x0000000000000000000000007b5e1f914d4665eb7e30a48f3717fe936a961306"),
								common.HexToHash("0xa7c30d79bac38383b63cf527b2a68c8a7efff3ba22dfd5b81d98030643ef0fca"),
							},
							Data:            hexutil.MustDecode("0x000000000000000000000000000000000000000000000000000000006476b3af"),
							BlockNumber:     lo.Must(new(big.Int).SetString("17375953", 0)),
							TransactionHash: common.HexToHash("0xae8fa2b053cf69a80648622620dd84ce2d27c6ca092f6fe049a4712bbea1a205"),
							Index:           91,
							Removed:         false,
						}, {
							Address: common.HexToAddress("0x3bDC69C4E5e13E52A65f5583c23EFB9636b469d6"),
							Topics: []common.Hash{
								common.HexToHash("0xfc06bd2dc22238bad571c0432cfc04aee3d074be8cd974c9a9151e99df57e72b"),
								common.HexToHash("0xd76aaac3ecd5ced13bbab3b240a426352f76a6fffd583c3b15f4ddae2b754e4e"),
							},
							Data:            hexutil.MustDecode("0x0000000000000000000000000000000000000000000000050aa25f43cf540000000000000000000000000000000000000000000000000000000000006476b3af"),
							BlockNumber:     lo.Must(new(big.Int).SetString("17375953", 0)),
							TransactionHash: common.HexToHash("0xae8fa2b053cf69a80648622620dd84ce2d27c6ca092f6fe049a4712bbea1a205"),
							Index:           92,
							Removed:         false,
						}, {
							Address: common.HexToAddress("0x42fD4e038A2c36BF72824D321021D08a69E4b434"),
							Topics: []common.Hash{
								common.HexToHash("0x26725881c2a4290b02cd153d6599fd484f0d4e6062c361e740fbbe39e7ad6142"),
								common.HexToHash("0x0000000000000000000000000000000000000000000000000000000000000001"),
							},
							Data:            hexutil.MustDecode("0x000000000000000000000000000000000000000000000000000000006476b3af"),
							BlockNumber:     lo.Must(new(big.Int).SetString("17375953", 0)),
							TransactionHash: common.HexToHash("0xae8fa2b053cf69a80648622620dd84ce2d27c6ca092f6fe049a4712bbea1a205"),
							Index:           93,
							Removed:         false,
						}, {
							Address: common.HexToAddress("0x42fD4e038A2c36BF72824D321021D08a69E4b434"),
							Topics: []common.Hash{
								common.HexToHash("0xef51b4c870b8b0100eae2072e91db01222a303072af3728e58c9d4d2da33127f"),
								common.HexToHash("0x000000000000000000000000dd3f50f8a6cafbe9b31a427582963f465e745af8"),
							},
							Data:            hexutil.MustDecode("0x000000000000000000000000000000000000000000000001ae361fc1451c0000000000000000000000000000000000000000000000000000000000006476b3af"),
							BlockNumber:     lo.Must(new(big.Int).SetString("17375953", 0)),
							TransactionHash: common.HexToHash("0xae8fa2b053cf69a80648622620dd84ce2d27c6ca092f6fe049a4712bbea1a205"),
							Index:           94,
							Removed:         false,
						}, {
							Address: common.HexToAddress("0xDD3f50F8A6CafbE9b31a427582963f465E745AF8"),
							Topics: []common.Hash{
								common.HexToHash("0xa1811054b7d96716259cff0d366c2f6405951e0efe00c8db3e237cbf77fe7be9"),
								common.HexToHash("0x00000000000000000000000042fd4e038a2c36bf72824d321021d08a69e4b434"),
							},
							Data:            hexutil.MustDecode("0x000000000000000000000000000000000000000000000001ae361fc1451c0000000000000000000000000000000000000000000000000000000000006476b3af"),
							BlockNumber:     lo.Must(new(big.Int).SetString("17375953", 0)),
							TransactionHash: common.HexToHash("0xae8fa2b053cf69a80648622620dd84ce2d27c6ca092f6fe049a4712bbea1a205"),
							Index:           95,
							Removed:         false,
						}, {
							Address: common.HexToAddress("0xe1F192CCfCAc3870D8aFCE67Fa4aC756a51184a8"),
							Topics: []common.Hash{
								common.HexToHash("0x26725881c2a4290b02cd153d6599fd484f0d4e6062c361e740fbbe39e7ad6142"),
								common.HexToHash("0x0000000000000000000000000000000000000000000000000000000000000001"),
							},
							Data:            hexutil.MustDecode("0x000000000000000000000000000000000000000000000000000000006476b3af"),
							BlockNumber:     lo.Must(new(big.Int).SetString("17375953", 0)),
							TransactionHash: common.HexToHash("0xae8fa2b053cf69a80648622620dd84ce2d27c6ca092f6fe049a4712bbea1a205"),
							Index:           96,
							Removed:         false,
						}, {
							Address: common.HexToAddress("0xe1F192CCfCAc3870D8aFCE67Fa4aC756a51184a8"),
							Topics: []common.Hash{
								common.HexToHash("0xef51b4c870b8b0100eae2072e91db01222a303072af3728e58c9d4d2da33127f"),
								common.HexToHash("0x000000000000000000000000dd3f50f8a6cafbe9b31a427582963f465e745af8"),
							},
							Data:            hexutil.MustDecode("0x000000000000000000000000000000000000000000000001ae361fc1451c0000000000000000000000000000000000000000000000000000000000006476b3af"),
							BlockNumber:     lo.Must(new(big.Int).SetString("17375953", 0)),
							TransactionHash: common.HexToHash("0xae8fa2b053cf69a80648622620dd84ce2d27c6ca092f6fe049a4712bbea1a205"),
							Index:           97,
							Removed:         false,
						}, {
							Address: common.HexToAddress("0xDD3f50F8A6CafbE9b31a427582963f465E745AF8"),
							Topics: []common.Hash{
								common.HexToHash("0xa1811054b7d96716259cff0d366c2f6405951e0efe00c8db3e237cbf77fe7be9"),
								common.HexToHash("0x000000000000000000000000e1f192ccfcac3870d8afce67fa4ac756a51184a8"),
							},
							Data:            hexutil.MustDecode("0x000000000000000000000000000000000000000000000001ae361fc1451c0000000000000000000000000000000000000000000000000000000000006476b3af"),
							BlockNumber:     lo.Must(new(big.Int).SetString("17375953", 0)),
							TransactionHash: common.HexToHash("0xae8fa2b053cf69a80648622620dd84ce2d27c6ca092f6fe049a4712bbea1a205"),
							Index:           98,
							Removed:         false,
						}, {
							Address: common.HexToAddress("0x7B5e1F914D4665Eb7E30A48f3717fE936A961306"),
							Topics: []common.Hash{
								common.HexToHash("0x26725881c2a4290b02cd153d6599fd484f0d4e6062c361e740fbbe39e7ad6142"),
								common.HexToHash("0x0000000000000000000000000000000000000000000000000000000000000001"),
							},
							Data:            hexutil.MustDecode("0x000000000000000000000000000000000000000000000000000000006476b3af"),
							BlockNumber:     lo.Must(new(big.Int).SetString("17375953", 0)),
							TransactionHash: common.HexToHash("0xae8fa2b053cf69a80648622620dd84ce2d27c6ca092f6fe049a4712bbea1a205"),
							Index:           99,
							Removed:         false,
						}, {
							Address: common.HexToAddress("0x7B5e1F914D4665Eb7E30A48f3717fE936A961306"),
							Topics: []common.Hash{
								common.HexToHash("0xef51b4c870b8b0100eae2072e91db01222a303072af3728e58c9d4d2da33127f"),
								common.HexToHash("0x000000000000000000000000dd3f50f8a6cafbe9b31a427582963f465e745af8"),
							},
							Data:            hexutil.MustDecode("0x000000000000000000000000000000000000000000000001ae361fc1451c0000000000000000000000000000000000000000000000000000000000006476b3af"),
							BlockNumber:     lo.Must(new(big.Int).SetString("17375953", 0)),
							TransactionHash: common.HexToHash("0xae8fa2b053cf69a80648622620dd84ce2d27c6ca092f6fe049a4712bbea1a205"),
							Index:           100,
							Removed:         false,
						}, {
							Address: common.HexToAddress("0xDD3f50F8A6CafbE9b31a427582963f465E745AF8"),
							Topics: []common.Hash{
								common.HexToHash("0xa1811054b7d96716259cff0d366c2f6405951e0efe00c8db3e237cbf77fe7be9"),
								common.HexToHash("0x0000000000000000000000007b5e1f914d4665eb7e30a48f3717fe936a961306"),
							},
							Data:            hexutil.MustDecode("0x000000000000000000000000000000000000000000000001ae361fc1451c0000000000000000000000000000000000000000000000000000000000006476b3af"),
							BlockNumber:     lo.Must(new(big.Int).SetString("17375953", 0)),
							TransactionHash: common.HexToHash("0xae8fa2b053cf69a80648622620dd84ce2d27c6ca092f6fe049a4712bbea1a205"),
							Index:           101,
							Removed:         false,
						}, {
							Address: common.HexToAddress("0xae78736Cd615f374D3085123A210448E74Fc6393"),
							Topics: []common.Hash{
								common.HexToHash("0xddf252ad1be2c89b69c2b068fc378daa952ba7f163c4a11628f55a4df523b3ef"),
								common.HexToHash("0x0000000000000000000000001136b25047e142fa3018184793aec68fbb173ce4"),
								common.HexToHash("0x0000000000000000000000001111111254fb6c44bac0bed2854e76f90643097d"),
							},
							Data:            hexutil.MustDecode("0x00000000000000000000000000000000000000000000000204b365c22005dd99"),
							BlockNumber:     lo.Must(new(big.Int).SetString("17375953", 0)),
							TransactionHash: common.HexToHash("0xae8fa2b053cf69a80648622620dd84ce2d27c6ca092f6fe049a4712bbea1a205"),
							Index:           102,
							Removed:         false,
						}, {
							Address: common.HexToAddress("0xae78736Cd615f374D3085123A210448E74Fc6393"),
							Topics: []common.Hash{
								common.HexToHash("0xddf252ad1be2c89b69c2b068fc378daa952ba7f163c4a11628f55a4df523b3ef"),
								common.HexToHash("0x0000000000000000000000001111111254fb6c44bac0bed2854e76f90643097d"),
								common.HexToHash("0x00000000000000000000000009c149843fd6a6085e1e677f744314ab9ec768cb"),
							},
							Data:            hexutil.MustDecode("0x00000000000000000000000000000000000000000000000204b365c22005dd99"),
							BlockNumber:     lo.Must(new(big.Int).SetString("17375953", 0)),
							TransactionHash: common.HexToHash("0xae8fa2b053cf69a80648622620dd84ce2d27c6ca092f6fe049a4712bbea1a205"),
							Index:           103,
							Removed:         false,
						}},
						Status:           1,
						TransactionHash:  common.HexToHash("0xae8fa2b053cf69a80648622620dd84ce2d27c6ca092f6fe049a4712bbea1a205"),
						TransactionIndex: 28,
					},
				},
				config: &config.Module{
					Network:  filter.NetworkEthereum,
					Endpoint: endpoint.MustGet(filter.NetworkEthereum),
				},
			},
			want: &schema.Feed{
				ID:      "0xae8fa2b053cf69a80648622620dd84ce2d27c6ca092f6fe049a4712bbea1a205",
				Network: filter.NetworkEthereum,
				Index:   28,
				From:    "0x09c149843fd6a6085e1E677f744314ab9eC768Cb",
				To:      oneinch.AddressAggregationRouterV4.String(),
				Type:    filter.TypeExchangeSwap,
				Calldata: &schema.Calldata{
					FunctionHash: "0x7c025200",
				},
				Platform: lo.ToPtr(filter.Platform1inch),
				Fee: &schema.Fee{
					Amount:  lo.Must(decimal.NewFromString("20429607000000000")),
					Decimal: 18,
				},
				Actions: []*schema.Action{
					{
						Type:     filter.TypeExchangeSwap,
						Tag:      filter.TagExchange,
						Platform: filter.Platform1inch.String(),
						From:     "0x09c149843fd6a6085e1E677f744314ab9eC768Cb",
						To:       "0x09c149843fd6a6085e1E677f744314ab9eC768Cb",
						Metadata: metadata.ExchangeSwap{
							From: metadata.Token{
								Value:    lo.ToPtr(lo.Must(decimal.NewFromString("39950000000000000000"))),
								Name:     "Ethereum",
								Symbol:   "ETH",
								Decimals: 18,
							},
							To: metadata.Token{
								Address:  lo.ToPtr("0xae78736Cd615f374D3085123A210448E74Fc6393"),
								Value:    lo.ToPtr(lo.Must(decimal.NewFromString("37232214428837338521"))),
								Name:     "Rocket Pool ETH",
								Symbol:   "rETH",
								Decimals: 18,
								Standard: metadata.StandardERC20,
							},
						},
					},
				},
				Status:    true,
				Timestamp: 1685500847,
			},
			wantError: require.NoError,
		},
		{
			name: "Swap ETH for wstETH on AggregationRouter V5",
			arguments: arguments{
				task: &source.Task{
					Network: filter.NetworkEthereum,
					ChainID: 1,
					Header: &ethereum.Header{
						Hash:         common.HexToHash("0xad31e0790a34689160fb8d6c930375e1ed47197b616df3ea8feda4a4d14822fc"),
						ParentHash:   common.HexToHash("0x792517a5ba887f6f82700291d3a74703152b52d63ae37742eb23922540eda2bd"),
						UncleHash:    common.HexToHash("0x1dcc4de8dec75d7aab85b567b6ccd41ad312451b948a7413f0a142fd40d49347"),
						Coinbase:     common.HexToAddress("0x1f9090aaE28b8a3dCeaDf281B0F12828e676c326"),
						Number:       lo.Must(new(big.Int).SetString("17376411", 0)),
						GasLimit:     30000000,
						GasUsed:      28352097,
						Timestamp:    1685506403,
						BaseFee:      lo.Must(new(big.Int).SetString("24421320987", 0)),
						Transactions: nil,
					},
					Transaction: &ethereum.Transaction{
						BlockHash: common.HexToHash("0x8e02caa4b60532be5c37bb10bf83a80921a30dfd37093cb44e6cf2f6080aa5e6"),
						From:      common.HexToAddress("0xd0B8DfCF9dA999db981A60a8DA6584E8e52b757c"),
						Gas:       267265,
						GasPrice:  lo.Must(new(big.Int).SetString("24521320987", 10)),
						Hash:      common.HexToHash("0x8e02caa4b60532be5c37bb10bf83a80921a30dfd37093cb44e6cf2f6080aa5e6"),
						Input:     hexutil.MustDecode("0x12aa3caf0000000000000000000000001136b25047e142fa3018184793aec68fbb173ce4000000000000000000000000eeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeee0000000000000000000000007f39c581f595b53c5cb19bd0b3f8da6c935e2ca00000000000000000000000001136b25047e142fa3018184793aec68fbb173ce4000000000000000000000000d0b8dfcf9da999db981a60a8da6584e8e52b757c00000000000000000000000000000000000000000000002d460351bf6412670b0000000000000000000000000000000000000000000000282baa1c82a9d7167d0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000014000000000000000000000000000000000000000000000000000000000000001600000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000015e0000000000000000000000000000000000000000000001400001120000c800a007e5c0d20000000000000000000000000000000000000000000000a400005400003a4060ae7ab96520de3a18e5e111b5eaab095312d7fe84a1903eab000000000000000000000000910bf2d50fa5e014fd06666f456182d4ab7c8bd20020d6bdbf78ae7ab96520de3a18e5e111b5eaab095312d7fe8451207f39c581f595b53c5cb19bd0b3f8da6c935e2ca0ae7ab96520de3a18e5e111b5eaab095312d7fe840004ea598cb0000000000000000000000000000000000000000000000000000000000000000000a0f2fa6b667f39c581f595b53c5cb19bd0b3f8da6c935e2ca000000000000000000000000000000000000000000000002830cf1433544014740000000000000000000d50900b63387d80a06c4eca277f39c581f595b53c5cb19bd0b3f8da6c935e2ca01111111254eeb25477b68fb85ed929f73a9605820000e26b9977"),
						To:        lo.ToPtr(common.HexToAddress("0x1111111254EEB25477B68fb85Ed929f73A960582")),
						Value:     lo.Must(new(big.Int).SetString("835148449206974441227", 0)),
						Type:      2,
						ChainID:   lo.Must(new(big.Int).SetString("1", 0)),
					},
					Receipt: &ethereum.Receipt{
						BlockHash:         common.HexToHash("0xad31e0790a34689160fb8d6c930375e1ed47197b616df3ea8feda4a4d14822fc"),
						BlockNumber:       lo.Must(new(big.Int).SetString("17376411", 0)),
						ContractAddress:   nil,
						CumulativeGasUsed: 22240598,
						EffectiveGasPrice: hexutil.MustDecodeBig("0x5b595aa1b"),
						GasUsed:           206833,

						Logs: []*ethereum.Log{{
							Address: common.HexToAddress("0xae7ab96520DE3A18E5e111B5EaAb095312D7fE84"),
							Topics: []common.Hash{
								common.HexToHash("0x96a25c8ce0baabc1fdefd93e9ed25d8e092a3332f3aa9a41722b5697231d1d1a"),
								common.HexToHash("0x0000000000000000000000001136b25047e142fa3018184793aec68fbb173ce4"),
							},
							Data:            hexutil.MustDecode("0x00000000000000000000000000000000000000000000002d460351bf6412670b000000000000000000000000910bf2d50fa5e014fd06666f456182d4ab7c8bd2"),
							BlockNumber:     lo.Must(new(big.Int).SetString("17376411", 0)),
							TransactionHash: common.HexToHash("0x8e02caa4b60532be5c37bb10bf83a80921a30dfd37093cb44e6cf2f6080aa5e6"),
							Index:           425,
							Removed:         false,
						}, {
							Address: common.HexToAddress("0xae7ab96520DE3A18E5e111B5EaAb095312D7fE84"),
							Topics: []common.Hash{
								common.HexToHash("0xddf252ad1be2c89b69c2b068fc378daa952ba7f163c4a11628f55a4df523b3ef"),
								common.HexToHash("0x0000000000000000000000000000000000000000000000000000000000000000"),
								common.HexToHash("0x0000000000000000000000001136b25047e142fa3018184793aec68fbb173ce4"),
							},
							Data:            hexutil.MustDecode("0x00000000000000000000000000000000000000000000002d460351bf6412670a"),
							BlockNumber:     lo.Must(new(big.Int).SetString("17376411", 0)),
							TransactionHash: common.HexToHash("0x8e02caa4b60532be5c37bb10bf83a80921a30dfd37093cb44e6cf2f6080aa5e6"),
							Index:           426,
							Removed:         false,
						}, {
							Address: common.HexToAddress("0xae7ab96520DE3A18E5e111B5EaAb095312D7fE84"),
							Topics: []common.Hash{
								common.HexToHash("0x9d9c909296d9c674451c0c24f02cb64981eb3b727f99865939192f880a755dcb"),
								common.HexToHash("0x0000000000000000000000000000000000000000000000000000000000000000"),
								common.HexToHash("0x0000000000000000000000001136b25047e142fa3018184793aec68fbb173ce4"),
							},
							Data:            hexutil.MustDecode("0x00000000000000000000000000000000000000000000002830cf143354401475"),
							BlockNumber:     lo.Must(new(big.Int).SetString("17376411", 0)),
							TransactionHash: common.HexToHash("0x8e02caa4b60532be5c37bb10bf83a80921a30dfd37093cb44e6cf2f6080aa5e6"),
							Index:           427,
							Removed:         false,
						}, {
							Address: common.HexToAddress("0xae7ab96520DE3A18E5e111B5EaAb095312D7fE84"),
							Topics: []common.Hash{
								common.HexToHash("0x8c5be1e5ebec7d5bd14f71427d1e84f3dd0314c0f7b2291e5b200ac8c7c3b925"),
								common.HexToHash("0x0000000000000000000000001136b25047e142fa3018184793aec68fbb173ce4"),
								common.HexToHash("0x0000000000000000000000007f39c581f595b53c5cb19bd0b3f8da6c935e2ca0"),
							},
							Data:            hexutil.MustDecode("0x00000000000000000000000000000000000000000000002d460351bf6412670c"),
							BlockNumber:     lo.Must(new(big.Int).SetString("17376411", 0)),
							TransactionHash: common.HexToHash("0x8e02caa4b60532be5c37bb10bf83a80921a30dfd37093cb44e6cf2f6080aa5e6"),
							Index:           428,
							Removed:         false,
						}, {
							Address: common.HexToAddress("0x7f39C581F595B53c5cb19bD0b3f8dA6c935E2Ca0"),
							Topics: []common.Hash{
								common.HexToHash("0xddf252ad1be2c89b69c2b068fc378daa952ba7f163c4a11628f55a4df523b3ef"),
								common.HexToHash("0x0000000000000000000000000000000000000000000000000000000000000000"),
								common.HexToHash("0x0000000000000000000000001136b25047e142fa3018184793aec68fbb173ce4"),
							},
							Data:            hexutil.MustDecode("0x00000000000000000000000000000000000000000000002830cf143354401476"),
							BlockNumber:     lo.Must(new(big.Int).SetString("17376411", 0)),
							TransactionHash: common.HexToHash("0x8e02caa4b60532be5c37bb10bf83a80921a30dfd37093cb44e6cf2f6080aa5e6"),
							Index:           429,
							Removed:         false,
						}, {
							Address: common.HexToAddress("0xae7ab96520DE3A18E5e111B5EaAb095312D7fE84"),
							Topics: []common.Hash{
								common.HexToHash("0x8c5be1e5ebec7d5bd14f71427d1e84f3dd0314c0f7b2291e5b200ac8c7c3b925"),
								common.HexToHash("0x0000000000000000000000001136b25047e142fa3018184793aec68fbb173ce4"),
								common.HexToHash("0x0000000000000000000000007f39c581f595b53c5cb19bd0b3f8da6c935e2ca0"),
							},
							Data:            hexutil.MustDecode("0x0000000000000000000000000000000000000000000000000000000000000000"),
							BlockNumber:     lo.Must(new(big.Int).SetString("17376411", 0)),
							TransactionHash: common.HexToHash("0x8e02caa4b60532be5c37bb10bf83a80921a30dfd37093cb44e6cf2f6080aa5e6"),
							Index:           430,
							Removed:         false,
						}, {
							Address: common.HexToAddress("0xae7ab96520DE3A18E5e111B5EaAb095312D7fE84"),
							Topics: []common.Hash{
								common.HexToHash("0xddf252ad1be2c89b69c2b068fc378daa952ba7f163c4a11628f55a4df523b3ef"),
								common.HexToHash("0x0000000000000000000000001136b25047e142fa3018184793aec68fbb173ce4"),
								common.HexToHash("0x0000000000000000000000007f39c581f595b53c5cb19bd0b3f8da6c935e2ca0"),
							},
							Data:            hexutil.MustDecode("0x00000000000000000000000000000000000000000000002d460351bf6412670c"),
							BlockNumber:     lo.Must(new(big.Int).SetString("17376411", 0)),
							TransactionHash: common.HexToHash("0x8e02caa4b60532be5c37bb10bf83a80921a30dfd37093cb44e6cf2f6080aa5e6"),
							Index:           431,
							Removed:         false,
						}, {
							Address: common.HexToAddress("0xae7ab96520DE3A18E5e111B5EaAb095312D7fE84"),
							Topics: []common.Hash{
								common.HexToHash("0x9d9c909296d9c674451c0c24f02cb64981eb3b727f99865939192f880a755dcb"),
								common.HexToHash("0x0000000000000000000000001136b25047e142fa3018184793aec68fbb173ce4"),
								common.HexToHash("0x0000000000000000000000007f39c581f595b53c5cb19bd0b3f8da6c935e2ca0"),
							},
							Data:            hexutil.MustDecode("0x00000000000000000000000000000000000000000000002830cf143354401476"),
							BlockNumber:     lo.Must(new(big.Int).SetString("17376411", 0)),
							TransactionHash: common.HexToHash("0x8e02caa4b60532be5c37bb10bf83a80921a30dfd37093cb44e6cf2f6080aa5e6"),
							Index:           432,
							Removed:         false,
						}, {
							Address: common.HexToAddress("0x7f39C581F595B53c5cb19bD0b3f8dA6c935E2Ca0"),
							Topics: []common.Hash{
								common.HexToHash("0xddf252ad1be2c89b69c2b068fc378daa952ba7f163c4a11628f55a4df523b3ef"),
								common.HexToHash("0x0000000000000000000000001136b25047e142fa3018184793aec68fbb173ce4"),
								common.HexToHash("0x0000000000000000000000001111111254eeb25477b68fb85ed929f73a960582"),
							},
							Data:            hexutil.MustDecode("0x00000000000000000000000000000000000000000000002830cf143354401476"),
							BlockNumber:     lo.Must(new(big.Int).SetString("17376411", 0)),
							TransactionHash: common.HexToHash("0x8e02caa4b60532be5c37bb10bf83a80921a30dfd37093cb44e6cf2f6080aa5e6"),
							Index:           433,
							Removed:         false,
						}, {
							Address: common.HexToAddress("0x7f39C581F595B53c5cb19bD0b3f8dA6c935E2Ca0"),
							Topics: []common.Hash{
								common.HexToHash("0xddf252ad1be2c89b69c2b068fc378daa952ba7f163c4a11628f55a4df523b3ef"),
								common.HexToHash("0x0000000000000000000000001111111254eeb25477b68fb85ed929f73a960582"),
								common.HexToHash("0x000000000000000000000000d0b8dfcf9da999db981a60a8da6584e8e52b757c"),
							},
							Data:            hexutil.MustDecode("0x00000000000000000000000000000000000000000000002830cf143354401476"),
							BlockNumber:     lo.Must(new(big.Int).SetString("17376411", 0)),
							TransactionHash: common.HexToHash("0x8e02caa4b60532be5c37bb10bf83a80921a30dfd37093cb44e6cf2f6080aa5e6"),
							Index:           434,
							Removed:         false,
						}},
						Status:           1,
						TransactionHash:  common.HexToHash("0x8e02caa4b60532be5c37bb10bf83a80921a30dfd37093cb44e6cf2f6080aa5e6"),
						TransactionIndex: 220,
					},
				},
				config: &config.Module{
					Network:  filter.NetworkEthereum,
					Endpoint: endpoint.MustGet(filter.NetworkEthereum),
				},
			},
			want: &schema.Feed{
				ID:      "0x8e02caa4b60532be5c37bb10bf83a80921a30dfd37093cb44e6cf2f6080aa5e6",
				Network: filter.NetworkEthereum,
				Index:   220,
				From:    "0xd0B8DfCF9dA999db981A60a8DA6584E8e52b757c",
				To:      oneinch.AddressAggregationRouterV5.String(),
				Type:    filter.TypeExchangeSwap,
				Calldata: &schema.Calldata{
					FunctionHash: "0x12aa3caf",
				},
				Platform: lo.ToPtr(filter.Platform1inch),
				Fee: &schema.Fee{
					Amount:  lo.Must(decimal.NewFromString("5071818383704171")),
					Decimal: 18,
				},
				Actions: []*schema.Action{
					{
						Type:     filter.TypeExchangeSwap,
						Tag:      filter.TagExchange,
						Platform: filter.Platform1inch.String(),
						From:     "0xd0B8DfCF9dA999db981A60a8DA6584E8e52b757c",
						To:       "0xd0B8DfCF9dA999db981A60a8DA6584E8e52b757c",
						Metadata: metadata.ExchangeSwap{
							From: metadata.Token{
								Value:    lo.ToPtr(lo.Must(decimal.NewFromString("835148449206974441227"))),
								Name:     "Ethereum",
								Symbol:   "ETH",
								Decimals: 18,
							},
							To: metadata.Token{
								Address:  lo.ToPtr("0x7f39C581F595B53c5cb19bD0b3f8dA6c935E2Ca0"),
								Value:    lo.ToPtr(lo.Must(decimal.NewFromString("741386814993071084662"))),
								Name:     "Wrapped liquid staked Ether 2.0",
								Symbol:   "wstETH",
								Decimals: 18,
								Standard: metadata.StandardERC20,
							},
						},
					},
				},
				Status:    true,
				Timestamp: 1685506403,
			},
			wantError: require.NoError,
		},
		{
			name: "Swap ETH for DAI by fillOrderRFQ on AggregationRouter V4",
			arguments: arguments{
				task: &source.Task{
					Network: filter.NetworkEthereum,
					ChainID: 1,
					Header: &ethereum.Header{
						Hash:         common.HexToHash("0x03500821735c98cec34ba125200189a1ca3bd6746cb6431dbba5db3b935fecfc"),
						ParentHash:   common.HexToHash("0x5d854c6c2ae8b32be9288107a751e80321eacb31092d184e48058030f3ffeb3b"),
						UncleHash:    common.HexToHash("0x1dcc4de8dec75d7aab85b567b6ccd41ad312451b948a7413f0a142fd40d49347"),
						Coinbase:     common.HexToAddress("0xEA674fdDe714fd979de3EdF0F56AA9716B898ec8"),
						Number:       lo.Must(new(big.Int).SetString("15086953", 0)),
						GasLimit:     30029295,
						GasUsed:      30025539,
						Timestamp:    1657083662,
						BaseFee:      lo.Must(new(big.Int).SetString("15881592452", 0)),
						Transactions: nil,
					},
					Transaction: &ethereum.Transaction{
						BlockHash: common.HexToHash("0xbd163f0df1e70293e3b8912fd5511ef0df143ea39dc827c85a1a26c6ede12756"),
						From:      common.HexToAddress("0x6Db2acbA03f08897D6286358632126ddF81d7597"),
						Gas:       146200,
						GasPrice:  lo.Must(new(big.Int).SetString("18881592452", 10)),
						Hash:      common.HexToHash("0xbd163f0df1e70293e3b8912fd5511ef0df143ea39dc827c85a1a26c6ede12756"),
						Input:     hexutil.MustDecode("0xd0a3b665800000000000000000000000000000000000000062c51796000000000007d38b0000000000000000000000006b175474e89094c44da98b954eedeac495271d0f000000000000000000000000c02aaa39b223fe8d0a0e5c4f27ead9083c756cc2000000000000000000000000b3c839dbde6b96d37c56ee4f9dad3390d49310aa00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000005dfe65272531b0000000000000000000000000000000000000000000000000000015566cd885600000000000000000000000000000000000000000000000000000000000000001400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001550f7dca7000000000000000000000000000000000000000000000000000000000000000000451cde90aadbec9d813b54efb5cb90901c33a8477a6f528200270974faf430b522071768a9b389ecb84a0777f40cde92bb4037e839be3d8685e72a5133476b3e834d62c5171e000000000000000000000000000000000000000000000000000000e26b9977"),
						To:        lo.ToPtr(common.HexToAddress("0x1111111254fb6c44bAC0beD2854e76F90643097d")),
						Value:     lo.Must(new(big.Int).SetString("6000000000000000", 0)),
						Type:      2,
						ChainID:   lo.Must(new(big.Int).SetString("1", 0)),
					},
					Receipt: &ethereum.Receipt{
						BlockHash:         common.HexToHash("0x03500821735c98cec34ba125200189a1ca3bd6746cb6431dbba5db3b935fecfc"),
						BlockNumber:       lo.Must(new(big.Int).SetString("15086953", 0)),
						ContractAddress:   nil,
						CumulativeGasUsed: 3329335,
						EffectiveGasPrice: hexutil.MustDecodeBig("0x4656e3c84"),
						GasUsed:           96364,

						Logs: []*ethereum.Log{{
							Address: common.HexToAddress("0x6B175474E89094C44Da98b954EedeAC495271d0F"),
							Topics: []common.Hash{
								common.HexToHash("0xddf252ad1be2c89b69c2b068fc378daa952ba7f163c4a11628f55a4df523b3ef"),
								common.HexToHash("0x000000000000000000000000b3c839dbde6b96d37c56ee4f9dad3390d49310aa"),
								common.HexToHash("0x0000000000000000000000006db2acba03f08897d6286358632126ddf81d7597"),
							},
							Data:            hexutil.MustDecode("0x0000000000000000000000000000000000000000000000005de65b5565594739"),
							BlockNumber:     lo.Must(new(big.Int).SetString("15086953", 0)),
							TransactionHash: common.HexToHash("0xbd163f0df1e70293e3b8912fd5511ef0df143ea39dc827c85a1a26c6ede12756"),
							Index:           75,
							Removed:         false,
						}, {
							Address: common.HexToAddress("0xC02aaA39b223FE8D0A0e5C4F27eAD9083C756Cc2"),
							Topics: []common.Hash{
								common.HexToHash("0xe1fffcc4923d04b559f4d29a8bfc6cda04eb5b0d3c460751c2402c5c5cc9109c"),
								common.HexToHash("0x0000000000000000000000001111111254fb6c44bac0bed2854e76f90643097d"),
							},
							Data:            hexutil.MustDecode("0x000000000000000000000000000000000000000000000000001550f7dca70000"),
							BlockNumber:     lo.Must(new(big.Int).SetString("15086953", 0)),
							TransactionHash: common.HexToHash("0xbd163f0df1e70293e3b8912fd5511ef0df143ea39dc827c85a1a26c6ede12756"),
							Index:           76,
							Removed:         false,
						}, {
							Address: common.HexToAddress("0xC02aaA39b223FE8D0A0e5C4F27eAD9083C756Cc2"),
							Topics: []common.Hash{
								common.HexToHash("0xddf252ad1be2c89b69c2b068fc378daa952ba7f163c4a11628f55a4df523b3ef"),
								common.HexToHash("0x0000000000000000000000001111111254fb6c44bac0bed2854e76f90643097d"),
								common.HexToHash("0x000000000000000000000000b3c839dbde6b96d37c56ee4f9dad3390d49310aa"),
							},
							Data:            hexutil.MustDecode("0x000000000000000000000000000000000000000000000000001550f7dca70000"),
							BlockNumber:     lo.Must(new(big.Int).SetString("15086953", 0)),
							TransactionHash: common.HexToHash("0xbd163f0df1e70293e3b8912fd5511ef0df143ea39dc827c85a1a26c6ede12756"),
							Index:           77,
							Removed:         false,
						}, {
							Address: common.HexToAddress("0x1111111254fb6c44bAC0beD2854e76F90643097d"),
							Topics: []common.Hash{
								common.HexToHash("0xc3b639f02b125bfa160e50739b8c44eb2d1b6908e2b6d5925c6d770f2ca78127"),
							},
							Data:            hexutil.MustDecode("0x4ee81701011ff359ee7e7e37f072bbda3ff434d5d9b742ae21ef9b5681eb73500000000000000000000000000000000000000000000000005de65b5565594739"),
							BlockNumber:     lo.Must(new(big.Int).SetString("15086953", 0)),
							TransactionHash: common.HexToHash("0xbd163f0df1e70293e3b8912fd5511ef0df143ea39dc827c85a1a26c6ede12756"),
							Index:           78,
							Removed:         false,
						}},
						Status:           1,
						TransactionHash:  common.HexToHash("0xbd163f0df1e70293e3b8912fd5511ef0df143ea39dc827c85a1a26c6ede12756"),
						TransactionIndex: 62,
					},
				},
				config: &config.Module{
					Network:  filter.NetworkEthereum,
					Endpoint: endpoint.MustGet(filter.NetworkEthereum),
				},
			},
			want: &schema.Feed{
				ID:      "0xbd163f0df1e70293e3b8912fd5511ef0df143ea39dc827c85a1a26c6ede12756",
				Network: filter.NetworkEthereum,
				Index:   62,
				From:    "0x6Db2acbA03f08897D6286358632126ddF81d7597",
				To:      oneinch.AddressAggregationRouterV4.String(),
				Type:    filter.TypeExchangeSwap,
				Calldata: &schema.Calldata{
					FunctionHash: "0xd0a3b665",
				},
				Platform: lo.ToPtr(filter.Platform1inch),
				Fee: &schema.Fee{
					Amount:  lo.Must(decimal.NewFromString("1819505775044528")),
					Decimal: 18,
				},
				Actions: []*schema.Action{
					{
						Type:     filter.TypeExchangeSwap,
						Tag:      filter.TagExchange,
						Platform: filter.Platform1inch.String(),
						From:     "0x6Db2acbA03f08897D6286358632126ddF81d7597",
						To:       "0x6Db2acbA03f08897D6286358632126ddF81d7597",
						Metadata: metadata.ExchangeSwap{
							From: metadata.Token{
								Value:    lo.ToPtr(lo.Must(decimal.NewFromString("6000000000000000"))),
								Name:     "Ethereum",
								Symbol:   "ETH",
								Decimals: 18,
							},
							To: metadata.Token{
								Address:  lo.ToPtr("0x6B175474E89094C44Da98b954EedeAC495271d0F"),
								Value:    lo.ToPtr(lo.Must(decimal.NewFromString("6766195912501446457"))),
								Name:     "Dai Stablecoin",
								Symbol:   "DAI",
								Decimals: 18,
								Standard: metadata.StandardERC20,
							},
						},
					},
				},
				Status:    true,
				Timestamp: 1657083662,
			},
			wantError: require.NoError,
		},
		{
			name: "Swap ETH for MKR by unoswap on AggregationRouter V4",
			arguments: arguments{
				task: &source.Task{
					Network: filter.NetworkEthereum,
					ChainID: 1,
					Header: &ethereum.Header{
						Hash:         common.HexToHash("0xfc8ddcb9fc28829a1842c37b94b59eadf8571e2013f3e4f7f2ee5d5dbd726d17"),
						ParentHash:   common.HexToHash("0x5bbfd013d97eb6d47e92a417d52cc34b1b8aabe889b387ffdb20ca7c581b869d"),
						UncleHash:    common.HexToHash("0x1dcc4de8dec75d7aab85b567b6ccd41ad312451b948a7413f0a142fd40d49347"),
						Coinbase:     common.HexToAddress("0x95222290DD7278Aa3Ddd389Cc1E1d165CC4BAfe5"),
						Number:       lo.Must(new(big.Int).SetString("17739598", 0)),
						GasLimit:     30000000,
						GasUsed:      15336926,
						Timestamp:    1689919271,
						BaseFee:      lo.Must(new(big.Int).SetString("15450910104", 0)),
						Transactions: nil,
					},
					Transaction: &ethereum.Transaction{
						BlockHash: common.HexToHash("0x190e674289665eb553544d59d61db7d8ff87e656604178207bfba0cbcc501b3f"),
						From:      common.HexToAddress("0x44b184A0C56F926bA3634DAD905690b3438aed77"),
						Gas:       235304,
						GasPrice:  lo.Must(new(big.Int).SetString("15550910104", 10)),
						Hash:      common.HexToHash("0x190e674289665eb553544d59d61db7d8ff87e656604178207bfba0cbcc501b3f"),
						Input:     hexutil.MustDecode("0x2e95b6c800000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000186cc6acd4b00000000000000000000000000000000000000000000000000000282d0d9f22b1f360000000000000000000000000000000000000000000000000000000000000080000000000000000000000000000000000000000000000000000000000000000180000000000000003b6d0340ba13afecda9beb75de5c56bbaf696b880a5a50ddf012a792"),
						To:        lo.ToPtr(common.HexToAddress("0x1111111254fb6c44bAC0beD2854e76F90643097d")),
						Value:     lo.Must(new(big.Int).SetString("110000000000000000", 0)),
						Type:      2,
						ChainID:   lo.Must(new(big.Int).SetString("1", 0)),
					},
					Receipt: &ethereum.Receipt{
						BlockHash:         common.HexToHash("0xfc8ddcb9fc28829a1842c37b94b59eadf8571e2013f3e4f7f2ee5d5dbd726d17"),
						BlockNumber:       lo.Must(new(big.Int).SetString("17739598", 0)),
						ContractAddress:   nil,
						CumulativeGasUsed: 9935117,
						EffectiveGasPrice: hexutil.MustDecodeBig("0x39ee80e98"),
						GasUsed:           98885,

						Logs: []*ethereum.Log{{
							Address: common.HexToAddress("0xC02aaA39b223FE8D0A0e5C4F27eAD9083C756Cc2"),
							Topics: []common.Hash{
								common.HexToHash("0xe1fffcc4923d04b559f4d29a8bfc6cda04eb5b0d3c460751c2402c5c5cc9109c"),
								common.HexToHash("0x0000000000000000000000001111111254fb6c44bac0bed2854e76f90643097d"),
							},
							Data:            hexutil.MustDecode("0x0000000000000000000000000000000000000000000000000186cc6acd4b0000"),
							BlockNumber:     lo.Must(new(big.Int).SetString("17739598", 0)),
							TransactionHash: common.HexToHash("0x190e674289665eb553544d59d61db7d8ff87e656604178207bfba0cbcc501b3f"),
							Index:           259,
							Removed:         false,
						}, {
							Address: common.HexToAddress("0xC02aaA39b223FE8D0A0e5C4F27eAD9083C756Cc2"),
							Topics: []common.Hash{
								common.HexToHash("0xddf252ad1be2c89b69c2b068fc378daa952ba7f163c4a11628f55a4df523b3ef"),
								common.HexToHash("0x0000000000000000000000001111111254fb6c44bac0bed2854e76f90643097d"),
								common.HexToHash("0x000000000000000000000000ba13afecda9beb75de5c56bbaf696b880a5a50dd"),
							},
							Data:            hexutil.MustDecode("0x0000000000000000000000000000000000000000000000000186cc6acd4b0000"),
							BlockNumber:     lo.Must(new(big.Int).SetString("17739598", 0)),
							TransactionHash: common.HexToHash("0x190e674289665eb553544d59d61db7d8ff87e656604178207bfba0cbcc501b3f"),
							Index:           260,
							Removed:         false,
						}, {
							Address: common.HexToAddress("0x9f8F72aA9304c8B593d555F12eF6589cC3A579A2"),
							Topics: []common.Hash{
								common.HexToHash("0xddf252ad1be2c89b69c2b068fc378daa952ba7f163c4a11628f55a4df523b3ef"),
								common.HexToHash("0x000000000000000000000000ba13afecda9beb75de5c56bbaf696b880a5a50dd"),
								common.HexToHash("0x00000000000000000000000044b184a0c56f926ba3634dad905690b3438aed77"),
							},
							Data:            hexutil.MustDecode("0x00000000000000000000000000000000000000000000000002860bca514b7fda"),
							BlockNumber:     lo.Must(new(big.Int).SetString("17739598", 0)),
							TransactionHash: common.HexToHash("0x190e674289665eb553544d59d61db7d8ff87e656604178207bfba0cbcc501b3f"),
							Index:           261,
							Removed:         false,
						}, {
							Address: common.HexToAddress("0xBa13afEcda9beB75De5c56BbAF696b880a5A50dD"),
							Topics: []common.Hash{
								common.HexToHash("0x1c411e9a96e071241c2f21f7726b17ae89e3cab4c78be50e062b03a9fffbbad1"),
							},
							Data:            hexutil.MustDecode("0x00000000000000000000000000000000000000000000000b7ea598e9abdeff28000000000000000000000000000000000000000000000006f037aa702d27d27a"),
							BlockNumber:     lo.Must(new(big.Int).SetString("17739598", 0)),
							TransactionHash: common.HexToHash("0x190e674289665eb553544d59d61db7d8ff87e656604178207bfba0cbcc501b3f"),
							Index:           262,
							Removed:         false,
						}, {
							Address: common.HexToAddress("0xBa13afEcda9beB75De5c56BbAF696b880a5A50dD"),
							Topics: []common.Hash{
								common.HexToHash("0xd78ad95fa46c994b6551d0da85fc275fe613ce37657fb8d5e3d130840159d822"),
								common.HexToHash("0x0000000000000000000000001111111254fb6c44bac0bed2854e76f90643097d"),
								common.HexToHash("0x00000000000000000000000044b184a0c56f926ba3634dad905690b3438aed77"),
							},
							Data:            hexutil.MustDecode("0x00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000186cc6acd4b000000000000000000000000000000000000000000000000000002860bca514b7fda0000000000000000000000000000000000000000000000000000000000000000"),
							BlockNumber:     lo.Must(new(big.Int).SetString("17739598", 0)),
							TransactionHash: common.HexToHash("0x190e674289665eb553544d59d61db7d8ff87e656604178207bfba0cbcc501b3f"),
							Index:           263,
							Removed:         false,
						}},
						Status:           1,
						TransactionHash:  common.HexToHash("0x190e674289665eb553544d59d61db7d8ff87e656604178207bfba0cbcc501b3f"),
						TransactionIndex: 168,
					},
				},
				config: &config.Module{
					Network:  filter.NetworkEthereum,
					Endpoint: endpoint.MustGet(filter.NetworkEthereum),
				},
			},
			want: &schema.Feed{
				ID:      "0x190e674289665eb553544d59d61db7d8ff87e656604178207bfba0cbcc501b3f",
				Network: filter.NetworkEthereum,
				Index:   168,
				From:    "0x44b184A0C56F926bA3634DAD905690b3438aed77",
				To:      oneinch.AddressAggregationRouterV4.String(),
				Type:    filter.TypeExchangeSwap,
				Calldata: &schema.Calldata{
					FunctionHash: "0x2e95b6c8",
				},
				Platform: lo.ToPtr(filter.Platform1inch),
				Fee: &schema.Fee{
					Amount:  lo.Must(decimal.NewFromString("1537751745634040")),
					Decimal: 18,
				},
				Actions: []*schema.Action{
					{
						Type:     filter.TypeExchangeSwap,
						Tag:      filter.TagExchange,
						Platform: filter.Platform1inch.String(),
						From:     "0x44b184A0C56F926bA3634DAD905690b3438aed77",
						To:       "0x44b184A0C56F926bA3634DAD905690b3438aed77",
						Metadata: metadata.ExchangeSwap{
							From: metadata.Token{
								Value:    lo.ToPtr(lo.Must(decimal.NewFromString("110000000000000000"))),
								Name:     "Ethereum",
								Symbol:   "ETH",
								Decimals: 18,
							},
							To: metadata.Token{
								Address:  lo.ToPtr("0x9f8F72aA9304c8B593d555F12eF6589cC3A579A2"),
								Value:    lo.ToPtr(lo.Must(decimal.NewFromString("181845798530285530"))),
								Name:     "Maker",
								Symbol:   "MKR",
								Decimals: 18,
								Standard: metadata.StandardERC20,
							},
						},
					},
				},
				Status:    true,
				Timestamp: 1689919271,
			},
			wantError: require.NoError,
		},
		{
			name: "Swap USDT for ETH by uniswapV3Swap on AggregationRouter V4",
			arguments: arguments{
				task: &source.Task{
					Network: filter.NetworkEthereum,
					ChainID: 1,
					Header: &ethereum.Header{
						Hash:         common.HexToHash("0x4c1075b63edbe4b6223edf41dc413ce9260af2bd3f667a5304886ac8a2bd61b1"),
						ParentHash:   common.HexToHash("0x7c7224e3c7cc8e44a6b0a1114a67a2c07b55a2775bcb51b0ed8faabe08236896"),
						UncleHash:    common.HexToHash("0x1dcc4de8dec75d7aab85b567b6ccd41ad312451b948a7413f0a142fd40d49347"),
						Coinbase:     common.HexToAddress("0xDAFEA492D9c6733ae3d56b7Ed1ADB60692c98Bc5"),
						Number:       lo.Must(new(big.Int).SetString("17739217", 0)),
						GasLimit:     30000000,
						GasUsed:      12956360,
						Timestamp:    1689914675,
						BaseFee:      lo.Must(new(big.Int).SetString("19501647410", 0)),
						Transactions: nil,
					},
					Transaction: &ethereum.Transaction{
						BlockHash: common.HexToHash("0x20f1c03b46061f08111601d9fb4f31be68eaa705af0d2d846fa5abbfb657037f"),
						From:      common.HexToAddress("0x8E2511b43bf95BFd18017FD205EfD6d246526c3A"),
						Gas:       263836,
						GasPrice:  lo.Must(new(big.Int).SetString("19601647410", 10)),
						Hash:      common.HexToHash("0x20f1c03b46061f08111601d9fb4f31be68eaa705af0d2d846fa5abbfb657037f"),
						Input:     hexutil.MustDecode("0xe449022e000000000000000000000000000000000000000000000000000000004b99767f0000000000000000000000000000000000000000000000000946739c60d6050300000000000000000000000000000000000000000000000000000000000000600000000000000000000000000000000000000000000000000000000000000001a0000000000000000000000011b815efb8f581194ae79006d24e0d814b7697f6f012a792"),
						To:        lo.ToPtr(common.HexToAddress("0x1111111254fb6c44bAC0beD2854e76F90643097d")),
						Value:     lo.Must(new(big.Int).SetString("0", 0)),
						Type:      2,
						ChainID:   lo.Must(new(big.Int).SetString("1", 0)),
					},
					Receipt: &ethereum.Receipt{
						BlockHash:         common.HexToHash("0x4c1075b63edbe4b6223edf41dc413ce9260af2bd3f667a5304886ac8a2bd61b1"),
						BlockNumber:       lo.Must(new(big.Int).SetString("17739217", 0)),
						ContractAddress:   nil,
						CumulativeGasUsed: 11318533,
						EffectiveGasPrice: hexutil.MustDecodeBig("0x490596732"),
						GasUsed:           116895,

						Logs: []*ethereum.Log{{
							Address: common.HexToAddress("0xC02aaA39b223FE8D0A0e5C4F27eAD9083C756Cc2"),
							Topics: []common.Hash{
								common.HexToHash("0xddf252ad1be2c89b69c2b068fc378daa952ba7f163c4a11628f55a4df523b3ef"),
								common.HexToHash("0x00000000000000000000000011b815efb8f581194ae79006d24e0d814b7697f6"),
								common.HexToHash("0x0000000000000000000000001111111254fb6c44bac0bed2854e76f90643097d"),
							},
							Data:            hexutil.MustDecode("0x0000000000000000000000000000000000000000000000000947a19e0b0f24c9"),
							BlockNumber:     lo.Must(new(big.Int).SetString("17739217", 0)),
							TransactionHash: common.HexToHash("0x20f1c03b46061f08111601d9fb4f31be68eaa705af0d2d846fa5abbfb657037f"),
							Index:           325,
							Removed:         false,
						}, {
							Address: common.HexToAddress("0xdAC17F958D2ee523a2206206994597C13D831ec7"),
							Topics: []common.Hash{
								common.HexToHash("0xddf252ad1be2c89b69c2b068fc378daa952ba7f163c4a11628f55a4df523b3ef"),
								common.HexToHash("0x0000000000000000000000008e2511b43bf95bfd18017fd205efd6d246526c3a"),
								common.HexToHash("0x00000000000000000000000011b815efb8f581194ae79006d24e0d814b7697f6"),
							},
							Data:            hexutil.MustDecode("0x000000000000000000000000000000000000000000000000000000004b99767f"),
							BlockNumber:     lo.Must(new(big.Int).SetString("17739217", 0)),
							TransactionHash: common.HexToHash("0x20f1c03b46061f08111601d9fb4f31be68eaa705af0d2d846fa5abbfb657037f"),
							Index:           326,
							Removed:         false,
						}, {
							Address: common.HexToAddress("0x11b815efB8f581194ae79006d24E0d814B7697F6"),
							Topics: []common.Hash{
								common.HexToHash("0xc42079f94a6350d7e6235f29174924f928cc2ac818eb64fed8004e115fbcca67"),
								common.HexToHash("0x0000000000000000000000001111111254fb6c44bac0bed2854e76f90643097d"),
								common.HexToHash("0x0000000000000000000000001111111254fb6c44bac0bed2854e76f90643097d"),
							},
							Data:            hexutil.MustDecode("0xfffffffffffffffffffffffffffffffffffffffffffffffff6b85e61f4f0db37000000000000000000000000000000000000000000000000000000004b99767f00000000000000000000000000000000000000000002da80a3f3159648709257000000000000000000000000000000000000000000000000a801e6ea12474d3dfffffffffffffffffffffffffffffffffffffffffffffffffffffffffffcef71"),
							BlockNumber:     lo.Must(new(big.Int).SetString("17739217", 0)),
							TransactionHash: common.HexToHash("0x20f1c03b46061f08111601d9fb4f31be68eaa705af0d2d846fa5abbfb657037f"),
							Index:           327,
							Removed:         false,
						}, {
							Address: common.HexToAddress("0xC02aaA39b223FE8D0A0e5C4F27eAD9083C756Cc2"),
							Topics: []common.Hash{
								common.HexToHash("0x7fcf532c15f0a6db0bd6d0e038bea71d30d808c7d98cb3bf7268a95bf5081b65"),
								common.HexToHash("0x0000000000000000000000001111111254fb6c44bac0bed2854e76f90643097d"),
							},
							Data:            hexutil.MustDecode("0x0000000000000000000000000000000000000000000000000947a19e0b0f24c9"),
							BlockNumber:     lo.Must(new(big.Int).SetString("17739217", 0)),
							TransactionHash: common.HexToHash("0x20f1c03b46061f08111601d9fb4f31be68eaa705af0d2d846fa5abbfb657037f"),
							Index:           328,
							Removed:         false,
						}},
						Status:           1,
						TransactionHash:  common.HexToHash("0x20f1c03b46061f08111601d9fb4f31be68eaa705af0d2d846fa5abbfb657037f"),
						TransactionIndex: 120,
					},
				},
				config: &config.Module{
					Network:  filter.NetworkEthereum,
					Endpoint: endpoint.MustGet(filter.NetworkEthereum),
				},
			},
			want: &schema.Feed{
				ID:      "0x20f1c03b46061f08111601d9fb4f31be68eaa705af0d2d846fa5abbfb657037f",
				Network: filter.NetworkEthereum,
				Index:   120,
				From:    "0x8E2511b43bf95BFd18017FD205EfD6d246526c3A",
				To:      oneinch.AddressAggregationRouterV4.String(),
				Type:    filter.TypeExchangeSwap,
				Calldata: &schema.Calldata{
					FunctionHash: "0xe449022e",
				},
				Platform: lo.ToPtr(filter.Platform1inch),
				Fee: &schema.Fee{
					Amount:  lo.Must(decimal.NewFromString("2291334573991950")),
					Decimal: 18,
				},
				Actions: []*schema.Action{
					{
						Type:     filter.TypeExchangeSwap,
						Tag:      filter.TagExchange,
						Platform: filter.Platform1inch.String(),
						From:     "0x8E2511b43bf95BFd18017FD205EfD6d246526c3A",
						To:       "0x8E2511b43bf95BFd18017FD205EfD6d246526c3A",
						Metadata: metadata.ExchangeSwap{
							From: metadata.Token{
								Address:  lo.ToPtr("0xdAC17F958D2ee523a2206206994597C13D831ec7"),
								Value:    lo.ToPtr(lo.Must(decimal.NewFromString("1268348543"))),
								Name:     "Tether USD",
								Symbol:   "USDT",
								Decimals: 6,
								Standard: metadata.StandardERC20,
							},
							To: metadata.Token{
								Value:    lo.ToPtr(lo.Must(decimal.NewFromString("668680769850254537"))),
								Name:     "Ethereum",
								Symbol:   "ETH",
								Decimals: 18,
							},
						},
					},
				},
				Status:    true,
				Timestamp: 1689914675,
			},
			wantError: require.NoError,
		},
		{
			name: "Swap WETH for ETH by swap on AggregationRouterV5",
			arguments: arguments{
				task: &source.Task{
					Network: filter.NetworkEthereum,
					ChainID: 1,
					Header: &ethereum.Header{
						Hash:         common.HexToHash("0xa538dbb419e51f3f6ae6561106f381136539c5bc0aa92765752432a840234ab1"),
						ParentHash:   common.HexToHash("0xa1623bdd32fcdbc9945cb3700c6548bb6ef623055861cd7b8e39a445910cc1f2"),
						UncleHash:    common.HexToHash("0x1dcc4de8dec75d7aab85b567b6ccd41ad312451b948a7413f0a142fd40d49347"),
						Coinbase:     common.HexToAddress("0x388C818CA8B9251b393131C08a736A67ccB19297"),
						Number:       lo.Must(new(big.Int).SetString("17376284", 0)),
						GasLimit:     30000000,
						GasUsed:      12361845,
						Timestamp:    1685504843,
						BaseFee:      lo.Must(new(big.Int).SetString("26922448266", 0)),
						Transactions: nil,
					},
					Transaction: &ethereum.Transaction{
						BlockHash: common.HexToHash("0xad01bd6113ec89138c8cd64d0730fb201df5fc987463b1f33173481daad95c68"),
						From:      common.HexToAddress("0x0874D10C8f7C40B45c91d0A8965987653383b697"),
						Gas:       119321,
						GasPrice:  lo.Must(new(big.Int).SetString("33899286749", 10)),
						Hash:      common.HexToHash("0xad01bd6113ec89138c8cd64d0730fb201df5fc987463b1f33173481daad95c68"),
						Input:     hexutil.MustDecode("0x12aa3caf0000000000000000000000001136b25047e142fa3018184793aec68fbb173ce4000000000000000000000000c02aaa39b223fe8d0a0e5c4f27ead9083c756cc2000000000000000000000000eeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeee0000000000000000000000001136b25047e142fa3018184793aec68fbb173ce4000000000000000000000000fccc1d9c2732a7966de960cea897f8be2337e6ad000000000000000000000000000000000000000000000002df85d331a7b40000000000000000000000000000000000000000000000000002dbd85b19163980000000000000000000000000000000000000000000000000000000000000000004000000000000000000000000000000000000000000000000000000000000014000000000000000000000000000000000000000000000000000000000000001600000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000008000000000000000000000000000000000000000000000000000006200003c4121c02aaa39b223fe8d0a0e5c4f27ead9083c756cc200042e1a7d4d0000000000000000000000000000000000000000000000000000000000000000e0211111111254eeb25477b68fb85ed929f73a9605820000000000000002df85d331a7b40000e26b9977"),
						To:        lo.ToPtr(common.HexToAddress("0x1111111254EEB25477B68fb85Ed929f73A960582")),
						Value:     lo.Must(new(big.Int).SetString("0", 0)),
						Type:      0,
						ChainID:   lo.Must(new(big.Int).SetString("1", 0)),
					},
					Receipt: &ethereum.Receipt{
						BlockHash:         common.HexToHash("0xa538dbb419e51f3f6ae6561106f381136539c5bc0aa92765752432a840234ab1"),
						BlockNumber:       lo.Must(new(big.Int).SetString("17376284", 0)),
						ContractAddress:   nil,
						CumulativeGasUsed: 2406973,
						EffectiveGasPrice: hexutil.MustDecodeBig("0x7e48e10dd"),
						GasUsed:           98922,

						Logs: []*ethereum.Log{{
							Address: common.HexToAddress("0xC02aaA39b223FE8D0A0e5C4F27eAD9083C756Cc2"),
							Topics: []common.Hash{
								common.HexToHash("0xddf252ad1be2c89b69c2b068fc378daa952ba7f163c4a11628f55a4df523b3ef"),
								common.HexToHash("0x0000000000000000000000000874d10c8f7c40b45c91d0a8965987653383b697"),
								common.HexToHash("0x0000000000000000000000001136b25047e142fa3018184793aec68fbb173ce4"),
							},
							Data:            hexutil.MustDecode("0x000000000000000000000000000000000000000000000002df85d331a7b40000"),
							BlockNumber:     lo.Must(new(big.Int).SetString("17376284", 0)),
							TransactionHash: common.HexToHash("0xad01bd6113ec89138c8cd64d0730fb201df5fc987463b1f33173481daad95c68"),
							Index:           86,
							Removed:         false,
						}, {
							Address: common.HexToAddress("0xC02aaA39b223FE8D0A0e5C4F27eAD9083C756Cc2"),
							Topics: []common.Hash{
								common.HexToHash("0x7fcf532c15f0a6db0bd6d0e038bea71d30d808c7d98cb3bf7268a95bf5081b65"),
								common.HexToHash("0x0000000000000000000000001136b25047e142fa3018184793aec68fbb173ce4"),
							},
							Data:            hexutil.MustDecode("0x000000000000000000000000000000000000000000000002df85d331a7b40000"),
							BlockNumber:     lo.Must(new(big.Int).SetString("17376284", 0)),
							TransactionHash: common.HexToHash("0xad01bd6113ec89138c8cd64d0730fb201df5fc987463b1f33173481daad95c68"),
							Index:           87,
							Removed:         false,
						}},
						Status:           1,
						TransactionHash:  common.HexToHash("0xad01bd6113ec89138c8cd64d0730fb201df5fc987463b1f33173481daad95c68"),
						TransactionIndex: 16,
					},
				},
				config: &config.Module{
					Network:  filter.NetworkEthereum,
					Endpoint: endpoint.MustGet(filter.NetworkEthereum),
				},
			},
			want: &schema.Feed{
				ID:      "0xad01bd6113ec89138c8cd64d0730fb201df5fc987463b1f33173481daad95c68",
				Network: filter.NetworkEthereum,
				Index:   16,
				From:    "0x0874D10C8f7C40B45c91d0A8965987653383b697",
				To:      oneinch.AddressAggregationRouterV5.String(),
				Type:    filter.TypeExchangeSwap,
				Calldata: &schema.Calldata{
					FunctionHash: "0x12aa3caf",
				},
				Platform: lo.ToPtr(filter.Platform1inch),
				Fee: &schema.Fee{
					Amount:  lo.Must(decimal.NewFromString("3353385243784578")),
					Decimal: 18,
				},
				Actions: []*schema.Action{
					{
						Type:     filter.TypeExchangeSwap,
						Tag:      filter.TagExchange,
						Platform: filter.Platform1inch.String(),
						From:     "0x0874D10C8f7C40B45c91d0A8965987653383b697",
						To:       "0xfccc1d9C2732A7966DE960cEA897f8Be2337E6Ad",
						Metadata: metadata.ExchangeSwap{
							From: metadata.Token{
								Address:  lo.ToPtr("0xC02aaA39b223FE8D0A0e5C4F27eAD9083C756Cc2"),
								Value:    lo.ToPtr(lo.Must(decimal.NewFromString("53000000000000000000"))),
								Name:     "Wrapped Ether",
								Symbol:   "WETH",
								Decimals: 18,
								Standard: metadata.StandardERC20,
							},
							To: metadata.Token{
								Value:    lo.ToPtr(lo.Must(decimal.NewFromString("53000000000000000000"))),
								Name:     "Ethereum",
								Symbol:   "ETH",
								Decimals: 18,
							},
						},
					},
				},
				Status:    true,
				Timestamp: 1685504843,
			},
			wantError: require.NoError,
		},
		{
			name: "Swap ETH for USDT by unoswap on AggregationRouter V5",
			arguments: arguments{
				task: &source.Task{
					Network: filter.NetworkEthereum,
					ChainID: 1,
					Header: &ethereum.Header{
						Hash:         common.HexToHash("0xb28256036f9a6b8155459e72e14d02d5c55a3044552d0156e620b812e611ea18"),
						ParentHash:   common.HexToHash("0x2a6ab720573359d61b50c0d8d108bf45b3260220dc45f8d5efacdf30ce020c37"),
						UncleHash:    common.HexToHash("0x1dcc4de8dec75d7aab85b567b6ccd41ad312451b948a7413f0a142fd40d49347"),
						Coinbase:     common.HexToAddress("0xbd3Afb0bB76683eCb4225F9DBc91f998713C3b01"),
						Number:       lo.Must(new(big.Int).SetString("17739729", 0)),
						GasLimit:     30000000,
						GasUsed:      17722343,
						Timestamp:    1689920879,
						BaseFee:      lo.Must(new(big.Int).SetString("17585941001", 0)),
						Transactions: nil,
					},
					Transaction: &ethereum.Transaction{
						BlockHash: common.HexToHash("0xf86953fa953fe8d8762d58b3126946a6c5460f63cea5db9fbef0fa6175660f14"),
						From:      common.HexToAddress("0x552C8368088541bE1Bf8D4323dc3F73C18D02551"),
						Gas:       163512,
						GasPrice:  lo.Must(new(big.Int).SetString("18335941001", 10)),
						Hash:      common.HexToHash("0xf86953fa953fe8d8762d58b3126946a6c5460f63cea5db9fbef0fa6175660f14"),
						Input:     hexutil.MustDecode("0x0502b1c5000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000006f05b59d3b2000000000000000000000000000000000000000000000000000000000000382421910000000000000000000000000000000000000000000000000000000000000080000000000000000000000000000000000000000000000000000000000000000100000000000000003b6d03400d4a11d5eeaac28ec3f61d100daf4d40471f1852e26b9977"),
						To:        lo.ToPtr(common.HexToAddress("0x1111111254EEB25477B68fb85Ed929f73A960582")),
						Value:     lo.Must(new(big.Int).SetString("500000000000000000", 0)),
						Type:      2,
						ChainID:   lo.Must(new(big.Int).SetString("1", 0)),
					},
					Receipt: &ethereum.Receipt{
						BlockHash:         common.HexToHash("0xb28256036f9a6b8155459e72e14d02d5c55a3044552d0156e620b812e611ea18"),
						BlockNumber:       lo.Must(new(big.Int).SetString("17739729", 0)),
						ContractAddress:   nil,
						CumulativeGasUsed: 4541995,
						EffectiveGasPrice: hexutil.MustDecodeBig("0x444e84189"),
						GasUsed:           124726,

						Logs: []*ethereum.Log{{
							Address: common.HexToAddress("0xC02aaA39b223FE8D0A0e5C4F27eAD9083C756Cc2"),
							Topics: []common.Hash{
								common.HexToHash("0xe1fffcc4923d04b559f4d29a8bfc6cda04eb5b0d3c460751c2402c5c5cc9109c"),
								common.HexToHash("0x0000000000000000000000001111111254eeb25477b68fb85ed929f73a960582"),
							},
							Data:            hexutil.MustDecode("0x00000000000000000000000000000000000000000000000006f05b59d3b20000"),
							BlockNumber:     lo.Must(new(big.Int).SetString("17739729", 0)),
							TransactionHash: common.HexToHash("0xf86953fa953fe8d8762d58b3126946a6c5460f63cea5db9fbef0fa6175660f14"),
							Index:           175,
							Removed:         false,
						}, {
							Address: common.HexToAddress("0xC02aaA39b223FE8D0A0e5C4F27eAD9083C756Cc2"),
							Topics: []common.Hash{
								common.HexToHash("0xddf252ad1be2c89b69c2b068fc378daa952ba7f163c4a11628f55a4df523b3ef"),
								common.HexToHash("0x0000000000000000000000001111111254eeb25477b68fb85ed929f73a960582"),
								common.HexToHash("0x0000000000000000000000000d4a11d5eeaac28ec3f61d100daf4d40471f1852"),
							},
							Data:            hexutil.MustDecode("0x00000000000000000000000000000000000000000000000006f05b59d3b20000"),
							BlockNumber:     lo.Must(new(big.Int).SetString("17739729", 0)),
							TransactionHash: common.HexToHash("0xf86953fa953fe8d8762d58b3126946a6c5460f63cea5db9fbef0fa6175660f14"),
							Index:           176,
							Removed:         false,
						}, {
							Address: common.HexToAddress("0xdAC17F958D2ee523a2206206994597C13D831ec7"),
							Topics: []common.Hash{
								common.HexToHash("0xddf252ad1be2c89b69c2b068fc378daa952ba7f163c4a11628f55a4df523b3ef"),
								common.HexToHash("0x0000000000000000000000000d4a11d5eeaac28ec3f61d100daf4d40471f1852"),
								common.HexToHash("0x000000000000000000000000552c8368088541be1bf8d4323dc3f73c18d02551"),
							},
							Data:            hexutil.MustDecode("0x00000000000000000000000000000000000000000000000000000000386c5a57"),
							BlockNumber:     lo.Must(new(big.Int).SetString("17739729", 0)),
							TransactionHash: common.HexToHash("0xf86953fa953fe8d8762d58b3126946a6c5460f63cea5db9fbef0fa6175660f14"),
							Index:           177,
							Removed:         false,
						}, {
							Address: common.HexToAddress("0x0d4a11d5EEaaC28EC3F61d100daF4d40471f1852"),
							Topics: []common.Hash{
								common.HexToHash("0x1c411e9a96e071241c2f21f7726b17ae89e3cab4c78be50e062b03a9fffbbad1"),
							},
							Data:            hexutil.MustDecode("0x00000000000000000000000000000000000000000000034d7d85a29c629f773d00000000000000000000000000000000000000000000000000001aef86cdbb1a"),
							BlockNumber:     lo.Must(new(big.Int).SetString("17739729", 0)),
							TransactionHash: common.HexToHash("0xf86953fa953fe8d8762d58b3126946a6c5460f63cea5db9fbef0fa6175660f14"),
							Index:           178,
							Removed:         false,
						}, {
							Address: common.HexToAddress("0x0d4a11d5EEaaC28EC3F61d100daF4d40471f1852"),
							Topics: []common.Hash{
								common.HexToHash("0xd78ad95fa46c994b6551d0da85fc275fe613ce37657fb8d5e3d130840159d822"),
								common.HexToHash("0x0000000000000000000000001111111254eeb25477b68fb85ed929f73a960582"),
								common.HexToHash("0x000000000000000000000000552c8368088541be1bf8d4323dc3f73c18d02551"),
							},
							Data:            hexutil.MustDecode("0x00000000000000000000000000000000000000000000000006f05b59d3b200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000386c5a57"),
							BlockNumber:     lo.Must(new(big.Int).SetString("17739729", 0)),
							TransactionHash: common.HexToHash("0xf86953fa953fe8d8762d58b3126946a6c5460f63cea5db9fbef0fa6175660f14"),
							Index:           179,
							Removed:         false,
						}},
						Status:           1,
						TransactionHash:  common.HexToHash("0xf86953fa953fe8d8762d58b3126946a6c5460f63cea5db9fbef0fa6175660f14"),
						TransactionIndex: 46,
					},
				},
				config: &config.Module{
					Network:  filter.NetworkEthereum,
					Endpoint: endpoint.MustGet(filter.NetworkEthereum),
				},
			},
			want: &schema.Feed{
				ID:      "0xf86953fa953fe8d8762d58b3126946a6c5460f63cea5db9fbef0fa6175660f14",
				Network: filter.NetworkEthereum,
				Index:   46,
				From:    "0x552C8368088541bE1Bf8D4323dc3F73C18D02551",
				To:      oneinch.AddressAggregationRouterV5.String(),
				Type:    filter.TypeExchangeSwap,
				Calldata: &schema.Calldata{
					FunctionHash: "0x0502b1c5",
				},
				Platform: lo.ToPtr(filter.Platform1inch),
				Fee: &schema.Fee{
					Amount:  lo.Must(decimal.NewFromString("2286968577290726")),
					Decimal: 18,
				},
				Actions: []*schema.Action{
					{
						Type:     filter.TypeExchangeSwap,
						Tag:      filter.TagExchange,
						Platform: filter.Platform1inch.String(),
						From:     "0x552C8368088541bE1Bf8D4323dc3F73C18D02551",
						To:       "0x552C8368088541bE1Bf8D4323dc3F73C18D02551",
						Metadata: metadata.ExchangeSwap{
							From: metadata.Token{
								Value:    lo.ToPtr(lo.Must(decimal.NewFromString("500000000000000000"))),
								Name:     "Ethereum",
								Symbol:   "ETH",
								Decimals: 18,
							},
							To: metadata.Token{
								Address:  lo.ToPtr("0xdAC17F958D2ee523a2206206994597C13D831ec7"),
								Value:    lo.ToPtr(lo.Must(decimal.NewFromString("946625111"))),
								Name:     "Tether USD",
								Symbol:   "USDT",
								Decimals: 6,
								Standard: metadata.StandardERC20,
							},
						},
					},
				},
				Status:    true,
				Timestamp: 1689920879,
			},
			wantError: require.NoError,
		},
		{
			name: "Swap ETH for USDC by uniswapV3Swap on AggregationRouter V5",
			arguments: arguments{
				task: &source.Task{
					Network: filter.NetworkEthereum,
					ChainID: 1,
					Header: &ethereum.Header{
						Hash:         common.HexToHash("0x706e44bc1d155170165e3733f79c62695182fac5770b90f17365f7024664560b"),
						ParentHash:   common.HexToHash("0x777ee9b29c036885bcdeeb4f38d1ce3dea8ffa0461f1764425575e6a9bb53674"),
						UncleHash:    common.HexToHash("0x1dcc4de8dec75d7aab85b567b6ccd41ad312451b948a7413f0a142fd40d49347"),
						Coinbase:     common.HexToAddress("0xDAFEA492D9c6733ae3d56b7Ed1ADB60692c98Bc5"),
						Number:       lo.Must(new(big.Int).SetString("17739734", 0)),
						GasLimit:     30000000,
						GasUsed:      13107153,
						Timestamp:    1689920939,
						BaseFee:      lo.Must(new(big.Int).SetString("17765947753", 0)),
						Transactions: nil,
					},
					Transaction: &ethereum.Transaction{
						BlockHash: common.HexToHash("0x5c2b5af33c383842f8f4b7cc65aca7cbddadd4815cf852ebdb1e84ac68805738"),
						From:      common.HexToAddress("0xB63F5Ff16296C57d3aa2340368B73b498E089BF8"),
						Gas:       273150,
						GasPrice:  lo.Must(new(big.Int).SetString("23000000000", 10)),
						Hash:      common.HexToHash("0x5c2b5af33c383842f8f4b7cc65aca7cbddadd4815cf852ebdb1e84ac68805738"),
						Input:     hexutil.MustDecode("0xe449022e00000000000000000000000000000000000000000000000006f05b59d3b20000000000000000000000000000000000000000000000000000000000003856e1c600000000000000000000000000000000000000000000000000000000000000600000000000000000000000000000000000000000000000000000000000000001c0000000000000000000000088e6a0c2ddd26feeb64f039a2c41296fcb3f56401f2c2fdf5257"),
						To:        lo.ToPtr(common.HexToAddress("0x1111111254EEB25477B68fb85Ed929f73A960582")),
						Value:     lo.Must(new(big.Int).SetString("500000000000000000", 0)),
						Type:      2,
						ChainID:   lo.Must(new(big.Int).SetString("1", 0)),
					},
					Receipt: &ethereum.Receipt{
						BlockHash:         common.HexToHash("0x706e44bc1d155170165e3733f79c62695182fac5770b90f17365f7024664560b"),
						BlockNumber:       lo.Must(new(big.Int).SetString("17739734", 0)),
						ContractAddress:   nil,
						CumulativeGasUsed: 1649294,
						EffectiveGasPrice: hexutil.MustDecodeBig("0x55ae82600"),
						GasUsed:           130706,

						Logs: []*ethereum.Log{{
							Address: common.HexToAddress("0xC02aaA39b223FE8D0A0e5C4F27eAD9083C756Cc2"),
							Topics: []common.Hash{
								common.HexToHash("0xe1fffcc4923d04b559f4d29a8bfc6cda04eb5b0d3c460751c2402c5c5cc9109c"),
								common.HexToHash("0x0000000000000000000000001111111254eeb25477b68fb85ed929f73a960582"),
							},
							Data:            hexutil.MustDecode("0x00000000000000000000000000000000000000000000000006f05b59d3b20000"),
							BlockNumber:     lo.Must(new(big.Int).SetString("17739734", 0)),
							TransactionHash: common.HexToHash("0x5c2b5af33c383842f8f4b7cc65aca7cbddadd4815cf852ebdb1e84ac68805738"),
							Index:           48,
							Removed:         false,
						}, {
							Address: common.HexToAddress("0xA0b86991c6218b36c1d19D4a2e9Eb0cE3606eB48"),
							Topics: []common.Hash{
								common.HexToHash("0xddf252ad1be2c89b69c2b068fc378daa952ba7f163c4a11628f55a4df523b3ef"),
								common.HexToHash("0x00000000000000000000000088e6a0c2ddd26feeb64f039a2c41296fcb3f5640"),
								common.HexToHash("0x000000000000000000000000b63f5ff16296c57d3aa2340368b73b498e089bf8"),
							},
							Data:            hexutil.MustDecode("0x000000000000000000000000000000000000000000000000000000003865bc18"),
							BlockNumber:     lo.Must(new(big.Int).SetString("17739734", 0)),
							TransactionHash: common.HexToHash("0x5c2b5af33c383842f8f4b7cc65aca7cbddadd4815cf852ebdb1e84ac68805738"),
							Index:           49,
							Removed:         false,
						}, {
							Address: common.HexToAddress("0xC02aaA39b223FE8D0A0e5C4F27eAD9083C756Cc2"),
							Topics: []common.Hash{
								common.HexToHash("0xddf252ad1be2c89b69c2b068fc378daa952ba7f163c4a11628f55a4df523b3ef"),
								common.HexToHash("0x0000000000000000000000001111111254eeb25477b68fb85ed929f73a960582"),
								common.HexToHash("0x00000000000000000000000088e6a0c2ddd26feeb64f039a2c41296fcb3f5640"),
							},
							Data:            hexutil.MustDecode("0x00000000000000000000000000000000000000000000000006f05b59d3b20000"),
							BlockNumber:     lo.Must(new(big.Int).SetString("17739734", 0)),
							TransactionHash: common.HexToHash("0x5c2b5af33c383842f8f4b7cc65aca7cbddadd4815cf852ebdb1e84ac68805738"),
							Index:           50,
							Removed:         false,
						}, {
							Address: common.HexToAddress("0x88e6A0c2dDD26FEEb64F039a2c41296FcB3f5640"),
							Topics: []common.Hash{
								common.HexToHash("0xc42079f94a6350d7e6235f29174924f928cc2ac818eb64fed8004e115fbcca67"),
								common.HexToHash("0x0000000000000000000000001111111254eeb25477b68fb85ed929f73a960582"),
								common.HexToHash("0x000000000000000000000000b63f5ff16296c57d3aa2340368b73b498e089bf8"),
							},
							Data:            hexutil.MustDecode("0xffffffffffffffffffffffffffffffffffffffffffffffffffffffffc79a43e800000000000000000000000000000000000000000000000006f05b59d3b2000000000000000000000000000000000000000059c5f4fd99879efa3fd23f65b27f00000000000000000000000000000000000000000000000289593fc0815fb423000000000000000000000000000000000000000000000000000000000003109b"),
							BlockNumber:     lo.Must(new(big.Int).SetString("17739734", 0)),
							TransactionHash: common.HexToHash("0x5c2b5af33c383842f8f4b7cc65aca7cbddadd4815cf852ebdb1e84ac68805738"),
							Index:           51,
							Removed:         false,
						}},
						Status:           1,
						TransactionHash:  common.HexToHash("0x5c2b5af33c383842f8f4b7cc65aca7cbddadd4815cf852ebdb1e84ac68805738"),
						TransactionIndex: 11,
					},
				},
				config: &config.Module{
					Network:  filter.NetworkEthereum,
					Endpoint: endpoint.MustGet(filter.NetworkEthereum),
				},
			},
			want: &schema.Feed{
				ID:      "0x5c2b5af33c383842f8f4b7cc65aca7cbddadd4815cf852ebdb1e84ac68805738",
				Network: filter.NetworkEthereum,
				Index:   11,
				From:    "0xB63F5Ff16296C57d3aa2340368B73b498E089BF8",
				To:      oneinch.AddressAggregationRouterV5.String(),
				Type:    filter.TypeExchangeSwap,
				Calldata: &schema.Calldata{
					FunctionHash: "0xe449022e",
				},
				Platform: lo.ToPtr(filter.Platform1inch),
				Fee: &schema.Fee{
					Amount:  lo.Must(decimal.NewFromString("3006238000000000")),
					Decimal: 18,
				},
				Actions: []*schema.Action{
					{
						Type:     filter.TypeExchangeSwap,
						Tag:      filter.TagExchange,
						Platform: filter.Platform1inch.String(),
						From:     "0xB63F5Ff16296C57d3aa2340368B73b498E089BF8",
						To:       "0xB63F5Ff16296C57d3aa2340368B73b498E089BF8",
						Metadata: metadata.ExchangeSwap{
							From: metadata.Token{
								Value:    lo.ToPtr(lo.Must(decimal.NewFromString("500000000000000000"))),
								Name:     "Ethereum",
								Symbol:   "ETH",
								Decimals: 18,
							},
							To: metadata.Token{
								Address:  lo.ToPtr("0xA0b86991c6218b36c1d19D4a2e9Eb0cE3606eB48"),
								Value:    lo.ToPtr(lo.Must(decimal.NewFromString("946191384"))),
								Name:     "USD Coin",
								Symbol:   "USDC",
								Decimals: 6,
								Standard: metadata.StandardERC20,
							},
						},
					},
				},
				Status:    true,
				Timestamp: 1689920939,
			},
			wantError: require.NoError,
		},
	}

	for _, testcase := range testcases {
		testcase := testcase

		t.Run(testcase.name, func(t *testing.T) {
			t.Parallel()

			ctx := context.Background()

			instance, err := worker.NewWorker(testcase.arguments.config)
			require.NoError(t, err)

			matched, err := instance.Match(ctx, testcase.arguments.task)
			testcase.wantError(t, err)
			require.True(t, matched)

			feed, err := instance.Transform(ctx, testcase.arguments.task)
			testcase.wantError(t, err)
			//t.Log(string(lo.Must(json.MarshalIndent(feed, "", "\x20\x20"))))
			//t.Log(string(lo.Must(json.MarshalIndent(testcase.want, "", "\x20\x20"))))
			require.Equal(t, testcase.want, feed)
			//require.Equal(t, string(lo.Must(json.MarshalIndent(feed, "", "\x20\x20"))), string(lo.Must(json.MarshalIndent(testcase.want, "", "\x20\x20"))))

			t.Log(feed)
		})
	}
}
